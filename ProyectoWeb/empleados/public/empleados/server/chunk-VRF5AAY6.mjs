import './polyfills.server.mjs';
import{$ as Y,A as Et,Aa as UR,B as Pt,Ba as Na,C as Ie,Ca as gf,D as G,Da as qR,E as uo,F as _i,G as Vn,Ga as zR,H as Mt,I as St,J as Yc,K as OR,Ka as GR,L as xR,La as jR,M as Ra,N as dv,Na as WR,O as Xc,Oa as mf,P as ho,Pa as Cv,Q as Wi,R as We,S as te,T as Jc,U as Un,V as Tn,W as Hi,X as PR,Y as cr,Z as fv,_ as Q,a as Rr,aa as mn,b as TR,ba as MR,c as Da,ca as en,d as bR,da as Zc,e as ji,ea as se,f as lo,fa as Or,g as Nr,ga as FR,h as wn,ha as pv,i as ke,ia as gv,j as IR,ja as mv,k as Kc,ka as xr,l as Qc,la as yv,m as hf,ma as _v,n as AR,na as LR,o as df,p as co,pa as BR,q as DR,r as uv,s as RR,t as ff,u as yi,ua as vv,v as hv,va as VR,w as NR,x as kR,xa as Ev,y as pf,ya as Sv,z as kr}from"./chunk-YL73UZOC.mjs";import{A as e1,B as X,C as yn,D as yt,E as Av,F as t1,G as nu,H as de,I as bn,J as Cf,K as Dv,L as zn,M as Ki,N as fo,O as wf,P as Tf,Q as ru,R as bf,S as tn,T as Q3,U as zt,a as O,b as ka,c as yf,d as HR,e as $R,f as wv,g as Ct,h as _f,i as eu,j as Tv,k as KR,l as Pr,m as bv,n as vf,o as QR,p as YR,q as Ef,r as ut,s as XR,t as JR,u as qn,v as $i,w as Sf,x as tu,y as Iv,z as ZR}from"./chunk-ORXK4VE6.mjs";import{a as mt,b as Bn,c as z,f as v,h as uf,i as cv,j as m}from"./chunk-72IGY6O2.mjs";var ve=v(Wn=>{"use strict";Object.defineProperty(Wn,"__esModule",{value:!0});Wn.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=Wn.DEFAULT_MAX_SEND_MESSAGE_LENGTH=Wn.Propagate=Wn.LogVerbosity=Wn.Status=void 0;var rk=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(rk||(Wn.Status=rk={})),ik=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(ik||(Wn.LogVerbosity=ik={})),sk=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}(sk||(Wn.Propagate=sk={}));Wn.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;Wn.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var LE=v((Rae,OG)=>{OG.exports={name:"@grpc/grpc-js",version:"1.9.14",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var Ze=v(rn=>{"use strict";var BE,VE,UE,qE;Object.defineProperty(rn,"__esModule",{value:!0});rn.isTracerEnabled=rn.trace=rn.log=rn.setLoggerVerbosity=rn.setLogger=rn.getLogger=void 0;var Ji=ve(),xG=z("process"),PG=LE().version,MG={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},So=MG,Wa=Ji.LogVerbosity.ERROR,FG=(VE=(BE=process.env.GRPC_NODE_VERBOSITY)!==null&&BE!==void 0?BE:process.env.GRPC_VERBOSITY)!==null&&VE!==void 0?VE:"";switch(FG.toUpperCase()){case"DEBUG":Wa=Ji.LogVerbosity.DEBUG;break;case"INFO":Wa=Ji.LogVerbosity.INFO;break;case"ERROR":Wa=Ji.LogVerbosity.ERROR;break;case"NONE":Wa=Ji.LogVerbosity.NONE;break;default:}var LG=()=>So;rn.getLogger=LG;var BG=n=>{So=n};rn.setLogger=BG;var VG=n=>{Wa=n};rn.setLoggerVerbosity=VG;var UG=(n,...e)=>{let t;if(n>=Wa){switch(n){case Ji.LogVerbosity.DEBUG:t=So.debug;break;case Ji.LogVerbosity.INFO:t=So.info;break;case Ji.LogVerbosity.ERROR:t=So.error;break}t||(t=So.error),t&&t.bind(So)(...e)}};rn.log=UG;var qG=(qE=(UE=process.env.GRPC_NODE_TRACE)!==null&&UE!==void 0?UE:process.env.GRPC_TRACE)!==null&&qE!==void 0?qE:"",zE=new Set,ok=new Set;for(let n of qG.split(","))n.startsWith("-")?ok.add(n.substring(1)):zE.add(n);var zG=zE.has("all");function GG(n,e,t){ak(e)&&(0,rn.log)(n,new Date().toISOString()+" | v"+PG+" "+xG.pid+" | "+e+" | "+t)}rn.trace=GG;function ak(n){return!ok.has(n)&&(zG||zE.has(n))}rn.isTracerEnabled=ak});var Ep=v(Ha=>{"use strict";Object.defineProperty(Ha,"__esModule",{value:!0});Ha.getErrorCode=Ha.getErrorMessage=void 0;function jG(n){return n instanceof Error?n.message:String(n)}Ha.getErrorMessage=jG;function WG(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}Ha.getErrorCode=WG});var sn=v(Cp=>{"use strict";Object.defineProperty(Cp,"__esModule",{value:!0});Cp.Metadata=void 0;var HG=Ze(),$G=ve(),KG=Ep(),QG=/^[0-9a-z_.-]+$/,YG=/^[ -~]*$/;function XG(n){return QG.test(n)}function JG(n){return YG.test(n)}function ck(n){return n.endsWith("-bin")}function ZG(n){return!n.startsWith("grpc-")}function Sp(n){return n.toLowerCase()}function lk(n,e){if(!XG(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(ck(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!JG(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var GE=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=Sp(e),lk(e,t),this.internalRepr.set(e,[t])}add(e,t){e=Sp(e),lk(e,t);let r=this.internalRepr.get(e);r===void 0?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=Sp(e),this.internalRepr.delete(e)}get(e){return e=Sp(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let i=r[0];e[t]=Buffer.isBuffer(i)?Buffer.from(i):i}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[r,i]of this.internalRepr){let s=i.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(r,s)}return e}merge(e){for(let[t,r]of e.internalRepr){let i=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,i)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(ej);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new n;for(let r of Object.keys(e)){if(r.charAt(0)===":")continue;let i=e[r];try{ck(r)?Array.isArray(i)?i.forEach(s=>{t.add(r,Buffer.from(s,"base64"))}):i!==void 0&&(ZG(r)?i.split(",").forEach(s=>{t.add(r,Buffer.from(s.trim(),"base64"))}):t.add(r,Buffer.from(i,"base64"))):Array.isArray(i)?i.forEach(s=>{t.add(r,s)}):i!==void 0&&t.add(r,i)}catch(s){let o=`Failed to add metadata entry ${r}: ${i}. ${(0,KG.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,HG.log)($G.LogVerbosity.ERROR,o)}}return t}};Cp.Metadata=GE;var ej=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var KE=v(wp=>{"use strict";Object.defineProperty(wp,"__esModule",{value:!0});wp.CallCredentials=void 0;var $E=sn();function tj(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var $a=class n{static createFromMetadataGenerator(e){return new WE(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,r)=>{let i;tj(e)?i=e.getRequestHeaders(t.service_url):i=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,l)=>{if(a){o(a);return}if(!l){o(new Error("Headers not set by metadata plugin"));return}s(l)})}),i.then(s=>{let o=new $E.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);r(null,o)},s=>{r(s)})})}static createEmpty(){return new HE}};wp.CallCredentials=$a;var jE=class n extends $a{constructor(e){super(),this.creds=e}generateMetadata(e){return m(this,null,function*(){let t=new $E.Metadata,r=yield Promise.all(this.creds.map(i=>i.generateMetadata(e)));for(let i of r)t.merge(i);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,r)=>t._equals(e.creds[r])):!1}},WE=class n extends $a{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(i,s)=>{s!==void 0?t(s):r(i)})})}compose(e){return new jE([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},HE=class n extends $a{generateMetadata(e){return Promise.resolve(new $E.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var YE=v(Ka=>{"use strict";Object.defineProperty(Ka,"__esModule",{value:!0});Ka.getDefaultRootsData=Ka.CIPHER_SUITES=void 0;var nj=z("fs");Ka.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var uk=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,QE=null;function rj(){return uk?(QE===null&&(QE=nj.readFileSync(uk)),QE):null}Ka.getDefaultRootsData=rj});var Ip=v(bp=>{"use strict";Object.defineProperty(bp,"__esModule",{value:!0});bp.ChannelCredentials=void 0;var ij=z("tls"),sj=KE(),hk=YE();function XE(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var Qa=class{constructor(e){this.callCredentials=e||sj.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var s;if(XE(e,"Root certificate"),XE(t,"Private key"),XE(r,"Certificate chain"),t&&!r)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,ij.createSecureContext)({ca:(s=e??(0,hk.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:r??void 0,ciphers:hk.CIPHER_SUITES});return new Tp(o,i??{})}static createFromSecureContext(e,t){return new Tp(e,t??{})}static createInsecure(){return new JE}};bp.ChannelCredentials=Qa;var JE=class n extends Qa{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},Tp=class n extends Qa{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new ZE(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},ZE=class n extends Qa{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var es=v(Wt=>{"use strict";Object.defineProperty(Wt,"__esModule",{value:!0});Wt.validateLoadBalancingConfig=Wt.getFirstUsableConfig=Wt.isLoadBalancerNameRegistered=Wt.createLoadBalancer=Wt.registerDefaultLoadBalancerType=Wt.registerLoadBalancerType=Wt.createChildChannelControlHelper=void 0;function oj(n,e){var t,r,i,s,o,a,l,c,u,h;return{createSubchannel:(r=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&r!==void 0?r:n.createSubchannel.bind(n),updateState:(s=(i=e.updateState)===null||i===void 0?void 0:i.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(h=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&h!==void 0?h:n.removeChannelzChild.bind(n)}}Wt.createChildChannelControlHelper=oj;var Zi={},eS=null;function aj(n,e,t){Zi[n]={LoadBalancer:e,LoadBalancingConfig:t}}Wt.registerLoadBalancerType=aj;function lj(n){eS=n}Wt.registerDefaultLoadBalancerType=lj;function cj(n,e){let t=n.getLoadBalancerName();return t in Zi?new Zi[t].LoadBalancer(e):null}Wt.createLoadBalancer=cj;function uj(n){return n in Zi}Wt.isLoadBalancerNameRegistered=uj;function hj(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in Zi)return t;return e&&eS?new Zi[eS].LoadBalancingConfig:null}Wt.getFirstUsableConfig=hj;function dj(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in Zi)return Zi[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}Wt.validateLoadBalancingConfig=dj});var tS=v(ts=>{"use strict";Object.defineProperty(ts,"__esModule",{value:!0});ts.extractAndSelectServiceConfig=ts.validateServiceConfig=ts.validateRetryThrottling=void 0;var fj=z("os"),Ap=ve(),pj=es(),Dp=/^\d+(\.\d{1,9})?s$/,gj="node";function mj(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function yj(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!Dp.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!Dp.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(Ap.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(Ap.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function _j(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!Dp.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(Ap.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(Ap.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function vj(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let r of n.name)t.name.push(mj(r));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&Dp.test(n.timeout)){let r=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:r[0]|0,nanos:((e=r[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=yj(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=_j(n.hedgingPolicy));return t}function dk(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}ts.validateRetryThrottling=dk;function fk(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let r of n.loadBalancingConfig)e.loadBalancingConfig.push((0,pj.validateLoadBalancingConfig)(r));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let r of n.methodConfig)e.methodConfig.push(vj(r));"retryThrottling"in n&&(e.retryThrottling=dk(n.retryThrottling));let t=[];for(let r of e.methodConfig)for(let i of r.name){for(let s of t)if(i.service===s.service&&i.method===s.method)throw new Error(`Invalid service config: duplicate name ${i.service}/${i.method}`);t.push(i)}return e}ts.validateServiceConfig=fk;function Ej(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:fk(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let r of n.clientLanguage)if(typeof r=="string")e.clientLanguage.push(r);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let r of n.clientHostname)if(typeof r=="string")e.clientHostname.push(r);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let r in n)if(!t.includes(r))throw new Error(`Invalid service config choice: unexpected field ${r}`);return e}function Sj(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let r=Ej(t);if(!(typeof r.percentage=="number"&&e>r.percentage)){if(Array.isArray(r.clientHostname)){let i=!1;for(let s of r.clientHostname)s===fj.hostname()&&(i=!0);if(!i)continue}if(Array.isArray(r.clientLanguage)){let i=!1;for(let s of r.clientLanguage)s===gj&&(i=!0);if(!i)continue}return r.serviceConfig}}throw new Error("No matching service config found")}function Cj(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let r=t.join("").substring(12),i=JSON.parse(r);return Sj(i,e)}return null}ts.extractAndSelectServiceConfig=Cj});var Hn=v(Rp=>{"use strict";Object.defineProperty(Rp,"__esModule",{value:!0});Rp.ConnectivityState=void 0;var pk=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(pk||(Rp.ConnectivityState=pk={}))});var An=v(ns=>{"use strict";Object.defineProperty(ns,"__esModule",{value:!0});ns.uriToString=ns.splitHostPort=ns.parseUri=void 0;var wj=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function Tj(n){let e=wj.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}ns.parseUri=Tj;var gk=/^\d+$/;function bj(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let r=n.substring(e+2);return gk.test(r)?{host:t,port:+r}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?gk.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}ns.splitHostPort=bj;function Ij(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}ns.uriToString=Ij});var Br=v($n=>{"use strict";Object.defineProperty($n,"__esModule",{value:!0});$n.mapUriDefaultScheme=$n.getDefaultAuthority=$n.createResolver=$n.registerDefaultScheme=$n.registerResolver=void 0;var rS=An(),Ya={},nS=null;function Aj(n,e){Ya[n]=e}$n.registerResolver=Aj;function Dj(n){nS=n}$n.registerDefaultScheme=Dj;function Rj(n,e,t){if(n.scheme!==void 0&&n.scheme in Ya)return new Ya[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,rS.uriToString)(n)}`)}$n.createResolver=Rj;function Nj(n){if(n.scheme!==void 0&&n.scheme in Ya)return Ya[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,rS.uriToString)(n)}`)}$n.getDefaultAuthority=Nj;function kj(n){return n.scheme===void 0||!(n.scheme in Ya)?nS!==null?{scheme:nS,authority:void 0,path:(0,rS.uriToString)(n)}:null:n}$n.mapUriDefaultScheme=kj});var is=v(rs=>{"use strict";Object.defineProperty(rs,"__esModule",{value:!0});rs.QueuePicker=rs.UnavailablePicker=rs.PickResultType=void 0;var Oj=sn(),xj=ve(),Np=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(Np||(rs.PickResultType=Np={})),iS=class{constructor(e){this.status=Object.assign({code:xj.Status.UNAVAILABLE,details:"No connection established",metadata:new Oj.Metadata},e)}pick(e){return{pickResultType:Np.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};rs.UnavailablePicker=iS;var sS=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:Np.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};rs.QueuePicker=sS});var xu=v(kp=>{"use strict";Object.defineProperty(kp,"__esModule",{value:!0});kp.BackoffTimeout=void 0;var Pj=1e3,Mj=1.6,Fj=12e4,Lj=.2;function Bj(n,e){return Math.random()*(e-n)+n}var oS=class{constructor(e,t){this.callback=e,this.initialDelay=Pj,this.multiplier=Mj,this.maxDelay=Fj,this.jitter=Lj,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(r=(t=this.timerId).unref)===null||r===void 0||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+Bj(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};kp.BackoffTimeout=oS});var xp=v(Op=>{"use strict";Object.defineProperty(Op,"__esModule",{value:!0});Op.ChildLoadBalancerHandler=void 0;var Vj=es(),Uj=Hn(),qj="child_load_balancer_helper",aS=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,r){return this.parent.channelControlHelper.createSubchannel(t,r)}updateState(t,r){var i;if(this.calledByPendingChild()){if(t===Uj.ConnectivityState.CONNECTING)return;(i=this.parent.currentChild)===null||i===void 0||i.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,r)}requestReresolution(){var t;let r=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===r&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,Vj.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,i=this.pendingChild)}else this.pendingChild===null?i=this.currentChild:i=this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return qj}};Op.ChildLoadBalancerHandler=aS});var yk=v(Pp=>{"use strict";Object.defineProperty(Pp,"__esModule",{value:!0});Pp.ResolvingLoadBalancer=void 0;var zj=es(),Gj=tS(),_n=Hn(),jj=Br(),Xa=is(),Wj=xu(),lS=ve(),Hj=sn(),$j=Ze(),Kj=ve(),Qj=An(),Yj=xp(),Xj="resolving_load_balancer";function mk(n){$j.trace(Kj.LogVerbosity.DEBUG,Xj,n)}var Jj=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function Zj(n,e,t,r){for(let i of t.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===n&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===n&&i.method===e)return!0}return!1}function eW(n,e,t,r){for(let i of t)if(Zj(n,e,i,r))return i;return null}function tW(n){return function(t,r){var i,s;let o=t.split("/").filter(c=>c.length>0),a=(i=o[0])!==null&&i!==void 0?i:"",l=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of Jj){let u=eW(a,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:lS.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:lS.Status.OK,dynamicFilterFactories:[]}}}var cS=class{constructor(e,t,r,i,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=i,this.onFailedResolution=s,this.latestChildState=_n.ConnectivityState.IDLE,this.latestChildPicker=new Xa.QueuePicker(this),this.currentState=_n.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,Gj.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(_n.ConnectivityState.IDLE,new Xa.QueuePicker(this)),this.childLoadBalancer=new Yj.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(mk("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,l)=>{this.latestChildState=a,this.latestChildPicker=l,this.updateState(a,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,jj.createResolver)(e,{onSuccessfulResolution:(a,l,c,u,h)=>{var d;this.backoffTimeout.stop(),this.backoffTimeout.reset();let f=null;l===null?c===null?(this.previousServiceConfig=null,f=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):f=this.previousServiceConfig:(f=l,this.previousServiceConfig=l);let g=(d=f?.loadBalancingConfig)!==null&&d!==void 0?d:[],y=(0,zj.getFirstUsableConfig)(g,!0);if(y===null){this.handleResolutionFailure({code:lS.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new Hj.Metadata});return}this.childLoadBalancer.updateAddressList(a,y,h);let E=f??this.defaultServiceConfig;this.onSuccessfulResolution(E,u??tW(E))},onError:a=>{this.handleResolutionFailure(a)}},r);let o={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new Wj.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===_n.ConnectivityState.IDLE&&this.updateState(_n.ConnectivityState.CONNECTING,new Xa.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){mk((0,Qj.uriToString)(this.target)+" "+_n.ConnectivityState[this.currentState]+" -> "+_n.ConnectivityState[e]),e===_n.ConnectivityState.IDLE&&(t=new Xa.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===_n.ConnectivityState.IDLE&&(this.updateState(_n.ConnectivityState.TRANSIENT_FAILURE,new Xa.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===_n.ConnectivityState.IDLE||this.currentState===_n.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=_n.ConnectivityState.IDLE,this.latestChildPicker=new Xa.QueuePicker(this),this.currentState=_n.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};Pp.ResolvingLoadBalancer=cS});var _k=v(Ja=>{"use strict";Object.defineProperty(Ja,"__esModule",{value:!0});Ja.channelOptionsEqual=Ja.recognizedOptions=void 0;Ja.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function nW(n,e){let t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==r[i]||n[t[i]]!==e[r[i]])return!1;return!0}Ja.channelOptionsEqual=nW});var Ur=v(Vr=>{"use strict";Object.defineProperty(Vr,"__esModule",{value:!0});Vr.stringToSubchannelAddress=Vr.subchannelAddressToString=Vr.subchannelAddressEqual=Vr.isTcpSubchannelAddress=void 0;var rW=z("net");function Pu(n){return"port"in n}Vr.isTcpSubchannelAddress=Pu;function iW(n,e){return!n&&!e?!0:!n||!e?!1:Pu(n)?Pu(e)&&n.host===e.host&&n.port===e.port:!Pu(e)&&n.path===e.path}Vr.subchannelAddressEqual=iW;function sW(n){return Pu(n)?n.host+":"+n.port:n.path}Vr.subchannelAddressToString=sW;var oW=443;function aW(n,e){return(0,rW.isIP)(n)?{host:n,port:e??oW}:{path:n}}Vr.stringToSubchannelAddress=aW});var Mp=v(Za=>{"use strict";Object.defineProperty(Za,"__esModule",{value:!0});Za.addAdminServicesToServer=Za.registerAdminService=void 0;var vk=[];function lW(n,e){vk.push({getServiceDefinition:n,getHandlers:e})}Za.registerAdminService=lW;function cW(n){for(let{getServiceDefinition:e,getHandlers:t}of vk)n.addService(e(),t())}Za.addAdminServicesToServer=cW});var Ek=v(Kn=>{"use strict";Object.defineProperty(Kn,"__esModule",{value:!0});Kn.ClientDuplexStreamImpl=Kn.ClientWritableStreamImpl=Kn.ClientReadableStreamImpl=Kn.ClientUnaryCallImpl=Kn.callErrorFromStatus=void 0;var uW=z("events"),pS=z("stream"),Mu=ve();function hW(n,e){let t=`${n.code} ${Mu.Status[n.code]}: ${n.details}`,i=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:i})}Kn.callErrorFromStatus=hW;var uS=class extends uW.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Mu.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};Kn.ClientUnaryCallImpl=uS;var hS=class extends pS.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Mu.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};Kn.ClientReadableStreamImpl=hS;var dS=class extends pS.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Mu.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Kn.ClientWritableStreamImpl=dS;var fS=class extends pS.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Mu.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Kn.ClientDuplexStreamImpl=fS});var Sk=v(el=>{"use strict";Object.defineProperty(el,"__esModule",{value:!0});el.InterceptingListenerImpl=el.isInterceptingListener=void 0;function dW(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}el.isInterceptingListener=dW;var gS=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};el.InterceptingListenerImpl=gS});var CS=v(Qn=>{"use strict";Object.defineProperty(Qn,"__esModule",{value:!0});Qn.getInterceptingCall=Qn.InterceptingCall=Qn.RequesterBuilder=Qn.ListenerBuilder=Qn.InterceptorConfigurationError=void 0;var fW=sn(),Ck=Sk(),wk=ve(),Tk=Ep(),Lu=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};Qn.InterceptorConfigurationError=Lu;var yS=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};Qn.ListenerBuilder=yS;var _S=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};Qn.RequesterBuilder=_S;var mS={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},Fu={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},vS=class{constructor(e,t){var r,i,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(r=t.start)!==null&&r!==void 0?r:Fu.start,sendMessage:(i=t.sendMessage)!==null&&i!==void 0?i:Fu.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:Fu.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:Fu.cancel}:this.requester=Fu}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,i,s,o,a,l;let c={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:u=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:u=>{},onReceiveStatus:(l=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,h)=>{var d,f,g;this.processingMetadata=!1;let y;if((0,Ck.isInterceptingListener)(h))y=h;else{let E={onReceiveMetadata:(d=h.onReceiveMetadata)!==null&&d!==void 0?d:mS.onReceiveMetadata,onReceiveMessage:(f=h.onReceiveMessage)!==null&&f!==void 0?f:mS.onReceiveMessage,onReceiveStatus:(g=h.onReceiveStatus)!==null&&g!==void 0?g:mS.onReceiveStatus};y=new Ck.InterceptingListenerImpl(E,c)}this.nextCall.start(u,y),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};Qn.InterceptingCall=vS;function pW(n,e,t){var r,i;let s=(r=t.deadline)!==null&&r!==void 0?r:1/0,o=t.host,a=(i=t.parent)!==null&&i!==void 0?i:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,o,a,l);return c&&u.setCredentials(c),u}var Fp=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(i){this.call.cancelWithStatus(wk.Status.INTERNAL,`Request message serialization failure: ${(0,Tk.getErrorMessage)(i)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:i=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,i)},onReceiveMessage:i=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(i)}catch(a){r={code:wk.Status.INTERNAL,details:`Response message parsing error: ${(0,Tk.getErrorMessage)(a)}`,metadata:new fW.Metadata},this.call.cancelWithStatus(r.code,r.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:i=>{var s,o;r?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,r):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,i)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},ES=class extends Fp{constructor(e,t){super(e,t)}start(e,t){var r,i;let s=!1,o={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:a=>{},onReceiveMessage:a=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,a)},onReceiveStatus:a=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,a)}};super.start(e,o),this.call.startRead()}},SS=class extends Fp{};function gW(n,e,t){let r=pW(n,t.path,e);return t.responseStream?new SS(r,t):new ES(r,t)}function mW(n,e,t,r){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new Lu("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new Lu("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?i=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):i=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return i.reduceRight((a,l)=>c=>l(c,a),a=>gW(r,a,e))(s)}Qn.getInterceptingCall=mW});var bS=v(Bp=>{"use strict";Object.defineProperty(Bp,"__esModule",{value:!0});Bp.Client=void 0;var qr=Ek(),yW=IS(),_W=Hn(),ss=ve(),tl=sn(),Lp=CS(),dr=Symbol(),nl=Symbol(),rl=Symbol(),Ti=Symbol();function wS(n){return typeof n=="function"}function il(n){return n.stack.split(`
`).slice(1).join(`
`)}var TS=class{constructor(e,t,r={}){var i,s;if(r=Object.assign({},r),this[nl]=(i=r.interceptors)!==null&&i!==void 0?i:[],delete r.interceptors,this[rl]=(s=r.interceptor_providers)!==null&&s!==void 0?s:[],delete r.interceptor_providers,this[nl].length>0&&this[rl].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[Ti]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[dr]=r.channelOverride;else if(r.channelFactoryOverride){let o=r.channelFactoryOverride;delete r.channelFactoryOverride,this[dr]=o(e,t,r)}else this[dr]=new yW.ChannelImplementation(e,t,r)}close(){this[dr].close()}getChannel(){return this[dr]}waitForReady(e,t){let r=i=>{if(i){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[dr].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===_W.ConnectivityState.READY)t();else try{this[dr].watchConnectivityState(s,e,r)}catch{t(new Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(wS(e))return{metadata:new tl.Metadata,options:{},callback:e};if(wS(t))return e instanceof tl.Metadata?{metadata:e,options:{},callback:t}:{metadata:new tl.Metadata,options:e,callback:t};if(!(e instanceof tl.Metadata&&t instanceof Object&&wS(r)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,a){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,o,a),h={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},d={argument:i,metadata:u.metadata,call:new qr.ClientUnaryCallImpl,channel:this[dr],methodDefinition:h,callOptions:u.options,callback:u.callback};this[Ti]&&(d=this[Ti](d));let f=d.call,g={clientInterceptors:this[nl],clientInterceptorProviders:this[rl],callInterceptors:(l=d.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=d.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},y=(0,Lp.getInterceptingCall)(g,d.methodDefinition,d.callOptions,d.channel);f.call=y;let E=null,I=!1,C=new Error;return y.start(d.metadata,{onReceiveMetadata:N=>{f.emit("metadata",N)},onReceiveMessage(N){E!==null&&y.cancelWithStatus(ss.Status.INTERNAL,"Too many responses received"),E=N},onReceiveStatus(N){if(!I){if(I=!0,N.code===ss.Status.OK)if(E===null){let k=il(C);d.callback((0,qr.callErrorFromStatus)({code:ss.Status.INTERNAL,details:"No message received",metadata:N.metadata},k))}else d.callback(null,E);else{let k=il(C);d.callback((0,qr.callErrorFromStatus)(N,k))}C=null,f.emit("status",N)}}}),y.sendMessage(i),y.halfClose(),f}makeClientStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkOptionalUnaryResponseArguments(i,s,o),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},h={metadata:c.metadata,call:new qr.ClientWritableStreamImpl(t),channel:this[dr],methodDefinition:u,callOptions:c.options,callback:c.callback};this[Ti]&&(h=this[Ti](h));let d=h.call,f={clientInterceptors:this[nl],clientInterceptorProviders:this[rl],callInterceptors:(a=h.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=h.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},g=(0,Lp.getInterceptingCall)(f,h.methodDefinition,h.callOptions,h.channel);d.call=g;let y=null,E=!1,I=new Error;return g.start(h.metadata,{onReceiveMetadata:C=>{d.emit("metadata",C)},onReceiveMessage(C){y!==null&&g.cancelWithStatus(ss.Status.INTERNAL,"Too many responses received"),y=C},onReceiveStatus(C){if(!E){if(E=!0,C.code===ss.Status.OK)if(y===null){let N=il(I);h.callback((0,qr.callErrorFromStatus)({code:ss.Status.INTERNAL,details:"No message received",metadata:C.metadata},N))}else h.callback(null,y);else{let N=il(I);h.callback((0,qr.callErrorFromStatus)(C,N))}I=null,d.emit("status",C)}}}),d}checkMetadataAndOptions(e,t){let r,i;return e instanceof tl.Metadata?(r=e,t?i=t:i={}):(e?i=e:i={},r=new tl.Metadata),{metadata:r,options:i}}makeServerStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkMetadataAndOptions(s,o),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},h={argument:i,metadata:c.metadata,call:new qr.ClientReadableStreamImpl(r),channel:this[dr],methodDefinition:u,callOptions:c.options};this[Ti]&&(h=this[Ti](h));let d=h.call,f={clientInterceptors:this[nl],clientInterceptorProviders:this[rl],callInterceptors:(a=h.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=h.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},g=(0,Lp.getInterceptingCall)(f,h.methodDefinition,h.callOptions,h.channel);d.call=g;let y=!1,E=new Error;return g.start(h.metadata,{onReceiveMetadata(I){d.emit("metadata",I)},onReceiveMessage(I){d.push(I)},onReceiveStatus(I){if(!y){if(y=!0,d.push(null),I.code!==ss.Status.OK){let C=il(E);d.emit("error",(0,qr.callErrorFromStatus)(I,C))}E=null,d.emit("status",I)}}}),g.sendMessage(i),g.halfClose(),d}makeBidiStreamRequest(e,t,r,i,s){var o,a;let l=this.checkMetadataAndOptions(i,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},u={metadata:l.metadata,call:new qr.ClientDuplexStreamImpl(t,r),channel:this[dr],methodDefinition:c,callOptions:l.options};this[Ti]&&(u=this[Ti](u));let h=u.call,d={clientInterceptors:this[nl],clientInterceptorProviders:this[rl],callInterceptors:(o=u.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=u.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},f=(0,Lp.getInterceptingCall)(d,u.methodDefinition,u.callOptions,u.channel);h.call=f;let g=!1,y=new Error;return f.start(u.metadata,{onReceiveMetadata(E){h.emit("metadata",E)},onReceiveMessage(E){h.push(E)},onReceiveStatus(E){if(!g){if(g=!0,h.push(null),E.code!==ss.Status.OK){let I=il(y);h.emit("error",(0,qr.callErrorFromStatus)(E,I))}y=null,h.emit("status",E)}}}),h}};Bp.Client=TS});var DS=v(sl=>{"use strict";Object.defineProperty(sl,"__esModule",{value:!0});sl.loadPackageDefinition=sl.makeClientConstructor=void 0;var Bu=bS(),vW={unary:Bu.Client.prototype.makeUnaryRequest,server_stream:Bu.Client.prototype.makeServerStreamRequest,client_stream:Bu.Client.prototype.makeClientStreamRequest,bidi:Bu.Client.prototype.makeBidiStreamRequest};function AS(n){return["__proto__","prototype","constructor"].includes(n)}function bk(n,e,t){t||(t={});class r extends Bu.Client{}return Object.keys(n).forEach(i=>{if(AS(i))return;let s=n[i],o;if(typeof i=="string"&&i.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,l=s.responseDeserialize,c=EW(vW[o],s.path,a,l);r.prototype[i]=c,Object.assign(r.prototype[i],s),s.originalName&&!AS(s.originalName)&&(r.prototype[s.originalName]=r.prototype[i])}),r.service=n,r.serviceName=e,r}sl.makeClientConstructor=bk;function EW(n,e,t,r){return function(...i){return n.call(this,e,t,r,...i)}}function SW(n){return"format"in n}function CW(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],i=t.split(".");if(i.some(a=>AS(a)))continue;let s=i[i.length-1],o=e;for(let a of i.slice(0,-1))o[a]||(o[a]={}),o=o[a];SW(r)?o[s]=r:o[s]=bk(r,s,{})}return e}sl.loadPackageDefinition=CW});var Yk=v((tle,Qk)=>{"use strict";var wW=1/0,TW="[object Symbol]",bW=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,IW=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Up="\\ud800-\\udfff",xk="\\u0300-\\u036f\\ufe20-\\ufe23",Pk="\\u20d0-\\u20f0",Mk="\\u2700-\\u27bf",Fk="a-z\\xdf-\\xf6\\xf8-\\xff",AW="\\xac\\xb1\\xd7\\xf7",DW="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",RW="\\u2000-\\u206f",NW=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Lk="A-Z\\xc0-\\xd6\\xd8-\\xde",Bk="\\ufe0e\\ufe0f",Vk=AW+DW+RW+NW,NS="['\u2019]",kW="["+Up+"]",Ik="["+Vk+"]",Vp="["+xk+Pk+"]",Uk="\\d+",OW="["+Mk+"]",qk="["+Fk+"]",zk="[^"+Up+Vk+Uk+Mk+Fk+Lk+"]",RS="\\ud83c[\\udffb-\\udfff]",xW="(?:"+Vp+"|"+RS+")",Gk="[^"+Up+"]",kS="(?:\\ud83c[\\udde6-\\uddff]){2}",OS="[\\ud800-\\udbff][\\udc00-\\udfff]",ol="["+Lk+"]",jk="\\u200d",Ak="(?:"+qk+"|"+zk+")",PW="(?:"+ol+"|"+zk+")",Dk="(?:"+NS+"(?:d|ll|m|re|s|t|ve))?",Rk="(?:"+NS+"(?:D|LL|M|RE|S|T|VE))?",Wk=xW+"?",Hk="["+Bk+"]?",MW="(?:"+jk+"(?:"+[Gk,kS,OS].join("|")+")"+Hk+Wk+")*",$k=Hk+Wk+MW,FW="(?:"+[OW,kS,OS].join("|")+")"+$k,LW="(?:"+[Gk+Vp+"?",Vp,kS,OS,kW].join("|")+")",BW=RegExp(NS,"g"),VW=RegExp(Vp,"g"),UW=RegExp(RS+"(?="+RS+")|"+LW+$k,"g"),qW=RegExp([ol+"?"+qk+"+"+Dk+"(?="+[Ik,ol,"$"].join("|")+")",PW+"+"+Rk+"(?="+[Ik,ol+Ak,"$"].join("|")+")",ol+"?"+Ak+"+"+Dk,ol+"+"+Rk,Uk,FW].join("|"),"g"),zW=RegExp("["+jk+Up+xk+Pk+Bk+"]"),GW=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,jW={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},WW=typeof global=="object"&&global&&global.Object===Object&&global,HW=typeof self=="object"&&self&&self.Object===Object&&self,$W=WW||HW||Function("return this")();function KW(n,e,t,r){var i=-1,s=n?n.length:0;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function QW(n){return n.split("")}function YW(n){return n.match(bW)||[]}function XW(n){return function(e){return n?.[e]}}var JW=XW(jW);function Kk(n){return zW.test(n)}function ZW(n){return GW.test(n)}function e6(n){return Kk(n)?t6(n):QW(n)}function t6(n){return n.match(UW)||[]}function n6(n){return n.match(qW)||[]}var r6=Object.prototype,i6=r6.toString,Nk=$W.Symbol,kk=Nk?Nk.prototype:void 0,Ok=kk?kk.toString:void 0;function s6(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function o6(n){if(typeof n=="string")return n;if(h6(n))return Ok?Ok.call(n):"";var e=n+"";return e=="0"&&1/n==-wW?"-0":e}function a6(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:s6(n,e,t)}function l6(n){return function(e){e=qp(e);var t=Kk(e)?e6(e):void 0,r=t?t[0]:e.charAt(0),i=t?a6(t,1).join(""):e.slice(1);return r[n]()+i}}function c6(n){return function(e){return KW(m6(p6(e).replace(BW,"")),n,"")}}function u6(n){return!!n&&typeof n=="object"}function h6(n){return typeof n=="symbol"||u6(n)&&i6.call(n)==TW}function qp(n){return n==null?"":o6(n)}var d6=c6(function(n,e,t){return e=e.toLowerCase(),n+(t?f6(e):e)});function f6(n){return g6(qp(n).toLowerCase())}function p6(n){return n=qp(n),n&&n.replace(IW,JW).replace(VW,"")}var g6=l6("toUpperCase");function m6(n,e,t){return n=qp(n),e=t?void 0:e,e===void 0?ZW(n)?n6(n):YW(n):n.match(e)||[]}Qk.exports=d6});var xS=v((nle,Xk)=>{"use strict";Xk.exports=y6;function y6(n,e){for(var t=new Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)t[r++]=arguments[i++];return new Promise(function(a,l){t[r]=function(u){if(s)if(s=!1,u)l(u);else{for(var h=new Array(arguments.length-1),d=0;d<h.length;)h[d++]=arguments[d];a.apply(null,h)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var tO=v(eO=>{"use strict";var zp=eO;zp.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&e.charAt(t)==="=";)++r;return Math.ceil(e.length*3)/4-r};var al=new Array(64),Zk=new Array(123);for(fr=0;fr<64;)Zk[al[fr]=fr<26?fr+65:fr<52?fr+71:fr<62?fr-4:fr-59|43]=fr++;var fr;zp.encode=function(e,t,r){for(var i=null,s=[],o=0,a=0,l;t<r;){var c=e[t++];switch(a){case 0:s[o++]=al[c>>2],l=(c&3)<<4,a=1;break;case 1:s[o++]=al[l|c>>4],l=(c&15)<<2,a=2;break;case 2:s[o++]=al[l|c>>6],s[o++]=al[c&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=al[l],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var Jk="invalid encoding";zp.decode=function(e,t,r){for(var i=r,s=0,o,a=0;a<e.length;){var l=e.charCodeAt(a++);if(l===61&&s>1)break;if((l=Zk[l])===void 0)throw Error(Jk);switch(s){case 0:o=l,s=1;break;case 1:t[r++]=o<<2|(l&48)>>4,o=l,s=2;break;case 2:t[r++]=(o&15)<<4|(l&60)>>2,o=l,s=3;break;case 3:t[r++]=(o&3)<<6|l,s=0;break}}if(s===1)throw Error(Jk);return r-i};zp.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var rO=v((ile,nO)=>{"use strict";nO.exports=Gp;function Gp(){this._listeners={}}Gp.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};Gp.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this};Gp.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}});var uO=v((sle,cO)=>{"use strict";cO.exports=iO(iO);function iO(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=r?i:s,n.writeFloatBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function a(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=r?o:a,n.readFloatBE=r?a:o}():function(){function e(r,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)r(1/i>0?0:2147483648,s,o);else if(isNaN(i))r(2143289344,s,o);else if(i>34028234663852886e22)r((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)r((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var l=Math.floor(Math.log(i)/Math.LN2),c=Math.round(i*Math.pow(2,-l)*8388608)&8388607;r((a<<31|l+127<<23|c)>>>0,s,o)}}n.writeFloatLE=e.bind(null,sO),n.writeFloatBE=e.bind(null,oO);function t(r,i,s){var o=r(i,s),a=(o>>31)*2+1,l=o>>>23&255,c=o&8388607;return l===255?c?NaN:a*(1/0):l===0?a*1401298464324817e-60*c:a*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,aO),n.readFloatBE=t.bind(null,lO)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=r?i:s,n.writeDoubleBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function a(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=r?o:a,n.readDoubleBE=r?a:o}():function(){function e(r,i,s,o,a,l){var c=o<0?1:0;if(c&&(o=-o),o===0)r(0,a,l+i),r(1/o>0?0:2147483648,a,l+s);else if(isNaN(o))r(0,a,l+i),r(2146959360,a,l+s);else if(o>17976931348623157e292)r(0,a,l+i),r((c<<31|2146435072)>>>0,a,l+s);else{var u;if(o<22250738585072014e-324)u=o/5e-324,r(u>>>0,a,l+i),r((c<<31|u/4294967296)>>>0,a,l+s);else{var h=Math.floor(Math.log(o)/Math.LN2);h===1024&&(h=1023),u=o*Math.pow(2,-h),r(u*4503599627370496>>>0,a,l+i),r((c<<31|h+1023<<20|u*1048576&1048575)>>>0,a,l+s)}}}n.writeDoubleLE=e.bind(null,sO,0,4),n.writeDoubleBE=e.bind(null,oO,4,0);function t(r,i,s,o,a){var l=r(o,a+i),c=r(o,a+s),u=(c>>31)*2+1,h=c>>>20&2047,d=4294967296*(c&1048575)+l;return h===2047?d?NaN:u*(1/0):h===0?u*5e-324*d:u*Math.pow(2,h-1075)*(d+4503599627370496)}n.readDoubleLE=t.bind(null,aO,0,4),n.readDoubleBE=t.bind(null,lO,4,0)}(),n}function sO(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function oO(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function aO(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function lO(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var PS=v((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var dO=v(hO=>{"use strict";var MS=hO;MS.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)r=e.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};MS.read=function(e,t,r){var i=r-t;if(i<1)return"";for(var s=null,o=[],a=0,l;t<r;)l=e[t++],l<128?o[a++]=l:l>191&&l<224?o[a++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(l>>10),o[a++]=56320+(l&1023)):o[a++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};MS.write=function(e,t,r){for(var i=r,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=s&63|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=s&63|128);return r-i}});var pO=v((ale,fO)=>{"use strict";fO.exports=_6;function _6(n,e,t){var r=t||8192,i=r>>>1,s=null,o=r;return function(l){if(l<1||l>i)return n(l);o+l>r&&(s=n(r),o=0);var c=e.call(s,o,o+=l);return o&7&&(o=(o|7)+1),c}}});var mO=v((lle,gO)=>{"use strict";gO.exports=bt;var Vu=zr();function bt(n,e){this.lo=n>>>0,this.hi=e>>>0}var Co=bt.zero=new bt(0,0);Co.toNumber=function(){return 0};Co.zzEncode=Co.zzDecode=function(){return this};Co.length=function(){return 1};var v6=bt.zeroHash="\0\0\0\0\0\0\0\0";bt.fromNumber=function(e){if(e===0)return Co;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new bt(r,i)};bt.from=function(e){if(typeof e=="number")return bt.fromNumber(e);if(Vu.isString(e))if(Vu.Long)e=Vu.Long.fromString(e);else return bt.fromNumber(parseInt(e,10));return e.low||e.high?new bt(e.low>>>0,e.high>>>0):Co};bt.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296};bt.prototype.toLong=function(e){return Vu.Long?new Vu.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var os=String.prototype.charCodeAt;bt.fromHash=function(e){return e===v6?Co:new bt((os.call(e,0)|os.call(e,1)<<8|os.call(e,2)<<16|os.call(e,3)<<24)>>>0,(os.call(e,4)|os.call(e,5)<<8|os.call(e,6)<<16|os.call(e,7)<<24)>>>0)};bt.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};bt.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};bt.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};bt.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}});var zr=v(FS=>{"use strict";var j=FS;j.asPromise=xS();j.base64=tO();j.EventEmitter=rO();j.float=uO();j.inquire=PS();j.utf8=dO();j.pool=pO();j.LongBits=mO();j.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);j.global=j.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||FS;j.emptyArray=Object.freeze?Object.freeze([]):[];j.emptyObject=Object.freeze?Object.freeze({}):{};j.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};j.isString=function(e){return typeof e=="string"||e instanceof String};j.isObject=function(e){return e&&typeof e=="object"};j.isset=j.isSet=function(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};j.Buffer=function(){try{var n=j.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();j._Buffer_from=null;j._Buffer_allocUnsafe=null;j.newBuffer=function(e){return typeof e=="number"?j.Buffer?j._Buffer_allocUnsafe(e):new j.Array(e):j.Buffer?j._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};j.Array=typeof Uint8Array<"u"?Uint8Array:Array;j.Long=j.global.dcodeIO&&j.global.dcodeIO.Long||j.global.Long||j.inquire("long");j.key2Re=/^true|false|0|1$/;j.key32Re=/^-?(?:0|[1-9][0-9]*)$/;j.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;j.longToHash=function(e){return e?j.LongBits.from(e).toHash():j.LongBits.zeroHash};j.longFromHash=function(e,t){var r=j.LongBits.fromHash(e);return j.Long?j.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)};function yO(n,e,t){for(var r=Object.keys(e),i=0;i<r.length;++i)(n[r[i]]===void 0||!t)&&(n[r[i]]=e[r[i]]);return n}j.merge=yO;j.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function _O(n){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&yO(this,r)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}j.newError=_O;j.ProtocolError=_O("ProtocolError");j.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};j.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}};j.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};j._configure=function(){var n=j.Buffer;if(!n){j._Buffer_from=j._Buffer_allocUnsafe=null;return}j._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,r){return new n(t,r)},j._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var Wp=v((ule,CO)=>{"use strict";CO.exports=_e;var Yn=zr(),LS,jp=Yn.LongBits,vO=Yn.base64,EO=Yn.utf8;function Uu(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function VS(){}function E6(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function _e(){this.len=0,this.head=new Uu(VS,0,0),this.tail=this.head,this.states=null}var SO=function(){return Yn.Buffer?function(){return(_e.create=function(){return new LS})()}:function(){return new _e}};_e.create=SO();_e.alloc=function(e){return new Yn.Array(e)};Yn.Array!==Array&&(_e.alloc=Yn.pool(_e.alloc,Yn.Array.prototype.subarray));_e.prototype._push=function(e,t,r){return this.tail=this.tail.next=new Uu(e,t,r),this.len+=t,this};function US(n,e,t){e[t]=n&255}function S6(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function qS(n,e){this.len=n,this.next=void 0,this.val=e}qS.prototype=Object.create(Uu.prototype);qS.prototype.fn=S6;_e.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new qS((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};_e.prototype.int32=function(e){return e<0?this._push(zS,10,jp.fromNumber(e)):this.uint32(e)};_e.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function zS(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}_e.prototype.uint64=function(e){var t=jp.from(e);return this._push(zS,t.length(),t)};_e.prototype.int64=_e.prototype.uint64;_e.prototype.sint64=function(e){var t=jp.from(e).zzEncode();return this._push(zS,t.length(),t)};_e.prototype.bool=function(e){return this._push(US,1,e?1:0)};function BS(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}_e.prototype.fixed32=function(e){return this._push(BS,4,e>>>0)};_e.prototype.sfixed32=_e.prototype.fixed32;_e.prototype.fixed64=function(e){var t=jp.from(e);return this._push(BS,4,t.lo)._push(BS,4,t.hi)};_e.prototype.sfixed64=_e.prototype.fixed64;_e.prototype.float=function(e){return this._push(Yn.float.writeFloatLE,4,e)};_e.prototype.double=function(e){return this._push(Yn.float.writeDoubleLE,8,e)};var C6=Yn.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};_e.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(US,1,0);if(Yn.isString(e)){var r=_e.alloc(t=vO.length(e));vO.decode(e,r,0),e=r}return this.uint32(t)._push(C6,t,e)};_e.prototype.string=function(e){var t=EO.length(e);return t?this.uint32(t)._push(EO.write,t,e):this._push(US,1,0)};_e.prototype.fork=function(){return this.states=new E6(this),this.head=this.tail=new Uu(VS,0,0),this.len=0,this};_e.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Uu(VS,0,0),this.len=0),this};_e.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};_e.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};_e._configure=function(n){LS=n,_e.create=SO(),LS._configure()}});var bO=v((hle,TO)=>{"use strict";TO.exports=Gr;var wO=Wp();(Gr.prototype=Object.create(wO.prototype)).constructor=Gr;var as=zr();function Gr(){wO.call(this)}Gr._configure=function(){Gr.alloc=as._Buffer_allocUnsafe,Gr.writeBytesBuffer=as.Buffer&&as.Buffer.prototype instanceof Uint8Array&&as.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}};Gr.prototype.bytes=function(e){as.isString(e)&&(e=as._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Gr.writeBytesBuffer,t,e),this};function w6(n,e,t){n.length<40?as.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}Gr.prototype.string=function(e){var t=as.Buffer.byteLength(e);return this.uint32(t),t&&this._push(w6,t,e),this};Gr._configure()});var $p=v((dle,NO)=>{"use strict";NO.exports=rt;var pr=zr(),jS,DO=pr.LongBits,T6=pr.utf8;function gr(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function rt(n){this.buf=n,this.pos=0,this.len=n.length}var IO=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new rt(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new rt(e);throw Error("illegal buffer")},RO=function(){return pr.Buffer?function(t){return(rt.create=function(i){return pr.Buffer.isBuffer(i)?new jS(i):IO(i)})(t)}:IO};rt.create=RO();rt.prototype._slice=pr.Array.prototype.subarray||pr.Array.prototype.slice;rt.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,gr(this,10);return e}}();rt.prototype.int32=function(){return this.uint32()|0};rt.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function GS(){var n=new DO(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw gr(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw gr(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}rt.prototype.bool=function(){return this.uint32()!==0};function Hp(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}rt.prototype.fixed32=function(){if(this.pos+4>this.len)throw gr(this,4);return Hp(this.buf,this.pos+=4)};rt.prototype.sfixed32=function(){if(this.pos+4>this.len)throw gr(this,4);return Hp(this.buf,this.pos+=4)|0};function AO(){if(this.pos+8>this.len)throw gr(this,8);return new DO(Hp(this.buf,this.pos+=4),Hp(this.buf,this.pos+=4))}rt.prototype.float=function(){if(this.pos+4>this.len)throw gr(this,4);var e=pr.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};rt.prototype.double=function(){if(this.pos+8>this.len)throw gr(this,4);var e=pr.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};rt.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw gr(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var i=pr.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)};rt.prototype.string=function(){var e=this.bytes();return T6.read(e,0,e.length)};rt.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw gr(this,e);this.pos+=e}else do if(this.pos>=this.len)throw gr(this);while(this.buf[this.pos++]&128);return this};rt.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};rt._configure=function(n){jS=n,rt.create=RO(),jS._configure();var e=pr.Long?"toLong":"toNumber";pr.merge(rt.prototype,{int64:function(){return GS.call(this)[e](!1)},uint64:function(){return GS.call(this)[e](!0)},sint64:function(){return GS.call(this).zzDecode()[e](!1)},fixed64:function(){return AO.call(this)[e](!0)},sfixed64:function(){return AO.call(this)[e](!1)}})}});var PO=v((fle,xO)=>{"use strict";xO.exports=wo;var OO=$p();(wo.prototype=Object.create(OO.prototype)).constructor=wo;var kO=zr();function wo(n){OO.call(this,n)}wo._configure=function(){kO.Buffer&&(wo.prototype._slice=kO.Buffer.prototype.slice)};wo.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};wo._configure()});var FO=v((ple,MO)=>{"use strict";MO.exports=qu;var WS=zr();(qu.prototype=Object.create(WS.EventEmitter.prototype)).constructor=qu;function qu(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");WS.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}qu.prototype.rpcCall=function n(e,t,r,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return WS.asPromise(n,o,e,t,r,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(l,c){if(l)return o.emit("error",l,e),s(l);if(c===null){o.end(!0);return}if(!(c instanceof r))try{c=r[o.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return o.emit("error",u,e),s(u)}return o.emit("data",c,e),s(null,c)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};qu.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var HS=v(LO=>{"use strict";var b6=LO;b6.Service=FO()});var $S=v((mle,BO)=>{"use strict";BO.exports={}});var qO=v(UO=>{"use strict";var vn=UO;vn.build="minimal";vn.Writer=Wp();vn.BufferWriter=bO();vn.Reader=$p();vn.BufferReader=PO();vn.util=zr();vn.rpc=HS();vn.roots=$S();vn.configure=VO;function VO(){vn.util._configure(),vn.Writer._configure(vn.BufferWriter),vn.Reader._configure(vn.BufferReader)}VO()});var GO=v((_le,zO)=>{"use strict";zO.exports=KS;function KS(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function r(s){if(typeof s!="string"){var o=i();if(KS.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),l=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)l[u]=a[u],c[u]=s[a[u++]];return l[u]=o,Function.apply(null,l).apply(null,c)}return Function(o)()}for(var h=new Array(arguments.length-1),d=0;d<h.length;)h[d]=arguments[++d];if(d=0,s=s.replace(/%([%dfijs])/g,function(g,y){var E=h[d++];switch(y){case"d":case"f":return String(Number(E));case"i":return String(Math.floor(E));case"j":return JSON.stringify(E);case"s":return String(E)}return"%"}),d!==h.length)throw Error("parameter count mismatch");return t.push(s),r}function i(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=i,r}KS.verbose=!1});var WO=v((vle,jO)=>{"use strict";jO.exports=zu;var I6=xS(),A6=PS(),QS=A6("fs");function zu(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&QS&&QS.readFile?QS.readFile(n,function(i,s){return i&&typeof XMLHttpRequest<"u"?zu.xhr(n,e,t):i?t(i):t(null,e.binary?s:s.toString("utf8"))}):zu.xhr(n,e,t):I6(zu,this,n,e)}zu.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(t.binary){var o=i.response;if(!o){o=[];for(var a=0;a<i.responseText.length;++a)o.push(i.responseText.charCodeAt(a)&255)}return r(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}});var KO=v($O=>{"use strict";var XS=$O,HO=XS.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},YS=XS.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),r=HO(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):r?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return i+t.join("/")};XS.resolve=function(e,t,r){return r||(t=YS(t)),HO(t)?t:(r||(e=YS(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?YS(e+"/"+t):t)}});var To=v(QO=>{"use strict";var Gu=QO,D6=It(),R6=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function ju(n,e){var t=0,r={};for(e|=0;t<n.length;)r[R6[t+e]]=n[t++];return r}Gu.basic=ju([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);Gu.defaults=ju([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",D6.emptyArray,null]);Gu.long=ju([0,0,0,1,1],7);Gu.mapKey=ju([0,0,0,5,5,0,0,0,1,1,0,2],2);Gu.packed=ju([1,5,0,0,0,5,5,0,0,0,1,1,0])});var ls=v((Cle,JO)=>{"use strict";JO.exports=Xn;var Kp=bo();((Xn.prototype=Object.create(Kp.prototype)).constructor=Xn).className="Field";var YO=mr(),XO=To(),ht=It(),JS,N6=/^required|optional|repeated$/;Xn.fromJSON=function(e,t){return new Xn(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function Xn(n,e,t,r,i,s,o){if(ht.isObject(r)?(o=i,s=r,r=i=void 0):ht.isObject(i)&&(o=s,s=i,i=void 0),Kp.call(this,n,s),!ht.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!ht.isString(t))throw TypeError("type must be a string");if(r!==void 0&&!N6.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!ht.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=t,this.id=e,this.extend=i||void 0,this.required=r==="required",this.optional=!this.required,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=ht.Long?XO.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=o}Object.defineProperty(Xn.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});Xn.prototype.setOption=function(e,t,r){return e==="packed"&&(this._packed=null),Kp.prototype.setOption.call(this,e,t,r)};Xn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return ht.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Xn.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=XO.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof JS?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof YO&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof YO))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=ht.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;ht.base64.test(this.typeDefault)?ht.base64.decode(this.typeDefault,e=ht.newBuffer(ht.base64.length(this.typeDefault)),0):ht.utf8.write(this.typeDefault,e=ht.newBuffer(ht.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=ht.emptyObject:this.repeated?this.defaultValue=ht.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof JS&&(this.parent.ctor.prototype[this.name]=this.defaultValue),Kp.prototype.resolve.call(this)};Xn.d=function(e,t,r,i){return typeof t=="function"?t=ht.decorateType(t).name:t&&typeof t=="object"&&(t=ht.decorateEnum(t).name),function(o,a){ht.decorateType(o.constructor).add(new Xn(a,e,t,r,{default:i}))}};Xn._configure=function(e){JS=e}});var ll=v((wle,tx)=>{"use strict";tx.exports=Jn;var Yp=bo();((Jn.prototype=Object.create(Yp.prototype)).constructor=Jn).className="OneOf";var ZO=ls(),Qp=It();function Jn(n,e,t,r){if(Array.isArray(e)||(t=e,e=void 0),Yp.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}Jn.fromJSON=function(e,t){return new Jn(e,t.oneof,t.options,t.comment)};Jn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Qp.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function ex(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}Jn.prototype.add=function(e){if(!(e instanceof ZO))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,ex(this),this};Jn.prototype.remove=function(e){if(!(e instanceof ZO))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};Jn.prototype.onAdd=function(e){Yp.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}ex(this)};Jn.prototype.onRemove=function(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);Yp.prototype.onRemove.call(this,e)};Jn.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(i,s){Qp.decorateType(i.constructor).add(new Jn(s,e)),Object.defineProperty(i,s,{get:Qp.oneOfGetter(e),set:Qp.oneOfSetter(e)})}}});var hl=v((Tle,sx)=>{"use strict";sx.exports=Ee;var ZS=bo();((Ee.prototype=Object.create(ZS.prototype)).constructor=Ee).className="Namespace";var nx=ls(),Xp=It(),k6=ll(),cl,Wu,ul;Ee.fromJSON=function(e,t){return new Ee(e,t.options).addJSON(t.nested)};function rx(n,e){if(n&&n.length){for(var t={},r=0;r<n.length;++r)t[n[r].name]=n[r].toJSON(e);return t}}Ee.arrayToJSON=rx;Ee.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1};Ee.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1};function Ee(n,e){ZS.call(this,n,e),this.nested=void 0,this._nestedArray=null}function ix(n){return n._nestedArray=null,n}Object.defineProperty(Ee.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=Xp.toArray(this.nested))}});Ee.prototype.toJSON=function(e){return Xp.toObject(["options",this.options,"nested",rx(this.nestedArray,e)])};Ee.prototype.addJSON=function(e){var t=this;if(e)for(var r=Object.keys(e),i=0,s;i<r.length;++i)s=e[r[i]],t.add((s.fields!==void 0?cl.fromJSON:s.values!==void 0?ul.fromJSON:s.methods!==void 0?Wu.fromJSON:s.id!==void 0?nx.fromJSON:Ee.fromJSON)(r[i],s));return this};Ee.prototype.get=function(e){return this.nested&&this.nested[e]||null};Ee.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof ul)return this.nested[e].values;throw Error("no such enum: "+e)};Ee.prototype.add=function(e){if(!(e instanceof nx&&e.extend!==void 0||e instanceof cl||e instanceof k6||e instanceof ul||e instanceof Wu||e instanceof Ee))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof Ee&&e instanceof Ee&&!(t instanceof cl||t instanceof Wu)){for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),ix(this)};Ee.prototype.remove=function(e){if(!(e instanceof ZS))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),ix(this)};Ee.prototype.define=function(e,t){if(Xp.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof Ee))throw Error("path conflicts with non-namespace objects")}else r.add(r=new Ee(i))}return t&&r.addJSON(t),r};Ee.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof Ee?e[t++].resolveAll():e[t++].resolve();return this.resolve()};Ee.prototype.lookup=function(e,t,r){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),Xp.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(e.length===1){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof Ee&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof Ee&&(i=this._nestedArray[s].lookup(e,t,!0)))return i;return this.parent===null||r?null:this.parent.lookup(e,t)};Ee.prototype.lookupType=function(e){var t=this.lookup(e,[cl]);if(!t)throw Error("no such type: "+e);return t};Ee.prototype.lookupEnum=function(e){var t=this.lookup(e,[ul]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};Ee.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[cl,ul]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};Ee.prototype.lookupService=function(e){var t=this.lookup(e,[Wu]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};Ee._configure=function(n,e,t){cl=n,Wu=e,ul=t}});var Jp=v((ble,ox)=>{"use strict";ox.exports=bi;var eC=ls();((bi.prototype=Object.create(eC.prototype)).constructor=bi).className="MapField";var O6=To(),Hu=It();function bi(n,e,t,r,i,s){if(eC.call(this,n,e,r,void 0,void 0,i,s),!Hu.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}bi.fromJSON=function(e,t){return new bi(e,t.id,t.keyType,t.type,t.options,t.comment)};bi.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Hu.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};bi.prototype.resolve=function(){if(this.resolved)return this;if(O6.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return eC.prototype.resolve.call(this)};bi.d=function(e,t,r){return typeof r=="function"?r=Hu.decorateType(r).name:r&&typeof r=="object"&&(r=Hu.decorateEnum(r).name),function(s,o){Hu.decorateType(s.constructor).add(new bi(o,e,t,r))}}});var Zp=v((Ile,ax)=>{"use strict";ax.exports=Io;var tC=bo();((Io.prototype=Object.create(tC.prototype)).constructor=Io).className="Method";var dl=It();function Io(n,e,t,r,i,s,o,a,l){if(dl.isObject(i)?(o=i,i=s=void 0):dl.isObject(s)&&(o=s,s=void 0),!(e===void 0||dl.isString(e)))throw TypeError("type must be a string");if(!dl.isString(t))throw TypeError("requestType must be a string");if(!dl.isString(r))throw TypeError("responseType must be a string");tC.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=l}Io.fromJSON=function(e,t){return new Io(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};Io.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return dl.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};Io.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),tC.prototype.resolve.call(this))}});var eg=v((Ale,cx)=>{"use strict";cx.exports=Zn;var cs=hl();((Zn.prototype=Object.create(cs.prototype)).constructor=Zn).className="Service";var nC=Zp(),$u=It(),x6=HS();function Zn(n,e){cs.call(this,n,e),this.methods={},this._methodsArray=null}Zn.fromJSON=function(e,t){var r=new Zn(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),s=0;s<i.length;++s)r.add(nC.fromJSON(i[s],t.methods[i[s]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r};Zn.prototype.toJSON=function(e){var t=cs.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return $u.toObject(["options",t&&t.options||void 0,"methods",cs.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(Zn.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=$u.toArray(this.methods))}});function lx(n){return n._methodsArray=null,n}Zn.prototype.get=function(e){return this.methods[e]||cs.prototype.get.call(this,e)};Zn.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return cs.prototype.resolve.call(this)};Zn.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof nC?(this.methods[e.name]=e,e.parent=this,lx(this)):cs.prototype.add.call(this,e)};Zn.prototype.remove=function(e){if(e instanceof nC){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,lx(this)}return cs.prototype.remove.call(this,e)};Zn.prototype.create=function(e,t,r){for(var i=new x6.Service(e,t,r),s=0,o;s<this.methodsArray.length;++s){var a=$u.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[a]=$u.codegen(["r","c"],$u.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return i}});var tg=v((Dle,ux)=>{"use strict";ux.exports=jr;var P6=zr();function jr(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}jr.create=function(e){return this.$type.create(e)};jr.encode=function(e,t){return this.$type.encode(e,t)};jr.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};jr.decode=function(e){return this.$type.decode(e)};jr.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};jr.verify=function(e){return this.$type.verify(e)};jr.fromObject=function(e){return this.$type.fromObject(e)};jr.toObject=function(e,t){return this.$type.toObject(e,t)};jr.prototype.toJSON=function(){return this.$type.toObject(this,P6.toJSONOptions)}});var rC=v((Rle,dx)=>{"use strict";dx.exports=L6;var M6=mr(),Ii=To(),hx=It();function F6(n){return"missing required '"+n.name+"'"}function L6(n){var e=hx.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var r=n._fieldsArray[t].resolve(),i=r.resolvedType instanceof M6?"int32":r.type,s="m"+hx.safeProp(r.name);e("case %i: {",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),Ii.defaults[r.keyType]!==void 0?e("k=%j",Ii.defaults[r.keyType]):e("k=null"),Ii.defaults[i]!==void 0?e("value=%j",Ii.defaults[i]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),Ii.basic[i]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",i),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),Ii.long[r.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),Ii.packed[i]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,i)("}else"),Ii.basic[i]===void 0?e(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,i)):Ii.basic[i]===void 0?e(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,i),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",F6(o))}return e("return m")}});var oC=v((Nle,fx)=>{"use strict";fx.exports=U6;var B6=mr(),iC=It();function er(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function sC(n,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof B6){n("switch(%s){",r)("default:")("return%j",er(e,"enum value"));for(var i=Object.keys(e.resolvedType.values),s=0;s<i.length;++s)n("case %i:",e.resolvedType.values[i[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",er(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",er(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",er(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",er(e,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",er(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",er(e,"buffer"));break}return n}function V6(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",er(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",er(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",er(e,"boolean key"));break}return n}function U6(n){var e=iC.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,r={};t.length&&e("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var s=n._fieldsArray[i].resolve(),o="m"+iC.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",er(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),V6(e,s,"k[i]"),sC(e,s,i,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",er(s,"array"))("for(var i=0;i<%s.length;++i){",o),sC(e,s,i,o+"[i]")("}");else{if(s.partOf){var a=iC.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",a)}sC(e,s,i,o)}s.optional&&e("}")}return e("return null")}});var cC=v(gx=>{"use strict";var px=gx,Ku=mr(),Wr=It();function aC(n,e,t,r){var i=!1;if(e.resolvedType)if(e.resolvedType instanceof Ku){n("switch(d%s){",r);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),e.repeated||n("break"),i=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",r,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,t,r);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}px.fromObject=function(e){var t=e.fieldsArray,r=Wr.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),o=Wr.safeProp(s.name);s.map?(r("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),aC(r,s,i,o+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),aC(r,s,i,o+"[i]")("}")("}")):(s.resolvedType instanceof Ku||r("if(d%s!=null){",o),aC(r,s,i,o),s.resolvedType instanceof Ku||r("}"))}return r("return m")};function lC(n,e,t,r){if(e.resolvedType)e.resolvedType instanceof Ku?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,t,r,r,t,r,r):n("d%s=types[%i].toObject(m%s,o)",r,t,r);else{var i=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}px.toObject=function(e){var t=e.fieldsArray.slice().sort(Wr.compareFieldsById);if(!t.length)return Wr.codegen()("return {}");for(var r=Wr.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?i:t[a].map?s:o).push(t[a]);if(i.length){for(r("if(o.arrays||o.defaults){"),a=0;a<i.length;++a)r("d%s=[]",Wr.safeProp(i[a].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),a=0;a<s.length;++a)r("d%s={}",Wr.safeProp(s[a].name));r("}")}if(o.length){for(r("if(o.defaults){"),a=0;a<o.length;++a){var l=o[a],c=Wr.safeProp(l.name);if(l.resolvedType instanceof Ku)r("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else r("d%s=%j",c,l.typeDefault)}r("}")}var h=!1;for(a=0;a<t.length;++a){var l=t[a],d=e._fieldsArray.indexOf(l),c=Wr.safeProp(l.name);l.map?(h||(h=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),lC(r,l,d,c+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),lC(r,l,d,c+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),lC(r,l,d,c),l.partOf&&r("if(o.oneofs)")("d%s=%j",Wr.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}});var uC=v(mx=>{"use strict";var q6=mx,z6=tg();q6[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",r="",i="";if(e&&e.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(i);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof z6){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=t),i=r+a,o["@type"]=i,o}return this.toObject(n,e)}}});var ig=v((xle,_x)=>{"use strict";_x.exports=Oe;var yr=hl();((Oe.prototype=Object.create(yr.prototype)).constructor=Oe).className="Type";var G6=mr(),fC=ll(),ng=ls(),j6=Jp(),W6=eg(),hC=tg(),dC=$p(),H6=Wp(),Ht=It(),$6=pC(),K6=rC(),Q6=oC(),yx=cC(),Y6=uC();function Oe(n,e){yr.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(Oe.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],r=t.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=Ht.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=Ht.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=Oe.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof hC||((n.prototype=new hC).constructor=n,Ht.merge(n.prototype,e)),n.$type=n.prototype.$type=this,Ht.merge(n,hC,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var r={};for(t=0;t<this.oneofsArray.length;++t)r[this._oneofsArray[t].resolve().name]={get:Ht.oneOfGetter(this._oneofsArray[t].oneof),set:Ht.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,r)}}});Oe.generateConstructor=function(e){for(var t=Ht.codegen(["p"],e.name),r=0,i;r<e.fieldsArray.length;++r)(i=e._fieldsArray[r]).map?t("this%s={}",Ht.safeProp(i.name)):i.repeated&&t("this%s=[]",Ht.safeProp(i.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function rg(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}Oe.fromJSON=function(e,t){var r=new Oe(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var i=Object.keys(t.fields),s=0;s<i.length;++s)r.add((typeof t.fields[i[s]].keyType<"u"?j6.fromJSON:ng.fromJSON)(i[s],t.fields[i[s]]));if(t.oneofs)for(i=Object.keys(t.oneofs),s=0;s<i.length;++s)r.add(fC.fromJSON(i[s],t.oneofs[i[s]]));if(t.nested)for(i=Object.keys(t.nested),s=0;s<i.length;++s){var o=t.nested[i[s]];r.add((o.id!==void 0?ng.fromJSON:o.fields!==void 0?Oe.fromJSON:o.values!==void 0?G6.fromJSON:o.methods!==void 0?W6.fromJSON:yr.fromJSON)(i[s],o))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r};Oe.prototype.toJSON=function(e){var t=yr.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return Ht.toObject(["options",t&&t.options||void 0,"oneofs",yr.arrayToJSON(this.oneofsArray,e),"fields",yr.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Oe.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return yr.prototype.resolveAll.call(this)};Oe.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};Oe.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof ng&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),rg(this)}return e instanceof fC?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),rg(this)):yr.prototype.add.call(this,e)};Oe.prototype.remove=function(e){if(e instanceof ng&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),rg(this)}if(e instanceof fC){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),rg(this)}return yr.prototype.remove.call(this,e)};Oe.prototype.isReservedId=function(e){return yr.isReservedId(this.reserved,e)};Oe.prototype.isReservedName=function(e){return yr.isReservedName(this.reserved,e)};Oe.prototype.create=function(e){return new this.ctor(e)};Oe.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=$6(this)({Writer:H6,types:t,util:Ht}),this.decode=K6(this)({Reader:dC,types:t,util:Ht}),this.verify=Q6(this)({types:t,util:Ht}),this.fromObject=yx.fromObject(this)({types:t,util:Ht}),this.toObject=yx.toObject(this)({types:t,util:Ht});var i=Y6[e];if(i){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(s),s.toObject=this.toObject,this.toObject=i.toObject.bind(s)}return this};Oe.prototype.encode=function(e,t){return this.setup().encode(e,t)};Oe.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};Oe.prototype.decode=function(e,t){return this.setup().decode(e,t)};Oe.prototype.decodeDelimited=function(e){return e instanceof dC||(e=dC.create(e)),this.decode(e,e.uint32())};Oe.prototype.verify=function(e){return this.setup().verify(e)};Oe.prototype.fromObject=function(e){return this.setup().fromObject(e)};Oe.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};Oe.d=function(e){return function(r){Ht.decorateType(r,e)}}});var ag=v((Ple,wx)=>{"use strict";wx.exports=Dn;var og=hl();((Dn.prototype=Object.create(og.prototype)).constructor=Dn).className="Root";var mC=ls(),Ex=mr(),X6=ll(),us=It(),Sx,gC,Qu;function Dn(n){og.call(this,"",n),this.deferred=[],this.files=[]}Dn.fromJSON=function(e,t){return t||(t=new Dn),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};Dn.prototype.resolvePath=us.path.resolve;Dn.prototype.fetch=us.fetch;function Cx(){}Dn.prototype.load=function n(e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=this;if(!r)return us.asPromise(n,i,e,t);var s=r===Cx;function o(f,g){if(r){if(s)throw f;var y=r;r=null,y(f,g)}}function a(f){var g=f.lastIndexOf("google/protobuf/");if(g>-1){var y=f.substring(g);if(y in Qu)return y}return null}function l(f,g){try{if(us.isString(g)&&g.charAt(0)==="{"&&(g=JSON.parse(g)),!us.isString(g))i.setOptions(g.options).addJSON(g.nested);else{gC.filename=f;var y=gC(g,i,t),E,I=0;if(y.imports)for(;I<y.imports.length;++I)(E=a(y.imports[I])||i.resolvePath(f,y.imports[I]))&&c(E);if(y.weakImports)for(I=0;I<y.weakImports.length;++I)(E=a(y.weakImports[I])||i.resolvePath(f,y.weakImports[I]))&&c(E,!0)}}catch(C){o(C)}!s&&!u&&o(null,i)}function c(f,g){if(f=a(f)||f,!(i.files.indexOf(f)>-1)){if(i.files.push(f),f in Qu){s?l(f,Qu[f]):(++u,setTimeout(function(){--u,l(f,Qu[f])}));return}if(s){var y;try{y=us.fs.readFileSync(f).toString("utf8")}catch(E){g||o(E);return}l(f,y)}else++u,i.fetch(f,function(E,I){if(--u,!!r){if(E){g?u||o(null,i):o(E);return}l(f,I)}})}}var u=0;us.isString(e)&&(e=[e]);for(var h=0,d;h<e.length;++h)(d=i.resolvePath("",e[h]))&&c(d);if(s)return i;u||o(null,i)};Dn.prototype.loadSync=function(e,t){if(!us.isNode)throw Error("not supported");return this.load(e,t,Cx)};Dn.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return og.prototype.resolveAll.call(this)};var sg=/^[A-Z]/;function vx(n,e){var t=e.parent.lookup(e.extend);if(t){var r=new mC(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(r.name)||(r.declaringField=e,e.extensionField=r,t.add(r)),!0}return!1}Dn.prototype._handleAdd=function(e){if(e instanceof mC)e.extend!==void 0&&!e.extensionField&&(vx(this,e)||this.deferred.push(e));else if(e instanceof Ex)sg.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof X6)){if(e instanceof Sx)for(var t=0;t<this.deferred.length;)vx(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);sg.test(e.name)&&(e.parent[e.name]=e)}};Dn.prototype._handleRemove=function(e){if(e instanceof mC){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof Ex)sg.test(e.name)&&delete e.parent[e.name];else if(e instanceof og){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);sg.test(e.name)&&delete e.parent[e.name]}};Dn._configure=function(n,e,t){Sx=n,gC=e,Qu=t}});var It=v((Mle,bx)=>{"use strict";var it=bx.exports=zr(),Tx=$S(),yC,_C;it.codegen=GO();it.fetch=WO();it.path=KO();it.fs=it.inquire("fs");it.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]};it.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],s=e[r++];s!==void 0&&(t[i]=s)}return t};var J6=/\\/g,Z6=/"/g;it.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};it.safeProp=function(e){return!/^[$\w_]+$/.test(e)||it.isReserved(e)?'["'+e.replace(J6,"\\\\").replace(Z6,'\\"')+'"]':"."+e};it.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var eH=/_([a-z])/g;it.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(eH,function(t,r){return r.toUpperCase()})};it.compareFieldsById=function(e,t){return e.id-t.id};it.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(it.decorateRoot.remove(e.$type),e.$type.name=t,it.decorateRoot.add(e.$type)),e.$type;yC||(yC=ig());var r=new yC(t||e.name);return it.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var tH=0;it.decorateEnum=function(e){if(e.$type)return e.$type;_C||(_C=mr());var t=new _C("Enum"+tH++,e);return it.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};it.setProperty=function(e,t,r){function i(s,o,a){var l=o.shift();if(l==="__proto__"||l==="prototype")return s;if(o.length>0)s[l]=i(s[l]||{},o,a);else{var c=s[l];c&&(a=[].concat(c).concat(a)),s[l]=a}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),i(e,t,r)};Object.defineProperty(it,"decorateRoot",{get:function(){return Tx.decorated||(Tx.decorated=new(ag()))}})});var bo=v((Fle,Ix)=>{"use strict";Ix.exports=Rn;Rn.className="ReflectionObject";var lg=It(),cg;function Rn(n,e){if(!lg.isString(n))throw TypeError("name must be a string");if(e&&!lg.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(Rn.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});Rn.prototype.toJSON=function(){throw Error()};Rn.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof cg&&t._handleAdd(this)};Rn.prototype.onRemove=function(e){var t=e.root;t instanceof cg&&t._handleRemove(this),this.parent=null,this.resolved=!1};Rn.prototype.resolve=function(){return this.resolved?this:(this.root instanceof cg&&(this.resolved=!0),this)};Rn.prototype.getOption=function(e){if(this.options)return this.options[e]};Rn.prototype.setOption=function(e,t,r){return(!r||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};Rn.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var s=i.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var o=s[e];lg.setProperty(o,r,t)}else s={},s[e]=lg.setProperty({},r,t),i.push(s)}else{var a={};a[e]=t,i.push(a)}return this};Rn.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this};Rn.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};Rn._configure=function(n){cg=n}});var mr=v((Lle,Rx)=>{"use strict";Rx.exports=Hr;var Ax=bo();((Hr.prototype=Object.create(Ax.prototype)).constructor=Hr).className="Enum";var Dx=hl(),ug=It();function Hr(n,e,t,r,i,s){if(Ax.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=s,this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}Hr.fromJSON=function(e,t){var r=new Hr(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r};Hr.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return ug.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};Hr.prototype.add=function(e,t,r,i){if(!ug.isString(e))throw TypeError("name must be a string");if(!ug.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this};Hr.prototype.remove=function(e){if(!ug.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};Hr.prototype.isReservedId=function(e){return Dx.isReservedId(this.reserved,e)};Hr.prototype.isReservedName=function(e){return Dx.isReservedName(this.reserved,e)}});var pC=v((Ble,kx)=>{"use strict";kx.exports=rH;var nH=mr(),vC=To(),EC=It();function Nx(n,e,t,r){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,r,(e.id<<3|2)>>>0)}function rH(n){for(var e=EC.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,r,i=n.fieldsArray.slice().sort(EC.compareFieldsById),t=0;t<i.length;++t){var s=i[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof nH?"int32":s.type,l=vC.basic[a];r="m"+EC.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|vC.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,r):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,a,r),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",r,r),s.packed&&vC.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",a,r)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",r),l===void 0?Nx(e,s,o,r+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,a,r)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,s.name),l===void 0?Nx(e,s,o,r):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,a,r))}return e("return w")}});var xx=v((Vle,Ox)=>{"use strict";var pe=Ox.exports=qO();pe.build="light";function iH(n,e,t){return typeof e=="function"?(t=e,e=new pe.Root):e||(e=new pe.Root),e.load(n,t)}pe.load=iH;function sH(n,e){return e||(e=new pe.Root),e.loadSync(n)}pe.loadSync=sH;pe.encoder=pC();pe.decoder=rC();pe.verifier=oC();pe.converter=cC();pe.ReflectionObject=bo();pe.Namespace=hl();pe.Root=ag();pe.Enum=mr();pe.Type=ig();pe.Field=ls();pe.OneOf=ll();pe.MapField=Jp();pe.Service=eg();pe.Method=Zp();pe.Message=tg();pe.wrappers=uC();pe.types=To();pe.util=It();pe.ReflectionObject._configure(pe.Root);pe.Namespace._configure(pe.Type,pe.Service,pe.Enum);pe.Root._configure(pe.Type);pe.Field._configure(pe.Type)});var CC=v((Ule,Fx)=>{"use strict";Fx.exports=Mx;var SC=/[\s{}=;:[\],'"()<>]/g,oH=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,aH=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,lH=/^ *[*/]+ */,cH=/^\s*\*?\/*/,uH=/\n/g,hH=/\s/,dH=/\\(.?)/g,fH={0:"\0",r:"\r",n:`
`,t:"	"};function Px(n){return n.replace(dH,function(e,t){switch(t){case"\\":case"":return t;default:return fH[t]||""}})}Mx.unescape=Px;function Mx(n,e){n=n.toString();var t=0,r=n.length,i=1,s=0,o={},a=[],l=null;function c(k){return Error("illegal "+k+" (line "+i+")")}function u(){var k=l==="'"?aH:oH;k.lastIndex=t-1;var U=k.exec(n);if(!U)throw c("string");return t=k.lastIndex,E(l),l=null,Px(U[1])}function h(k){return n.charAt(k)}function d(k,U,J){var ue={type:n.charAt(k++),lineEmpty:!1,leading:J},gt;e?gt=2:gt=3;var Vt=k-gt,Ne;do if(--Vt<0||(Ne=n.charAt(Vt))===`
`){ue.lineEmpty=!0;break}while(Ne===" "||Ne==="	");for(var T=n.substring(k,U).split(uH),Qe=0;Qe<T.length;++Qe)T[Qe]=T[Qe].replace(e?cH:lH,"").trim();ue.text=T.join(`
`).trim(),o[i]=ue,s=i}function f(k){var U=g(k),J=n.substring(k,U),ue=/^\s*\/\//.test(J);return ue}function g(k){for(var U=k;U<r&&h(U)!==`
`;)U++;return U}function y(){if(a.length>0)return a.shift();if(l)return u();var k,U,J,ue,gt,Vt=t===0;do{if(t===r)return null;for(k=!1;hH.test(J=h(t));)if(J===`
`&&(Vt=!0,++i),++t===r)return null;if(h(t)==="/"){if(++t===r)throw c("comment");if(h(t)==="/")if(e){if(ue=t,gt=!1,f(t-1)){gt=!0;do if(t=g(t),t===r||(t++,!Vt))break;while(f(t))}else t=Math.min(r,g(t)+1);gt&&(d(ue,t,Vt),Vt=!0),i++,k=!0}else{for(gt=h(ue=t+1)==="/";h(++t)!==`
`;)if(t===r)return null;++t,gt&&(d(ue,t-1,Vt),Vt=!0),++i,k=!0}else if((J=h(t))==="*"){ue=t+1,gt=e||h(ue)==="*";do{if(J===`
`&&++i,++t===r)throw c("comment");U=J,J=h(t)}while(U!=="*"||J!=="/");++t,gt&&(d(ue,t-2,Vt),Vt=!0),k=!0}else return"/"}}while(k);var Ne=t;SC.lastIndex=0;var T=SC.test(h(Ne++));if(!T)for(;Ne<r&&!SC.test(h(Ne));)++Ne;var Qe=n.substring(t,t=Ne);return(Qe==='"'||Qe==="'")&&(l=Qe),Qe}function E(k){a.push(k)}function I(){if(!a.length){var k=y();if(k===null)return null;E(k)}return a[0]}function C(k,U){var J=I(),ue=J===k;if(ue)return y(),!0;if(!U)throw c("token '"+J+"', '"+k+"' expected");return!1}function N(k){var U=null,J;return k===void 0?(J=o[i-1],delete o[i-1],J&&(e||J.type==="*"||J.lineEmpty)&&(U=J.leading?J.text:null)):(s<k&&I(),J=o[k],delete o[k],J&&!J.lineEmpty&&(e||J.type==="/")&&(U=J.leading?null:J.text)),U}return Object.defineProperty({next:y,peek:I,push:E,skip:C,cmnt:N},"line",{get:function(){return i}})}});var zx=v((qle,qx)=>{"use strict";qx.exports=Ai;Ai.filename=null;Ai.defaults={keepCase:!1};var pH=CC(),Lx=ag(),Bx=ig(),Vx=ls(),gH=Jp(),Ux=ll(),mH=mr(),yH=eg(),_H=Zp(),wC=To(),TC=It(),vH=/^[1-9][0-9]*$/,EH=/^-?[1-9][0-9]*$/,SH=/^0[x][0-9a-fA-F]+$/,CH=/^-?0[x][0-9a-fA-F]+$/,wH=/^0[0-7]+$/,TH=/^-?0[0-7]+$/,bH=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,$r=/^[a-zA-Z_][a-zA-Z_0-9]*$/,Kr=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,IH=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function Ai(n,e,t){e instanceof Lx||(t=e,e=new Lx),t||(t=Ai.defaults);var r=t.preferTrailingComment||!1,i=pH(n,t.alternateCommentMode||!1),s=i.next,o=i.push,a=i.peek,l=i.skip,c=i.cmnt,u=!0,h,d,f,g,y=!1,E=e,I=t.keepCase?function(A){return A}:TC.camelCase;function C(A,D,x){var $=Ai.filename;return x||(Ai.filename=null),Error("illegal "+(D||"token")+" '"+A+"' ("+($?$+", ":"")+"line "+i.line+")")}function N(){var A=[],D;do{if((D=s())!=='"'&&D!=="'")throw C(D);A.push(s()),l(D),D=a()}while(D==='"'||D==="'");return A.join("")}function k(A){var D=s();switch(D){case"'":case'"':return o(D),N();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return J(D,!0)}catch{if(A&&Kr.test(D))return D;throw C(D,"value")}}function U(A,D){var x,$;do D&&((x=a())==='"'||x==="'")?A.push(N()):A.push([$=ue(s()),l("to",!0)?ue(s()):$]);while(l(",",!0));l(";")}function J(A,D){var x=1;switch(A.charAt(0)==="-"&&(x=-1,A=A.substring(1)),A){case"inf":case"INF":case"Inf":return x*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(vH.test(A))return x*parseInt(A,10);if(SH.test(A))return x*parseInt(A,16);if(wH.test(A))return x*parseInt(A,8);if(bH.test(A))return x*parseFloat(A);throw C(A,"number",D)}function ue(A,D){switch(A){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!D&&A.charAt(0)==="-")throw C(A,"id");if(EH.test(A))return parseInt(A,10);if(CH.test(A))return parseInt(A,16);if(TH.test(A))return parseInt(A,8);throw C(A,"id")}function gt(){if(h!==void 0)throw C("package");if(h=s(),!Kr.test(h))throw C(h,"name");E=E.define(h),l(";")}function Vt(){var A=a(),D;switch(A){case"weak":D=f||(f=[]),s();break;case"public":s();default:D=d||(d=[]);break}A=N(),l(";"),D.push(A)}function Ne(){if(l("="),g=N(),y=g==="proto3",!y&&g!=="proto2")throw C(g,"syntax");l(";")}function T(A,D){switch(D){case"option":return Fe(A,D),l(";"),!0;case"message":return b(A,D),!0;case"enum":return be(A,D),!0;case"service":return ct(A,D),!0;case"extend":return Aa(A,D),!0}return!1}function Qe(A,D,x){var $=i.line;if(A&&(typeof A.comment!="string"&&(A.comment=c()),A.filename=Ai.filename),l("{",!0)){for(var W;(W=s())!=="}";)D(W);l(";",!0)}else x&&x(),l(";"),A&&(typeof A.comment!="string"||r)&&(A.comment=c($)||A.comment)}function b(A,D){if(!$r.test(D=s()))throw C(D,"type name");var x=new Bx(D);Qe(x,function(W){if(!T(x,W))switch(W){case"map":ye(x,W);break;case"required":case"repeated":p(x,W);break;case"optional":y?p(x,"proto3_optional"):p(x,"optional");break;case"oneof":Ve(x,W);break;case"extensions":U(x.extensions||(x.extensions=[]));break;case"reserved":U(x.reserved||(x.reserved=[]),!0);break;default:if(!y||!Kr.test(W))throw C(W);o(W),p(x,"optional");break}}),A.add(x)}function p(A,D,x){var $=s();if($==="group"){L(A,D);return}for(;$.endsWith(".")||a().startsWith(".");)$+=s();if(!Kr.test($))throw C($,"type");var W=s();if(!$r.test(W))throw C(W,"name");W=I(W),l("=");var he=new Vx(W,ue(s()),$,D,x);if(Qe(he,function(Cn){if(Cn==="option")Fe(he,Cn),l(";");else throw C(Cn)},function(){Ut(he)}),D==="proto3_optional"){var xt=new Ux("_"+W);he.setOption("proto3_optional",!0),xt.add(he),A.add(xt)}else A.add(he);!y&&he.repeated&&(wC.packed[$]!==void 0||wC.basic[$]===void 0)&&he.setOption("packed",!1,!0)}function L(A,D){var x=s();if(!$r.test(x))throw C(x,"name");var $=TC.lcFirst(x);x===$&&(x=TC.ucFirst(x)),l("=");var W=ue(s()),he=new Bx(x);he.group=!0;var xt=new Vx($,W,x,D);xt.filename=Ai.filename,Qe(he,function(Cn){switch(Cn){case"option":Fe(he,Cn),l(";");break;case"required":case"repeated":p(he,Cn);break;case"optional":y?p(he,"proto3_optional"):p(he,"optional");break;case"message":b(he,Cn);break;case"enum":be(he,Cn);break;default:throw C(Cn)}}),A.add(he).add(xt)}function ye(A){l("<");var D=s();if(wC.mapKey[D]===void 0)throw C(D,"type");l(",");var x=s();if(!Kr.test(x))throw C(x,"type");l(">");var $=s();if(!$r.test($))throw C($,"name");l("=");var W=new gH(I($),ue(s()),D,x);Qe(W,function(xt){if(xt==="option")Fe(W,xt),l(";");else throw C(xt)},function(){Ut(W)}),A.add(W)}function Ve(A,D){if(!$r.test(D=s()))throw C(D,"name");var x=new Ux(I(D));Qe(x,function(W){W==="option"?(Fe(x,W),l(";")):(o(W),p(x,"optional"))}),A.add(x)}function be(A,D){if(!$r.test(D=s()))throw C(D,"name");var x=new mH(D);Qe(x,function(W){switch(W){case"option":Fe(x,W),l(";");break;case"reserved":U(x.reserved||(x.reserved=[]),!0);break;default:nt(x,W)}}),A.add(x)}function nt(A,D){if(!$r.test(D))throw C(D,"name");l("=");var x=ue(s(),!0),$={options:void 0};$.setOption=function(W,he){this.options===void 0&&(this.options={}),this.options[W]=he},Qe($,function(he){if(he==="option")Fe($,he),l(";");else throw C(he)},function(){Ut($)}),A.add(D,x,$.comment,$.options)}function Fe(A,D){var x=l("(",!0);if(!Kr.test(D=s()))throw C(D,"name");var $=D,W=$,he;x&&(l(")"),$="("+$+")",W=$,D=a(),IH.test(D)&&(he=D.slice(1),$+=D,s())),l("=");var xt=Jt(A,$);Ye(A,W,xt,he)}function Jt(A,D){if(l("{",!0)){for(var x={};!l("}",!0);){if(!$r.test(qt=s()))throw C(qt,"name");if(qt===null)throw C(qt,"end of input");var $,W=qt;if(l(":",!0),a()==="{")$=Jt(A,D+"."+qt);else if(a()==="["){$=[];var he;if(l("[",!0)){do he=k(!0),$.push(he);while(l(",",!0));l("]"),typeof he<"u"&&lt(A,D+"."+qt,he)}}else $=k(!0),lt(A,D+"."+qt,$);var xt=x[W];xt&&($=[].concat(xt).concat($)),x[W]=$,l(",",!0),l(";",!0)}return x}var Gi=k(!0);return lt(A,D,Gi),Gi}function lt(A,D,x){A.setOption&&A.setOption(D,x)}function Ye(A,D,x,$){A.setParsedOption&&A.setParsedOption(D,x,$)}function Ut(A){if(l("[",!0)){do Fe(A,"option");while(l(",",!0));l("]")}return A}function ct(A,D){if(!$r.test(D=s()))throw C(D,"service name");var x=new yH(D);Qe(x,function(W){if(!T(x,W))if(W==="rpc")Zt(x,W);else throw C(W)}),A.add(x)}function Zt(A,D){var x=c(),$=D;if(!$r.test(D=s()))throw C(D,"name");var W=D,he,xt,Gi,Cn;if(l("("),l("stream",!0)&&(xt=!0),!Kr.test(D=s())||(he=D,l(")"),l("returns"),l("("),l("stream",!0)&&(Cn=!0),!Kr.test(D=s())))throw C(D);Gi=D,l(")");var cf=new _H(W,$,he,Gi,xt,Cn);cf.comment=x,Qe(cf,function(lv){if(lv==="option")Fe(cf,lv),l(";");else throw C(lv)}),A.add(cf)}function Aa(A,D){if(!Kr.test(D=s()))throw C(D,"reference");var x=D;Qe(null,function(W){switch(W){case"required":case"repeated":p(A,W,x);break;case"optional":y?p(A,"proto3_optional",x):p(A,"optional",x);break;default:if(!y||!Kr.test(W))throw C(W);o(W),p(A,"optional",x);break}})}for(var qt;(qt=s())!==null;)switch(qt){case"package":if(!u)throw C(qt);gt();break;case"import":if(!u)throw C(qt);Vt();break;case"syntax":if(!u)throw C(qt);Ne();break;case"option":Fe(E,qt),l(";");break;default:if(T(E,qt)){u=!1;continue}throw C(qt)}return Ai.filename=null,{package:h,imports:d,weakImports:f,syntax:g,root:e}}});var Wx=v((zle,jx)=>{"use strict";jx.exports=_r;var AH=/\/|\./;function _r(n,e){AH.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),_r[n]=e}_r("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var Gx;_r("duration",{Duration:Gx={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});_r("timestamp",{Timestamp:Gx});_r("empty",{Empty:{fields:{}}});_r("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});_r("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});_r("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});_r.get=function(e){return _r[e]||null}});var $x=v((Gle,Hx)=>{"use strict";var hs=Hx.exports=xx();hs.build="full";hs.tokenize=CC();hs.parse=zx();hs.common=Wx();hs.Root._configure(hs.Type,hs.parse,hs.common)});var hg=v((jle,Kx)=>{"use strict";Kx.exports=$x()});var bC=v((Wle,DH)=>{DH.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var Zx=v((le,Jx)=>{"use strict";var on=hg();Jx.exports=le=on.descriptor=on.Root.fromJSON(bC()).lookup(".google.protobuf");var Qx=on.Namespace,Yu=on.Root,Di=on.Enum,ds=on.Type,fs=on.Field,RH=on.MapField,dg=on.OneOf,Xu=on.Service,fg=on.Method;Yu.fromDescriptor=function(e){typeof e.length=="number"&&(e=le.FileDescriptorSet.decode(e));var t=new Yu;if(e.file)for(var r,i,s=0,o;s<e.file.length;++s){if(i=t,(r=e.file[s]).package&&r.package.length&&(i=t.define(r.package)),r.name&&r.name.length&&t.files.push(i.filename=r.name),r.messageType)for(o=0;o<r.messageType.length;++o)i.add(ds.fromDescriptor(r.messageType[o],r.syntax));if(r.enumType)for(o=0;o<r.enumType.length;++o)i.add(Di.fromDescriptor(r.enumType[o]));if(r.extension)for(o=0;o<r.extension.length;++o)i.add(fs.fromDescriptor(r.extension[o]));if(r.service)for(o=0;o<r.service.length;++o)i.add(Xu.fromDescriptor(r.service[o]));var a=fl(r.options,le.FileOptions);if(a){var l=Object.keys(a);for(o=0;o<l.length;++o)i.setOption(l[o],a[l[o]])}}return t};Yu.prototype.toDescriptor=function(e){var t=le.FileDescriptorSet.create();return Yx(this,t.file,e),t};function Yx(n,e,t){var r=le.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(r.syntax=t),n instanceof Yu||(r.package=n.fullName.substring(1));for(var i=0,s;i<n.nestedArray.length;++i)(s=n._nestedArray[i])instanceof ds?r.messageType.push(s.toDescriptor(t)):s instanceof Di?r.enumType.push(s.toDescriptor()):s instanceof fs?r.extension.push(s.toDescriptor(t)):s instanceof Xu?r.service.push(s.toDescriptor()):s instanceof Qx&&Yx(s,e,t);r.options=pl(n.options,le.FileOptions),r.messageType.length+r.enumType.length+r.extension.length+r.service.length&&e.push(r)}var NH=0;ds.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=le.DescriptorProto.decode(e));var r=new ds(e.name.length?e.name:"Type"+NH++,fl(e.options,le.MessageOptions)),i;if(e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)r.add(dg.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var s=fs.fromDescriptor(e.field[i],t);r.add(s),e.field[i].hasOwnProperty("oneofIndex")&&r.oneofsArray[e.field[i].oneofIndex].add(s)}if(e.extension)for(i=0;i<e.extension.length;++i)r.add(fs.fromDescriptor(e.extension[i],t));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)r.add(ds.fromDescriptor(e.nestedType[i],t)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&r.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)r.add(Di.fromDescriptor(e.enumType[i]));if(e.extensionRange&&e.extensionRange.length)for(r.extensions=[],i=0;i<e.extensionRange.length;++i)r.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(r.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)r.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)r.reserved.push(e.reservedName[i])}return r};ds.prototype.toDescriptor=function(e){var t=le.DescriptorProto.create({name:this.name}),r;for(r=0;r<this.fieldsArray.length;++r){var i;if(t.field.push(i=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof RH){var s=IC(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),o=IC(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),a=o===11||o===14?this._fieldsArray[r].resolvedType&&Xx(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;t.nestedType.push(le.DescriptorProto.create({name:i.typeName,field:[le.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),le.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:le.MessageOptions.create({mapEntry:!0})}))}}for(r=0;r<this.oneofsArray.length;++r)t.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof fs?t.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof ds?t.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof Di&&t.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)t.extensionRange.push(le.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)typeof this.reserved[r]=="string"?t.reservedName.push(this.reserved[r]):t.reservedRange.push(le.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return t.options=pl(this.options,le.MessageOptions),t};var kH=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;fs.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=le.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var r;e.typeName&&e.typeName.length?r=e.typeName:r=FH(e.type);var i;switch(e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var o=new fs(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(o.options=fl(e.options,le.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:var l=kH.exec(a);l&&(a=parseInt(a));break}o.setOption("default",a)}return LH(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o};fs.prototype.toDescriptor=function(e){var t=le.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=on.util.ucFirst(this.name),t.label=3;else{switch(t.type=IC(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?Xx(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=pl(this.options,le.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=le.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=le.FieldOptions.create())).packed=!0),t};var OH=0;Di.fromDescriptor=function(e){typeof e.length=="number"&&(e=le.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;t[i&&i.length?i:"NAME"+s]=s}return new Di(e.name&&e.name.length?e.name:"Enum"+OH++,t,fl(e.options,le.EnumOptions))};Di.prototype.toDescriptor=function(){for(var e=[],t=0,r=Object.keys(this.values);t<r.length;++t)e.push(le.EnumValueDescriptorProto.create({name:r[t],number:this.values[r[t]]}));return le.EnumDescriptorProto.create({name:this.name,value:e,options:pl(this.options,le.EnumOptions)})};var xH=0;dg.fromDescriptor=function(e){return typeof e.length=="number"&&(e=le.OneofDescriptorProto.decode(e)),new dg(e.name&&e.name.length?e.name:"oneof"+xH++)};dg.prototype.toDescriptor=function(){return le.OneofDescriptorProto.create({name:this.name})};var PH=0;Xu.fromDescriptor=function(e){typeof e.length=="number"&&(e=le.ServiceDescriptorProto.decode(e));var t=new Xu(e.name&&e.name.length?e.name:"Service"+PH++,fl(e.options,le.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)t.add(fg.fromDescriptor(e.method[r]));return t};Xu.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return le.ServiceDescriptorProto.create({name:this.name,method:e,options:pl(this.options,le.ServiceOptions)})};var MH=0;fg.fromDescriptor=function(e){return typeof e.length=="number"&&(e=le.MethodDescriptorProto.decode(e)),new fg(e.name&&e.name.length?e.name:"Method"+MH++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,fl(e.options,le.MethodOptions))};fg.prototype.toDescriptor=function(){return le.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:pl(this.options,le.MethodOptions)})};function FH(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function LH(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function IC(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof Di)return 14;if(e instanceof ds)return e.group?10:11;throw Error("illegal type: "+n)}function fl(n,e){if(n){for(var t=[],r=0,i,s,o;r<e.fieldsArray.length;++r)(s=(i=e._fieldsArray[r]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(o=n[s],i.resolvedType instanceof Di&&typeof o=="number"&&i.resolvedType.valuesById[o]!==void 0&&(o=i.resolvedType.valuesById[o]),t.push(BH(s),o));return t.length?on.util.toObject(t):void 0}}function pl(n,e){if(n){for(var t=[],r=0,i=Object.keys(n),s,o;r<i.length;++r)if(o=n[s=i[r]],s!=="default"){var a=e.fields[s];!a&&!(a=e.fields[s=on.util.camelCase(s)])||t.push(s,o)}return t.length?e.fromObject(on.util.toObject(t)):void 0}}function Xx(n,e){var t=n.fullName.split("."),r=e.fullName.split("."),i=0,s=0,o=r.length-1;if(!(n instanceof Yu)&&e instanceof Qx)for(;i<t.length&&s<o&&t[i]===r[s];){var a=e.lookup(t[i++],!0);if(a!==null&&a!==e)break;++s}else for(;i<t.length&&s<o&&t[i]===r[s];++i,++s);return r.slice(s).join(".")}function BH(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var eP=v((Hle,VH)=>{VH.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var tP=v(($le,UH)=>{UH.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var nP=v((Kle,qH)=>{qH.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var oP=v(ps=>{"use strict";Object.defineProperty(ps,"__esModule",{value:!0});ps.addCommonProtos=ps.loadProtosWithOptionsSync=ps.loadProtosWithOptions=void 0;var rP=z("fs"),iP=z("path"),gl=hg();function sP(n,e){let t=n.resolvePath;n.resolvePath=(r,i)=>{if(iP.isAbsolute(i))return i;for(let s of e){let o=iP.join(s,i);try{return rP.accessSync(o,rP.constants.R_OK),o}catch{continue}}return process.emitWarning(`${i} not found in any of the include paths ${e}`),t(r,i)}}function zH(n,e){return m(this,null,function*(){let t=new gl.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));sP(t,e.includeDirs)}let r=yield t.load(n,e);return r.resolveAll(),r})}ps.loadProtosWithOptions=zH;function GH(n,e){let t=new gl.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");sP(t,e.includeDirs)}let r=t.loadSync(n,e);return r.resolveAll(),r}ps.loadProtosWithOptionsSync=GH;function jH(){let n=eP(),e=bC(),t=tP(),r=nP();gl.common("api",n.nested.google.nested.protobuf.nested),gl.common("descriptor",e.nested.google.nested.protobuf.nested),gl.common("source_context",t.nested.google.nested.protobuf.nested),gl.common("type",r.nested.google.nested.protobuf.nested)}ps.addCommonProtos=jH});var cP=v((lP,AC)=>{"use strict";var aP=function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(b,p,L){this.low=b|0,this.high=p|0,this.unsigned=!!L}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(b){return(b&&b.__isLong__)===!0}function i(b){var p=Math.clz32(b&-b);return b?31-p:p}t.isLong=r;var s={},o={};function a(b,p){var L,ye,Ve;return p?(b>>>=0,(Ve=0<=b&&b<256)&&(ye=o[b],ye)?ye:(L=c(b,0,!0),Ve&&(o[b]=L),L)):(b|=0,(Ve=-128<=b&&b<128)&&(ye=s[b],ye)?ye:(L=c(b,b<0?-1:0,!1),Ve&&(s[b]=L),L))}t.fromInt=a;function l(b,p){if(isNaN(b))return p?k:N;if(p){if(b<0)return k;if(b>=E)return Vt}else{if(b<=-I)return Ne;if(b+1>=I)return gt}return b<0?l(-b,p).neg():c(b%y|0,b/y|0,p)}t.fromNumber=l;function c(b,p,L){return new t(b,p,L)}t.fromBits=c;var u=Math.pow;function h(b,p,L){if(b.length===0)throw Error("empty string");if(typeof p=="number"?(L=p,p=!1):p=!!p,b==="NaN"||b==="Infinity"||b==="+Infinity"||b==="-Infinity")return p?k:N;if(L=L||10,L<2||36<L)throw RangeError("radix");var ye;if((ye=b.indexOf("-"))>0)throw Error("interior hyphen");if(ye===0)return h(b.substring(1),p,L).neg();for(var Ve=l(u(L,8)),be=N,nt=0;nt<b.length;nt+=8){var Fe=Math.min(8,b.length-nt),Jt=parseInt(b.substring(nt,nt+Fe),L);if(Fe<8){var lt=l(u(L,Fe));be=be.mul(lt).add(l(Jt))}else be=be.mul(Ve),be=be.add(l(Jt))}return be.unsigned=p,be}t.fromString=h;function d(b,p){return typeof b=="number"?l(b,p):typeof b=="string"?h(b,p):c(b.low,b.high,typeof p=="boolean"?p:b.unsigned)}t.fromValue=d;var f=65536,g=1<<24,y=f*f,E=y*y,I=E/2,C=a(g),N=a(0);t.ZERO=N;var k=a(0,!0);t.UZERO=k;var U=a(1);t.ONE=U;var J=a(1,!0);t.UONE=J;var ue=a(-1);t.NEG_ONE=ue;var gt=c(-1,2147483647,!1);t.MAX_VALUE=gt;var Vt=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=Vt;var Ne=c(0,-2147483648,!1);t.MIN_VALUE=Ne;var T=t.prototype;T.toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*y+(this.low>>>0):this.high*y+(this.low>>>0)},T.toString=function(p){if(p=p||10,p<2||36<p)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Ne)){var L=l(p),ye=this.div(L),Ve=ye.mul(L).sub(this);return ye.toString(p)+Ve.toInt().toString(p)}else return"-"+this.neg().toString(p);for(var be=l(u(p,6),this.unsigned),nt=this,Fe="";;){var Jt=nt.div(be),lt=nt.sub(Jt.mul(be)).toInt()>>>0,Ye=lt.toString(p);if(nt=Jt,nt.isZero())return Ye+Fe;for(;Ye.length<6;)Ye="0"+Ye;Fe=""+Ye+Fe}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Ne)?64:this.neg().getNumBitsAbs();for(var p=this.high!=0?this.high:this.low,L=31;L>0&&!(p&1<<L);L--);return this.high!=0?L+33:L+1},T.isZero=function(){return this.high===0&&this.low===0},T.eqz=T.isZero,T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||this.high>=0},T.isOdd=function(){return(this.low&1)===1},T.isEven=function(){return(this.low&1)===0},T.equals=function(p){return r(p)||(p=d(p)),this.unsigned!==p.unsigned&&this.high>>>31===1&&p.high>>>31===1?!1:this.high===p.high&&this.low===p.low},T.eq=T.equals,T.notEquals=function(p){return!this.eq(p)},T.neq=T.notEquals,T.ne=T.notEquals,T.lessThan=function(p){return this.comp(p)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(p){return this.comp(p)<=0},T.lte=T.lessThanOrEqual,T.le=T.lessThanOrEqual,T.greaterThan=function(p){return this.comp(p)>0},T.gt=T.greaterThan,T.greaterThanOrEqual=function(p){return this.comp(p)>=0},T.gte=T.greaterThanOrEqual,T.ge=T.greaterThanOrEqual,T.compare=function(p){if(r(p)||(p=d(p)),this.eq(p))return 0;var L=this.isNegative(),ye=p.isNegative();return L&&!ye?-1:!L&&ye?1:this.unsigned?p.high>>>0>this.high>>>0||p.high===this.high&&p.low>>>0>this.low>>>0?-1:1:this.sub(p).isNegative()?-1:1},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq(Ne)?Ne:this.not().add(U)},T.neg=T.negate,T.add=function(p){r(p)||(p=d(p));var L=this.high>>>16,ye=this.high&65535,Ve=this.low>>>16,be=this.low&65535,nt=p.high>>>16,Fe=p.high&65535,Jt=p.low>>>16,lt=p.low&65535,Ye=0,Ut=0,ct=0,Zt=0;return Zt+=be+lt,ct+=Zt>>>16,Zt&=65535,ct+=Ve+Jt,Ut+=ct>>>16,ct&=65535,Ut+=ye+Fe,Ye+=Ut>>>16,Ut&=65535,Ye+=L+nt,Ye&=65535,c(ct<<16|Zt,Ye<<16|Ut,this.unsigned)},T.subtract=function(p){return r(p)||(p=d(p)),this.add(p.neg())},T.sub=T.subtract,T.multiply=function(p){if(this.isZero())return this;if(r(p)||(p=d(p)),e){var L=e.mul(this.low,this.high,p.low,p.high);return c(L,e.get_high(),this.unsigned)}if(p.isZero())return this.unsigned?k:N;if(this.eq(Ne))return p.isOdd()?Ne:N;if(p.eq(Ne))return this.isOdd()?Ne:N;if(this.isNegative())return p.isNegative()?this.neg().mul(p.neg()):this.neg().mul(p).neg();if(p.isNegative())return this.mul(p.neg()).neg();if(this.lt(C)&&p.lt(C))return l(this.toNumber()*p.toNumber(),this.unsigned);var ye=this.high>>>16,Ve=this.high&65535,be=this.low>>>16,nt=this.low&65535,Fe=p.high>>>16,Jt=p.high&65535,lt=p.low>>>16,Ye=p.low&65535,Ut=0,ct=0,Zt=0,Aa=0;return Aa+=nt*Ye,Zt+=Aa>>>16,Aa&=65535,Zt+=be*Ye,ct+=Zt>>>16,Zt&=65535,Zt+=nt*lt,ct+=Zt>>>16,Zt&=65535,ct+=Ve*Ye,Ut+=ct>>>16,ct&=65535,ct+=be*lt,Ut+=ct>>>16,ct&=65535,ct+=nt*Jt,Ut+=ct>>>16,ct&=65535,Ut+=ye*Ye+Ve*lt+be*Jt+nt*Fe,Ut&=65535,c(Zt<<16|Aa,Ut<<16|ct,this.unsigned)},T.mul=T.multiply,T.divide=function(p){if(r(p)||(p=d(p)),p.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&p.low===-1&&p.high===-1)return this;var L=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,p.low,p.high);return c(L,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?k:N;var ye,Ve,be;if(this.unsigned){if(p.unsigned||(p=p.toUnsigned()),p.gt(this))return k;if(p.gt(this.shru(1)))return J;be=k}else{if(this.eq(Ne)){if(p.eq(U)||p.eq(ue))return Ne;if(p.eq(Ne))return U;var nt=this.shr(1);return ye=nt.div(p).shl(1),ye.eq(N)?p.isNegative()?U:ue:(Ve=this.sub(p.mul(ye)),be=ye.add(Ve.div(p)),be)}else if(p.eq(Ne))return this.unsigned?k:N;if(this.isNegative())return p.isNegative()?this.neg().div(p.neg()):this.neg().div(p).neg();if(p.isNegative())return this.div(p.neg()).neg();be=N}for(Ve=this;Ve.gte(p);){ye=Math.max(1,Math.floor(Ve.toNumber()/p.toNumber()));for(var Fe=Math.ceil(Math.log(ye)/Math.LN2),Jt=Fe<=48?1:u(2,Fe-48),lt=l(ye),Ye=lt.mul(p);Ye.isNegative()||Ye.gt(Ve);)ye-=Jt,lt=l(ye,this.unsigned),Ye=lt.mul(p);lt.isZero()&&(lt=U),be=be.add(lt),Ve=Ve.sub(Ye)}return be},T.div=T.divide,T.modulo=function(p){if(r(p)||(p=d(p)),e){var L=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,p.low,p.high);return c(L,e.get_high(),this.unsigned)}return this.sub(this.div(p).mul(p))},T.mod=T.modulo,T.rem=T.modulo,T.not=function(){return c(~this.low,~this.high,this.unsigned)},T.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},T.clz=T.countLeadingZeros,T.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},T.ctz=T.countTrailingZeros,T.and=function(p){return r(p)||(p=d(p)),c(this.low&p.low,this.high&p.high,this.unsigned)},T.or=function(p){return r(p)||(p=d(p)),c(this.low|p.low,this.high|p.high,this.unsigned)},T.xor=function(p){return r(p)||(p=d(p)),c(this.low^p.low,this.high^p.high,this.unsigned)},T.shiftLeft=function(p){return r(p)&&(p=p.toInt()),(p&=63)===0?this:p<32?c(this.low<<p,this.high<<p|this.low>>>32-p,this.unsigned):c(0,this.low<<p-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(p){return r(p)&&(p=p.toInt()),(p&=63)===0?this:p<32?c(this.low>>>p|this.high<<32-p,this.high>>p,this.unsigned):c(this.high>>p-32,this.high>=0?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(p){return r(p)&&(p=p.toInt()),(p&=63)===0?this:p<32?c(this.low>>>p|this.high<<32-p,this.high>>>p,this.unsigned):p===32?c(this.high,0,this.unsigned):c(this.high>>>p-32,0,this.unsigned)},T.shru=T.shiftRightUnsigned,T.shr_u=T.shiftRightUnsigned,T.rotateLeft=function(p){var L;return r(p)&&(p=p.toInt()),(p&=63)===0?this:p===32?c(this.high,this.low,this.unsigned):p<32?(L=32-p,c(this.low<<p|this.high>>>L,this.high<<p|this.low>>>L,this.unsigned)):(p-=32,L=32-p,c(this.high<<p|this.low>>>L,this.low<<p|this.high>>>L,this.unsigned))},T.rotl=T.rotateLeft,T.rotateRight=function(p){var L;return r(p)&&(p=p.toInt()),(p&=63)===0?this:p===32?c(this.high,this.low,this.unsigned):p<32?(L=32-p,c(this.high<<L|this.low>>>p,this.low<<L|this.high>>>p,this.unsigned)):(p-=32,L=32-p,c(this.low<<L|this.high>>>p,this.high<<L|this.low>>>p,this.unsigned))},T.rotr=T.rotateRight,T.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},T.toBytes=function(p){return p?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var p=this.high,L=this.low;return[L&255,L>>>8&255,L>>>16&255,L>>>24,p&255,p>>>8&255,p>>>16&255,p>>>24]},T.toBytesBE=function(){var p=this.high,L=this.low;return[p>>>24,p>>>16&255,p>>>8&255,p&255,L>>>24,L>>>16&255,L>>>8&255,L&255]},t.fromBytes=function(p,L,ye){return ye?t.fromBytesLE(p,L):t.fromBytesBE(p,L)},t.fromBytesLE=function(p,L){return new t(p[0]|p[1]<<8|p[2]<<16|p[3]<<24,p[4]|p[5]<<8|p[6]<<16|p[7]<<24,L)},t.fromBytesBE=function(p,L){return new t(p[4]<<24|p[5]<<16|p[6]<<8|p[7],p[0]<<24|p[1]<<16|p[2]<<8|p[3],L)};var Qe=t;return n.default=Qe,"default"in n?n.default:n}({});typeof define=="function"&&define.amd?define([],function(){return aP}):typeof AC=="object"&&typeof lP=="object"&&(AC.exports=aP)});var kC=v($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.loadFileDescriptorSetFromObject=$t.loadFileDescriptorSetFromBuffer=$t.fromJSON=$t.loadSync=$t.load=$t.isAnyExtension=$t.Long=void 0;var WH=Yk(),Qr=hg(),RC=Zx(),NC=oP(),HH=cP();$t.Long=HH;function $H(n){return"@type"in n&&typeof n["@type"]=="string"}$t.isAnyExtension=$H;var dP={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function KH(n,e){return n===""?e:n+"."+e}function QH(n){return n instanceof Qr.Service||n instanceof Qr.Type||n instanceof Qr.Enum}function YH(n){return n instanceof Qr.Namespace||n instanceof Qr.Root}function fP(n,e){let t=KH(e,n.name);return QH(n)?[[t,n]]:YH(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(r=>fP(n.nested[r],t)).reduce((r,i)=>r.concat(i),[]):[]}function uP(n,e){return function(r){return n.toObject(n.decode(r),e)}}function hP(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let r=n.fromObject(t);return n.encode(r).finish()}}function XH(n,e,t,r){let i=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:hP(i),requestDeserialize:uP(i,t),responseSerialize:hP(s),responseDeserialize:uP(s,t),originalName:WH(n.name),requestType:DC(i,r),responseType:DC(s,r)}}function JH(n,e,t,r){let i={};for(let s of n.methodsArray)i[s.name]=XH(s,e,t,r);return i}function DC(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,dP),fileDescriptorProtos:e}}function ZH(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,dP),fileDescriptorProtos:e}}function e$(n,e,t,r){if(n instanceof Qr.Service)return JH(n,e,t,r);if(n instanceof Qr.Type)return DC(n,r);if(n instanceof Qr.Enum)return ZH(n,r);throw new Error("Type mismatch in reflection object handling")}function pg(n,e){let t={};n.resolveAll();let i=n.toDescriptor("proto3").file.map(s=>Buffer.from(RC.FileDescriptorProto.encode(s).finish()));for(let[s,o]of fP(n,""))t[s]=e$(o,s,e,i);return t}function pP(n,e){e=e||{};let t=Qr.Root.fromDescriptor(n);return t.resolveAll(),pg(t,e)}function t$(n,e){return(0,NC.loadProtosWithOptions)(n,e).then(t=>pg(t,e))}$t.load=t$;function n$(n,e){let t=(0,NC.loadProtosWithOptionsSync)(n,e);return pg(t,e)}$t.loadSync=n$;function r$(n,e){e=e||{};let t=Qr.Root.fromJSON(n);return t.resolveAll(),pg(t,e)}$t.fromJSON=r$;function i$(n,e){let t=RC.FileDescriptorSet.decode(n);return pP(t,e)}$t.loadFileDescriptorSetFromBuffer=i$;function s$(n,e){let t=RC.FileDescriptorSet.fromObject(n);return pP(t,e)}$t.loadFileDescriptorSetFromObject=s$;(0,NC.addCommonProtos)()});var Ao=v(Ue=>{"use strict";Object.defineProperty(Ue,"__esModule",{value:!0});Ue.setup=Ue.getChannelzServiceDefinition=Ue.getChannelzHandlers=Ue.unregisterChannelzRef=Ue.registerChannelzSocket=Ue.registerChannelzServer=Ue.registerChannelzSubchannel=Ue.registerChannelzChannel=Ue.ChannelzCallTracker=Ue.ChannelzChildrenTracker=Ue.ChannelzTrace=void 0;var gP=z("net"),Ju=Hn(),eh=ve(),o$=Ur(),a$=Mp(),l$=DS();function OC(n){return{channel_id:n.id,name:n.name}}function FC(n){return{subchannel_id:n.id,name:n.name}}function c$(n){return{server_id:n.id}}function mg(n){return{socket_id:n.id,name:n.name}}var mP=32,xC=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let i=new Date;this.events.push({description:t,severity:e,timestamp:i,childChannel:r?.kind==="channel"?r:void 0,childSubchannel:r?.kind==="subchannel"?r:void 0}),this.events.length>=mP*2&&(this.events=this.events.slice(mP)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:Ri(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:Ri(e.timestamp),channel_ref:e.childChannel?OC(e.childChannel):null,subchannel_ref:e.childSubchannel?FC(e.childSubchannel):null}))}}};Ue.ChannelzTrace=xC;var PC=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,i;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(r=this.subchannelChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(i=this.socketChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:i}of this.channelChildren.values())e.push(i);let t=[];for(let{ref:i}of this.subchannelChildren.values())t.push(i);let r=[];for(let{ref:i}of this.socketChildren.values())r.push(i);return{channels:e,subchannels:t,sockets:r}}};Ue.ChannelzChildrenTracker=PC;var MC=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};Ue.ChannelzCallTracker=MC;var u$=1;function yg(){return u$++}var Zu=[],LC=[],gs=[],BC=[];function h$(n,e,t){let r=yg(),i={id:r,name:n,kind:"channel"};return t&&(Zu[r]={ref:i,getInfo:e}),i}Ue.registerChannelzChannel=h$;function d$(n,e,t){let r=yg(),i={id:r,name:n,kind:"subchannel"};return t&&(LC[r]={ref:i,getInfo:e}),i}Ue.registerChannelzSubchannel=d$;function f$(n,e){let t=yg(),r={id:t,kind:"server"};return e&&(gs[t]={ref:r,getInfo:n}),r}Ue.registerChannelzServer=f$;function p$(n,e,t){let r=yg(),i={id:r,name:n,kind:"socket"};return t&&(BC[r]={ref:i,getInfo:e}),i}Ue.registerChannelzSocket=p$;function g$(n){switch(n.kind){case"channel":delete Zu[n.id];return;case"subchannel":delete LC[n.id];return;case"server":delete gs[n.id];return;case"socket":delete BC[n.id];return}}Ue.unregisterChannelzRef=g$;function m$(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function yP(n){if(n==="")return[];let e=n.split(":").map(r=>m$(r));return[].concat(...e)}function y$(n){if((0,gP.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,gP.isIPv6)(n)){let e,t,r=n.indexOf("::");r===-1?(e=n,t=""):(e=n.substring(0,r),t=n.substring(r+2));let i=Buffer.from(yP(e)),s=Buffer.from(yP(t)),o=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,o,s])}else return null}function vP(n){switch(n){case Ju.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case Ju.ConnectivityState.IDLE:return{state:"IDLE"};case Ju.ConnectivityState.READY:return{state:"READY"};case Ju.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case Ju.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function Ri(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function EP(n){let e=n.getInfo();return{ref:OC(n.ref),data:{target:e.target,state:vP(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Ri(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>OC(t)),subchannel_ref:e.children.subchannels.map(t=>FC(t))}}function _$(n,e){let t=Number.parseInt(n.request.channel_id),r=Zu[t];if(r===void 0){e({code:eh.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:EP(r)})}function v$(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_channel_id);for(;i<Zu.length;i++){let s=Zu[i];if(s!==void 0&&(r.push(EP(s)),r.length>=t))break}e(null,{channel:r,end:i>=gs.length})}function SP(n){let e=n.getInfo();return{ref:c$(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Ri(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>mg(t))}}function E$(n,e){let t=Number.parseInt(n.request.server_id),r=gs[t];if(r===void 0){e({code:eh.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:SP(r)})}function S$(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_server_id);for(;i<gs.length;i++){let s=gs[i];if(s!==void 0&&(r.push(SP(s)),r.length>=t))break}e(null,{server:r,end:i>=gs.length})}function C$(n,e){let t=Number.parseInt(n.request.subchannel_id),r=LC[t];if(r===void 0){e({code:eh.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let i=r.getInfo(),s={ref:FC(r.ref),data:{target:i.target,state:vP(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:Ri(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(o=>mg(o))};e(null,{subchannel:s})}function _P(n){var e;return(0,o$.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=y$(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function w$(n,e){var t,r,i,s,o;let a=Number.parseInt(n.request.socket_id),l=BC[a];if(l===void 0){e({code:eh.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(r=c.security.cipherSuiteOtherName)!==null&&r!==void 0?r:void 0,local_certificate:(i=c.security.localCertificate)!==null&&i!==void 0?i:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,h={ref:mg(l.ref),local:c.localAddress?_P(c.localAddress):null,remote:c.remoteAddress?_P(c.remoteAddress):null,remote_name:(o=c.remoteName)!==null&&o!==void 0?o:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:Ri(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:Ri(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:Ri(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:Ri(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:h})}function T$(n,e){let t=Number.parseInt(n.request.server_id),r=gs[t];if(r===void 0){e({code:eh.Status.NOT_FOUND,details:"No server data found for id "+t});return}let i=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=r.getInfo().sessionChildren.sockets.sort((u,h)=>u.id-h.id),l=[],c=0;for(;c<a.length&&!(a[c].id>=i&&(l.push(mg(a[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=a.length})}function CP(){return{GetChannel:_$,GetTopChannels:v$,GetServer:E$,GetServers:S$,GetSubchannel:C$,GetSocket:w$,GetServerSockets:T$}}Ue.getChannelzHandlers=CP;var gg=null;function wP(){if(gg)return gg;let n=kC().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return gg=(0,l$.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,gg}Ue.getChannelzServiceDefinition=wP;function b$(){(0,a$.registerAdminService)(wP,CP)}Ue.setup=b$});var TP=v(vg=>{"use strict";Object.defineProperty(vg,"__esModule",{value:!0});vg.Subchannel=void 0;var xe=Hn(),I$=xu(),VC=Ze(),_g=ve(),A$=An(),D$=Ur(),ml=Ao(),R$="subchannel",N$=~(1<<31),UC=class{constructor(e,t,r,i,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=i,this.connector=s,this.connectivityState=xe.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new ml.ChannelzCallTracker,this.childrenTracker=new ml.ChannelzChildrenTracker,this.streamTracker=new ml.ChannelzCallTracker;let a={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new I$.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,D$.subchannelAddressToString)(t),this.keepaliveTime=(o=r["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new ml.ChannelzTrace,this.channelzRef=(0,ml.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){VC.trace(_g.LogVerbosity.DEBUG,R$,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){VC.trace(_g.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([xe.ConnectivityState.TRANSIENT_FAILURE],xe.ConnectivityState.CONNECTING):this.transitionToState([xe.ConnectivityState.TRANSIENT_FAILURE],xe.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,N$);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([xe.ConnectivityState.CONNECTING],xe.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(r=>{this.transitionToState([xe.ConnectivityState.READY],xe.ConnectivityState.IDLE),r&&this.keepaliveTime>0&&(this.keepaliveTime*=2,VC.log(_g.LogVerbosity.ERROR,`Connection to ${(0,A$.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([xe.ConnectivityState.CONNECTING],xe.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,r){var i,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(xe.ConnectivityState[this.connectivityState]+" -> "+xe.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+xe.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case xe.ConnectivityState.READY:this.stopBackoff();break;case xe.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case xe.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(i=this.transport)===null||i===void 0||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case xe.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,ml.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([xe.ConnectivityState.CONNECTING,xe.ConnectivityState.READY],xe.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,r,i){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===_g.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,r,i,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([xe.ConnectivityState.IDLE],xe.ConnectivityState.CONNECTING)||this.connectivityState===xe.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([xe.ConnectivityState.TRANSIENT_FAILURE],xe.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};vg.Subchannel=UC});var jC=v(_s=>{"use strict";Object.defineProperty(_s,"__esModule",{value:!0});_s.setup=_s.DEFAULT_PORT=void 0;var bP=Br(),AP=z("dns"),DP=z("util"),k$=tS(),qC=ve(),zC=sn(),O$=Ze(),x$=ve(),ms=An(),IP=z("net"),P$=xu(),M$="dns_resolver";function ys(n){O$.trace(x$.LogVerbosity.DEBUG,M$,n)}_s.DEFAULT_PORT=443;var F$=3e4,L$=DP.promisify(AP.resolveTxt),B$=DP.promisify(AP.lookup);function V$(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(r=>r.length));t++)for(let r of n)t<r.length&&e.push(r[t]);return e}var GC=class{constructor(e,t,r){var i,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,ys("Resolver constructed for target "+(0,ms.uriToString)(e));let a=(0,ms.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,IP.isIPv4)(a.host)||(0,IP.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(i=a.port)!==null&&i!==void 0?i:_s.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:_s.DEFAULT_PORT),this.percentage=Math.random()*100,r["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:qC.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,ms.uriToString)(this.target)}`,metadata:new zC.Metadata};let l={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new P$.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=r["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:F$,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(ys("Returning IP address for target "+(0,ms.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)ys("Failed to parse DNS address "+(0,ms.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:qC.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,ms.uriToString)(this.target)}`,metadata:new zC.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;ys("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=B$(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let r=t.filter(o=>o.family===4),i=t.filter(o=>o.family===6);this.latestLookupResult=V$(i,r).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if(ys("Resolved addresses for target "+(0,ms.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(ys("Resolution error for target "+(0,ms.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=L$(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,k$.extractAndSelectServiceConfig)(t,this.percentage)}catch(r){this.latestServiceConfigError={code:qC.Status.UNAVAILABLE,details:`Parsing service config failed with error ${r.message}`,metadata:new zC.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?ys('resolution update delayed by "min time between resolutions" rate limit'):ys("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function U$(){(0,bP.registerResolver)("dns",GC),(0,bP.registerDefaultScheme)("dns")}_s.setup=U$});var WC=v(vl=>{"use strict";Object.defineProperty(vl,"__esModule",{value:!0});vl.getProxiedConnection=vl.mapProxyName=void 0;var th=Ze(),yl=ve(),q$=Br(),z$=z("http"),G$=z("tls"),j$=Ze(),RP=Ur(),_l=An(),W$=z("url"),H$=jC(),$$="proxy";function vs(n){j$.trace(yl.LogVerbosity.DEBUG,$$,n)}function K$(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new W$.URL(n)}catch{return(0,th.log)(yl.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,th.log)(yl.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let r=null;t.username&&(t.password?((0,th.log)(yl.LogVerbosity.INFO,"userinfo found in proxy URI"),r=`${t.username}:${t.password}`):r=t.username);let i=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${i}:${s}`};return r&&(o.creds=r),vs("Proxy server "+o.address+" set by environment variable "+e),o}function Q$(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(vs("No proxy server list set by environment variable "+e),n.split(",")):[]}function Y$(n,e){var t;let r={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return r;let i=K$();if(!i.address)return r;let s=(0,_l.splitHostPort)(n.path);if(!s)return r;let o=s.host;for(let l of Q$())if(l===o)return vs("Not using proxy for target in no_proxy list: "+(0,_l.uriToString)(n)),r;let a={"grpc.http_connect_target":(0,_l.uriToString)(n)};return i.creds&&(a["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:a}}vl.mapProxyName=Y$;function X$(n,e,t){var r;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let i=e["grpc.http_connect_target"],s=(0,_l.parseUri)(i);if(s===null)return Promise.resolve({});let o=(0,_l.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(r=o.port)!==null&&r!==void 0?r:H$.DEFAULT_PORT}`,l={method:"CONNECT",path:a},c={Host:a};(0,RP.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,RP.subchannelAddressToString)(n);return vs("Using proxy "+u+" to connect to "+l.path),new Promise((h,d)=>{let f=z$.request(l);f.once("connect",(g,y,E)=>{var I;if(f.removeAllListeners(),y.removeAllListeners(),g.statusCode===200)if(vs("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let C=(0,q$.getDefaultAuthority)(s),N=(0,_l.splitHostPort)(C),k=(I=N?.host)!==null&&I!==void 0?I:C,U=G$.connect(Object.assign({host:k,servername:k,socket:y},t),()=>{vs("Successfully established a TLS connection to "+l.path+" through proxy "+u),h({socket:U,realTarget:s})});U.on("error",J=>{vs("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+J.message),d()})}else vs("Successfully established a plaintext connection to "+l.path+" through proxy "+u),h({socket:y,realTarget:s});else(0,th.log)(yl.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+g.statusCode),d()}),f.once("error",g=>{f.removeAllListeners(),(0,th.log)(yl.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+g.message),d()}),f.end()})}vl.getProxiedConnection=X$});var $C=v(Eg=>{"use strict";Object.defineProperty(Eg,"__esModule",{value:!0});Eg.StreamDecoder=void 0;var Ni=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(Ni||{}),HC=class{constructor(){this.readState=Ni.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,r,i=[];for(;t<e.length;)switch(this.readState){case Ni.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=Ni.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case Ni.READING_SIZE:if(r=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+r),this.readSizeRemaining-=r,t+=r,this.readSizeRemaining===0)if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=Ni.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=Ni.NO_DATA,i.push(s)}break;case Ni.READING_MESSAGE:if(r=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+r)),this.readMessageRemaining-=r,t+=r,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=Ni.NO_DATA,i.push(o)}break;default:throw new Error("Unexpected read state")}return i}};Eg.StreamDecoder=HC});var NP=v(Sg=>{"use strict";Object.defineProperty(Sg,"__esModule",{value:!0});Sg.Http2SubchannelCall=void 0;var ki=z("http2"),J$=z("os"),Ae=ve(),Es=sn(),Z$=$C(),e9=Ze(),t9=ve(),n9="subchannel_call";function r9(n){for(let[e,t]of Object.entries(J$.constants.errno))if(t===n)return e;return"Unknown system error "+n}var KC=class{constructor(e,t,r,i,s){this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=s,this.decoder=new Z$.StreamDecoder,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=Ae.Status.UNKNOWN,this.finalStatus=null,this.internalError=null,e.on("response",(o,a)=>{let l="";for(let c of Object.keys(o))l+="		"+c+": "+o[c]+`
`;switch(this.trace(`Received server headers:
`+l),o[":status"]){case 400:this.mappedStatusCode=Ae.Status.INTERNAL;break;case 401:this.mappedStatusCode=Ae.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=Ae.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=Ae.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=Ae.Status.UNAVAILABLE;break;default:this.mappedStatusCode=Ae.Status.UNKNOWN}if(a&ki.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(o);else{let c;try{c=Es.Metadata.fromHttp2Headers(o)}catch(u){this.endCall({code:Ae.Status.UNKNOWN,details:u.message,metadata:new Es.Metadata});return}this.listener.onReceiveMetadata(c)}}),e.on("trailers",o=>{this.handleTrailers(o)}),e.on("data",o=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+o.length);let a=this.decoder.write(o);for(let l of a)this.trace("parsed message of length "+l.length),this.callEventTracker.addMessageReceived(),this.tryPush(l)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var o;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((o=this.finalStatus)===null||o===void 0?void 0:o.code)===Ae.Status.OK)return;let a,l="";switch(e.rstCode){case ki.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;a=Ae.Status.INTERNAL,l=`Received RST_STREAM with code ${e.rstCode}`;break;case ki.constants.NGHTTP2_REFUSED_STREAM:a=Ae.Status.UNAVAILABLE,l="Stream refused by server";break;case ki.constants.NGHTTP2_CANCEL:a=Ae.Status.CANCELLED,l="Call cancelled";break;case ki.constants.NGHTTP2_ENHANCE_YOUR_CALM:a=Ae.Status.RESOURCE_EXHAUSTED,l="Bandwidth exhausted or memory limit exceeded";break;case ki.constants.NGHTTP2_INADEQUATE_SECURITY:a=Ae.Status.PERMISSION_DENIED,l="Protocol not secure enough";break;case ki.constants.NGHTTP2_INTERNAL_ERROR:a=Ae.Status.INTERNAL,this.internalError===null?l=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(a=Ae.Status.UNAVAILABLE,l=this.internalError.message):l=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:a=Ae.Status.INTERNAL,l=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:a,details:l,metadata:new Es.Metadata,rstCode:e.rstCode})})}),e.on("error",o=>{o.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+o.message+" code="+o.code+" errno="+r9(o.errno)+" syscall="+o.syscall),this.internalError=o),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:Ae.Status.UNAVAILABLE,details:"Connection dropped",metadata:new Es.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){e9.trace(t9.LogVerbosity.DEBUG,n9,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===Ae.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==Ae.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let r;try{r=Es.Metadata.fromHttp2Headers(e)}catch{r=new Es.Metadata}let i=r.getMap(),s=this.mappedStatusCode;if(s===Ae.Status.UNKNOWN&&typeof i["grpc-status"]=="string"){let l=Number(i["grpc-status"]);l in Ae.Status&&(s=l,this.trace("received status code "+l+" from server")),r.remove("grpc-status")}let o="";if(typeof i["grpc-message"]=="string"){try{o=decodeURI(i["grpc-message"])}catch{o=i["grpc-message"]}r.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:r};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===Ae.Status.OK?t=ki.constants.NGHTTP2_NO_ERROR:t=ki.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new Es.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==Ae.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=i=>{process.nextTick(()=>{var s;let o=Ae.Status.UNAVAILABLE;i?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=Ae.Status.INTERNAL),i&&this.cancelWithStatus(o,`Write error: ${i.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(i){this.endCall({code:Ae.Status.UNAVAILABLE,details:`Write failed with error ${i.message}`,metadata:new Es.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};Sg.Http2SubchannelCall=KC});var QC=v(Cg=>{"use strict";Object.defineProperty(Cg,"__esModule",{value:!0});Cg.getNextCallNumber=void 0;var i9=0;function s9(){return i9++}Cg.getNextCallNumber=s9});var xP=v(Tg=>{"use strict";Object.defineProperty(Tg,"__esModule",{value:!0});Tg.Http2SubchannelConnector=void 0;var ew=z("http2"),kP=z("tls"),YC=Ao(),nh=ve(),o9=WC(),Sl=Ze(),OP=Br(),wg=Ur(),El=An(),a9=z("net"),l9=NP(),c9=QC(),XC="transport",u9="transport_flowctrl",h9=LE().version,{HTTP2_HEADER_AUTHORITY:d9,HTTP2_HEADER_CONTENT_TYPE:f9,HTTP2_HEADER_METHOD:p9,HTTP2_HEADER_PATH:g9,HTTP2_HEADER_TE:m9,HTTP2_HEADER_USER_AGENT:y9}=ew.constants,_9=2e4,v9=Buffer.from("too_many_pings","ascii"),JC=class{constructor(e,t,r,i){this.session=e,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=_9,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new YC.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,wg.subchannelAddressToString)(t),r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,YC.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${h9}`,r["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=r["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let l=!1;s===ew.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals(v9)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),Sl.isTracerEnabled(XC)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let i=this.session.socket,s=i.remoteAddress?(0,wg.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,o=i.localAddress?(0,wg.stringToSubchannelAddress)(i.localAddress,i.localPort):null,a;if(this.session.encrypted){let c=i,u=c.getCipher(),h=c.getCertificate(),d=c.getPeerCertificate();a={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:h&&"raw"in h?h.raw:null,remoteCertificate:d&&"raw"in d?d.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(r=this.session.state.remoteWindowSize)!==null&&r!==void 0?r:null}}trace(e){Sl.trace(nh.LogVerbosity.DEBUG,XC,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){Sl.trace(nh.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){Sl.trace(nh.LogVerbosity.DEBUG,u9,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){Sl.trace(nh.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((r,i,s)=>{r&&(this.keepaliveTrace("Ping failed with error "+r.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,i,s){let o=e.toHttp2Headers();o[d9]=t,o[y9]=this.userAgent,o[f9]="application/grpc",o[p9]="POST",o[g9]=r,o[m9]="trailers";let a;try{a=this.session.request(o)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var h;(h=s.onCallEnd)===null||h===void 0||h.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var h;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(h=s.onStreamEnd)===null||h===void 0||h.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var h;(h=s.onCallEnd)===null||h===void 0||h.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var h;(h=s.onStreamEnd)===null||h===void 0||h.call(s,u)}},c=new l9.Http2SubchannelCall(a,l,i,this,(0,c9.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}shutdown(){this.session.close(),(0,YC.unregisterChannelzRef)(this.channelzRef)}},ZC=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){Sl.trace(nh.LogVerbosity.DEBUG,XC,(0,El.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,i){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,l,c;let u;i.realTarget?(u=(0,El.uriToString)(i.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,El.uriToString)(i.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,wg.subchannelAddressToString)(e)));let h=(0,OP.getDefaultAuthority)((a=i.realTarget)!==null&&a!==void 0?a:this.channelTarget),d=t._getConnectionOptions()||{};d.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?d.maxSessionMemory=r["grpc-node.max_session_memory"]:d.maxSessionMemory=Number.MAX_SAFE_INTEGER;let f="http://";if("secureContext"in d){if(f="https://",r["grpc.ssl_target_name_override"]){let E=r["grpc.ssl_target_name_override"];d.checkServerIdentity=(I,C)=>(0,kP.checkServerIdentity)(E,C),d.servername=E}else{let E=(c=(l=(0,El.splitHostPort)(h))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";d.servername=E}i.socket&&(d.createConnection=(E,I)=>i.socket)}else d.createConnection=(E,I)=>i.socket?i.socket:a9.connect(e);d=Object.assign(Object.assign(Object.assign({},d),e),{enableTrace:r["grpc-node.tls_enable_trace"]===1});let g=ew.connect(f+h,d);this.session=g;let y="Failed to connect";g.unref(),g.once("connect",()=>{g.removeAllListeners(),s(new JC(g,e,r,u)),this.session=null}),g.once("close",()=>{this.session=null,setImmediate(()=>{o(`${y} (${new Date().toISOString()})`)})}),g.once("error",E=>{y=E.message,this.trace("connection failed with error "+y)})})}connect(e,t,r){var i,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let a=r["grpc.ssl_target_name_override"];o.checkServerIdentity=(l,c)=>(0,kP.checkServerIdentity)(a,c),o.servername=a}else if("grpc.http_connect_target"in r){let a=(0,OP.getDefaultAuthority)((i=(0,El.parseUri)(r["grpc.http_connect_target"]))!==null&&i!==void 0?i:{path:"localhost"}),l=(0,El.splitHostPort)(a);o.servername=(s=l?.host)!==null&&s!==void 0?s:a}r["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,o9.getProxiedConnection)(e,r,o).then(a=>this.createSession(e,t,r,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};Tg.Http2SubchannelConnector=ZC});var PP=v(Cl=>{"use strict";Object.defineProperty(Cl,"__esModule",{value:!0});Cl.getSubchannelPool=Cl.SubchannelPool=void 0;var E9=_k(),S9=TP(),C9=Ur(),w9=An(),T9=xP(),b9=1e4,rh=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let i=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());i.length>0&&(e=!1),this.pool[t]=i}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},b9),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,r,i){this.ensureCleanupTask();let s=(0,w9.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let l of a)if((0,C9.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,E9.channelOptionsEqual)(r,l.channelArguments)&&i._equals(l.channelCredentials))return l.subchannel}let o=new S9.Subchannel(e,t,r,i,new T9.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:r,channelCredentials:i,subchannel:o}),o.ref(),o}};Cl.SubchannelPool=rh;var I9=new rh;function A9(n){return n?I9:new rh}Cl.getSubchannelPool=A9});var nw=v(wl=>{"use strict";Object.defineProperty(wl,"__esModule",{value:!0});wl.FilterStackFactory=wl.FilterStack=void 0;var bg=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMessage(t);return t}receiveMessage(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};wl.FilterStack=bg;var tw=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new bg(this.factories.map(e=>e.createFilter()))}};wl.FilterStackFactory=tw});var rw=v(Ig=>{"use strict";Object.defineProperty(Ig,"__esModule",{value:!0});Ig.CompressionAlgorithms=void 0;var MP=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(MP||(Ig.CompressionAlgorithms=MP={}))});var Dg=v(Ag=>{"use strict";Object.defineProperty(Ag,"__esModule",{value:!0});Ag.BaseFilter=void 0;var iw=class{sendMetadata(e){return m(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return m(this,null,function*(){return e})}receiveMessage(e){return m(this,null,function*(){return e})}receiveTrailers(e){return e}};Ag.BaseFilter=iw});var BP=v(bl=>{"use strict";Object.defineProperty(bl,"__esModule",{value:!0});bl.CompressionFilterFactory=bl.CompressionFilter=void 0;var Rg=z("zlib"),LP=rw(),D9=ve(),R9=Dg(),N9=Ze(),k9=n=>typeof n=="number"&&typeof LP.CompressionAlgorithms[n]=="string",Tl=class{writeMessage(e,t){return m(this,null,function*(){let r=e;t&&(r=yield this.compressMessage(r));let i=Buffer.allocUnsafe(r.length+5);return i.writeUInt8(t?1:0,0),i.writeUInt32BE(r.length,1),r.copy(i,5),i})}readMessage(e){return m(this,null,function*(){let t=e.readUInt8(0)===1,r=e.slice(5);return t&&(r=yield this.decompressMessage(r)),r})}},Do=class extends Tl{compressMessage(e){return m(this,null,function*(){return e})}writeMessage(e,t){return m(this,null,function*(){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},sw=class extends Tl{compressMessage(e){return new Promise((t,r)=>{Rg.deflate(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{Rg.inflate(e,(i,s)=>{i?r(i):t(s)})})}},ow=class extends Tl{compressMessage(e){return new Promise((t,r)=>{Rg.gzip(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{Rg.unzip(e,(i,s)=>{i?r(i):t(s)})})}},aw=class extends Tl{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function FP(n){switch(n){case"identity":return new Do;case"deflate":return new sw;case"gzip":return new ow;default:return new aw(n)}}var Ng=class extends R9.BaseFilter{constructor(e,t){var r;super(),this.sharedFilterConfig=t,this.sendCompression=new Do,this.receiveCompression=new Do,this.currentCompressionAlgorithm="identity";let i=e["grpc.default_compression_algorithm"];if(i!==void 0)if(k9(i)){let s=LP.CompressionAlgorithms[i],o=(r=t.serverSupportedEncodingHeader)===null||r===void 0?void 0:r.split(",");(!o||o.includes(s))&&(this.currentCompressionAlgorithm=s,this.sendCompression=FP(this.currentCompressionAlgorithm))}else N9.log(D9.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${i}`)}sendMetadata(e){return m(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let i=t[0];typeof i=="string"&&(this.receiveCompression=FP(i))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new Do,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return m(this,null,function*(){var t;let r=yield e,i;return this.sendCompression instanceof Do?i=!1:i=(((t=r.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(r.message,i),flags:r.flags}})}receiveMessage(e){return m(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};bl.CompressionFilter=Ng;var lw=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new Ng(this.options,this.sharedFilterConfig)}};bl.CompressionFilterFactory=lw});var UP=v(Il=>{"use strict";Object.defineProperty(Il,"__esModule",{value:!0});Il.MaxMessageSizeFilterFactory=Il.MaxMessageSizeFilter=void 0;var O9=Dg(),kg=ve(),VP=sn(),Og=class extends O9.BaseFilter{constructor(e){super(),this.maxSendMessageSize=kg.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=kg.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,"grpc.max_send_message_length"in e&&(this.maxSendMessageSize=e["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in e&&(this.maxReceiveMessageSize=e["grpc.max_receive_message_length"])}sendMessage(e){return m(this,null,function*(){if(this.maxSendMessageSize===-1)return e;{let t=yield e;if(t.message.length>this.maxSendMessageSize)throw{code:kg.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${t.message.length} vs. ${this.maxSendMessageSize})`,metadata:new VP.Metadata};return t}})}receiveMessage(e){return m(this,null,function*(){if(this.maxReceiveMessageSize===-1)return e;{let t=yield e;if(t.length>this.maxReceiveMessageSize)throw{code:kg.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${t.length} vs. ${this.maxReceiveMessageSize})`,metadata:new VP.Metadata};return t}})}};Il.MaxMessageSizeFilter=Og;var cw=class{constructor(e){this.options=e}createFilter(){return new Og(this.options)}};Il.MaxMessageSizeFilterFactory=cw});var xg=v(Yr=>{"use strict";Object.defineProperty(Yr,"__esModule",{value:!0});Yr.deadlineToString=Yr.getRelativeTimeout=Yr.getDeadlineTimeoutString=Yr.minDeadline=void 0;function x9(...n){let e=1/0;for(let t of n){let r=t instanceof Date?t.getTime():t;r<e&&(e=r)}return e}Yr.minDeadline=x9;var P9=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function M9(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[r,i]of P9){let s=t/i;if(s<1e8)return String(Math.ceil(s))+r}throw new Error("Deadline is too far in the future")}Yr.getDeadlineTimeoutString=M9;var F9=2147483647;function L9(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),r=e-t;return r<0?0:r>F9?1/0:r}Yr.getRelativeTimeout=L9;function B9(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}Yr.deadlineToString=B9});var Mg=v(Pg=>{"use strict";Object.defineProperty(Pg,"__esModule",{value:!0});Pg.restrictControlPlaneStatusCode=void 0;var Xr=ve(),V9=[Xr.Status.OK,Xr.Status.INVALID_ARGUMENT,Xr.Status.NOT_FOUND,Xr.Status.ALREADY_EXISTS,Xr.Status.FAILED_PRECONDITION,Xr.Status.ABORTED,Xr.Status.OUT_OF_RANGE,Xr.Status.DATA_LOSS];function U9(n,e){return V9.includes(n)?{code:Xr.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${Xr.Status[n]} ${e}`}:{code:n,details:e}}Pg.restrictControlPlaneStatusCode=U9});var zP=v(Bg=>{"use strict";Object.defineProperty(Bg,"__esModule",{value:!0});Bg.LoadBalancingCall=void 0;var qP=Hn(),Fg=ve(),q9=xg(),Lg=sn(),ih=is(),z9=An(),G9=Ze(),uw=Mg(),j9=z("http2"),W9="load_balancing_call",hw=class{constructor(e,t,r,i,s,o,a){var l,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),h="";u.length>=2&&(h=u[1]);let d=(c=(l=(0,z9.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${d}/${h}`}trace(e){G9.trace(Fg.LogVerbosity.DEBUG,W9,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,i;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(r=this.listener)===null||r===void 0||r.onReceiveStatus(s),(i=this.onCallEnded)===null||i===void 0||i.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+ih.PickResultType[r.pickResultType]+" subchannel: "+i+" status: "+((e=r.status)===null||e===void 0?void 0:e.code)+" "+((t=r.status)===null||t===void 0?void 0:t.details)),r.pickResultType){case ih.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let h=this.metadata.clone();if(h.merge(a),h.get("authorization").length>1&&this.outputStatus({code:Fg.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new Lg.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==qP.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+qP.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&h.set("grpc-timeout",(0,q9.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(h,this.host,this.methodName,{onReceiveMetadata:d=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(d)},onReceiveMessage:d=>{this.trace("Received message"),this.listener.onReceiveMessage(d)},onReceiveStatus:d=>{this.trace("Received status"),d.rstCode===j9.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(d,"REFUSED"):this.outputStatus(d,"PROCESSED")}})}catch(d){this.trace("Failed to start call on picked subchannel "+i+" with error "+d.message),this.outputStatus({code:Fg.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+d.message,metadata:new Lg.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=r.onCallStarted)===null||u===void 0||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:l,details:c}=(0,uw.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:Fg.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:l,details:c,metadata:new Lg.Metadata},"PROCESSED")});break;case ih.PickResultType.DROP:let{code:s,details:o}=(0,uw.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:r.status.metadata},"DROP")});break;case ih.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:l}=(0,uw.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:a,details:l,metadata:r.status.metadata},"PROCESSED")})}break;case ih.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new Lg.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};Bg.LoadBalancingCall=hw});var jP=v(Ug=>{"use strict";Object.defineProperty(Ug,"__esModule",{value:!0});Ug.ResolvingCall=void 0;var Al=ve(),Vg=xg(),GP=sn(),H9=Ze(),$9=Mg(),K9="resolving_call",dw=class{constructor(e,t,r,i,s,o){this.channel=e,this.method=t,this.filterStackFactory=i,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&Al.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(Al.Status.CANCELLED,"Cancelled by parent call")}),r.flags&Al.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,Vg.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){H9.trace(Al.LogVerbosity.DEBUG,K9,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,Vg.deadlineToString)(this.deadline));let e=(0,Vg.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(Al.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(r=>r(t)),process.nextTick(()=>{var r;(r=this.listener)===null||r===void 0||r.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(i=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,i.message),this.pendingHalfClose&&r.halfClose()},i=>{this.cancelWithStatus(i.code,i.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==Al.Status.OK){let{code:r,details:i}=(0,$9.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:r,details:i,metadata:new GP.Metadata});return}if(t.methodConfig.timeout){let r=new Date;r.setSeconds(r.getSeconds()+t.methodConfig.timeout.seconds),r.setMilliseconds(r.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,Vg.minDeadline)(this.deadline,r),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(r=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(r,{onReceiveMetadata:i=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(i))},onReceiveMessage:i=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(i).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:i=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=i:this.outputStatus(i)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},r=>{this.outputStatus(r)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new GP.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};Ug.ResolvingCall=dw});var WP=v(Ss=>{"use strict";Object.defineProperty(Ss,"__esModule",{value:!0});Ss.RetryingCall=Ss.MessageBufferTracker=Ss.RetryThrottler=void 0;var qg=ve(),Q9=sn(),Y9=Ze(),X9="retrying_call",pw=class{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};Ss.RetryThrottler=pw;var gw=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;return this.limitPerCall-i<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,i+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;if(i<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${i}`);this.allocatedPerCall.set(t,i-e)}freeAll(e){var t;let r=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<r)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}};Ss.MessageBufferTracker=gw;var fw="grpc-previous-rpc-attempts",mw=class{constructor(e,t,r,i,s,o,a,l,c){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){Y9.trace(qg.LogVerbosity.DEBUG,X9,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new Q9.Metadata});for(let{call:r}of this.underlyingCalls)r.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let r=this.getBufferEntry(t);r.allocated&&this.bufferTracker.free(r.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(qg.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[r,i]of this.underlyingCalls.entries())i.state==="ACTIVE"&&i.nextMessageToSend>e&&(e=i.nextMessageToSend,t=r);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(r=>r===t||r.toString().toLowerCase()===qg.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,i=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,i),r}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}let i;if(e===null)i=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else i=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},i)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var i,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((i=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&i!==void 0?i:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(r===null)a=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(r,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var r;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===qg.Status.OK){(r=this.retryThrottler)===null||r===void 0||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let i=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(i.maxAttempts,5))return;let s=(e=i.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(r=(t=this.hedgingTimer).unref)===null||r===void 0||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,i=this.initialMetadata.clone();r>0&&i.set(fw,`${r}`);let s=!1;e.start(i,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,r>0&&o.set(fw,`${r}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&r>0&&o.metadata.set(fw,`${r}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let i=this.underlyingCalls[e],s=i.nextMessageToSend;(r=(t=this.getBufferEntry(s)).callback)===null||r===void 0||r.call(t),this.clearSentMessages(),i.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:i=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let i={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:i,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(r=e.callback)===null||r===void 0||r.call(e);for(let[a,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};Ss.RetryingCall=mw});var Gg=v(zg=>{"use strict";Object.defineProperty(zg,"__esModule",{value:!0});zg.BaseSubchannelWrapper=void 0;var yw=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};zg.BaseSubchannelWrapper=yw});var KP=v(Hg=>{"use strict";Object.defineProperty(Hg,"__esModule",{value:!0});Hg.InternalChannel=void 0;var J9=Ip(),Z9=yk(),eK=PP(),HP=is(),sh=ve(),tK=nw(),nK=BP(),$P=Br(),_w=Ze(),rK=UP(),iK=WC(),jg=An(),Jr=Hn(),oh=Ao(),sK=zP(),oK=xg(),aK=jP(),vw=QC(),lK=Mg(),Ew=WP(),cK=Gg(),uK=2147483647,hK=1e3,dK=30*60*1e3,Wg=new Map,fK=1<<24,pK=1<<20,Sw=class extends cK.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(r,i,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},Cw=class{constructor(e,t,r){var i,s,o,a,l,c,u,h;if(this.credentials=t,this.options=r,this.connectivityState=Jr.ConnectivityState.IDLE,this.currentPicker=new HP.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new oh.ChannelzCallTracker,this.childrenTracker=new oh.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof J9.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let d=(0,jg.parseUri)(e);if(d===null)throw new Error(`Could not parse target name "${e}"`);let f=(0,$P.mapUriDefaultScheme)(d);if(f===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},uK),(s=(i=this.callRefTimer).unref)===null||s===void 0||s.call(i),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new oh.ChannelzTrace,this.channelzRef=(0,oh.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,$P.getDefaultAuthority)(f);let g=(0,iK.mapProxyName)(f,r);this.target=g.target,this.options=Object.assign({},this.options,g.extraOptions),this.subchannelPool=(0,eK.getSubchannelPool)(((o=r["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new Ew.MessageBufferTracker((a=r["grpc.retry_buffer_size"])!==null&&a!==void 0?a:fK,(l=r["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:pK),this.keepaliveTime=(c=r["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=r["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:dK,hK);let y={createSubchannel:(I,C)=>{let N=this.subchannelPool.getOrCreateSubchannel(this.target,I,Object.assign({},this.options,C),this.credentials);N.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",N.getChannelzRef());let k=new Sw(N,this);return this.wrappedSubchannels.add(k),k},updateState:(I,C)=>{this.currentPicker=C;let N=this.pickQueue.slice();this.pickQueue=[],N.length>0&&this.callRefTimerUnref();for(let k of N)k.doPick();this.updateState(I)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:I=>{this.channelzEnabled&&this.childrenTracker.refChild(I)},removeChannelzChild:I=>{this.channelzEnabled&&this.childrenTracker.unrefChild(I)}};this.resolvingLoadBalancer=new Z9.ResolvingLoadBalancer(this.target,y,r,(I,C)=>{I.retryThrottling?Wg.set(this.getTarget(),new Ew.RetryThrottler(I.retryThrottling.maxTokens,I.retryThrottling.tokenRatio,Wg.get(this.getTarget()))):Wg.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=C,this.currentResolutionError=null,process.nextTick(()=>{let N=this.configSelectionQueue;this.configSelectionQueue=[],N.length>0&&this.callRefTimerUnref();for(let k of N)k.getConfig()})},I=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+I.code+' and details "'+I.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,lK.restrictControlPlaneStatusCode)(I.code,I.details)),{metadata:I.metadata}));let C=this.configSelectionQueue;this.configSelectionQueue=[],C.length>0&&this.callRefTimerUnref();for(let N of C)N.reportResolverError(I)}),this.filterStackFactory=new tK.FilterStackFactory([new rK.MaxMessageSizeFilterFactory(this.options),new nK.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let E=new Error;(0,_w.trace)(sh.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((h=E.stack)===null||h===void 0?void 0:h.substring(E.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,_w.trace)(t??sh.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,jg.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,i;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(i=(r=this.callRefTimer).ref)===null||i===void 0||i.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(r=>r===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,_w.trace)(sh.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,jg.uriToString)(this.target)+" "+Jr.ConnectivityState[this.connectivityState]+" -> "+Jr.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Jr.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let r of t)e!==r.currentState&&(r.timer&&clearTimeout(r.timer),this.removeConnectivityStateWatcher(r),r.callback());e!==Jr.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(Jr.ConnectivityState.IDLE),this.currentPicker=new HP.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(r=(t=this.idleTimer).unref)===null||r===void 0||r.call(t)}maybeStartIdleTimer(){this.connectivityState!==Jr.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===sh.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,i,s){let o=(0,vw.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new sK.LoadBalancingCall(this,e,t,r,i,s,o)}createRetryingCall(e,t,r,i,s){let o=(0,vw.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new Ew.RetryingCall(this,e,t,r,i,s,o,this.retryBufferTracker,Wg.get(this.getTarget()))}createInnerCall(e,t,r,i,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,r,i,s):this.createRetryingCall(e,t,r,i,s)}createResolvingCall(e,t,r,i,s){let o=(0,vw.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,oK.deadlineToString)(t));let a={deadline:t,flags:s??sh.Propagate.DEFAULTS,host:r??this.defaultAuthority,parentCall:i},l=new aK.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(Jr.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,oh.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,jg.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===Jr.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let i=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(r,new Error("Deadline passed without connectivity state change"));return}i=setTimeout(()=>{this.removeConnectivityStateWatcher(s),r(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:r,timer:i};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===Jr.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,r,i,s)}};Hg.InternalChannel=Cw});var IS=v($g=>{"use strict";Object.defineProperty($g,"__esModule",{value:!0});$g.ChannelImplementation=void 0;var gK=Ip(),mK=KP(),ww=class{constructor(e,t,r){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof gK.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new mK.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,i,s)}};$g.ChannelImplementation=ww});var iM=v(tr=>{"use strict";Object.defineProperty(tr,"__esModule",{value:!0});tr.Http2ServerCallStream=tr.ServerDuplexStreamImpl=tr.ServerWritableStreamImpl=tr.ServerReadableStreamImpl=tr.ServerUnaryCallImpl=void 0;var ZP=z("events"),Dl=z("http2"),Iw=z("stream"),eM=z("zlib"),tM=z("util"),qe=ve(),Aw=sn(),yK=$C(),nM=Ze(),lh=Ep(),rM="server_call",_K=(0,tM.promisify)(eM.unzip),vK=(0,tM.promisify)(eM.inflate);function ah(n){nM.trace(qe.LogVerbosity.DEBUG,rM,n)}var EK="grpc-accept-encoding",SK="grpc-encoding",QP="grpc-message",YP="grpc-status",XP="grpc-timeout",CK=/(\d{1,8})\s*([HMSmun])/,wK={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},TK={[EK]:"identity,deflate,gzip",[SK]:"identity"},JP={[Dl.constants.HTTP2_HEADER_STATUS]:Dl.constants.HTTP_STATUS_OK,[Dl.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},bK={waitForTrailers:!0},Tw=class extends ZP.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};tr.ServerUnaryCallImpl=Tw;var Kg=class extends Iw.Readable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};tr.ServerReadableStreamImpl=Kg;var ch=class extends Iw.Writable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=i,this.cancelled=!1,this.trailingMetadata=new Aw.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let i=this.call.serializeMessage(e);if(!this.call.write(i)){this.call.once("drain",r);return}}catch(i){this.emit("error",{details:(0,lh.getErrorMessage)(i),code:qe.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:qe.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};tr.ServerWritableStreamImpl=ch;var Rl=class extends Iw.Duplex{constructor(e,t,r,i,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=i,this.cancelled=!1,this.trailingMetadata=new Aw.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};tr.ServerDuplexStreamImpl=Rl;Rl.prototype._read=Kg.prototype._read;Rl.prototype._write=ch.prototype._write;Rl.prototype._final=ch.prototype._final;var bw=class extends ZP.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=qe.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=qe.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",i=>{}),this.stream.once("close",()=>{var i;ah("Request to method "+((i=this.handler)===null||i===void 0?void 0:i.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:qe.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){return t==="deflate"?vK(e.subarray(5)):t==="gzip"?_K(e.subarray(5)):t==="identity"?e.subarray(5):Promise.reject({code:qe.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},JP),TK),t);this.stream.respond(r,bK)}receiveMetadata(e){let t=Aw.Metadata.fromHttp2Headers(e);nM.isTracerEnabled(rM)&&ah("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(XP);if(r.length>0){let i=r[0].toString().match(CK);if(i===null){let a=new Error("Invalid deadline");return a.code=qe.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+i[1]*wK[i[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout(IK,s,this),t.remove(XP)}return t.remove(Dl.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(Dl.constants.HTTP2_HEADER_TE),t.remove(Dl.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:i}=this,s=0,o=this,a=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(h){if(s+=h.byteLength,l!==-1&&s>l){i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),r({code:qe.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}a.push(h)}function u(h){if(i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),h!==void 0){r({code:qe.Status.INTERNAL,details:h.message});return}if(s===0){r({code:qe.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let d=Buffer.concat(a,s),g=d.readUInt8(0)===1?e:"identity",y=o.getDecompressedMessage(d,g);if(Buffer.isBuffer(y)){t(o.deserializeMessageWithInternalError(y));return}y.then(E=>t(o.deserializeMessageWithInternalError(E)),E=>r(E.code?E:{code:qe.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return m(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,lh.getErrorMessage)(t),code:qe.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,i=Buffer.allocUnsafe(r+5);return i.writeUInt8(0,0),i.writeUInt32BE(r,1),t.copy(i,5),i}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,r,i){return m(this,null,function*(){if(!this.checkCancelled()){if(r===void 0&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:qe.Status.OK,details:"OK",metadata:r})}catch(s){this.sendError({details:(0,lh.getErrorMessage)(s),code:qe.Status.INTERNAL})}}})}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===qe.Status.OK),!this.checkCancelled())if(ah("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+qe.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var i;let s=Object.assign({[YP]:e.code,[QP]:encodeURI(e.details)},(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let i=Object.assign(Object.assign({[YP]:e.code,[QP]:encodeURI(e.details)},JP),(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.respond(i,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:qe.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:qe.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new yK.StreamDecoder,i=!1,s=!1,o=!1,a=()=>m(this,null,function*(){!o&&i&&!s&&(o=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>m(this,null,function*(){let c=r.write(l);s=!0,this.stream.pause();for(let u of c){if(this.maxReceiveMessageSize!==-1&&u.length>this.maxReceiveMessageSize){this.sendError({code:qe.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${u.length} vs. ${this.maxReceiveMessageSize})`});return}this.emit("receiveMessage");let d=u.readUInt8(0)===1?t:"identity",f=yield this.getDecompressedMessage(u,d);if(!f)return;yield this.pushOrBufferMessage(e,f)}s=!1,this.stream.resume(),yield a()})),this.stream.once("end",()=>m(this,null,function*(){i=!0,yield a()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(t===null||r===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return m(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return m(this,null,function*(){if(t===null){ah("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}ah("Received message of length "+t.length),this.isPushPending=!0;try{let r=yield this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let i=(0,lh.getErrorCode)(r);(i===null||i<qe.Status.OK||i>qe.Status.UNAUTHENTICATED)&&(i=qe.Status.INTERNAL),e.emit("error",{details:(0,lh.getErrorMessage)(r),code:i})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};tr.Http2ServerCallStream=bw;function IK(n){let e=new Error("Deadline exceeded");e.code=qe.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var Nw=v(Qg=>{"use strict";Object.defineProperty(Qg,"__esModule",{value:!0});Qg.ServerCredentials=void 0;var sM=YE(),uh=class{static createInsecure(){return new Dw}static createSsl(e,t,r=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof r!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);i.push(a.cert_chain),s.push(a.private_key)}return new Rw({ca:e||(0,sM.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:sM.CIPHER_SUITES})}};Qg.ServerCredentials=uh;var Dw=class extends uh{_isSecure(){return!1}_getSettings(){return null}},Rw=class extends uh{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var lM=v(Jg=>{"use strict";Object.defineProperty(Jg,"__esModule",{value:!0});Jg.Server=void 0;var Cs=z("http2"),Oi=ve(),Ro=iM(),AK=Nw(),oM=Br(),Yg=Ze(),vr=Ur(),DK=An(),En=Ao(),Xg=~(1<<31),RK=~(1<<31),NK=2e4,{HTTP2_HEADER_PATH:aM}=Cs.constants,kK="server";function OK(){}function kw(n){return{code:Oi.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function xK(n,e){let t=kw(e);switch(n){case"unary":return(r,i)=>{i(t,null)};case"clientStream":return(r,i)=>{i(t,null)};case"serverStream":return r=>{r.emit("error",t)};case"bidi":return r=>{r.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var Ow=class{constructor(e){var t,r,i,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new En.ChannelzTrace,this.callTracker=new En.ChannelzCallTracker,this.listenerChildrenTracker=new En.ChannelzChildrenTracker,this.sessionChildrenTracker=new En.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,En.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:Xg,this.maxConnectionAgeGraceMs=(r=this.options["grpc.max_connection_age_grace_ms"])!==null&&r!==void 0?r:Xg,this.keepaliveTimeMs=(i=this.options["grpc.keepalive_time_ms"])!==null&&i!==void 0?i:RK,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:NK,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,i;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,vr.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,l=o.localAddress?(0,vr.stringToSubchannelAddress)(o.localAddress,o.localPort):null,c;if(e.encrypted){let h=o,d=h.getCipher(),f=h.getCertificate(),g=h.getPeerCertificate();c={cipherSuiteStandardName:(t=d.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:d.standardName?null:d.name,localCertificate:f&&"raw"in f?f.raw:null,remoteCertificate:g&&"raw"in g?g.raw:null}}else c=null;return{remoteAddress:a,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(r=e.state.localWindowSize)!==null&&r!==void 0?r:null,remoteFlowControlWindow:(i=e.state.remoteWindowSize)!==null&&i!==void 0?i:null}}}trace(e){Yg.trace(Oi.LogVerbosity.DEBUG,kK,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let r=Object.keys(e);if(r.length===0)throw new Error("Cannot add an empty service to a server");r.forEach(i=>{let s=e[i],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[i],l;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?l=a.bind(t):l=xK(o,i),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(r=>{let i=e[r];this.unregister(i.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof AK.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof r!="function")throw new TypeError("callback must be a function");let i=(0,DK.parseUri)(e);if(i===null)throw new Error(`Could not parse port "${e}"`);let s=(0,oM.mapUriDefaultScheme)(i);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(f,g)=>{process.nextTick(()=>r(f,g))},l=()=>{let f;if(t._isSecure()){let g=Object.assign(o,t._getSettings());g.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,f=Cs.createSecureServer(g),f.on("secureConnection",y=>{y.on("error",E=>{this.trace("An incoming TLS connection closed with error: "+E.message)})})}else f=Cs.createServer(o);return f.setTimeout(0,OK),this._setupHandlers(f),f},c=(f,g,y)=>f.length===0?Promise.resolve({port:g,count:y}):Promise.all(f.map(E=>{this.trace("Attempting to bind "+(0,vr.subchannelAddressToString)(E));let I;(0,vr.isTcpSubchannelAddress)(E)?I={host:E.host,port:g}:I=E;let C=l();return new Promise((N,k)=>{let U=J=>{this.trace("Failed to bind "+(0,vr.subchannelAddressToString)(E)+" with error "+J.message),N(J)};C.once("error",U),C.listen(I,()=>{if(this.shutdown){C.close(),N(new Error("bindAsync failed because server is shutdown"));return}let J=C.address(),ue;typeof J=="string"?ue={path:J}:ue={host:J.address,port:J.port};let gt=(0,En.registerChannelzSocket)((0,vr.subchannelAddressToString)(ue),()=>({localAddress:ue,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(gt),this.http2ServerList.push({server:C,channelzRef:gt}),this.trace("Successfully bound "+(0,vr.subchannelAddressToString)(ue)),N("port"in ue?ue.port:g),C.removeListener("error",U)})})})).then(E=>{let I=0;for(let C of E)if(typeof C=="number"&&(I+=1,C!==g))throw new Error("Invalid state: multiple port numbers added from single address");return{port:g,count:I+y}}),u=f=>{if(f.length===0)return Promise.resolve({port:0,count:0});let g=f[0],y=l();return new Promise((E,I)=>{let C=N=>{this.trace("Failed to bind "+(0,vr.subchannelAddressToString)(g)+" with error "+N.message),E(u(f.slice(1)))};y.once("error",C),y.listen(g,()=>{if(this.shutdown){y.close(),E({port:0,count:0});return}let N=y.address(),k={host:N.address,port:N.port},U=(0,En.registerChannelzSocket)((0,vr.subchannelAddressToString)(k),()=>({localAddress:k,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(U),this.http2ServerList.push({server:y,channelzRef:U}),this.trace("Successfully bound "+(0,vr.subchannelAddressToString)(k)),E(c(f.slice(1),N.port,1)),y.removeListener("error",C)})})},h={onSuccessfulResolution:(f,g,y)=>{if(h.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),f.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let E;(0,vr.isTcpSubchannelAddress)(f[0])?f[0].port===0?E=u(f):E=c(f,f[0].port,0):E=c(f,1,0),E.then(I=>{if(I.count===0){let C=`No address added out of total ${f.length} resolved`;Yg.log(Oi.LogVerbosity.ERROR,C),a(new Error(C),0)}else I.count<f.length&&Yg.log(Oi.LogVerbosity.INFO,`WARNING Only ${I.count} addresses added out of total ${f.length} resolved`),a(null,I.port)},I=>{let C=`No address added out of total ${f.length} resolved`;Yg.log(Oi.LogVerbosity.ERROR,C),a(new Error(C),0)})},onError:f=>{a(new Error(f.details),0)}};(0,oM.createResolver)(s,h,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,En.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(Cs.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,En.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,i,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:r,deserialize:i,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,En.unregisterChannelzRef)(this.channelzRef),e(s)},r=0;function i(){r--,r===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(r++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,En.unregisterChannelzRef)(o)),i()}));this.sessions.forEach((s,o)=>{o.closed||(r+=1,o.close(i))}),r===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[Cs.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof r!="string"||!r.startsWith("application/grpc")?(e.respond({[Cs.constants.HTTP2_HEADER_STATUS]:Cs.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let i=new Ro.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=Oi.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed()),i.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),r?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed();return}let i=t[aM],s=this._retrieveHandler(i);if(!s){this._respondWithError(kw(i),e,r);return}let o=new Ro.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===Oi.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",a=>{a?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed(),o.sendError({code:Oi.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let r=t[aM],i=this._retrieveHandler(r);if(!i){this._respondWithError(kw(r),e,null);return}let s=new Ro.Http2ServerCallStream(e,i,this.options);this._runHandlerForCall(s,i,t)||s.sendError({code:Oi.Status.INTERNAL,details:`Unknown handler type: ${i.type}`})}_runHandlerForCall(e,t,r){var i;let s=e.receiveMetadata(r),o=(i=s.get("grpc-encoding")[0])!==null&&i!==void 0?i:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")PK(e,t,s,o);else if(a==="clientStream")MK(e,t,s,o);else if(a==="serverStream")FK(e,t,s,o);else if(a==="bidi")LK(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),r="null";t&&(typeof t=="string"?r=t:r=t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",s=>{var o,a,l,c,u;if(!this.started){s.destroy();return}let h=(0,En.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),d={ref:h,streamTracker:new En.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,d);let f=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+f),this.sessionChildrenTracker.refChild(h));let g=null,y=null,E=!1;if(this.maxConnectionAgeMs!==Xg){let C=this.maxConnectionAgeMs/10,N=Math.random()*C*2-C;g=(l=(a=setTimeout(()=>{var k,U;E=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+f);try{s.goaway(Cs.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==Xg&&(y=(U=(k=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||U===void 0?void 0:U.call(k))},this.maxConnectionAgeMs+N)).unref)===null||l===void 0?void 0:l.call(a)}let I=(u=(c=setInterval(()=>{var C,N;let k=(N=(C=setTimeout(()=>{E=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+f),s.close()},this.keepaliveTimeoutMs)).unref)===null||N===void 0?void 0:N.call(C);try{s.ping((U,J,ue)=>{clearTimeout(k)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(E||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+f),this.sessionChildrenTracker.unrefChild(h),(0,En.unregisterChannelzRef)(h)),g&&clearTimeout(g),y&&clearTimeout(y),I&&clearTimeout(I),this.sessions.delete(s)})})}};Jg.Server=Ow;function PK(n,e,t,r){return m(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new Ro.ServerUnaryCallImpl(n,t,i);e.func(s,(o,a,l,c)=>{n.sendUnaryMessage(o,a,l,c)})}catch(i){n.sendError(i)}})}function MK(n,e,t,r){let i=new Ro.ServerReadableStreamImpl(n,t,e.deserialize,r);function s(o,a,l,c){i.destroy(),n.sendUnaryMessage(o,a,l,c)}n.cancelled||(i.on("error",s),e.func(i,s))}function FK(n,e,t,r){return m(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new Ro.ServerWritableStreamImpl(n,t,e.serialize,i);e.func(s)}catch(i){n.sendError(i)}})}function LK(n,e,t,r){let i=new Ro.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,r);n.cancelled||e.func(i)}});var cM=v(Zg=>{"use strict";Object.defineProperty(Zg,"__esModule",{value:!0});Zg.StatusBuilder=void 0;var xw=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};Zg.StatusBuilder=xw});var Pw=v(ws=>{"use strict";Object.defineProperty(ws,"__esModule",{value:!0});ws.isDuration=ws.durationToMs=ws.msToDuration=void 0;function BK(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}ws.msToDuration=BK;function VK(n){return n.seconds*1e3+n.nanos/1e6|0}ws.durationToMs=VK;function UK(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}ws.isDuration=UK});var zw=v(Ts=>{"use strict";var Mw;Object.defineProperty(Ts,"__esModule",{value:!0});Ts.setup=Ts.OutlierDetectionLoadBalancer=Ts.OutlierDetectionLoadBalancingConfig=void 0;var tm=Hn(),hM=ve(),No=Pw(),dM=Gw(),fM=es(),qK=xp(),zK=is(),uM=Ur(),GK=Gg(),jK=Ze(),WK="outlier_detection";function At(n){jK.trace(hM.LogVerbosity.DEBUG,WK,n)}var qw="outlier_detection",HK=((Mw=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&Mw!==void 0?Mw:"true")==="true",$K={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},KK={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function Nl(n,e,t,r){if(e in n&&typeof n[e]!==t){let i=r?`${r}.${e}`:e;throw new Error(`outlier detection config ${i} parse error: expected ${t}, got ${typeof n[e]}`)}}function Fw(n,e,t){let r=t?`${t}.${e}`:e;if(e in n){if(!(0,No.isDuration)(n[e]))throw new Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function em(n,e,t){let r=t?`${t}.${e}`:e;if(Nl(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}var hh=class n{constructor(e,t,r,i,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=r??3e5,this.maxEjectionPercent=i??10,this.successRateEjection=s?Object.assign(Object.assign({},$K),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},KK),o):null}getLoadBalancerName(){return qw}toJsonObject(){return{interval:(0,No.msToDuration)(this.intervalMs),base_ejection_time:(0,No.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,No.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(Fw(e,"interval"),Fw(e,"base_ejection_time"),Fw(e,"max_ejection_time"),em(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");Nl(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),em(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),Nl(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),Nl(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");em(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),em(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),Nl(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),Nl(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,No.durationToMs)(e.interval):null,e.base_ejection_time?(0,No.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,No.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(fM.validateLoadBalancingConfig))}};Ts.OutlierDetectionLoadBalancingConfig=hh;var Bw=class extends GK.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((r,i,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,i,s,o)})}getConnectivityState(){return this.ejected?tm.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,tm.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,tm.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function Lw(){return{success:0,failure:0}}var Vw=class{constructor(){this.activeBucket=Lw(),this.inactiveBucket=Lw()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=Lw()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},Uw=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===zK.PickResultType.COMPLETE){let r=t.subchannel,i=r.getMapEntry();if(i){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===hM.Status.OK?i.counter.addSuccess():i.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel()})}else return t}},nm=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new qK.ChildLoadBalancerHandler((0,dM.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let i=e.createSubchannel(t,r),s=this.addressMap.get((0,uM.subchannelAddressToString)(t)),o=new Bw(i,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,r)=>{t===tm.ConnectivityState.READY?e.updateState(t,new Uw(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;At("Running success rate check");let r=t.request_volume,i=0,s=[];for(let[h,d]of this.addressMap){let f=d.counter.getLastSuccesses(),g=d.counter.getLastFailures();At("Stats for "+h+": successes="+f+" failures="+g+" targetRequestVolume="+r),f+g>=r&&(i+=1,s.push(f/(f+g)))}if(At("Found "+i+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),i<t.minimum_hosts)return;let o=s.reduce((h,d)=>h+d)/s.length,a=0;for(let h of s){let d=h-o;a+=d*d}let l=a/s.length,c=Math.sqrt(l),u=o-c*(t.stdev_factor/1e3);At("stdev="+c+" ejectionThreshold="+u);for(let[h,d]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let f=d.counter.getLastSuccesses(),g=d.counter.getLastFailures();if(f+g<r)continue;let y=f/(f+g);if(At("Checking candidate "+h+" successRate="+y),y<u){let E=Math.random()*100;At("Candidate "+h+" randomNumber="+E+" enforcement_percentage="+t.enforcement_percentage),E<t.enforcement_percentage&&(At("Ejecting candidate "+h),this.eject(d,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;At("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let i of this.addressMap.values()){let s=i.counter.getLastSuccesses(),o=i.counter.getLastFailures();s+o>=t.request_volume&&(r+=1)}if(!(r<t.minimum_hosts))for(let[i,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(At("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let c=Math.random()*100;At("Candidate "+i+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(At("Ejecting candidate "+i),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let r of e.subchannelWrappers)r.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(r=(t=this.ejectionTimer).unref)===null||r===void 0||r.call(t)}runChecks(){let e=new Date;if(At("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,r]of this.addressMap.entries())if(r.currentEjectionTimestamp===null)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let i=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(r.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(i*r.ejectionTimeMultiplier,Math.max(i,s))),o<new Date&&(At("Unejecting "+t),this.uneject(r))}}}updateAddressList(e,t,r){if(!(t instanceof hh))return;let i=new Set;for(let o of e)i.add((0,uM.subchannelAddressToString)(o));for(let o of i)this.addressMap.has(o)||(At("Adding map entry for "+o),this.addressMap.set(o,{counter:new Vw,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())i.has(o)||(At("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,fM.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){At("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else At("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{At("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return qw}};Ts.OutlierDetectionLoadBalancer=nm;function QK(){HK&&(0,dM.registerLoadBalancerType)(qw,nm,hh)}Ts.setup=QK});var Gw=v(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});ee.OutlierDetectionLoadBalancingConfig=ee.BaseSubchannelWrapper=ee.registerAdminService=ee.FilterStackFactory=ee.BaseFilter=ee.PickResultType=ee.QueuePicker=ee.UnavailablePicker=ee.ChildLoadBalancerHandler=ee.subchannelAddressToString=ee.validateLoadBalancingConfig=ee.getFirstUsableConfig=ee.registerLoadBalancerType=ee.createChildChannelControlHelper=ee.BackoffTimeout=ee.durationToMs=ee.uriToString=ee.createResolver=ee.registerResolver=ee.log=ee.trace=void 0;var pM=Ze();Object.defineProperty(ee,"trace",{enumerable:!0,get:function(){return pM.trace}});Object.defineProperty(ee,"log",{enumerable:!0,get:function(){return pM.log}});var gM=Br();Object.defineProperty(ee,"registerResolver",{enumerable:!0,get:function(){return gM.registerResolver}});Object.defineProperty(ee,"createResolver",{enumerable:!0,get:function(){return gM.createResolver}});var YK=An();Object.defineProperty(ee,"uriToString",{enumerable:!0,get:function(){return YK.uriToString}});var XK=Pw();Object.defineProperty(ee,"durationToMs",{enumerable:!0,get:function(){return XK.durationToMs}});var JK=xu();Object.defineProperty(ee,"BackoffTimeout",{enumerable:!0,get:function(){return JK.BackoffTimeout}});var rm=es();Object.defineProperty(ee,"createChildChannelControlHelper",{enumerable:!0,get:function(){return rm.createChildChannelControlHelper}});Object.defineProperty(ee,"registerLoadBalancerType",{enumerable:!0,get:function(){return rm.registerLoadBalancerType}});Object.defineProperty(ee,"getFirstUsableConfig",{enumerable:!0,get:function(){return rm.getFirstUsableConfig}});Object.defineProperty(ee,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return rm.validateLoadBalancingConfig}});var ZK=Ur();Object.defineProperty(ee,"subchannelAddressToString",{enumerable:!0,get:function(){return ZK.subchannelAddressToString}});var e5=xp();Object.defineProperty(ee,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return e5.ChildLoadBalancerHandler}});var jw=is();Object.defineProperty(ee,"UnavailablePicker",{enumerable:!0,get:function(){return jw.UnavailablePicker}});Object.defineProperty(ee,"QueuePicker",{enumerable:!0,get:function(){return jw.QueuePicker}});Object.defineProperty(ee,"PickResultType",{enumerable:!0,get:function(){return jw.PickResultType}});var t5=Dg();Object.defineProperty(ee,"BaseFilter",{enumerable:!0,get:function(){return t5.BaseFilter}});var n5=nw();Object.defineProperty(ee,"FilterStackFactory",{enumerable:!0,get:function(){return n5.FilterStackFactory}});var r5=Mp();Object.defineProperty(ee,"registerAdminService",{enumerable:!0,get:function(){return r5.registerAdminService}});var i5=Gg();Object.defineProperty(ee,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return i5.BaseSubchannelWrapper}});var s5=zw();Object.defineProperty(ee,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return s5.OutlierDetectionLoadBalancingConfig}})});var mM=v(im=>{"use strict";Object.defineProperty(im,"__esModule",{value:!0});im.setup=void 0;var o5=Br(),Ww=class{constructor(e,t,r){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let i;e.authority===""?i="/"+e.path:i=e.path,this.addresses=[{path:i}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function a5(){(0,o5.registerResolver)("unix",Ww)}im.setup=a5});var SM=v(am=>{"use strict";Object.defineProperty(am,"__esModule",{value:!0});am.setup=void 0;var yM=z("net"),sm=ve(),Hw=sn(),_M=Br(),vM=An(),l5=Ze(),c5="ip_resolver";function EM(n){l5.trace(sm.LogVerbosity.DEBUG,c5,n)}var $w="ipv4",Kw="ipv6",u5=443,om=class{constructor(e,t,r){var i;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,EM("Resolver constructed for target "+(0,vM.uriToString)(e));let s=[];if(!(e.scheme===$w||e.scheme===Kw)){this.error={code:sm.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new Hw.Metadata};return}let o=e.path.split(",");for(let a of o){let l=(0,vM.splitHostPort)(a);if(l===null){this.error={code:sm.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new Hw.Metadata};return}if(e.scheme===$w&&!(0,yM.isIPv4)(l.host)||e.scheme===Kw&&!(0,yM.isIPv6)(l.host)){this.error={code:sm.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new Hw.Metadata};return}s.push({host:l.host,port:(i=l.port)!==null&&i!==void 0?i:u5})}this.addresses=s,EM("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function h5(){(0,_M.registerResolver)($w,om),(0,_M.registerResolver)(Kw,om)}am.setup=h5});var TM=v(Zr=>{"use strict";Object.defineProperty(Zr,"__esModule",{value:!0});Zr.setup=Zr.PickFirstLoadBalancer=Zr.shuffled=Zr.PickFirstLoadBalancingConfig=void 0;var CM=es(),Kt=Hn(),lm=is(),d5=Ze(),f5=ve(),p5="pick_first";function Qw(n){d5.trace(f5.LogVerbosity.DEBUG,p5,n)}var dh="pick_first",g5=250,fh=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return dh}toJsonObject(){return{[dh]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};Zr.PickFirstLoadBalancingConfig=fh;var Yw=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:lm.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function wM(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}Zr.shuffled=wM;var cm=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=Kt.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.onSubchannelStateUpdate(t,r,i,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(Kt.ConnectivityState.READY,new Yw(this.currentPick)):this.children.length===0?this.updateState(Kt.ConnectivityState.IDLE,new lm.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(Kt.ConnectivityState.TRANSIENT_FAILURE,new lm.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(Kt.ConnectivityState.CONNECTING,new lm.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,i){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){r!==Kt.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){r===Kt.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),r===Kt.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,i&&(this.lastError=i),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let i=r.subchannel.getConnectivityState();if(i===Kt.ConnectivityState.IDLE||i===Kt.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===Kt.ConnectivityState.IDLE&&(Qw("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var i;(i=this.children[e])===null||i===void 0||i.subchannel.startConnecting()})),this.connectionDelayTimeout=(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},g5)).unref)===null||r===void 0?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(Qw("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){Qw(Kt.ConnectivityState[this.currentState]+" -> "+Kt.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(r=>({subchannel:this.channelControlHelper.createSubchannel(r,{}),hasReportedTransientFailure:!1}));for(let{subchannel:r}of t)r.ref(),this.channelControlHelper.addChannelzChild(r.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:r}of this.children)if(r.addConnectivityStateListener(this.subchannelStateListener),r.getConnectivityState()===Kt.ConnectivityState.READY){this.pickSubchannel(r);return}for(let r of this.children)r.subchannel.getConnectivityState()===Kt.ConnectivityState.TRANSIENT_FAILURE&&(r.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof fh&&(t.getShuffleAddressList()&&(e=wM(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===Kt.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return dh}};Zr.PickFirstLoadBalancer=cm;function m5(){(0,CM.registerLoadBalancerType)(dh,cm,fh),(0,CM.registerDefaultLoadBalancerType)(dh)}Zr.setup=m5});var IM=v(kl=>{"use strict";Object.defineProperty(kl,"__esModule",{value:!0});kl.setup=kl.RoundRobinLoadBalancer=void 0;var y5=es(),Qt=Hn(),um=is(),_5=Ur(),v5=Ze(),E5=ve(),S5="round_robin";function bM(n){v5.trace(E5.LogVerbosity.DEBUG,S5,n)}var hm="round_robin",Xw=class n{getLoadBalancerName(){return hm}constructor(){}toJsonObject(){return{[hm]:{}}}static createFromJson(e){return new n}},Jw=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:um.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},dm=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=Qt.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.calculateAndUpdateState(),(i===Qt.ConnectivityState.TRANSIENT_FAILURE||i===Qt.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(Qt.ConnectivityState.READY)>0){let e=this.subchannels.filter(r=>r.getConnectivityState()===Qt.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(Qt.ConnectivityState.READY,new Jw(e,t))}else this.countSubchannelsWithState(Qt.ConnectivityState.CONNECTING)>0?this.updateState(Qt.ConnectivityState.CONNECTING,new um.QueuePicker(this)):this.countSubchannelsWithState(Qt.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(Qt.ConnectivityState.TRANSIENT_FAILURE,new um.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(Qt.ConnectivityState.IDLE,new um.QueuePicker(this))}updateState(e,t){bM(Qt.ConnectivityState[this.currentState]+" -> "+Qt.ConnectivityState[e]),e===Qt.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),bM("Connect to address list "+e.map(r=>(0,_5.subchannelAddressToString)(r))),this.subchannels=e.map(r=>this.channelControlHelper.createSubchannel(r,{}));for(let r of this.subchannels){r.ref(),r.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(r.getChannelzRef());let i=r.getConnectivityState();(i===Qt.ConnectivityState.IDLE||i===Qt.ConnectivityState.TRANSIENT_FAILURE)&&r.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return hm}};kl.RoundRobinLoadBalancer=dm;function C5(){(0,y5.registerLoadBalancerType)(hm,dm,Xw)}kl.setup=C5});var NM=v(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});V.experimental=V.addAdminServicesToServer=V.getChannelzHandlers=V.getChannelzServiceDefinition=V.InterceptorConfigurationError=V.InterceptingCall=V.RequesterBuilder=V.ListenerBuilder=V.StatusBuilder=V.getClientChannel=V.ServerCredentials=V.Server=V.setLogVerbosity=V.setLogger=V.load=V.loadObject=V.CallCredentials=V.ChannelCredentials=V.waitForClientReady=V.closeClient=V.Channel=V.makeGenericClientConstructor=V.makeClientConstructor=V.loadPackageDefinition=V.Client=V.compressionAlgorithms=V.propagate=V.connectivityState=V.status=V.logVerbosity=V.Metadata=V.credentials=void 0;var fm=KE();Object.defineProperty(V,"CallCredentials",{enumerable:!0,get:function(){return fm.CallCredentials}});var w5=IS();Object.defineProperty(V,"Channel",{enumerable:!0,get:function(){return w5.ChannelImplementation}});var T5=rw();Object.defineProperty(V,"compressionAlgorithms",{enumerable:!0,get:function(){return T5.CompressionAlgorithms}});var b5=Hn();Object.defineProperty(V,"connectivityState",{enumerable:!0,get:function(){return b5.ConnectivityState}});var pm=Ip();Object.defineProperty(V,"ChannelCredentials",{enumerable:!0,get:function(){return pm.ChannelCredentials}});var AM=bS();Object.defineProperty(V,"Client",{enumerable:!0,get:function(){return AM.Client}});var Zw=ve();Object.defineProperty(V,"logVerbosity",{enumerable:!0,get:function(){return Zw.LogVerbosity}});Object.defineProperty(V,"status",{enumerable:!0,get:function(){return Zw.Status}});Object.defineProperty(V,"propagate",{enumerable:!0,get:function(){return Zw.Propagate}});var DM=Ze(),e0=DS();Object.defineProperty(V,"loadPackageDefinition",{enumerable:!0,get:function(){return e0.loadPackageDefinition}});Object.defineProperty(V,"makeClientConstructor",{enumerable:!0,get:function(){return e0.makeClientConstructor}});Object.defineProperty(V,"makeGenericClientConstructor",{enumerable:!0,get:function(){return e0.makeClientConstructor}});var I5=sn();Object.defineProperty(V,"Metadata",{enumerable:!0,get:function(){return I5.Metadata}});var A5=lM();Object.defineProperty(V,"Server",{enumerable:!0,get:function(){return A5.Server}});var D5=Nw();Object.defineProperty(V,"ServerCredentials",{enumerable:!0,get:function(){return D5.ServerCredentials}});var R5=cM();Object.defineProperty(V,"StatusBuilder",{enumerable:!0,get:function(){return R5.StatusBuilder}});V.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),combineCallCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),createInsecure:pm.ChannelCredentials.createInsecure,createSsl:pm.ChannelCredentials.createSsl,createFromSecureContext:pm.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:fm.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:fm.CallCredentials.createFromGoogleCredential,createEmpty:fm.CallCredentials.createEmpty};var N5=n=>n.close();V.closeClient=N5;var k5=(n,e,t)=>n.waitForReady(e,t);V.waitForClientReady=k5;var O5=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};V.loadObject=O5;var x5=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};V.load=x5;var P5=n=>{DM.setLogger(n)};V.setLogger=P5;var M5=n=>{DM.setLoggerVerbosity(n)};V.setLogVerbosity=M5;var F5=n=>AM.Client.prototype.getChannel.call(n);V.getClientChannel=F5;var gm=CS();Object.defineProperty(V,"ListenerBuilder",{enumerable:!0,get:function(){return gm.ListenerBuilder}});Object.defineProperty(V,"RequesterBuilder",{enumerable:!0,get:function(){return gm.RequesterBuilder}});Object.defineProperty(V,"InterceptingCall",{enumerable:!0,get:function(){return gm.InterceptingCall}});Object.defineProperty(V,"InterceptorConfigurationError",{enumerable:!0,get:function(){return gm.InterceptorConfigurationError}});var RM=Ao();Object.defineProperty(V,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return RM.getChannelzServiceDefinition}});Object.defineProperty(V,"getChannelzHandlers",{enumerable:!0,get:function(){return RM.getChannelzHandlers}});var L5=Mp();Object.defineProperty(V,"addAdminServicesToServer",{enumerable:!0,get:function(){return L5.addAdminServicesToServer}});var B5=Gw();V.experimental=B5;var V5=jC(),U5=mM(),q5=SM(),z5=TM(),G5=IM(),j5=zw(),W5=Ao();V5.setup(),U5.setup(),q5.setup(),z5.setup(),G5.setup(),j5.setup(),W5.setup()});var hi=v((YI,PB)=>{"use strict";var Zy=z("buffer"),ui=Zy.Buffer;function xB(n,e){for(var t in n)e[t]=n[t]}ui.from&&ui.alloc&&ui.allocUnsafe&&ui.allocUnsafeSlow?PB.exports=Zy:(xB(Zy,YI),YI.Buffer=ua);function ua(n,e,t){return ui(n,e,t)}ua.prototype=Object.create(ui.prototype);xB(ui,ua);ua.from=function(n,e,t){if(typeof n=="number")throw new TypeError("Argument must not be a number");return ui(n,e,t)};ua.alloc=function(n,e,t){if(typeof n!="number")throw new TypeError("Argument must be a number");var r=ui(n);return e!==void 0?typeof t=="string"?r.fill(e,t):r.fill(e):r.fill(0),r};ua.allocUnsafe=function(n){if(typeof n!="number")throw new TypeError("Argument must be a number");return ui(n)};ua.allocUnsafeSlow=function(n){if(typeof n!="number")throw new TypeError("Argument must be a number");return Zy.SlowBuffer(n)}});var LB=v(XI=>{"use strict";var MB=z("stream").Stream,FB=z("util"),ha=function(n){this.readable=this.writable=!0,this._paused=!1,this._driver=n};FB.inherits(ha,MB);ha.prototype.pause=function(){this._paused=!0,this._driver.messages._paused=!0};ha.prototype.resume=function(){this._paused=!1,this.emit("drain");var n=this._driver.messages;n._paused=!1,n.emit("drain")};ha.prototype.write=function(n){return this.writable?(this._driver.parse(n),!this._paused):!1};ha.prototype.end=function(n){if(this.writable){n!==void 0&&this.write(n),this.writable=!1;var e=this._driver.messages;e.readable&&(e.readable=e.writable=!1,e.emit("end"))}};ha.prototype.destroy=function(){this.end()};var da=function(n){this.readable=this.writable=!0,this._paused=!1,this._driver=n};FB.inherits(da,MB);da.prototype.pause=function(){this._driver.io._paused=!0};da.prototype.resume=function(){this._driver.io._paused=!1,this._driver.io.emit("drain")};da.prototype.write=function(n){return this.writable?(typeof n=="string"?this._driver.text(n):this._driver.binary(n),!this._paused):!1};da.prototype.end=function(n){n!==void 0&&this.write(n)};da.prototype.destroy=function(){};XI.IO=ha;XI.Messages=da});var e_=v((Ghe,BB)=>{"use strict";var Ac=function(){this.clear()};Ac.prototype.ALLOWED_DUPLICATES=["set-cookie","set-cookie2","warning","www-authenticate"];Ac.prototype.clear=function(){this._sent={},this._lines=[]};Ac.prototype.set=function(n,e){if(e!==void 0){n=this._strip(n),e=this._strip(e);var t=n.toLowerCase();(!this._sent.hasOwnProperty(t)||this.ALLOWED_DUPLICATES.indexOf(t)>=0)&&(this._sent[t]=!0,this._lines.push(n+": "+e+`\r
`))}};Ac.prototype.toString=function(){return this._lines.join("")};Ac.prototype._strip=function(n){return n.toString().replace(/^ */,"").replace(/ *$/,"")};BB.exports=Ac});var UB=v((jhe,VB)=>{"use strict";var t_=hi().Buffer,n_=function(){this._queue=[],this._queueSize=0,this._offset=0};n_.prototype.put=function(n){!n||n.length===0||(t_.isBuffer(n)||(n=t_.from(n)),this._queue.push(n),this._queueSize+=n.length)};n_.prototype.read=function(n){if(n>this._queueSize)return null;if(n===0)return t_.alloc(0);this._queueSize-=n;var e=this._queue,t=n,r=e[0],i,s;if(r.length>=n)return r.length===n?e.shift():(s=r.slice(0,n),e[0]=r.slice(n),s);for(var o=0,a=e.length;o<a&&!(t<e[o].length);o++)t-=e[o].length;return i=e.splice(0,o),t>0&&e.length>0&&(i.push(e[0].slice(0,t)),e[0]=e[0].slice(t)),t_.concat(i,n)};n_.prototype.eachByte=function(n,e){for(var t,r,i;this._queue.length>0;){for(t=this._queue[0],r=t.length;this._offset<r;)i=this._offset,this._offset+=1,n.call(e,t[i]);this._offset=0,this._queue.shift()}};VB.exports=n_});var Xs=v((Whe,HB)=>{"use strict";var qB=hi().Buffer,jB=z("events").EventEmitter,Ite=z("util"),zB=LB(),WB=e_(),Ate=UB(),hn=function(n,e,t){jB.call(this),hn.validateOptions(t||{},["maxLength","masking","requireMasking","protocols"]),this._request=n,this._reader=new Ate,this._options=t||{},this._maxLength=this._options.maxLength||this.MAX_LENGTH,this._headers=new WB,this.__queue=[],this.readyState=0,this.url=e,this.io=new zB.IO(this),this.messages=new zB.Messages(this),this._bindEventListeners()};Ite.inherits(hn,jB);hn.isWebSocket=function(n){var e=n.headers.connection||"",t=n.headers.upgrade||"";return n.method==="GET"&&e.toLowerCase().split(/ *, */).indexOf("upgrade")>=0&&t.toLowerCase()==="websocket"};hn.validateOptions=function(n,e){for(var t in n)if(e.indexOf(t)<0)throw new Error("Unrecognized option: "+t)};var GB={MAX_LENGTH:67108863,STATES:["connecting","open","closing","closed"],_bindEventListeners:function(){var n=this;this.messages.on("error",function(){}),this.on("message",function(e){var t=n.messages;t.readable&&t.emit("data",e.data)}),this.on("error",function(e){var t=n.messages;t.readable&&t.emit("error",e)}),this.on("close",function(){var e=n.messages;e.readable&&(e.readable=e.writable=!1,e.emit("end"))})},getState:function(){return this.STATES[this.readyState]||null},addExtension:function(n){return!1},setHeader:function(n,e){return this.readyState>0?!1:(this._headers.set(n,e),!0)},start:function(){if(this.readyState!==0)return!1;if(!hn.isWebSocket(this._request))return this._failHandshake(new Error("Not a WebSocket request"));var n;try{n=this._handshakeResponse()}catch(e){return this._failHandshake(e)}return this._write(n),this._stage!==-1&&this._open(),!0},_failHandshake:function(n){var e=new WB;return e.set("Content-Type","text/plain"),e.set("Content-Length",qB.byteLength(n.message,"utf8")),e=["HTTP/1.1 400 Bad Request",e.toString(),n.message],this._write(qB.from(e.join(`\r
`),"utf8")),this._fail("protocol_error",n.message),!1},text:function(n){return this.frame(n)},binary:function(n){return!1},ping:function(){return!1},pong:function(){return!1},close:function(n,e){return this.readyState!==1?!1:(this.readyState=3,this.emit("close",new hn.CloseEvent(null,null)),!0)},_open:function(){this.readyState=1,this.__queue.forEach(function(n){this.frame.apply(this,n)},this),this.__queue=[],this.emit("open",new hn.OpenEvent)},_queue:function(n){return this.__queue.push(n),!0},_write:function(n){var e=this.io;e.readable&&e.emit("data",n)},_fail:function(n,e){this.readyState=2,this.emit("error",new Error(e)),this.close()}};for(JI in GB)hn.prototype[JI]=GB[JI];var JI;hn.ConnectEvent=function(){};hn.OpenEvent=function(){};hn.CloseEvent=function(n,e){this.code=n,this.reason=e};hn.MessageEvent=function(n){this.data=n};hn.PingEvent=function(n){this.data=n};hn.PongEvent=function(n){this.data=n};HB.exports=hn});var XB=v(nA=>{"use strict";var eA=z("assert");nA.HTTPParser=K;function K(n){eA.ok(n===K.REQUEST||n===K.RESPONSE||n===void 0),n===void 0||this.initialize(n),this.maxHeaderSize=K.maxHeaderSize}K.prototype.initialize=function(n,e){eA.ok(n===K.REQUEST||n===K.RESPONSE),this.type=n,this.state=n+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1};K.encoding="ascii";K.maxHeaderSize=80*1024;K.REQUEST="REQUEST";K.RESPONSE="RESPONSE";var $B=K.kOnHeaders=1,ZI=K.kOnHeadersComplete=2,r_=K.kOnBody=3,tA=K.kOnMessageComplete=4;K.prototype[$B]=K.prototype[ZI]=K.prototype[r_]=K.prototype[tA]=function(){};var KB=!0;Object.defineProperty(K,"kOnExecute",{get:function(){return KB=!1,99}});var QB=nA.methods=K.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK","SOURCE"],YB=QB.indexOf("CONNECT");K.prototype.reinitialize=K;K.prototype.close=K.prototype.pause=K.prototype.resume=K.prototype.free=function(){};K.prototype._compatMode0_11=!1;K.prototype.getAsyncId=function(){return 0};var Dte={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};K.prototype.execute=function(n,e,t){if(!(this instanceof K))throw new TypeError("not a HTTPParser");e=e||0,t=typeof t=="number"?t:n.length,this.chunk=n,this.offset=e;var r=this.end=e+t;try{for(;this.offset<r&&!this[this.state](););}catch(i){if(this.isUserCall)throw i;return this.hadError=!0,i}return this.chunk=null,t=this.offset-e,Dte[this.state]&&(this.headerSize+=t,this.headerSize>(this.maxHeaderSize||K.maxHeaderSize))?new Error("max header size exceeded"):t};var Rte={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};K.prototype.finish=function(){if(!this.hadError){if(!Rte[this.state])return new Error("invalid state for EOF");this.state==="BODY_RAW"&&this.userCall()(this[tA]())}};K.prototype.consume=K.prototype.unconsume=K.prototype.getCurrentBuffer=function(){};K.prototype.userCall=function(){this.isUserCall=!0;var n=this;return function(e){return n.isUserCall=!1,e}};K.prototype.nextRequest=function(){this.userCall()(this[tA]()),this.reinitialize(this.type)};K.prototype.consumeLine=function(){for(var n=this.end,e=this.chunk,t=this.offset;t<n;t++)if(e[t]===10){var r=this.line+e.toString(K.encoding,this.offset,t);return r.charAt(r.length-1)==="\r"&&(r=r.substr(0,r.length-1)),this.line="",this.offset=t+1,r}this.line+=e.toString(K.encoding,this.offset,this.end),this.offset=this.end};var Nte=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,kte=/^[ \t]+(.*[^ \t])/;K.prototype.parseHeader=function(n,e){if(n.indexOf("\r")!==-1)throw i_("HPE_LF_EXPECTED");var t=Nte.exec(n),r=t&&t[1];if(r)e.push(r),e.push(t[2]);else{var i=kte.exec(n);i&&e.length&&(e[e.length-1]&&(e[e.length-1]+=" "),e[e.length-1]+=i[1])}};var Ote=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;K.prototype.REQUEST_LINE=function(){var n=this.consumeLine();if(n){var e=Ote.exec(n);if(e===null)throw i_("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?e[1]:QB.indexOf(e[1]),this.info.method===-1)throw new Error("invalid request method");this.info.url=e[2],this.info.versionMajor=+e[3],this.info.versionMinor=+e[4],this.body_bytes=0,this.state="HEADER"}};var xte=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;K.prototype.RESPONSE_LINE=function(){var n=this.consumeLine();if(n){var e=xte.exec(n);if(e===null)throw i_("HPE_INVALID_CONSTANT");this.info.versionMajor=+e[1],this.info.versionMinor=+e[2];var t=this.info.statusCode=+e[3];this.info.statusMessage=e[4],((t/100|0)===1||t===204||t===304)&&(this.body_bytes=0),this.state="HEADER"}};K.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(this.connection.indexOf("close")!==-1)return!1}else if(this.connection.indexOf("keep-alive")===-1)return!1;return!!(this.body_bytes!==null||this.isChunked)};K.prototype.HEADER=function(){var n=this.consumeLine();if(n!==void 0){var e=this.info;if(n)this.parseHeader(n,e.headers);else{for(var t=e.headers,r=!1,i,s=!1,o=0;o<t.length;o+=2)switch(t[o].toLowerCase()){case"transfer-encoding":this.isChunked=t[o+1].toLowerCase()==="chunked";break;case"content-length":if(i=+t[o+1],r){if(i!==this.body_bytes)throw i_("HPE_UNEXPECTED_CONTENT_LENGTH")}else r=!0,this.body_bytes=i;break;case"connection":this.connection+=t[o+1].toLowerCase();break;case"upgrade":s=!0;break}this.isChunked&&r&&(r=!1,this.body_bytes=null),s&&this.connection.indexOf("upgrade")!=-1?e.upgrade=this.type===K.REQUEST||e.statusCode===101:e.upgrade=e.method===YB,this.isChunked&&e.upgrade&&(this.isChunked=!1),e.shouldKeepAlive=this.shouldKeepAlive();var a;if(KB?a=this.userCall()(this[ZI](e)):a=this.userCall()(this[ZI](e.versionMajor,e.versionMinor,e.headers,e.method,e.url,e.statusCode,e.statusMessage,e.upgrade,e.shouldKeepAlive)),a===2)return this.nextRequest(),!0;if(this.isChunked&&!a)this.state="BODY_CHUNKHEAD";else{if(a||this.body_bytes===0)return this.nextRequest(),e.upgrade;this.body_bytes===null?this.state="BODY_RAW":this.state="BODY_SIZED"}}}};K.prototype.BODY_CHUNKHEAD=function(){var n=this.consumeLine();n!==void 0&&(this.body_bytes=parseInt(n,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")};K.prototype.BODY_CHUNK=function(){var n=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[r_](this.chunk,this.offset,n)),this.offset+=n,this.body_bytes-=n,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")};K.prototype.BODY_CHUNKEMPTYLINE=function(){var n=this.consumeLine();n!==void 0&&(eA.equal(n,""),this.state="BODY_CHUNKHEAD")};K.prototype.BODY_CHUNKTRAILERS=function(){var n=this.consumeLine();n!==void 0&&(n?this.parseHeader(n,this.trailers):(this.trailers.length&&this.userCall()(this[$B](this.trailers,"")),this.nextRequest()))};K.prototype.BODY_RAW=function(){var n=this.end-this.offset;this.userCall()(this[r_](this.chunk,this.offset,n)),this.offset=this.end};K.prototype.BODY_SIZED=function(){var n=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[r_](this.chunk,this.offset,n)),this.offset+=n,this.body_bytes-=n,this.body_bytes||this.nextRequest()};["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(n){var e=K["kOn"+n];Object.defineProperty(K.prototype,"on"+n,{get:function(){return this[e]},set:function(t){return this._compatMode0_11=!0,YB="CONNECT",this[e]=t}})});function i_(n){var e=new Error("Parse Error");return e.code=n,e}});var o_=v(($he,ZB)=>{"use strict";var s_=XB().HTTPParser,Pte=hi().Buffer,Mte={request:s_.REQUEST||"request",response:s_.RESPONSE||"response"},dn=function(n){this._type=n,this._parser=new s_(Mte[n]),this._complete=!1,this.headers={};var e=null,t=this;this._parser.onHeaderField=function(r,i,s){e=r.toString("utf8",i,i+s).toLowerCase()},this._parser.onHeaderValue=function(r,i,s){var o=r.toString("utf8",i,i+s);t.headers.hasOwnProperty(e)?t.headers[e]+=", "+o:t.headers[e]=o},this._parser.onHeadersComplete=this._parser[s_.kOnHeadersComplete]=function(r,i,s,o,a,l){var c=arguments[0];if(typeof c=="object"&&(o=c.method,a=c.url,l=c.statusCode,s=c.headers),t.method=typeof o=="number"?dn.METHODS[o]:o,t.statusCode=l,t.url=a,!!s){for(var u=0,h=s.length,d,f;u<h;u+=2)d=s[u].toLowerCase(),f=s[u+1],t.headers.hasOwnProperty(d)?t.headers[d]+=", "+f:t.headers[d]=f;t._complete=!0}}};dn.METHODS={0:"DELETE",1:"GET",2:"HEAD",3:"POST",4:"PUT",5:"CONNECT",6:"OPTIONS",7:"TRACE",8:"COPY",9:"LOCK",10:"MKCOL",11:"MOVE",12:"PROPFIND",13:"PROPPATCH",14:"SEARCH",15:"UNLOCK",16:"BIND",17:"REBIND",18:"UNBIND",19:"ACL",20:"REPORT",21:"MKACTIVITY",22:"CHECKOUT",23:"MERGE",24:"M-SEARCH",25:"NOTIFY",26:"SUBSCRIBE",27:"UNSUBSCRIBE",28:"PATCH",29:"PURGE",30:"MKCALENDAR",31:"LINK",32:"UNLINK"};var JB=process.version?process.version.match(/[0-9]+/g).map(function(n){return parseInt(n,10)}):[];JB[0]===0&&JB[1]===12&&(dn.METHODS[16]="REPORT",dn.METHODS[17]="MKACTIVITY",dn.METHODS[18]="CHECKOUT",dn.METHODS[19]="MERGE",dn.METHODS[20]="M-SEARCH",dn.METHODS[21]="NOTIFY",dn.METHODS[22]="SUBSCRIBE",dn.METHODS[23]="UNSUBSCRIBE",dn.METHODS[24]="PATCH",dn.METHODS[25]="PURGE");dn.prototype.isComplete=function(){return this._complete};dn.prototype.parse=function(n){var e=this._parser.execute(n,0,n.length);if(typeof e!="number"){this.error=e,this._complete=!0;return}this._complete&&(this.body=e<n.length?n.slice(e):Pte.alloc(0))};ZB.exports=dn});var nV=v((Khe,tV)=>{"use strict";var rA=/([!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+)/,Fte=/([^!#\$%&'\*\+\-\.\^_`\|~0-9A-Za-z])/g,Lte=/"((?:\\[\x00-\x7f]|[^\x00-\x08\x0a-\x1f\x7f"\\])*)"/,iA=new RegExp(rA.source+"(?:=(?:"+rA.source+"|"+Lte.source+"))?"),sA=new RegExp(rA.source+"(?: *; *"+iA.source+")*","g"),Bte=new RegExp("^"+sA.source+"(?: *, *"+sA.source+")*$"),Vte=/^-?(0|[1-9][0-9]*)(\.[0-9]+)?$/,eV=Object.prototype.hasOwnProperty,Ute={parseHeader:function(n){var e=new _d;if(n===""||n===void 0)return e;if(!Bte.test(n))throw new SyntaxError("Invalid Sec-WebSocket-Extensions header: "+n);var t=n.match(sA);return t.forEach(function(r){var i=r.match(new RegExp(iA.source,"g")),s=i.shift(),o={};i.forEach(function(a){var l=a.match(iA),c=l[1],u;l[2]!==void 0?u=l[2]:l[3]!==void 0?u=l[3].replace(/\\/g,""):u=!0,Vte.test(u)&&(u=parseFloat(u)),eV.call(o,c)?(o[c]=[].concat(o[c]),o[c].push(u)):o[c]=u},this),e.push(s,o)},this),e},serializeParams:function(n,e){var t=[],r=function(s,o){o instanceof Array?o.forEach(function(a){r(s,a)}):o===!0?t.push(s):typeof o=="number"?t.push(s+"="+o):Fte.test(o)?t.push(s+'="'+o.replace(/"/g,'\\"')+'"'):t.push(s+"="+o)};for(var i in e)r(i,e[i]);return[n].concat(t).join("; ")}},_d=function(){this._byName={},this._inOrder=[]};_d.prototype.push=function(n,e){eV.call(this._byName,n)||(this._byName[n]=[]),this._byName[n].push(e),this._inOrder.push({name:n,params:e})};_d.prototype.eachOffer=function(n,e){for(var t=this._inOrder,r=0,i=t.length;r<i;r++)n.call(e,t[r].name,t[r].params)};_d.prototype.byName=function(n){return this._byName[n]||[]};_d.prototype.toArray=function(){return this._inOrder.slice()};tV.exports=Ute});var oA=v((Qhe,rV)=>{"use strict";var vd=function(n){this._bufferSize=n,this.clear()};vd.prototype.clear=function(){this._buffer=new Array(this._bufferSize),this._ringOffset=0,this._ringSize=this._bufferSize,this._head=0,this._tail=0,this.length=0};vd.prototype.push=function(n){var e=!1,t=!1;this._ringSize<this._bufferSize?e=this._tail===0:this._ringOffset===this._ringSize&&(e=!0,t=this._tail===0),e&&(this._tail=this._bufferSize,this._buffer=this._buffer.concat(new Array(this._bufferSize)),this._bufferSize=this._buffer.length,t&&(this._ringSize=this._bufferSize)),this._buffer[this._tail]=n,this.length+=1,this._tail<this._ringSize&&(this._ringOffset+=1),this._tail=(this._tail+1)%this._bufferSize};vd.prototype.peek=function(){if(this.length!==0)return this._buffer[this._head]};vd.prototype.shift=function(){if(this.length!==0){var n=this._buffer[this._head];return this._buffer[this._head]=void 0,this.length-=1,this._ringOffset-=1,this._ringOffset===0&&this.length>0?(this._head=this._ringSize,this._ringOffset=this.length,this._ringSize=this._bufferSize):this._head=(this._head+1)%this._ringSize,n}};rV.exports=vd});var sV=v((Yhe,iV)=>{"use strict";var qte=oA(),Dc=function(n,e){this._session=n,this._method=e,this._queue=new qte(Dc.QUEUE_SIZE),this._stopped=!1,this.pending=0};Dc.QUEUE_SIZE=8;Dc.prototype.call=function(n,e,t,r){if(!this._stopped){var i={error:n,message:e,callback:t,context:r,done:!1},s=!1,o=this;if(this._queue.push(i),i.error)return i.done=!0,this._stop(),this._flushQueue();var a=function(l,c){s^(s=!0)&&(l?(o._stop(),i.error=l,i.message=null):i.message=c,i.done=!0,o._flushQueue())};try{this._session[this._method](e,a)}catch(l){a(l)}}};Dc.prototype._stop=function(){this.pending=this._queue.length,this._stopped=!0};Dc.prototype._flushQueue=function(){for(var n=this._queue,e;n.length>0&&n.peek().done;)e=n.shift(),e.error?(this.pending=0,n.clear()):this.pending-=1,e.callback.call(e.context,e.error,e.message)};iV.exports=Dc});var aA=v((Xhe,oV)=>{"use strict";var zte=oA(),fa=function(){this._complete=!1,this._callbacks=new zte(fa.QUEUE_SIZE)};fa.QUEUE_SIZE=4;fa.all=function(n){var e=new fa,t=n.length,r=t;for(t===0&&e.done();r--;)n[r].then(function(){t-=1,t===0&&e.done()});return e};fa.prototype.then=function(n){this._complete?n():this._callbacks.push(n)};fa.prototype.done=function(){this._complete=!0;for(var n=this._callbacks,e;e=n.shift();)e()};oV.exports=fa});var cV=v((Jhe,lV)=>{"use strict";var aV=sV(),Gte=aA(),pa=function(n){this._ext=n[0],this._session=n[1],this._functors={incoming:new aV(this._session,"processIncomingMessage"),outgoing:new aV(this._session,"processOutgoingMessage")}};pa.prototype.pending=function(n){var e=this._functors[n];e._stopped||(e.pending+=1)};pa.prototype.incoming=function(n,e,t,r){this._exec("incoming",n,e,t,r)};pa.prototype.outgoing=function(n,e,t,r){this._exec("outgoing",n,e,t,r)};pa.prototype.close=function(){return this._closed=this._closed||new Gte,this._doClose(),this._closed};pa.prototype._exec=function(n,e,t,r,i){this._functors[n].call(e,t,function(s,o){s&&(s.message=this._ext.name+": "+s.message),r.call(i,s,o),this._doClose()},this)};pa.prototype._doClose=function(){var n=this._functors.incoming,e=this._functors.outgoing;!this._closed||n.pending+e.pending!==0||(this._session&&this._session.close(),this._session=null,this._closed.done())};lV.exports=pa});var hV=v((Zhe,uV)=>{"use strict";var jte=cV(),Wte=aA(),Ed=function(n){this._cells=n.map(function(e){return new jte(e)}),this._stopped={incoming:!1,outgoing:!1}};Ed.prototype.processIncomingMessage=function(n,e,t){this._stopped.incoming||this._loop("incoming",this._cells.length-1,-1,-1,n,e,t)};Ed.prototype.processOutgoingMessage=function(n,e,t){this._stopped.outgoing||this._loop("outgoing",0,this._cells.length,1,n,e,t)};Ed.prototype.close=function(n,e){this._stopped={incoming:!0,outgoing:!0};var t=this._cells.map(function(r){return r.close()});n&&Wte.all(t).then(function(){n.call(e)})};Ed.prototype._loop=function(n,e,t,r,i,s,o){for(var a=this._cells,l=a.length,c=this;l--;)a[l].pending(n);var u=function(h,d,f){if(h===t)return s.call(o,d,f);a[h][n](d,f,function(g,y){g&&(c._stopped[n]=!0),u(h+r,g,y)})};u(e,null,i)};uV.exports=Ed});var gV=v((ede,pV)=>{"use strict";var Sd=nV(),dV=hV(),a_=function(){this._rsv1=this._rsv2=this._rsv3=null,this._byName={},this._inOrder=[],this._sessions=[],this._index={}};a_.MESSAGE_OPCODES=[1,2];var fV={add:function(n){if(typeof n.name!="string")throw new TypeError("extension.name must be a string");if(n.type!=="permessage")throw new TypeError('extension.type must be "permessage"');if(typeof n.rsv1!="boolean")throw new TypeError("extension.rsv1 must be true or false");if(typeof n.rsv2!="boolean")throw new TypeError("extension.rsv2 must be true or false");if(typeof n.rsv3!="boolean")throw new TypeError("extension.rsv3 must be true or false");if(this._byName.hasOwnProperty(n.name))throw new TypeError('An extension with name "'+n.name+'" is already registered');this._byName[n.name]=n,this._inOrder.push(n)},generateOffer:function(){var n=[],e=[],t={};return this._inOrder.forEach(function(r){var i=r.createClientSession();if(i){var s=[r,i];n.push(s),t[r.name]=s;var o=i.generateOffer();o=o?[].concat(o):[],o.forEach(function(a){e.push(Sd.serializeParams(r.name,a))},this)}},this),this._sessions=n,this._index=t,e.length>0?e.join(", "):null},activate:function(n){var e=Sd.parseHeader(n),t=[];e.eachOffer(function(r,i){var s=this._index[r];if(!s)throw new Error('Server sent an extension response for unknown extension "'+r+'"');var o=s[0],a=s[1],l=this._reserved(o);if(l)throw new Error("Server sent two extension responses that use the RSV"+l[0]+' bit: "'+l[1]+'" and "'+o.name+'"');if(a.activate(i)!==!0)throw new Error("Server sent unacceptable extension parameters: "+Sd.serializeParams(r,i));this._reserve(o),t.push(s)},this),this._sessions=t,this._pipeline=new dV(t)},generateResponse:function(n){var e=[],t=[],r=Sd.parseHeader(n);return this._inOrder.forEach(function(i){var s=r.byName(i.name);if(!(s.length===0||this._reserved(i))){var o=i.createServerSession(s);o&&(this._reserve(i),e.push([i,o]),t.push(Sd.serializeParams(i.name,o.generateResponse())))}},this),this._sessions=e,this._pipeline=new dV(e),t.length>0?t.join(", "):null},validFrameRsv:function(n){var e={rsv1:!1,rsv2:!1,rsv3:!1},t;if(a_.MESSAGE_OPCODES.indexOf(n.opcode)>=0)for(var r=0,i=this._sessions.length;r<i;r++)t=this._sessions[r][0],e.rsv1=e.rsv1||t.rsv1,e.rsv2=e.rsv2||t.rsv2,e.rsv3=e.rsv3||t.rsv3;return(e.rsv1||!n.rsv1)&&(e.rsv2||!n.rsv2)&&(e.rsv3||!n.rsv3)},processIncomingMessage:function(n,e,t){this._pipeline.processIncomingMessage(n,e,t)},processOutgoingMessage:function(n,e,t){this._pipeline.processOutgoingMessage(n,e,t)},close:function(n,e){if(!this._pipeline)return n.call(e);this._pipeline.close(n,e)},_reserve:function(n){this._rsv1=this._rsv1||n.rsv1&&n.name,this._rsv2=this._rsv2||n.rsv2&&n.name,this._rsv3=this._rsv3||n.rsv3&&n.name},_reserved:function(n){return this._rsv1&&n.rsv1?[1,this._rsv1]:this._rsv2&&n.rsv2?[2,this._rsv2]:this._rsv3&&n.rsv3?[3,this._rsv3]:!1}};for(lA in fV)a_.prototype[lA]=fV[lA];var lA;pV.exports=a_});var vV=v((tde,_V)=>{"use strict";var yV=function(){},mV={final:!1,rsv1:!1,rsv2:!1,rsv3:!1,opcode:null,masked:!1,maskingKey:null,lengthBytes:1,length:0,payload:null};for(cA in mV)yV.prototype[cA]=mV[cA];var cA;_V.exports=yV});var wV=v((nde,CV)=>{"use strict";var Hte=hi().Buffer,SV=function(){this.rsv1=!1,this.rsv2=!1,this.rsv3=!1,this.opcode=null,this.length=0,this._chunks=[]},EV={read:function(){return this.data=this.data||Hte.concat(this._chunks,this.length)},pushFrame:function(n){this.rsv1=this.rsv1||n.rsv1,this.rsv2=this.rsv2||n.rsv2,this.rsv3=this.rsv3||n.rsv3,this.opcode===null&&(this.opcode=n.opcode),this._chunks.push(n.payload),this.length+=n.length}};for(uA in EV)SV.prototype[uA]=EV[uA];var uA;CV.exports=SV});var dA=v((rde,DV)=>{"use strict";var Cd=hi().Buffer,AV=z("crypto"),$te=z("util"),Kte=gV(),ga=Xs(),TV=vV(),bV=wV(),xn=function(n,e,t){if(ga.apply(this,arguments),this._extensions=new Kte,this._stage=0,this._masking=this._options.masking,this._protocols=this._options.protocols||[],this._requireMasking=this._options.requireMasking,this._pingCallbacks={},typeof this._protocols=="string"&&(this._protocols=this._protocols.split(/ *, */)),!!this._request){var r=this._request.headers["sec-websocket-protocol"],i=this._protocols;r!==void 0&&(typeof r=="string"&&(r=r.split(/ *, */)),this.protocol=r.filter(function(s){return i.indexOf(s)>=0})[0]),this.version="hybi-"+xn.VERSION}};$te.inherits(xn,ga);xn.VERSION="13";xn.mask=function(n,e,t){if(!e||e.length===0)return n;t=t||0;for(var r=0,i=n.length-t;r<i;r++)n[t+r]=n[t+r]^e[r%4];return n};xn.generateAccept=function(n){var e=AV.createHash("sha1");return e.update(n+xn.GUID),e.digest("base64")};xn.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";var IV={FIN:128,MASK:128,RSV1:64,RSV2:32,RSV3:16,OPCODE:15,LENGTH:127,OPCODES:{continuation:0,text:1,binary:2,close:8,ping:9,pong:10},OPCODE_CODES:[0,1,2,8,9,10],MESSAGE_OPCODES:[0,1,2],OPENING_OPCODES:[1,2],ERRORS:{normal_closure:1e3,going_away:1001,protocol_error:1002,unacceptable:1003,encoding_error:1007,policy_violation:1008,too_large:1009,extension_error:1010,unexpected_condition:1011},ERROR_CODES:[1e3,1001,1002,1003,1007,1008,1009,1010,1011],DEFAULT_ERROR_CODE:1e3,MIN_RESERVED_ERROR:3e3,MAX_RESERVED_ERROR:4999,UTF8_MATCH:/^([\x00-\x7F]|[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF]|\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})*$/,addExtension:function(n){return this._extensions.add(n),!0},parse:function(n){this._reader.put(n);for(var e=!0;e;)switch(this._stage){case 0:e=this._reader.read(1),e&&this._parseOpcode(e[0]);break;case 1:e=this._reader.read(1),e&&this._parseLength(e[0]);break;case 2:e=this._reader.read(this._frame.lengthBytes),e&&this._parseExtendedLength(e);break;case 3:e=this._reader.read(4),e&&(this._stage=4,this._frame.maskingKey=e);break;case 4:e=this._reader.read(this._frame.length),e&&(this._stage=0,this._emitFrame(e));break;default:e=null}},text:function(n){return this.readyState>1?!1:this.frame(n,"text")},binary:function(n){return this.readyState>1?!1:this.frame(n,"binary")},ping:function(n,e){return this.readyState>1?!1:(n=n||"",e&&(this._pingCallbacks[n]=e),this.frame(n,"ping"))},pong:function(n){return this.readyState>1?!1:(n=n||"",this.frame(n,"pong"))},close:function(n,e){return n=n||"",e=e||this.ERRORS.normal_closure,this.readyState<=0?(this.readyState=3,this.emit("close",new ga.CloseEvent(e,n)),!0):this.readyState===1?(this.readyState=2,this._extensions.close(function(){this.frame(n,"close",e)},this),!0):!1},frame:function(n,e,t){if(this.readyState<=0)return this._queue([n,e,t]);if(this.readyState>2)return!1;n instanceof Array&&(n=Cd.from(n)),typeof n=="number"&&(n=n.toString());var r=new bV,i=typeof n=="string",s,o;r.rsv1=r.rsv2=r.rsv3=!1,r.opcode=this.OPCODES[e||(i?"text":"binary")],s=i?Cd.from(n,"utf8"):n,t&&(o=s,s=Cd.allocUnsafe(2+o.length),s.writeUInt16BE(t,0),o.copy(s,2)),r.data=s;var a=function(l){var c=new TV;c.final=!0,c.rsv1=l.rsv1,c.rsv2=l.rsv2,c.rsv3=l.rsv3,c.opcode=l.opcode,c.masked=!!this._masking,c.length=l.data.length,c.payload=l.data,c.masked&&(c.maskingKey=AV.randomBytes(4)),this._sendFrame(c)};return this.MESSAGE_OPCODES.indexOf(r.opcode)>=0?this._extensions.processOutgoingMessage(r,function(l,c){if(l)return this._fail("extension_error",l.message);a.call(this,c)},this):a.call(this,r),!0},_sendFrame:function(n){var e=n.length,t=e<=125?2:e<=65535?4:10,r=t+(n.masked?4:0),i=Cd.allocUnsafe(r+e),s=n.masked?this.MASK:0;i[0]=(n.final?this.FIN:0)|(n.rsv1?this.RSV1:0)|(n.rsv2?this.RSV2:0)|(n.rsv3?this.RSV3:0)|n.opcode,e<=125?i[1]=s|e:e<=65535?(i[1]=s|126,i.writeUInt16BE(e,2)):(i[1]=s|127,i.writeUInt32BE(Math.floor(e/4294967296),2),i.writeUInt32BE(e%4294967296,6)),n.payload.copy(i,r),n.masked&&(n.maskingKey.copy(i,t),xn.mask(i,n.maskingKey,r)),this._write(i)},_handshakeResponse:function(){var n=this._request.headers["sec-websocket-key"],e=this._request.headers["sec-websocket-version"];if(e!==xn.VERSION)throw new Error("Unsupported WebSocket version: "+e);if(typeof n!="string")throw new Error("Missing handshake request header: Sec-WebSocket-Key");this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Accept",xn.generateAccept(n)),this.protocol&&this._headers.set("Sec-WebSocket-Protocol",this.protocol);var t=this._extensions.generateResponse(this._request.headers["sec-websocket-extensions"]);t&&this._headers.set("Sec-WebSocket-Extensions",t);var r="HTTP/1.1 101 Switching Protocols",i=[r,this._headers.toString(),""];return Cd.from(i.join(`\r
`),"utf8")},_shutdown:function(n,e,t){delete this._frame,delete this._message,this._stage=5;var r=this.readyState===1;this.readyState=2,this._extensions.close(function(){r&&this.frame(e,"close",n),this.readyState=3,t&&this.emit("error",new Error(e)),this.emit("close",new ga.CloseEvent(n,e))},this)},_fail:function(n,e){this.readyState>1||this._shutdown(this.ERRORS[n],e,!0)},_parseOpcode:function(n){var e=[this.RSV1,this.RSV2,this.RSV3].map(function(r){return(n&r)===r}),t=this._frame=new TV;if(t.final=(n&this.FIN)===this.FIN,t.rsv1=e[0],t.rsv2=e[1],t.rsv3=e[2],t.opcode=n&this.OPCODE,this._stage=1,!this._extensions.validFrameRsv(t))return this._fail("protocol_error","One or more reserved bits are on: reserved1 = "+(t.rsv1?1:0)+", reserved2 = "+(t.rsv2?1:0)+", reserved3 = "+(t.rsv3?1:0));if(this.OPCODE_CODES.indexOf(t.opcode)<0)return this._fail("protocol_error","Unrecognized frame opcode: "+t.opcode);if(this.MESSAGE_OPCODES.indexOf(t.opcode)<0&&!t.final)return this._fail("protocol_error","Received fragmented control frame: opcode = "+t.opcode);if(this._message&&this.OPENING_OPCODES.indexOf(t.opcode)>=0)return this._fail("protocol_error","Received new data frame but previous continuous frame is unfinished")},_parseLength:function(n){var e=this._frame;if(e.masked=(n&this.MASK)===this.MASK,e.length=n&this.LENGTH,e.length>=0&&e.length<=125){if(this._stage=e.masked?3:4,!this._checkFrameLength())return}else this._stage=2,e.lengthBytes=e.length===126?2:8;if(this._requireMasking&&!e.masked)return this._fail("unacceptable","Received unmasked frame but masking is required")},_parseExtendedLength:function(n){var e=this._frame;if(e.length=this._readUInt(n),this._stage=e.masked?3:4,this.MESSAGE_OPCODES.indexOf(e.opcode)<0&&e.length>125)return this._fail("protocol_error","Received control frame having too long payload: "+e.length);this._checkFrameLength()},_checkFrameLength:function(){var n=this._message?this._message.length:0;return n+this._frame.length>this._maxLength?(this._fail("too_large","WebSocket frame length too large"),!1):!0},_emitFrame:function(n){var e=this._frame,t=e.payload=xn.mask(n,e.maskingKey),r=e.opcode,i,s,o,a,l;if(delete this._frame,r===this.OPCODES.continuation){if(!this._message)return this._fail("protocol_error","Received unexpected continuation frame");this._message.pushFrame(e)}if((r===this.OPCODES.text||r===this.OPCODES.binary)&&(this._message=new bV,this._message.pushFrame(e)),e.final&&this.MESSAGE_OPCODES.indexOf(r)>=0)return this._emitMessage(this._message);r===this.OPCODES.close&&(s=t.length>=2?t.readUInt16BE(0):null,o=t.length>2?this._encode(t.slice(2)):null,t.length!==0&&!(s!==null&&s>=this.MIN_RESERVED_ERROR&&s<=this.MAX_RESERVED_ERROR)&&this.ERROR_CODES.indexOf(s)<0&&(s=this.ERRORS.protocol_error),(t.length>125||t.length>2&&!o)&&(s=this.ERRORS.protocol_error),this._shutdown(s||this.DEFAULT_ERROR_CODE,o||"")),r===this.OPCODES.ping&&(this.frame(t,"pong"),this.emit("ping",new ga.PingEvent(t.toString()))),r===this.OPCODES.pong&&(a=this._pingCallbacks,i=this._encode(t),l=a[i],delete a[i],l&&l(),this.emit("pong",new ga.PongEvent(t.toString())))},_emitMessage:function(e){var e=this._message;e.read(),delete this._message,this._extensions.processIncomingMessage(e,function(t,r){if(t)return this._fail("extension_error",t.message);var i=r.data;if(r.opcode===this.OPCODES.text&&(i=this._encode(i)),i===null)return this._fail("encoding_error","Could not decode a text frame as UTF-8");this.emit("message",new ga.MessageEvent(i))},this)},_encode:function(n){try{var e=n.toString("binary",0,n.length);if(!this.UTF8_MATCH.test(e))return null}catch{}return n.toString("utf8",0,n.length)},_readUInt:function(n){return n.length===2?n.readUInt16BE(0):n.readUInt32BE(0)*4294967296+n.readUInt32BE(4)}};for(hA in IV)xn.prototype[hA]=IV[hA];var hA;DV.exports=xn});var xV=v((ide,OV)=>{"use strict";var kV=hi().Buffer,Qte=z("stream").Stream,RV=z("url"),Yte=z("util"),Xte=Xs(),Jte=e_(),Zte=o_(),ene={"ws:":80,"wss:":443},pA=function(n,e,t){this._client=n,this._http=new Zte("response"),this._origin=typeof n.url=="object"?n.url:RV.parse(n.url),this._url=typeof e=="object"?e:RV.parse(e),this._options=t||{},this._state=0,this.readable=this.writable=!0,this._paused=!1,this._headers=new Jte,this._headers.set("Host",this._origin.host),this._headers.set("Connection","keep-alive"),this._headers.set("Proxy-Connection","keep-alive");var r=this._url.auth&&kV.from(this._url.auth,"utf8").toString("base64");r&&this._headers.set("Proxy-Authorization","Basic "+r)};Yte.inherits(pA,Qte);var NV={setHeader:function(n,e){return this._state!==0?!1:(this._headers.set(n,e),!0)},start:function(){if(this._state!==0)return!1;this._state=1;var n=this._origin,e=n.port||ene[n.protocol],t="CONNECT "+n.hostname+":"+e+" HTTP/1.1",r=[t,this._headers.toString(),""];return this.emit("data",kV.from(r.join(`\r
`),"utf8")),!0},pause:function(){this._paused=!0},resume:function(){this._paused=!1,this.emit("drain")},write:function(n){if(!this.writable)return!1;if(this._http.parse(n),!this._http.isComplete())return!this._paused;if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this.statusCode===200)this.emit("connect",new Xte.ConnectEvent);else{var e="Can't establish a connection to the server at "+this._origin.href;this.emit("error",new Error(e))}return this.end(),!this._paused},end:function(n){this.writable&&(n!==void 0&&this.write(n),this.readable=this.writable=!1,this.emit("close"),this.emit("end"))},destroy:function(){this.end()}};for(fA in NV)pA.prototype[fA]=NV[fA];var fA;OV.exports=pA});var LV=v((sde,FV)=>{"use strict";var MV=hi().Buffer,tne=z("crypto"),nne=z("url"),rne=z("util"),ine=o_(),sne=Xs(),Rc=dA(),one=xV(),wd=function(n,e){this.version="hybi-"+Rc.VERSION,Rc.call(this,null,n,e),this.readyState=-1,this._key=wd.generateKey(),this._accept=Rc.generateAccept(this._key),this._http=new ine("response");var t=nne.parse(this.url),r=t.auth&&MV.from(t.auth,"utf8").toString("base64");if(this.VALID_PROTOCOLS.indexOf(t.protocol)<0)throw new Error(this.url+" is not a valid WebSocket URL");this._pathname=(t.pathname||"/")+(t.search||""),this._headers.set("Host",t.host),this._headers.set("Upgrade","websocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Key",this._key),this._headers.set("Sec-WebSocket-Version",Rc.VERSION),this._protocols.length>0&&this._headers.set("Sec-WebSocket-Protocol",this._protocols.join(", ")),r&&this._headers.set("Authorization","Basic "+r)};rne.inherits(wd,Rc);wd.generateKey=function(){return tne.randomBytes(16).toString("base64")};var PV={VALID_PROTOCOLS:["ws:","wss:"],proxy:function(n,e){return new one(this,n,e)},start:function(){return this.readyState!==-1?!1:(this._write(this._handshakeRequest()),this.readyState=0,!0)},parse:function(n){if(this.readyState!==3){if(this.readyState>0)return Rc.prototype.parse.call(this,n);this._http.parse(n),this._http.isComplete()&&(this._validateHandshake(),this.readyState!==3&&(this._open(),this.parse(this._http.body)))}},_handshakeRequest:function(){var n=this._extensions.generateOffer();n&&this._headers.set("Sec-WebSocket-Extensions",n);var e="GET "+this._pathname+" HTTP/1.1",t=[e,this._headers.toString(),""];return MV.from(t.join(`\r
`),"utf8")},_failHandshake:function(n){n="Error during WebSocket handshake: "+n,this.readyState=3,this.emit("error",new Error(n)),this.emit("close",new sne.CloseEvent(this.ERRORS.protocol_error,n))},_validateHandshake:function(){if(this.statusCode=this._http.statusCode,this.headers=this._http.headers,this._http.error)return this._failHandshake(this._http.error.message);if(this._http.statusCode!==101)return this._failHandshake("Unexpected response code: "+this._http.statusCode);var n=this._http.headers,e=n.upgrade||"",t=n.connection||"",r=n["sec-websocket-accept"]||"",i=n["sec-websocket-protocol"]||"";if(e==="")return this._failHandshake("'Upgrade' header is missing");if(e.toLowerCase()!=="websocket")return this._failHandshake("'Upgrade' header value is not 'WebSocket'");if(t==="")return this._failHandshake("'Connection' header is missing");if(t.toLowerCase()!=="upgrade")return this._failHandshake("'Connection' header value is not 'Upgrade'");if(r!==this._accept)return this._failHandshake("Sec-WebSocket-Accept mismatch");if(this.protocol=null,i!==""){if(this._protocols.indexOf(i)<0)return this._failHandshake("Sec-WebSocket-Protocol mismatch");this.protocol=i}try{this._extensions.activate(this.headers["sec-websocket-extensions"])}catch(s){return this._failHandshake(s.message)}}};for(gA in PV)wd.prototype[gA]=PV[gA];var gA;FV.exports=wd});var _A=v((ode,VV)=>{"use strict";var l_=hi().Buffer,c_=Xs(),ane=z("util"),yA=function(n,e,t){c_.apply(this,arguments),this._stage=0,this.version="hixie-75",this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("WebSocket-Origin",this._request.headers.origin),this._headers.set("WebSocket-Location",this.url)};ane.inherits(yA,c_);var BV={close:function(){return this.readyState===3?!1:(this.readyState=3,this.emit("close",new c_.CloseEvent(null,null)),!0)},parse:function(n){this.readyState>1||(this._reader.put(n),this._reader.eachByte(function(e){var t;switch(this._stage){case-1:this._body.push(e),this._sendHandshakeBody();break;case 0:this._parseLeadingByte(e);break;case 1:if(this._length=(e&127)+128*this._length,this._closing&&this._length===0)return this.close();(e&128)!==128&&(this._length===0?this._stage=0:(this._skipped=0,this._stage=2));break;case 2:if(e===255)this._stage=0,t=l_.from(this._buffer).toString("utf8",0,this._buffer.length),this.emit("message",new c_.MessageEvent(t));else if(this._length)this._skipped+=1,this._skipped===this._length&&(this._stage=0);else if(this._buffer.push(e),this._buffer.length>this._maxLength)return this.close();break}},this))},frame:function(n){if(this.readyState===0)return this._queue([n]);if(this.readyState>1)return!1;typeof n!="string"&&(n=n.toString());var e=l_.byteLength(n),t=l_.allocUnsafe(e+2);return t[0]=0,t.write(n,1),t[t.length-1]=255,this._write(t),!0},_handshakeResponse:function(){var n="HTTP/1.1 101 Web Socket Protocol Handshake",e=[n,this._headers.toString(),""];return l_.from(e.join(`\r
`),"utf8")},_parseLeadingByte:function(n){(n&128)===128?(this._length=0,this._stage=1):(delete this._length,delete this._skipped,this._buffer=[],this._stage=2)}};for(mA in BV)yA.prototype[mA]=BV[mA];var mA;VV.exports=yA});var jV=v((ade,GV)=>{"use strict";var Td=hi().Buffer,lne=Xs(),u_=_A(),cne=z("crypto"),une=z("util"),UV=function(n){return parseInt((n.match(/[0-9]/g)||[]).join(""),10)},qV=function(n){return(n.match(/ /g)||[]).length},EA=function(n,e,t){u_.apply(this,arguments),this._stage=-1,this._body=[],this.version="hixie-76",this._headers.clear(),this._headers.set("Upgrade","WebSocket"),this._headers.set("Connection","Upgrade"),this._headers.set("Sec-WebSocket-Origin",this._request.headers.origin),this._headers.set("Sec-WebSocket-Location",this.url)};une.inherits(EA,u_);var zV={BODY_SIZE:8,start:function(){return u_.prototype.start.call(this)?(this._started=!0,this._sendHandshakeBody(),!0):!1},close:function(){return this.readyState===3?!1:(this.readyState===1&&this._write(Td.from([255,0])),this.readyState=3,this.emit("close",new lne.CloseEvent(null,null)),!0)},_handshakeResponse:function(){var a=this._request.headers,n=a["sec-websocket-key1"],e=a["sec-websocket-key2"];if(!n)throw new Error("Missing required header: Sec-WebSocket-Key1");if(!e)throw new Error("Missing required header: Sec-WebSocket-Key2");var t=UV(n),r=qV(n),i=UV(e),s=qV(e);if(t%r!==0||i%s!==0)throw new Error("Client sent invalid Sec-WebSocket-Key headers");this._keyValues=[t/r,i/s];var o="HTTP/1.1 101 WebSocket Protocol Handshake",a=[o,this._headers.toString(),""];return Td.from(a.join(`\r
`),"binary")},_handshakeSignature:function(){if(this._body.length<this.BODY_SIZE)return null;var n=cne.createHash("md5"),e=Td.allocUnsafe(8+this.BODY_SIZE);return e.writeUInt32BE(this._keyValues[0],0),e.writeUInt32BE(this._keyValues[1],4),Td.from(this._body).copy(e,8,0,this.BODY_SIZE),n.update(e),Td.from(n.digest("binary"),"binary")},_sendHandshakeBody:function(){if(this._started){var n=this._handshakeSignature();n&&(this._write(n),this._stage=0,this._open(),this._body.length>this.BODY_SIZE&&this.parse(this._body.slice(this.BODY_SIZE)))}},_parseLeadingByte:function(n){if(n!==255)return u_.prototype._parseLeadingByte.call(this,n);this._closing=!0,this._length=0,this._stage=1}};for(vA in zV)EA.prototype[vA]=zV[vA];var vA;GV.exports=EA});var HV=v((lde,WV)=>{"use strict";var hne=z("util"),dne=o_(),wA=Xs(),fne=_A(),pne=jV(),gne=dA(),ma=function(n){wA.call(this,null,null,n),this._http=new dne("request")};hne.inherits(ma,wA);var CA={EVENTS:["open","message","error","close","ping","pong"],_bindEventListeners:function(){this.messages.on("error",function(){}),this.on("error",function(){})},parse:function(n){if(this._delegate)return this._delegate.parse(n);if(this._http.parse(n),!!this._http.isComplete()){this.method=this._http.method,this.url=this._http.url,this.headers=this._http.headers,this.body=this._http.body;var e=this;this._delegate=ma.http(this,this._options),this._delegate.messages=this.messages,this._delegate.io=this.io,this._open(),this.EVENTS.forEach(function(t){this._delegate.on(t,function(r){e.emit(t,r)})},this),this.protocol=this._delegate.protocol,this.version=this._delegate.version,this.parse(this._http.body),this.emit("connect",new wA.ConnectEvent)}},_open:function(){this.__queue.forEach(function(n){this._delegate[n[0]].apply(this._delegate,n[1])},this),this.__queue=[]}};["addExtension","setHeader","start","frame","text","binary","ping","close"].forEach(function(n){CA[n]=function(){return this._delegate?this._delegate[n].apply(this._delegate,arguments):(this.__queue.push([n,arguments]),!0)}});for(SA in CA)ma.prototype[SA]=CA[SA];var SA;ma.isSecureRequest=function(n){if(n.connection&&n.connection.authorized!==void 0||n.socket&&n.socket.secure)return!0;var e=n.headers;return e?e.https==="on"||e["x-forwarded-ssl"]==="on"||e["x-forwarded-scheme"]==="https"||e["x-forwarded-proto"]==="https":!1};ma.determineUrl=function(n){var e=this.isSecureRequest(n)?"wss:":"ws:";return e+"//"+n.headers.host+n.url};ma.http=function(n,e){e=e||{},e.requireMasking===void 0&&(e.requireMasking=!0);var t=n.headers,r=t["sec-websocket-version"],i=t["sec-websocket-key"],s=t["sec-websocket-key1"],o=t["sec-websocket-key2"],a=this.determineUrl(n);return r||i?new gne(n,a,e):s||o?new pne(n,a,e):new fne(n,a,e)};WV.exports=ma});var bd=v((cde,KV)=>{"use strict";var $V=Xs(),mne=LV(),h_=HV(),yne={client:function(n,e){return e=e||{},e.masking===void 0&&(e.masking=!0),new mne(n,e)},server:function(n){return n=n||{},n.requireMasking===void 0&&(n.requireMasking=!0),new h_(n)},http:function(){return h_.http.apply(h_,arguments)},isSecureRequest:function(n){return h_.isSecureRequest(n)},isWebSocket:function(n){return $V.isWebSocket(n)},validateOptions:function(n,e){$V.validateOptions(n,e)}};KV.exports=yne});var Id=v((ude,QV)=>{"use strict";var ya=function(n,e){this.type=n;for(var t in e)this[t]=e[t]};ya.prototype.initEvent=function(n,e,t){this.type=n,this.bubbles=e,this.cancelable=t};ya.prototype.stopPropagation=function(){};ya.prototype.preventDefault=function(){};ya.CAPTURING_PHASE=1;ya.AT_TARGET=2;ya.BUBBLING_PHASE=3;QV.exports=ya});var TA=v((hde,YV)=>{"use strict";var _ne=Id(),vne={onopen:null,onmessage:null,onerror:null,onclose:null,addEventListener:function(n,e,t){this.on(n,e)},removeEventListener:function(n,e,t){this.removeListener(n,e)},dispatchEvent:function(n){n.target=n.currentTarget=this,n.eventPhase=_ne.AT_TARGET,this["on"+n.type]&&this["on"+n.type](n),this.emit(n.type,n)}};YV.exports=vne});var f_=v((dde,ZV)=>{"use strict";var Ene=z("stream").Stream,Sne=z("util"),Cne=bd(),XV=TA(),d_=Id(),Ge=function(n){n=n||{},Cne.validateOptions(n,["headers","extensions","maxLength","ping","proxy","tls","ca"]),this.readable=this.writable=!0;var e=n.headers;if(e)for(var t in e)this._driver.setHeader(t,e[t]);var r=n.extensions;r&&[].concat(r).forEach(this._driver.addExtension,this._driver),this._ping=n.ping,this._pingId=0,this.readyState=Ge.CONNECTING,this.bufferedAmount=0,this.protocol="",this.url=this._driver.url,this.version=this._driver.version;var i=this;this._driver.on("open",function(s){i._open()}),this._driver.on("message",function(s){i._receiveMessage(s.data)}),this._driver.on("close",function(s){i._beginClose(s.reason,s.code)}),this._driver.on("error",function(s){i._emitError(s.message)}),this.on("error",function(){}),this._driver.messages.on("drain",function(){i.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){i._pingId+=1,i.ping(i._pingId.toString())},this._ping*1e3)),this._configureStream(),this._proxy||(this._stream.pipe(this._driver.io),this._driver.io.pipe(this._stream))};Sne.inherits(Ge,Ene);Ge.CONNECTING=0;Ge.OPEN=1;Ge.CLOSING=2;Ge.CLOSED=3;Ge.CLOSE_TIMEOUT=3e4;var JV={write:function(n){return this.send(n)},end:function(n){n!==void 0&&this.send(n),this.close()},pause:function(){return this._driver.messages.pause()},resume:function(){return this._driver.messages.resume()},send:function(n){return this.readyState>Ge.OPEN?!1:(n instanceof Buffer||(n=String(n)),this._driver.messages.write(n))},ping:function(n,e){return this.readyState>Ge.OPEN?!1:this._driver.ping(n,e)},close:function(n,e){if(n===void 0&&(n=1e3),e===void 0&&(e=""),n!==1e3&&(n<3e3||n>4999))throw new Error("Failed to execute 'close' on WebSocket: The code must be either 1000, or between 3000 and 4999. "+n+" is neither.");if(this.readyState<Ge.CLOSING){var t=this;this._closeTimer=setTimeout(function(){t._beginClose("",1006)},Ge.CLOSE_TIMEOUT)}this.readyState!==Ge.CLOSED&&(this.readyState=Ge.CLOSING),this._driver.close(e,n)},_configureStream:function(){var n=this;this._stream.setTimeout(0),this._stream.setNoDelay(!0),["close","end"].forEach(function(e){this._stream.on(e,function(){n._finalizeClose()})},this),this._stream.on("error",function(e){n._emitError("Network error: "+n.url+": "+e.message),n._finalizeClose()})},_open:function(){if(this.readyState===Ge.CONNECTING){this.readyState=Ge.OPEN,this.protocol=this._driver.protocol||"";var n=new d_("open");n.initEvent("open",!1,!1),this.dispatchEvent(n)}},_receiveMessage:function(n){if(this.readyState>Ge.OPEN)return!1;this.readable&&this.emit("data",n);var e=new d_("message",{data:n});e.initEvent("message",!1,!1),this.dispatchEvent(e)},_emitError:function(n){if(!(this.readyState>=Ge.CLOSING)){var e=new d_("error",{message:n});e.initEvent("error",!1,!1),this.dispatchEvent(e)}},_beginClose:function(n,e){this.readyState!==Ge.CLOSED&&(this.readyState=Ge.CLOSING,this._closeParams=[n,e],this._stream&&(this._stream.destroy(),this._stream.readable||this._finalizeClose()))},_finalizeClose:function(){if(this.readyState!==Ge.CLOSED){this.readyState=Ge.CLOSED,this._closeTimer&&clearTimeout(this._closeTimer),this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end(),this.readable&&this.emit("end"),this.readable=this.writable=!1;var n=this._closeParams?this._closeParams[0]:"",e=this._closeParams?this._closeParams[1]:1006,t=new d_("close",{code:e,reason:n});t.initEvent("close",!1,!1),this.dispatchEvent(t)}}};for(bA in JV)Ge.prototype[bA]=JV[bA];var bA;for(IA in XV)Ge.prototype[IA]=XV[IA];var IA;ZV.exports=Ge});var sU=v((pde,iU)=>{"use strict";var wne=z("util"),Tne=z("net"),eU=z("tls"),tU=z("url"),bne=bd(),nU=f_(),fde=Id(),Ine={"http:":80,"https:":443,"ws:":80,"wss:":443},rU=["https:","wss:"],p_=function(n,e,t){t=t||{},this.url=n,this._driver=bne.client(this.url,{maxLength:t.maxLength,protocols:e}),["open","error"].forEach(function(d){this._driver.on(d,function(){h.headers=h._driver.headers,h.statusCode=h._driver.statusCode})},this);var r=t.proxy||{},i=tU.parse(r.origin||this.url),s=i.port||Ine[i.protocol],o=rU.indexOf(i.protocol)>=0,a=function(){h._onConnect()},l=t.net||{},c=t.tls||{},u=r.origin?r.tls||{}:c,h=this;l.host=u.host=i.hostname,l.port=u.port=s,c.ca=c.ca||t.ca,u.servername=u.servername||i.hostname,this._stream=o?eU.connect(u,a):Tne.connect(l,a),r.origin&&this._configureProxy(r,c),nU.call(this,t)};wne.inherits(p_,nU);p_.prototype._onConnect=function(){var n=this._proxy||this._driver;n.start()};p_.prototype._configureProxy=function(n,e){var t=tU.parse(this.url),r=rU.indexOf(t.protocol)>=0,i=this,s;if(this._proxy=this._driver.proxy(n.origin),n.headers)for(s in n.headers)this._proxy.setHeader(s,n.headers[s]);this._proxy.pipe(this._stream,{end:!1}),this._stream.pipe(this._proxy),this._proxy.on("connect",function(){if(r){var o={socket:i._stream,servername:t.hostname};for(s in e)o[s]=e[s];i._stream=eU.connect(o),i._configureStream()}i._driver.io.pipe(i._stream),i._stream.pipe(i._driver.io),i._driver.start()}),this._proxy.on("error",function(o){i._driver.emit("error",o)})};iU.exports=p_});var uU=v((gde,cU)=>{"use strict";var Ane=z("stream").Stream,Dne=z("util"),Rne=bd(),Nne=e_(),Nc=f_(),oU=TA(),aU=Id(),Ad=function(n,e,t){this.writable=!0,t=t||{},this._stream=e.socket,this._ping=t.ping||this.DEFAULT_PING,this._retry=t.retry||this.DEFAULT_RETRY;var r=Rne.isSecureRequest(n)?"https:":"http:";this.url=r+"//"+n.headers.host+n.url,this.lastEventId=n.headers["last-event-id"]||"",this.readyState=Nc.CONNECTING;var i=new Nne,s=this;if(t.headers)for(var o in t.headers)i.set(o,t.headers[o]);if(!(!this._stream||!this._stream.writable)){process.nextTick(function(){s._open()}),this._stream.setTimeout(0),this._stream.setNoDelay(!0);var a=`HTTP/1.1 200 OK\r
Content-Type: text/event-stream\r
Cache-Control: no-cache, no-store\r
Connection: close\r
`+i.toString()+`\r
retry: `+Math.floor(this._retry*1e3)+`\r
\r
`;this._write(a),this._stream.on("drain",function(){s.emit("drain")}),this._ping&&(this._pingTimer=setInterval(function(){s.ping()},this._ping*1e3)),["error","end"].forEach(function(l){s._stream.on(l,function(){s.close()})})}};Dne.inherits(Ad,Ane);Ad.isEventSource=function(n){if(n.method!=="GET")return!1;var e=(n.headers.accept||"").split(/\s*,\s*/);return e.indexOf("text/event-stream")>=0};var lU={DEFAULT_PING:10,DEFAULT_RETRY:5,_write:function(n){if(!this.writable)return!1;try{return this._stream.write(n,"utf8")}catch{return!1}},_open:function(){if(this.readyState===Nc.CONNECTING){this.readyState=Nc.OPEN;var n=new aU("open");n.initEvent("open",!1,!1),this.dispatchEvent(n)}},write:function(n){return this.send(n)},end:function(n){n!==void 0&&this.write(n),this.close()},send:function(n,e){if(this.readyState>Nc.OPEN)return!1;n=String(n).replace(/(\r\n|\r|\n)/g,"$1data: "),e=e||{};var t="";return e.event&&(t+="event: "+e.event+`\r
`),e.id&&(t+="id: "+e.id+`\r
`),t+="data: "+n+`\r
\r
`,this._write(t)},ping:function(){return this._write(`:\r
\r
`)},close:function(){if(this.readyState>Nc.OPEN)return!1;this.readyState=Nc.CLOSED,this.writable=!1,this._pingTimer&&clearInterval(this._pingTimer),this._stream&&this._stream.end();var n=new aU("close");return n.initEvent("close",!1,!1),this.dispatchEvent(n),!0}};for(AA in lU)Ad.prototype[AA]=lU[AA];var AA;for(DA in oU)Ad.prototype[DA]=oU[DA];var DA;cU.exports=Ad});var fU=v((mde,dU)=>{"use strict";var kne=z("util"),RA=bd(),hU=f_(),Js=function(n,e,t,r,i){i=i||{},this._stream=e,this._driver=RA.http(n,{maxLength:i.maxLength,protocols:r});var s=this;if(!(!this._stream||!this._stream.writable)){if(!this._stream.readable)return this._stream.end();var o=function(){s._stream.removeListener("data",o)};this._stream.on("data",o),hU.call(this,i),process.nextTick(function(){s._driver.start(),s._driver.io.write(t)})}};kne.inherits(Js,hU);Js.isWebSocket=function(n){return RA.isWebSocket(n)};Js.validateOptions=function(n,e){RA.validateOptions(n,e)};Js.WebSocket=Js;Js.Client=sU();Js.EventSource=uU();dU.exports=Js});var h1=(()=>{let e=class e{constructor(r,i){this._renderer=r,this._elementRef=i,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(r,i){this._renderer.setProperty(this._elementRef.nativeElement,r,i)}registerOnTouched(r){this.onTouched=r}registerOnChange(r){this.onChange=r}setDisabledState(r){this.setProperty("disabled",r)}};e.\u0275fac=function(i){return new(i||e)(te(Jc),te(Xc))},e.\u0275dir=St({type:e});let n=e;return n})(),Pf=(()=>{let e=class e extends h1{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Ra(e)))(s||e)}})(),e.\u0275dir=St({type:e,features:[Tn]});let n=e;return n})(),Fa=new Ie("");var Y3={provide:Fa,useExisting:kr(()=>La),multi:!0};function X3(){let n=Sv()?Sv().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var J3=new Ie(""),La=(()=>{let e=class e extends h1{constructor(r,i,s){super(r,i),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!X3())}writeValue(r){let i=r??"";this.setProperty("value",i)}_handleInput(r){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(r)}_compositionStart(){this._composing=!0}_compositionEnd(r){this._composing=!1,this._compositionMode&&this.onChange(r)}};e.\u0275fac=function(i){return new(i||e)(te(Jc),te(Xc),te(J3,8))},e.\u0275dir=St({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,s){i&1&&en("input",function(a){return s._handleInput(a.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(a){return s._compositionEnd(a.target.value)})},features:[xr([Y3]),Tn]});let n=e;return n})();function Qi(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}function d1(n){return n!=null&&typeof n.length=="number"}var lu=new Ie(""),Mf=new Ie(""),Z3=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,xa=class{static min(e){return e4(e)}static max(e){return t4(e)}static required(e){return f1(e)}static requiredTrue(e){return n4(e)}static email(e){return r4(e)}static minLength(e){return i4(e)}static maxLength(e){return s4(e)}static pattern(e){return o4(e)}static nullValidator(e){return Af(e)}static compose(e){return v1(e)}static composeAsync(e){return E1(e)}};function e4(n){return e=>{if(Qi(e.value)||Qi(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}function t4(n){return e=>{if(Qi(e.value)||Qi(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}function f1(n){return Qi(n.value)?{required:!0}:null}function n4(n){return n.value===!0?null:{required:!0}}function r4(n){return Qi(n.value)||Z3.test(n.value)?null:{email:!0}}function i4(n){return e=>Qi(e.value)||!d1(e.value)?null:e.value.length<n?{minlength:{requiredLength:n,actualLength:e.value.length}}:null}function s4(n){return e=>d1(e.value)&&e.value.length>n?{maxlength:{requiredLength:n,actualLength:e.value.length}}:null}function o4(n){if(!n)return Af;let e,t;return typeof n=="string"?(t="",n.charAt(0)!=="^"&&(t+="^"),t+=n,n.charAt(n.length-1)!=="$"&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),r=>{if(Qi(r.value))return null;let i=r.value;return e.test(i)?null:{pattern:{requiredPattern:t,actualValue:i}}}}function Af(n){return null}function p1(n){return n!=null}function g1(n){return BR(n)?Nr(n):n}function m1(n){let e={};return n.forEach(t=>{e=t!=null?mt(mt({},e),t):e}),Object.keys(e).length===0?null:e}function y1(n,e){return e.map(t=>t(n))}function a4(n){return!n.validate}function _1(n){return n.map(e=>a4(e)?e:t=>e.validate(t))}function v1(n){if(!n)return null;let e=n.filter(p1);return e.length==0?null:function(t){return m1(y1(t,e))}}function Ov(n){return n!=null?v1(_1(n)):null}function E1(n){if(!n)return null;let e=n.filter(p1);return e.length==0?null:function(t){let r=y1(t,e).map(g1);return IR(r).pipe(ke(m1))}}function xv(n){return n!=null?E1(_1(n)):null}function n1(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function S1(n){return n._rawValidators}function C1(n){return n._rawAsyncValidators}function Rv(n){return n?Array.isArray(n)?n:[n]:[]}function Df(n,e){return Array.isArray(n)?n.includes(e):n===e}function r1(n,e){let t=Rv(e);return Rv(n).forEach(i=>{Df(t,i)||t.push(i)}),t}function i1(n,e){return Rv(e).filter(t=>!Df(n,t))}var Rf=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Ov(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=xv(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},vi=class extends Rf{get formDirective(){return null}get path(){return null}},po=class extends Rf{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},Nf=class{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},l4={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},aoe=Bn(mt({},l4),{"[class.ng-submitted]":"isSubmitted"}),Ff=(()=>{let e=class e extends Nf{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(te(po,2))},e.\u0275dir=St({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,s){i&2&&fv("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[Tn]});let n=e;return n})(),Lf=(()=>{let e=class e extends Nf{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(te(vi,10))},e.\u0275dir=St({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,s){i&2&&fv("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)("ng-submitted",s.isSubmitted)},features:[Tn]});let n=e;return n})();var iu="VALID",If="INVALID",Oa="PENDING",su="DISABLED";function Pv(n){return(Bf(n)?n.validators:n)||null}function c4(n){return Array.isArray(n)?Ov(n):n||null}function Mv(n,e){return(Bf(e)?e.asyncValidators:n)||null}function u4(n){return Array.isArray(n)?xv(n):n||null}function Bf(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function w1(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new pf(1e3,"");if(!r[t])throw new pf(1001,"")}function T1(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new pf(1002,"")})}var Pa=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===iu}get invalid(){return this.status===If}get pending(){return this.status==Oa}get disabled(){return this.status===su}get enabled(){return this.status!==su}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(r1(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(r1(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(i1(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(i1(e,this._rawAsyncValidators))}hasValidator(e){return Df(this._rawValidators,e)}hasAsyncValidator(e){return Df(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Oa,e.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=su,this.errors=null,this._forEachChild(r=>{r.disable(Bn(mt({},e),{onlySelf:!0}))}),this._updateValue(),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Bn(mt({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=iu,this._forEachChild(r=>{r.enable(Bn(mt({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Bn(mt({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===iu||this.status===Oa)&&this._runAsyncValidator(e.emitEvent)),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?su:iu}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Oa,this._hasOwnPendingAsyncValidator=!0;let t=g1(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new ho,this.statusChanges=new ho}_calculateStatus(){return this._allControlsDisabled()?su:this.errors?If:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Oa)?Oa:this._anyControlsHaveStatus(If)?If:iu}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Bf(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=c4(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=u4(this._rawAsyncValidators)}},Ma=class extends Pa{constructor(e,t,r){super(Pv(t),Mv(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){T1(this,!0,e),Object.keys(e).forEach(r=>{w1(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var Nv=class extends Ma{};var cu=new Ie("CallSetDisabledState",{providedIn:"root",factory:()=>Vf}),Vf="always";function b1(n,e){return[...e.path,n]}function kf(n,e,t=Vf){Fv(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),d4(n,e),p4(n,e),f4(n,e),h4(n,e)}function s1(n,e,t=!0){let r=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(r),e.valueAccessor.registerOnTouched(r)),xf(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function Of(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function h4(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function Fv(n,e){let t=S1(n);e.validator!==null?n.setValidators(n1(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=C1(n);e.asyncValidator!==null?n.setAsyncValidators(n1(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();Of(e._rawValidators,i),Of(e._rawAsyncValidators,i)}function xf(n,e){let t=!1;if(n!==null){if(e.validator!==null){let i=S1(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.validator);s.length!==i.length&&(t=!0,n.setValidators(s))}}if(e.asyncValidator!==null){let i=C1(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.asyncValidator);s.length!==i.length&&(t=!0,n.setAsyncValidators(s))}}}let r=()=>{};return Of(e._rawValidators,r),Of(e._rawAsyncValidators,r),t}function d4(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&I1(n,e)})}function f4(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&I1(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function I1(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function p4(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function A1(n,e){n==null,Fv(n,e)}function g4(n,e){return xf(n,e)}function D1(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function m4(n){return Object.getPrototypeOf(n.constructor)===Pf}function R1(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function N1(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===La?t=s:m4(s)?r=s:i=s}),i||r||t||null}function y4(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}var _4={provide:vi,useExisting:kr(()=>Lv)},ou=(()=>Promise.resolve())(),Lv=(()=>{let e=class e extends vi{constructor(r,i,s){super(),this.callSetDisabledState=s,this.submitted=!1,this._directives=new Set,this.ngSubmit=new ho,this.form=new Ma({},Ov(r),xv(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(r){ou.then(()=>{let i=this._findContainer(r.path);r.control=i.registerControl(r.name,r.control),kf(r.control,r,this.callSetDisabledState),r.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(r)})}getControl(r){return this.form.get(r.path)}removeControl(r){ou.then(()=>{let i=this._findContainer(r.path);i&&i.removeControl(r.name),this._directives.delete(r)})}addFormGroup(r){ou.then(()=>{let i=this._findContainer(r.path),s=new Ma({});A1(s,r),i.registerControl(r.name,s),s.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(r){ou.then(()=>{let i=this._findContainer(r.path);i&&i.removeControl(r.name)})}getFormGroup(r){return this.form.get(r.path)}updateModel(r,i){ou.then(()=>{this.form.get(r.path).setValue(i)})}setValue(r){this.control.setValue(r)}onSubmit(r){return this.submitted=!0,R1(this.form,this._directives),this.ngSubmit.emit(r),r?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(r=void 0){this.form.reset(r),this.submitted=!1}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(r){return r.pop(),r.length?this.form.get(r):this.form}};e.\u0275fac=function(i){return new(i||e)(te(lu,10),te(Mf,10),te(cu,8))},e.\u0275dir=St({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(i,s){i&1&&en("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{options:[_i.None,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[xr([_4]),Tn]});let n=e;return n})();function o1(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function a1(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var au=class extends Pa{constructor(e=null,t,r){super(Pv(t),Mv(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Bf(t)&&(t.nonNullable||t.initialValueIsDefault)&&(a1(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){o1(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){o1(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){a1(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var v4=n=>n instanceof au;var E4={provide:po,useExisting:kr(()=>Bv)},l1=(()=>Promise.resolve())(),Bv=(()=>{let e=class e extends po{constructor(r,i,s,o,a,l){super(),this._changeDetectorRef=a,this.callSetDisabledState=l,this.control=new au,this._registered=!1,this.name="",this.update=new ho,this._parent=r,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=N1(this,o)}ngOnChanges(r){if(this._checkForErrors(),!this._registered||"name"in r){if(this._registered&&(this._checkName(),this.formDirective)){let i=r.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in r&&this._updateDisabled(r),D1(r,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(r){this.viewModel=r,this.update.emit(r)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){kf(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(r){l1.then(()=>{this.control.setValue(r,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(r){let i=r.isDisabled.currentValue,s=i!==0&&Ev(i);l1.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(r){return this._parent?b1(r,this._parent):[r]}};e.\u0275fac=function(i){return new(i||e)(te(vi,9),te(lu,10),te(Mf,10),te(Fa,10),te(VR,8),te(cu,8))},e.\u0275dir=St({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[_i.None,"disabled","isDisabled"],model:[_i.None,"ngModel","model"],options:[_i.None,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[xr([E4]),Tn,Yc]});let n=e;return n})(),Uf=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=St({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let n=e;return n})(),S4={provide:Fa,useExisting:kr(()=>Vv),multi:!0},Vv=(()=>{let e=class e extends Pf{writeValue(r){let i=r??"";this.setProperty("value",i)}registerOnChange(r){this.onChange=i=>{r(i==""?null:parseFloat(i))}}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Ra(e)))(s||e)}})(),e.\u0275dir=St({type:e,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(i,s){i&1&&en("input",function(a){return s.onChange(a.target.value)})("blur",function(){return s.onTouched()})},features:[xr([S4]),Tn]});let n=e;return n})();var k1=new Ie("");var C4={provide:vi,useExisting:kr(()=>Uv)},Uv=(()=>{let e=class e extends vi{constructor(r,i,s){super(),this.callSetDisabledState=s,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new ho,this._setValidators(r),this._setAsyncValidators(i)}ngOnChanges(r){this._checkFormPresent(),r.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(xf(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(r){let i=this.form.get(r.path);return kf(i,r,this.callSetDisabledState),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(r),i}getControl(r){return this.form.get(r.path)}removeControl(r){s1(r.control||null,r,!1),y4(this.directives,r)}addFormGroup(r){this._setUpFormContainer(r)}removeFormGroup(r){this._cleanUpFormContainer(r)}getFormGroup(r){return this.form.get(r.path)}addFormArray(r){this._setUpFormContainer(r)}removeFormArray(r){this._cleanUpFormContainer(r)}getFormArray(r){return this.form.get(r.path)}updateModel(r,i){this.form.get(r.path).setValue(i)}onSubmit(r){return this.submitted=!0,R1(this.form,this.directives),this.ngSubmit.emit(r),r?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(r=void 0){this.form.reset(r),this.submitted=!1}_updateDomValue(){this.directives.forEach(r=>{let i=r.control,s=this.form.get(r.path);i!==s&&(s1(i||null,r),v4(s)&&(kf(s,r,this.callSetDisabledState),r.control=s))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(r){let i=this.form.get(r.path);A1(i,r),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(r){if(this.form){let i=this.form.get(r.path);i&&g4(i,r)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){Fv(this.form,this),this._oldForm&&xf(this._oldForm,this)}_checkFormPresent(){this.form}};e.\u0275fac=function(i){return new(i||e)(te(lu,10),te(Mf,10),te(cu,8))},e.\u0275dir=St({type:e,selectors:[["","formGroup",""]],hostBindings:function(i,s){i&1&&en("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{form:[_i.None,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[xr([C4]),Tn,Yc]});let n=e;return n})();var w4={provide:po,useExisting:kr(()=>qv)},qv=(()=>{let e=class e extends po{set isDisabled(r){}constructor(r,i,s,o,a){super(),this._ngModelWarningConfig=a,this._added=!1,this.name=null,this.update=new ho,this._ngModelWarningSent=!1,this._parent=r,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=N1(this,o)}ngOnChanges(r){this._added||this._setUpControl(),D1(r,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(r){this.viewModel=r,this.update.emit(r)}get path(){return b1(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}};e._ngModelWarningSentOnce=!1,e.\u0275fac=function(i){return new(i||e)(te(vi,13),te(lu,10),te(Mf,10),te(Fa,10),te(k1,8))},e.\u0275dir=St({type:e,selectors:[["","formControlName",""]],inputs:{name:[_i.None,"formControlName","name"],isDisabled:[_i.None,"disabled","isDisabled"],model:[_i.None,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[xr([w4]),Tn,Yc]});let n=e;return n})(),T4={provide:Fa,useExisting:kr(()=>x1),multi:!0};function O1(n,e){return n==null?`${e}`:(e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function b4(n){return n.split(":")[0]}var x1=(()=>{let e=class e extends Pf{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(r){this._compareWith=r}writeValue(r){this.value=r;let i=this._getOptionId(r),s=O1(i,r);this.setProperty("value",s)}registerOnChange(r){this.onChange=i=>{this.value=this._getOptionValue(i),r(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(r){for(let i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i),r))return i;return null}_getOptionValue(r){let i=b4(r);return this._optionMap.has(i)?this._optionMap.get(i):r}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Ra(e)))(s||e)}})(),e.\u0275dir=St({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(i,s){i&1&&en("change",function(a){return s.onChange(a.target.value)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[xr([T4]),Tn]});let n=e;return n})(),P1=(()=>{let e=class e{constructor(r,i,s){this._element=r,this._renderer=i,this._select=s,this._select&&(this.id=this._select._registerOption())}set ngValue(r){this._select!=null&&(this._select._optionMap.set(this.id,r),this._setElementValue(O1(this.id,r)),this._select.writeValue(this._select.value))}set value(r){this._setElementValue(r),this._select&&this._select.writeValue(this._select.value)}_setElementValue(r){this._renderer.setProperty(this._element.nativeElement,"value",r)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};e.\u0275fac=function(i){return new(i||e)(te(Xc),te(Jc),te(x1,9))},e.\u0275dir=St({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let n=e;return n})(),I4={provide:Fa,useExisting:kr(()=>M1),multi:!0};function c1(n,e){return n==null?`${e}`:(typeof e=="string"&&(e=`'${e}'`),e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function A4(n){return n.split(":")[0]}var M1=(()=>{let e=class e extends Pf{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(r){this._compareWith=r}writeValue(r){this.value=r;let i;if(Array.isArray(r)){let s=r.map(o=>this._getOptionId(o));i=(o,a)=>{o._setSelected(s.indexOf(a.toString())>-1)}}else i=(s,o)=>{s._setSelected(!1)};this._optionMap.forEach(i)}registerOnChange(r){this.onChange=i=>{let s=[],o=i.selectedOptions;if(o!==void 0){let a=o;for(let l=0;l<a.length;l++){let c=a[l],u=this._getOptionValue(c.value);s.push(u)}}else{let a=i.options;for(let l=0;l<a.length;l++){let c=a[l];if(c.selected){let u=this._getOptionValue(c.value);s.push(u)}}}this.value=s,r(s)}}_registerOption(r){let i=(this._idCounter++).toString();return this._optionMap.set(i,r),i}_getOptionId(r){for(let i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i)._value,r))return i;return null}_getOptionValue(r){let i=A4(r);return this._optionMap.has(i)?this._optionMap.get(i)._value:r}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Ra(e)))(s||e)}})(),e.\u0275dir=St({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(i,s){i&1&&en("change",function(a){return s.onChange(a.target)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[xr([I4]),Tn]});let n=e;return n})(),F1=(()=>{let e=class e{constructor(r,i,s){this._element=r,this._renderer=i,this._select=s,this._select&&(this.id=this._select._registerOption(this))}set ngValue(r){this._select!=null&&(this._value=r,this._setElementValue(c1(this.id,r)),this._select.writeValue(this._select.value))}set value(r){this._select?(this._value=r,this._setElementValue(c1(this.id,r)),this._select.writeValue(this._select.value)):this._setElementValue(r)}_setElementValue(r){this._renderer.setProperty(this._element.nativeElement,"value",r)}_setSelected(r){this._renderer.setProperty(this._element.nativeElement,"selected",r)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};e.\u0275fac=function(i){return new(i||e)(te(Xc),te(Jc),te(M1,9))},e.\u0275dir=St({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let n=e;return n})();var D4=(()=>{let e=class e{constructor(){this._validator=Af}ngOnChanges(r){if(this.inputName in r){let i=this.normalizeInput(r[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):Af,this._onChange&&this._onChange()}}validate(r){return this._validator(r)}registerOnValidatorChange(r){this._onChange=r}enabled(r){return r!=null}};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=St({type:e,features:[Yc]});let n=e;return n})();var R4={provide:lu,useExisting:kr(()=>zv),multi:!0};var zv=(()=>{let e=class e extends D4{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=Ev,this.createValidator=r=>f1}enabled(r){return r}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Ra(e)))(s||e)}})(),e.\u0275dir=St({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(i,s){i&2&&PR("required",s._enabled?"":null)},inputs:{required:"required"},features:[xr([R4]),Tn]});let n=e;return n})();var L1=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Mt({type:e}),e.\u0275inj=Pt({});let n=e;return n})(),kv=class extends Pa{constructor(e,t,r){super(Pv(t),Mv(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[this._adjustIndex(e)]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,r={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(e,t={}){let r=this._adjustIndex(e);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,r={}){let i=this._adjustIndex(e);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),t&&(this.controls.splice(i,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){T1(this,!1,e),e.forEach((r,i)=>{w1(this,!1,i),this.at(i).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(e.forEach((r,i)=>{this.at(i)&&this.at(i).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((r,i)=>{r.reset(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_adjustIndex(e){return e<0?e+this.length:e}_syncPendingControls(){let e=this.controls.reduce((t,r)=>r._syncPendingControls()?!0:t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,r)=>{e(t,r)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(let e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}_find(e){return this.at(e)??null}};function u1(n){return!!n&&(n.asyncValidators!==void 0||n.validators!==void 0||n.updateOn!==void 0)}var B1=(()=>{let e=class e{constructor(){this.useNonNullable=!1}get nonNullable(){let r=new e;return r.useNonNullable=!0,r}group(r,i=null){let s=this._reduceControls(r),o={};return u1(i)?o=i:i!==null&&(o.validators=i.validator,o.asyncValidators=i.asyncValidator),new Ma(s,o)}record(r,i=null){let s=this._reduceControls(r);return new Nv(s,i)}control(r,i,s){let o={};return this.useNonNullable?(u1(i)?o=i:(o.validators=i,o.asyncValidators=s),new au(r,Bn(mt({},o),{nonNullable:!0}))):new au(r,i,s)}array(r,i,s){let o=r.map(a=>this._createControl(a));return new kv(o,i,s)}_reduceControls(r){let i={};return Object.keys(r).forEach(s=>{i[s]=this._createControl(r[s])}),i}_createControl(r){if(r instanceof au)return r;if(r instanceof Pa)return r;if(Array.isArray(r)){let i=r[0],s=r.length>1?r[1]:null,o=r.length>2?r[2]:null;return this.control(i,s,o)}else return this.control(r)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Et({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var V1=(()=>{let e=class e{static withConfig(r){return{ngModule:e,providers:[{provide:cu,useValue:r.callSetDisabledState??Vf}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Mt({type:e}),e.\u0275inj=Pt({imports:[L1]});let n=e;return n})(),U1=(()=>{let e=class e{static withConfig(r){return{ngModule:e,providers:[{provide:k1,useValue:r.warnOnNgModelWithFormControl??"always"},{provide:cu,useValue:r.callSetDisabledState??Vf}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Mt({type:e}),e.\u0275inj=Pt({imports:[L1]});let n=e;return n})();var N4="firebase",k4="10.10.0";tn(N4,k4,"app");var Ei=new _v("ANGULARFIRE2_VERSION");function Wv(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var uu=(n,e)=>{let t=e?[e]:bf(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},Gn=class{constructor(){return uu(O4)}},O4="app-check";function Ba(){}var qf=class{zone;delegate;constructor(e,t=bR){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},jv=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Ba,{},Ba,Ba)),t.pipe(NR({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Si=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new qf(Zone.current)),this.insideAngular=t.run(()=>new qf(Zone.current,Da)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(G(Un))};static \u0275prov=Et({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function zf(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function x4(n){return zf().ngZone.runOutsideAngular(()=>n())}function go(n){return zf().ngZone.run(()=>n())}function Xe(n){return P4(zf())(n)}function P4(n){return function(t){return t=t.lift(new jv(n.ngZone)),t.pipe(lo(n.outsideAngular),ji(n.insideAngular))}}var M4=(n,e)=>function(){let r=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),go(()=>n.apply(void 0,r))},Hv=(n,e)=>function(){let t,r=arguments;for(let s=0;s<arguments.length;s++)typeof r[s]=="function"&&(e&&(t||=go(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Ba,{},Ba,Ba))),r[s]=M4(r[s],t));let i=x4(()=>n.apply(this,r));if(!e)if(i instanceof Rr){let s=zf();return i.pipe(lo(s.outsideAngular),ji(s.insideAngular))}else return go(()=>i);return i instanceof Rr?i.pipe(Xe):i instanceof Promise?go(()=>new Promise((s,o)=>i.then(a=>go(()=>s(a)),a=>go(()=>o(a))))):typeof i=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),i.apply(this,arguments)}:go(()=>i)};var Gf=class{constructor(e){return e}},jf=class{constructor(){return bf()}};var sae=uf(Q3(),1);var Mz="auth";var Wf=class{constructor(){return uu(Mz)}};import{inspect as H5,TextEncoder as $5,TextDecoder as K5}from"util";import{randomBytes as Q5}from"crypto";var Fz=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},hr={},F,gE=gE||{},Z=Fz||self;function sp(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function Tu(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function Lz(n){return Object.prototype.hasOwnProperty.call(n,Kv)&&n[Kv]||(n[Kv]=++Bz)}var Kv="closure_uid_"+(1e9*Math.random()>>>0),Bz=0;function Vz(n,e,t){return n.call.apply(n.bind,arguments)}function Uz(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function Gt(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Gt=Vz:Gt=Uz,Gt.apply(null,arguments)}function Hf(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function Tt(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function Yi(){this.s=this.s,this.o=this.o}var qz=0;Yi.prototype.s=!1;Yi.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),qz!=0)&&Lz(this)};Yi.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Z1=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function mE(n){let e=n.length;if(0<e){let t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function q1(n,e){for(let t=1;t<arguments.length;t++){let r=arguments[t];if(sp(r)){let i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function jt(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}jt.prototype.h=function(){this.defaultPrevented=!0};var zz=function(){if(!Z.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let t=()=>{};Z.addEventListener("test",t,e),Z.removeEventListener("test",t,e)}catch{}return n}();function mu(n){return/^[\s\xa0]*$/.test(n)}function op(){var n=Z.navigator;return n&&(n=n.userAgent)?n:""}function Mr(n){return op().indexOf(n)!=-1}function yE(n){return yE[" "](n),n}yE[" "]=function(){};function Gz(n,e){var t=kG;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}var jz=Mr("Opera"),za=Mr("Trident")||Mr("MSIE"),eN=Mr("Edge"),Zv=eN||za,tN=Mr("Gecko")&&!(op().toLowerCase().indexOf("webkit")!=-1&&!Mr("Edge"))&&!(Mr("Trident")||Mr("MSIE"))&&!Mr("Edge"),Wz=op().toLowerCase().indexOf("webkit")!=-1&&!Mr("Edge");function nN(){var n=Z.document;return n?n.documentMode:void 0}var eE;e:{if($f="",Kf=function(){var n=op();if(tN)return/rv:([^\);]+)(\)|;)/.exec(n);if(eN)return/Edge\/([\d\.]+)/.exec(n);if(za)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(Wz)return/WebKit\/(\S+)/.exec(n);if(jz)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),Kf&&($f=Kf?Kf[1]:""),za&&(Qf=nN(),Qf!=null&&Qf>parseFloat($f))){eE=String(Qf);break e}eE=$f}var $f,Kf,Qf,tE;Z.document&&za?(Qv=nN(),tE=Qv||parseInt(eE,10)||void 0):tE=void 0;var Qv,Hz=tE;function yu(n,e){if(jt.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(tN){e:{try{yE(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:$z[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&yu.$.h.call(this)}}Tt(yu,jt);var $z={2:"touch",3:"pen",4:"mouse"};yu.prototype.h=function(){yu.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var bu="closure_listenable_"+(1e6*Math.random()|0),Kz=0;function Qz(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++Kz,this.fa=this.ia=!1}function ap(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function _E(n,e,t){for(let r in n)e.call(t,n[r],r,n)}function Yz(n,e){for(let t in n)e.call(void 0,n[t],t,n)}function rN(n){let e={};for(let t in n)e[t]=n[t];return e}var z1="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function iN(n,e){let t,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(t in r)n[t]=r[t];for(let s=0;s<z1.length;s++)t=z1[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function lp(n){this.src=n,this.g={},this.h=0}lp.prototype.add=function(n,e,t,r,i){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=rE(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):(e=new Qz(e,this.src,s,!!r,i),e.ia=t,n.push(e)),e};function nE(n,e){var t=e.type;if(t in n.g){var r=n.g[t],i=Z1(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(ap(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function rE(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}var vE="closure_lm_"+(1e6*Math.random()|0),Yv={};function sN(n,e,t,r,i){if(r&&r.once)return aN(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)sN(n,e[s],t,r,i);return null}return t=CE(t),n&&n[bu]?n.O(e,t,Tu(r)?!!r.capture:!!r,i):oN(n,e,t,!1,r,i)}function oN(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=Tu(i)?!!i.capture:!!i,a=SE(n);if(a||(n[vE]=a=new lp(n)),t=a.add(e,t,r,o,s),t.proxy)return t;if(r=Xz(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)zz||(i=o),i===void 0&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(cN(e.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return t}function Xz(){function n(t){return e.call(n.src,n.listener,t)}let e=Jz;return n}function aN(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)aN(n,e[s],t,r,i);return null}return t=CE(t),n&&n[bu]?n.P(e,t,Tu(r)?!!r.capture:!!r,i):oN(n,e,t,!0,r,i)}function lN(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)lN(n,e[s],t,r,i);else r=Tu(r)?!!r.capture:!!r,t=CE(t),n&&n[bu]?(n=n.i,e=String(e).toString(),e in n.g&&(s=n.g[e],t=rE(s,t,r,i),-1<t&&(ap(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete n.g[e],n.h--)))):n&&(n=SE(n))&&(e=n.g[e.toString()],n=-1,e&&(n=rE(e,t,r,i)),(t=-1<n?e[n]:null)&&EE(t))}function EE(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[bu])nE(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(cN(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=SE(e))?(nE(t,n),t.h==0&&(t.src=null,e[vE]=null)):ap(n)}}}function cN(n){return n in Yv?Yv[n]:Yv[n]="on"+n}function Jz(n,e){if(n.fa)n=!0;else{e=new yu(e,this);var t=n.listener,r=n.la||n.src;n.ia&&EE(n),n=t.call(r,e)}return n}function SE(n){return n=n[vE],n instanceof lp?n:null}var Xv="__closure_events_fn_"+(1e9*Math.random()>>>0);function CE(n){return typeof n=="function"?n:(n[Xv]||(n[Xv]=function(e){return n.handleEvent(e)}),n[Xv])}function wt(){Yi.call(this),this.i=new lp(this),this.S=this,this.J=null}Tt(wt,Yi);wt.prototype[bu]=!0;wt.prototype.removeEventListener=function(n,e,t,r){lN(this,n,e,t,r)};function Lt(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,typeof e=="string")e=new jt(e,n);else if(e instanceof jt)e.target=e.target||n;else{var i=e;e=new jt(r,n),iN(e,i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=Yf(o,r,!0,e)&&i}if(o=e.g=n,i=Yf(o,r,!0,e)&&i,i=Yf(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)o=e.g=t[s],i=Yf(o,r,!1,e)&&i}wt.prototype.N=function(){if(wt.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)ap(t[r]);delete n.g[e],n.h--}}this.J=null};wt.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)};wt.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};function Yf(n,e,t,r){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,l=o.la||o.src;o.ia&&nE(n.i,o),i=a.call(l,r)!==!1&&i}}return i&&!r.defaultPrevented}var wE=Z.JSON.stringify,iE=class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function Zz(){var n=TE;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var sE=class{constructor(){this.h=this.g=null}add(e,t){let r=uN.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},uN=new iE(()=>new oE,n=>n.reset()),oE=class{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}};function eG(n){var e=1;n=n.split(":");let t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function tG(n){Z.setTimeout(()=>{throw n},0)}var _u,vu=!1,TE=new sE,hN=()=>{let n=Z.Promise.resolve(void 0);_u=()=>{n.then(nG)}},nG=()=>{for(var n;n=Zz();){try{n.h.call(n.g)}catch(t){tG(t)}var e=uN;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}vu=!1};function cp(n,e){wt.call(this),this.h=n||1,this.g=e||Z,this.j=Gt(this.qb,this),this.l=Date.now()}Tt(cp,wt);F=cp.prototype;F.ga=!1;F.T=null;F.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Lt(this,"tick"),this.ga&&(bE(this),this.start()))}};F.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function bE(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}F.N=function(){cp.$.N.call(this),bE(this),delete this.g};function IE(n,e,t){if(typeof n=="function")t&&(n=Gt(n,t));else if(n&&typeof n.handleEvent=="function")n=Gt(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:Z.setTimeout(n,e||0)}function dN(n){n.g=IE(()=>{n.g=null,n.i&&(n.i=!1,dN(n))},n.j);let e=n.h;n.h=null,n.m.apply(null,e)}var aE=class extends Yi{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:dN(this)}N(){super.N(),this.g&&(Z.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function Eu(n){Yi.call(this),this.h=n,this.g={}}Tt(Eu,Yi);var G1=[];function fN(n,e,t,r){Array.isArray(t)||(t&&(G1[0]=t.toString()),t=G1);for(var i=0;i<t.length;i++){var s=sN(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function pN(n){_E(n.g,function(e,t){this.g.hasOwnProperty(t)&&EE(e)},n),n.g={}}Eu.prototype.N=function(){Eu.$.N.call(this),pN(this)};Eu.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function up(){this.g=!0}up.prototype.Ea=function(){this.g=!1};function rG(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var h=u.split("_");o=2<=h.length&&h[1]=="type"?o+(u+"="+c+"&"):o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+t+`
`+o})}function iG(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+t+`
`+s+" "+o})}function Ua(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+oG(n,t)+(r?" "+r:"")})}function sG(n,e){n.info(function(){return"TIMEOUT: "+e})}up.prototype.info=function(){};function oG(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return wE(t)}catch{return e}}var vo={},j1=null;function hp(){return j1=j1||new wt}vo.Ta="serverreachability";function gN(n){jt.call(this,vo.Ta,n)}Tt(gN,jt);function Su(n){let e=hp();Lt(e,new gN(e))}vo.STAT_EVENT="statevent";function mN(n,e){jt.call(this,vo.STAT_EVENT,n),this.stat=e}Tt(mN,jt);function nn(n){let e=hp();Lt(e,new mN(e,n))}vo.Ua="timingevent";function yN(n,e){jt.call(this,vo.Ua,n),this.size=e}Tt(yN,jt);function Iu(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return Z.setTimeout(function(){n()},e)}var dp={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},_N={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function AE(){}AE.prototype.h=null;function W1(n){return n.h||(n.h=n.i())}function vN(){}var Au={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function DE(){jt.call(this,"d")}Tt(DE,jt);function RE(){jt.call(this,"c")}Tt(RE,jt);var lE;function fp(){}Tt(fp,AE);fp.prototype.g=function(){return new XMLHttpRequest};fp.prototype.i=function(){return{}};lE=new fp;function Du(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new Eu(this),this.P=aG,n=Zv?125:void 0,this.V=new cp(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new EN}function EN(){this.i=null,this.g="",this.h=!1}var aG=45e3,SN={},cE={};F=Du.prototype;F.setTimeout=function(n){this.P=n};function uE(n,e,t){n.L=1,n.A=gp(wi(e)),n.u=t,n.S=!0,CN(n,null)}function CN(n,e){n.G=Date.now(),Ru(n),n.B=wi(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),NN(t.i,"t",r),n.o=0,t=n.l.J,n.h=new EN,n.g=XN(n.l,t?e:null,!n.u),0<n.O&&(n.M=new aE(Gt(n.Pa,n,n.g),n.O)),fN(n.U,n.g,"readystatechange",n.nb),e=n.I?rN(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),Su(),rG(n.j,n.v,n.B,n.m,n.W,n.u)}F.nb=function(n){n=n.target;let e=this.M;e&&Fr(n)==3?e.l():this.Pa(n)};F.Pa=function(n){try{if(n==this.g)e:{let u=Fr(this.g);var e=this.g.Ia();let h=this.g.da();if(!(3>u)&&(u!=3||Zv||this.g&&(this.h.h||this.g.ja()||Q1(this.g)))){this.J||u!=4||e==7||(e==8||0>=h?Su(3):Su(2)),pp(this);var t=this.g.da();this.ca=t;t:if(wN(this)){var r=Q1(this.g);n="";var i=r.length,s=Fr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){mo(this),gu(this);var o="";break t}this.h.i=new Z.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=t==200,iG(this.j,this.v,this.B,this.m,this.W,u,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!mu(a)){var c=a;break t}}c=null}if(t=c)Ua(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,hE(this,t);else{this.i=!1,this.s=3,nn(12),mo(this),gu(this);break e}}this.S?(TN(this,u,o),Zv&&this.i&&u==3&&(fN(this.U,this.V,"tick",this.mb),this.V.start())):(Ua(this.j,this.m,o,null),hE(this,o)),u==4&&mo(this),this.i&&!this.J&&(u==4?$N(this.l,this):(this.i=!1,Ru(this)))}else DG(this.g),t==400&&0<o.indexOf("Unknown SID")?(this.s=3,nn(12)):(this.s=0,nn(13)),mo(this),gu(this)}}}catch{}finally{}};function wN(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function TN(n,e,t){let r=!0,i;for(;!n.J&&n.o<t.length;)if(i=lG(n,t),i==cE){e==4&&(n.s=4,nn(14),r=!1),Ua(n.j,n.m,null,"[Incomplete Response]");break}else if(i==SN){n.s=4,nn(15),Ua(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}else Ua(n.j,n.m,i,null),hE(n,i);wN(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),e!=4||t.length!=0||n.h.h||(n.s=1,nn(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),ME(e),e.M=!0,nn(11))):(Ua(n.j,n.m,t,"[Invalid Chunked Response]"),mo(n),gu(n))}F.mb=function(){if(this.g){var n=Fr(this.g),e=this.g.ja();this.o<e.length&&(pp(this),TN(this,n,e),this.i&&n!=4&&Ru(this))}};function lG(n,e){var t=n.o,r=e.indexOf(`
`,t);return r==-1?cE:(t=Number(e.substring(t,r)),isNaN(t)?SN:(r+=1,r+t>e.length?cE:(e=e.slice(r,r+t),n.o=r+t,e)))}F.cancel=function(){this.J=!0,mo(this)};function Ru(n){n.Y=Date.now()+n.P,bN(n,n.P)}function bN(n,e){if(n.C!=null)throw Error("WatchDog timer not null");n.C=Iu(Gt(n.lb,n),e)}function pp(n){n.C&&(Z.clearTimeout(n.C),n.C=null)}F.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(sG(this.j,this.B),this.L!=2&&(Su(),nn(17)),mo(this),this.s=2,gu(this)):bN(this,this.Y-n)};function gu(n){n.l.H==0||n.J||$N(n.l,n)}function mo(n){pp(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,bE(n.V),pN(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function hE(n,e){try{var t=n.l;if(t.H!=0&&(t.g==n||dE(t.i,n))){if(!n.K&&dE(t.i,n)&&t.H==3){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<n.G)tp(t),_p(t);else break e;PE(t),nn(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&t.A==0&&!t.v&&(t.v=Iu(Gt(t.ib,t),6e3));if(1>=xN(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else yo(t,11)}else if((n.K||t.g==n)&&tp(t),!mu(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(t.V=c[0],c=c[1],t.H==2)if(c[0]=="c"){t.K=c[1],t.pa=c[2];let u=c[3];u!=null&&(t.ra=u,t.l.info("VER="+t.ra));let h=c[4];h!=null&&(t.Ga=h,t.l.info("SVER="+t.Ga));let d=c[5];d!=null&&typeof d=="number"&&0<d&&(r=1.5*d,t.L=r,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;let f=n.g;if(f){let g=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(g){var s=r.i;s.g||g.indexOf("spdy")==-1&&g.indexOf("quic")==-1&&g.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(NE(s,s.h),s.h=null))}if(r.F){let y=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;y&&(r.Da=y,Le(r.I,r.F,y))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms")),r=t;var o=n;if(r.wa=YN(r,r.J?r.pa:null,r.Y),o.K){PN(r.i,o);var a=o,l=r.L;l&&a.setTimeout(l),a.C&&(pp(a),Ru(a)),r.g=o}else WN(r);0<t.j.length&&vp(t)}else c[0]!="stop"&&c[0]!="close"||yo(t,7);else t.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?yo(t,7):xE(t):c[0]!="noop"&&t.h&&t.h.Aa(c),t.A=0)}}Su(4)}catch{}}function cG(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(sp(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}e=[],t=0;for(r in n)e[t++]=n[r];return e}function uG(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(sp(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(let r in n)e[t++]=r;return e}}}function IN(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(sp(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=uG(n),r=cG(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}var AN=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function hG(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function _o(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof _o){this.h=n.h,Zf(this,n.j),this.s=n.s,this.g=n.g,ep(this,n.m),this.l=n.l;var e=n.i,t=new Cu;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),H1(this,t),this.o=n.o}else n&&(e=String(n).match(AN))?(this.h=!1,Zf(this,e[1]||"",!0),this.s=fu(e[2]||""),this.g=fu(e[3]||"",!0),ep(this,e[4]),this.l=fu(e[5]||"",!0),H1(this,e[6]||"",!0),this.o=fu(e[7]||"")):(this.h=!1,this.i=new Cu(null,this.h))}_o.prototype.toString=function(){var n=[],e=this.j;e&&n.push(pu(e,$1,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(pu(e,$1,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(pu(t,t.charAt(0)=="/"?pG:fG,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",pu(t,mG)),n.join("")};function wi(n){return new _o(n)}function Zf(n,e,t){n.j=t?fu(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function ep(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function H1(n,e,t){e instanceof Cu?(n.i=e,yG(n.i,n.h)):(t||(e=pu(e,gG)),n.i=new Cu(e,n.h))}function Le(n,e,t){n.i.set(e,t)}function gp(n){return Le(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function fu(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function pu(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,dG),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function dG(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var $1=/[#\/\?@]/g,fG=/[#\?:]/g,pG=/[#\?]/g,gG=/[#\?@]/g,mG=/#/g;function Cu(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Xi(n){n.g||(n.g=new Map,n.h=0,n.i&&hG(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}F=Cu.prototype;F.add=function(n,e){Xi(this),this.i=null,n=Ga(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function DN(n,e){Xi(n),e=Ga(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function RN(n,e){return Xi(n),e=Ga(n,e),n.g.has(e)}F.forEach=function(n,e){Xi(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)};F.ta=function(){Xi(this);let n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){let i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t};F.Z=function(n){Xi(this);let e=[];if(typeof n=="string")RN(this,n)&&(e=e.concat(this.g.get(Ga(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};F.set=function(n,e){return Xi(this),this.i=null,n=Ga(this,n),RN(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};F.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function NN(n,e,t){DN(n,e),0<t.length&&(n.i=null,n.g.set(Ga(n,e),mE(t)),n.h+=t.length)}F.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};function Ga(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function yG(n,e){e&&!n.j&&(Xi(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(DN(this,r),NN(this,i,t))},n)),n.j=e}var _G=class{constructor(n,e){this.g=n,this.map=e}};function kN(n){this.l=n||vG,Z.PerformanceNavigationTiming?(n=Z.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(Z.g&&Z.g.Ka&&Z.g.Ka()&&Z.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var vG=10;function ON(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function xN(n){return n.h?1:n.g?n.g.size:0}function dE(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function NE(n,e){n.g?n.g.add(e):n.h=e}function PN(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}kN.prototype.cancel=function(){if(this.i=MN(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function MN(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(let t of n.g.values())e=e.concat(t.F);return e}return mE(n.i)}var EG=class{stringify(n){return Z.JSON.stringify(n,void 0)}parse(n){return Z.JSON.parse(n,void 0)}};function SG(){this.g=new EG}function CG(n,e,t){let r=t||"";try{IN(n,function(i,s){let o=i;Tu(i)&&(o=wE(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function wG(n,e){let t=new up;if(Z.Image){let r=new Image;r.onload=Hf(Xf,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Hf(Xf,t,r,"TestLoadImage: error",!1,e),r.onabort=Hf(Xf,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Hf(Xf,t,r,"TestLoadImage: timeout",!1,e),Z.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}function Xf(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function Nu(n){this.l=n.ec||null,this.j=n.ob||!1}Tt(Nu,AE);Nu.prototype.g=function(){return new mp(this.l,this.j)};Nu.prototype.i=function(n){return function(){return n}}({});function mp(n,e){wt.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=kE,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Tt(mp,wt);var kE=0;F=mp.prototype;F.open=function(n,e){if(this.readyState!=kE)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,wu(this)};F.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||Z).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};F.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ku(this)),this.readyState=kE};F.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,wu(this)),this.g&&(this.readyState=3,wu(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof Z.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;FN(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function FN(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}F.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?ku(this):wu(this),this.readyState==3&&FN(this)}};F.Za=function(n){this.g&&(this.response=this.responseText=n,ku(this))};F.Ya=function(n){this.g&&(this.response=n,ku(this))};F.ka=function(){this.g&&ku(this)};function ku(n){n.readyState=4,n.l=null,n.j=null,n.A=null,wu(n)}F.setRequestHeader=function(n,e){this.v.append(n,e)};F.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};F.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function wu(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(mp.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var TG=Z.JSON.parse;function Je(n){wt.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=LN,this.L=this.M=!1}Tt(Je,wt);var LN="",bG=/^https?$/i,IG=["POST","PUT"];F=Je.prototype;F.Oa=function(n){this.M=n};F.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():lE.g(),this.C=this.u?W1(this.u):W1(lE),this.g.onreadystatechange=Gt(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){K1(this,s);return}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())t.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),i=Z.FormData&&n instanceof Z.FormData,!(0<=Z1(IG,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{UN(this),0<this.B&&((this.L=AG(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Gt(this.ua,this)):this.A=IE(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){K1(this,s)}};function AG(n){return za&&typeof n.timeout=="number"&&n.ontimeout!==void 0}F.ua=function(){typeof gE<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Lt(this,"timeout"),this.abort(8))};function K1(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,BN(n),yp(n)}function BN(n){n.F||(n.F=!0,Lt(n,"complete"),Lt(n,"error"))}F.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Lt(this,"complete"),Lt(this,"abort"),yp(this))};F.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),yp(this,!0)),Je.$.N.call(this)};F.La=function(){this.s||(this.G||this.v||this.l?VN(this):this.kb())};F.kb=function(){VN(this)};function VN(n){if(n.h&&typeof gE<"u"&&(!n.C[1]||Fr(n)!=4||n.da()!=2)){if(n.v&&Fr(n)==4)IE(n.La,0,n);else if(Lt(n,"readystatechange"),Fr(n)==4){n.h=!1;try{let o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=o===0){var i=String(n.I).match(AN)[1]||null;!i&&Z.self&&Z.self.location&&(i=Z.self.location.protocol.slice(0,-1)),r=!bG.test(i?i.toLowerCase():"")}t=r}if(t)Lt(n,"complete"),Lt(n,"success");else{n.m=6;try{var s=2<Fr(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",BN(n)}}finally{yp(n)}}}}function yp(n,e){if(n.g){UN(n);let t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||Lt(n,"ready");try{t.onreadystatechange=r}catch{}}}function UN(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(Z.clearTimeout(n.A),n.A=null)}F.isActive=function(){return!!this.g};function Fr(n){return n.g?n.g.readyState:0}F.da=function(){try{return 2<Fr(this)?this.g.status:-1}catch{return-1}};F.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};F.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),TG(e)}};function Q1(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case LN:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function DG(n){let e={};n=(n.g&&2<=Fr(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(mu(n[r]))continue;var t=eG(n[r]);let i=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();let s=e[i]||[];e[i]=s,s.push(t)}Yz(e,function(r){return r.join(", ")})}F.Ia=function(){return this.m};F.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function qN(n){let e="";return _E(n,function(t,r){e+=r,e+=":",e+=t,e+=`\r
`}),e}function OE(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=qN(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):Le(n,e,t))}function hu(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function zN(n){this.Ga=0,this.j=[],this.l=new up,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=hu("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=hu("baseRetryDelayMs",5e3,n),this.hb=hu("retryDelaySeedMs",1e4,n),this.eb=hu("forwardChannelMaxRetries",2,n),this.xa=hu("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new kN(n&&n.concurrentRequestLimit),this.Ja=new SG,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}F=zN.prototype;F.ra=8;F.H=1;function xE(n){if(GN(n),n.H==3){var e=n.W++,t=wi(n.I);if(Le(t,"SID",n.K),Le(t,"RID",e),Le(t,"TYPE","terminate"),Ou(n,t),e=new Du(n,n.l,e),e.L=2,e.A=gp(wi(t)),t=!1,Z.navigator&&Z.navigator.sendBeacon)try{t=Z.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&Z.Image&&(new Image().src=e.A,t=!0),t||(e.g=XN(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Ru(e)}QN(n)}function _p(n){n.g&&(ME(n),n.g.cancel(),n.g=null)}function GN(n){_p(n),n.u&&(Z.clearTimeout(n.u),n.u=null),tp(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&Z.clearTimeout(n.m),n.m=null)}function vp(n){if(!ON(n.i)&&!n.m){n.m=!0;var e=n.Na;_u||hN(),vu||(_u(),vu=!0),TE.add(e,n),n.C=0}}function RG(n,e){return xN(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=Iu(Gt(n.Na,n,e),KN(n,n.C)),n.C++,!0)}F.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let i=new Du(this,this.l,n),s=this.s;if(this.U&&(s?(s=rN(s),iN(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var r=this.j[t];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=jN(this,i,e),t=wi(this.I),Le(t,"RID",n),Le(t,"CVER",22),this.F&&Le(t,"X-HTTP-Session-Id",this.F),Ou(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(qN(s)))+"&"+e:this.o&&OE(t,this.o,s)),NE(this.i,i),this.bb&&Le(t,"TYPE","init"),this.P?(Le(t,"$req",e),Le(t,"SID","null"),i.aa=!0,uE(i,t,null)):uE(i,t,e),this.H=2}}else this.H==3&&(n?Y1(this,n):this.j.length==0||ON(this.i)||Y1(this))};function Y1(n,e){var t;e?t=e.m:t=n.W++;let r=wi(n.I);Le(r,"SID",n.K),Le(r,"RID",t),Le(r,"AID",n.V),Ou(n,r),n.o&&n.s&&OE(r,n.o,n.s),t=new Du(n,n.l,t,n.C+1),n.o===null&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=jN(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),NE(n.i,t),uE(t,r,e)}function Ou(n,e){n.na&&_E(n.na,function(t,r){Le(e,r,t)}),n.h&&IN({},function(t,r){Le(e,r,t)})}function jN(n,e,t){t=Math.min(n.j.length,t);var r=n.h?Gt(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){let o=["count="+t];s==-1?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let l=0;l<t;l++){let c=i[l].g,u=i[l].map;if(c-=s,0>c)s=Math.max(0,i[l].g-100),a=!1;else try{CG(u,o,"req"+c+"_")}catch{r&&r(u)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function WN(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;_u||hN(),vu||(_u(),vu=!0),TE.add(e,n),n.A=0}}function PE(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=Iu(Gt(n.Ma,n),KN(n,n.A)),n.A++,!0)}F.Ma=function(){if(this.u=null,HN(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=Iu(Gt(this.jb,this),n)}};F.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,nn(10),_p(this),HN(this))};function ME(n){n.B!=null&&(Z.clearTimeout(n.B),n.B=null)}function HN(n){n.g=new Du(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=wi(n.wa);Le(e,"RID","rpc"),Le(e,"SID",n.K),Le(e,"AID",n.V),Le(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&Le(e,"TO",n.qa),Le(e,"TYPE","xmlhttp"),Ou(n,e),n.o&&n.s&&OE(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=gp(wi(e)),t.u=null,t.S=!0,CN(t,n)}F.ib=function(){this.v!=null&&(this.v=null,_p(this),PE(this),nn(19))};function tp(n){n.v!=null&&(Z.clearTimeout(n.v),n.v=null)}function $N(n,e){var t=null;if(n.g==e){tp(n),ME(n),n.g=null;var r=2}else if(dE(n.i,e))t=e.F,PN(n.i,e),r=1;else return;if(n.H!=0){if(e.i)if(r==1){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;r=hp(),Lt(r,new yN(r,t)),vp(n)}else WN(n);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&RG(n,e)||r==2&&PE(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:yo(n,5);break;case 4:yo(n,10);break;case 3:yo(n,6);break;default:yo(n,2)}}}function KN(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function yo(n,e){if(n.l.info("Error code "+e),e==2){var t=null;n.h&&(t=null);var r=Gt(n.pb,n);t||(t=new _o("//www.google.com/images/cleardot.gif"),Z.location&&Z.location.protocol=="http"||Zf(t,"https"),gp(t)),wG(t.toString(),r)}else nn(2);n.H=0,n.h&&n.h.za(e),QN(n),GN(n)}F.pb=function(n){n?(this.l.info("Successfully pinged google.com"),nn(2)):(this.l.info("Failed to ping google.com"),nn(1))};function QN(n){if(n.H=0,n.ma=[],n.h){let e=MN(n.i);(e.length!=0||n.j.length!=0)&&(q1(n.ma,e),q1(n.ma,n.j),n.i.i.length=0,mE(n.j),n.j.length=0),n.h.ya()}}function YN(n,e,t){var r=t instanceof _o?wi(t):new _o(t);if(r.g!="")e&&(r.g=e+"."+r.g),ep(r,r.m);else{var i=Z.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new _o(null);r&&Zf(s,r),e&&(s.g=e),i&&ep(s,i),t&&(s.l=t),r=s}return t=n.F,e=n.Da,t&&e&&Le(r,t,e),Le(r,"VER",n.ra),Ou(n,r),r}function XN(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n.Ha&&!n.va?new Je(new Nu({ob:t})):new Je(n.va),e.Oa(n.J),e}F.isActive=function(){return!!this.h&&this.h.isActive(this)};function JN(){}F=JN.prototype;F.Ba=function(){};F.Aa=function(){};F.za=function(){};F.ya=function(){};F.isActive=function(){return!0};F.Va=function(){};function np(){if(za&&!(10<=Number(Hz)))throw Error("Environmental error: no available transport.")}np.prototype.g=function(n,e){return new In(n,e)};function In(n,e){wt.call(this),this.g=new zN(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!mu(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!mu(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new ja(this)}Tt(In,wt);In.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;nn(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=YN(n,null,n.Y),vp(n)};In.prototype.close=function(){xE(this.g)};In.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=wE(n),n=t);e.j.push(new _G(e.fb++,n)),e.H==3&&vp(e)};In.prototype.N=function(){this.g.h=null,delete this.j,xE(this.g),delete this.g,In.$.N.call(this)};function ZN(n){DE.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(let t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}Tt(ZN,DE);function ek(){RE.call(this),this.status=1}Tt(ek,RE);function ja(n){this.g=n}Tt(ja,JN);ja.prototype.Ba=function(){Lt(this.g,"a")};ja.prototype.Aa=function(n){Lt(this.g,new ZN(n))};ja.prototype.za=function(n){Lt(this.g,new ek)};ja.prototype.ya=function(){Lt(this.g,"b")};function NG(){this.blockSize=-1}function ur(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}Tt(ur,NG);ur.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function Jv(n,e,t){t||(t=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=n.g[0],t=n.g[1],i=n.g[2];var s=n.g[3],o=e+(s^t&(i^s))+r[0]+3614090360&4294967295;e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[3]+3250441966&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[4]+4118548399&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[7]+4249261313&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[8]+1770035416&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[11]+2304563134&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[12]+1804603682&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[15]+1236535329&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(i^s&(t^i))+r[1]+4129170786&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[0]+3921069994&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[5]+3593408605&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[4]+3889429448&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[9]+568446438&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[8]+1163531501&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[13]+2850285829&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[12]+2368359562&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(t^i^s)+r[5]+4294588738&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[14]+4259657740&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[1]+2763975236&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[10]+3200236656&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[13]+681279174&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[6]+76029189&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[9]+3654602809&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[2]+3299628645&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(i^(t|~s))+r[0]+4096336452&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[5]+4237533241&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[12]+1700485571&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[1]+2240044497&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[8]+1873313359&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[13]+1309151649&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[4]+4149444226&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}ur.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=t;)Jv(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){Jv(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){Jv(this,r),i=0;break}}this.h=i,this.i+=e};ur.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=t&255,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};function we(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=n[i]|0;r&&s==e||(t[i]=s,r=!1)}this.g=t}var kG={};function FE(n){return-128<=n&&128>n?Gz(n,function(e){return new we([e|0],0>e?-1:0)}):new we([n|0],0>n?-1:0)}function Lr(n){if(isNaN(n)||!isFinite(n))return qa;if(0>n)return Ft(Lr(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=fE;return new we(e,0)}function tk(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return Ft(tk(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Lr(Math.pow(e,8)),r=qa,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=Lr(Math.pow(e,s)),r=r.R(s).add(Lr(o))):(r=r.R(t),r=r.add(Lr(o)))}return r}var fE=4294967296,qa=FE(0),pE=FE(1),X1=FE(16777216);F=we.prototype;F.ea=function(){if(jn(this))return-Ft(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:fE+r)*e,e*=fE}return n};F.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(Ci(this))return"0";if(jn(this))return"-"+Ft(this).toString(n);for(var e=Lr(Math.pow(n,6)),t=this,r="";;){var i=ip(t,e).g;t=rp(t,i.R(e));var s=((0<t.g.length?t.g[0]:t.h)>>>0).toString(n);if(t=i,Ci(t))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};F.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function Ci(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function jn(n){return n.h==-1}F.X=function(n){return n=rp(this,n),jn(n)?-1:Ci(n)?0:1};function Ft(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new we(t,~n.h).add(pE)}F.abs=function(){return jn(this)?Ft(this):this};F.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(n.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,t[i]=o<<16|s}return new we(t,t[t.length-1]&-2147483648?-1:0)};function rp(n,e){return n.add(Ft(e))}F.R=function(n){if(Ci(this)||Ci(n))return qa;if(jn(this))return jn(n)?Ft(this).R(Ft(n)):Ft(Ft(this).R(n));if(jn(n))return Ft(this.R(Ft(n)));if(0>this.X(X1)&&0>n.X(X1))return Lr(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=n.D(i)>>>16,l=n.D(i)&65535;t[2*r+2*i]+=o*l,Jf(t,2*r+2*i),t[2*r+2*i+1]+=s*l,Jf(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,Jf(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,Jf(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new we(t,0)};function Jf(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function du(n,e){this.g=n,this.h=e}function ip(n,e){if(Ci(e))throw Error("division by zero");if(Ci(n))return new du(qa,qa);if(jn(n))return e=ip(Ft(n),e),new du(Ft(e.g),Ft(e.h));if(jn(e))return e=ip(n,Ft(e)),new du(Ft(e.g),e.h);if(30<n.g.length){if(jn(n)||jn(e))throw Error("slowDivide_ only works with positive integers.");for(var t=pE,r=e;0>=r.X(n);)t=J1(t),r=J1(r);var i=Va(t,1),s=Va(r,1);for(r=Va(r,2),t=Va(t,2);!Ci(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=Va(r,1),t=Va(t,1)}return e=rp(n,i.R(e)),new du(i,e)}for(i=qa;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=Math.ceil(Math.log(t)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=Lr(t),o=s.R(e);jn(o)||0<o.X(n);)t-=r,s=Lr(t),o=s.R(e);Ci(s)&&(s=pE),i=i.add(s),n=rp(n,o)}return new du(i,n)}F.gb=function(n){return ip(this,n).h};F.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new we(t,this.h&n.h)};F.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new we(t,this.h|n.h)};F.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new we(t,this.h^n.h)};function J1(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new we(t,n.h)}function Va(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new we(i,n.h)}np.prototype.createWebChannel=np.prototype.g;In.prototype.send=In.prototype.u;In.prototype.open=In.prototype.m;In.prototype.close=In.prototype.close;dp.NO_ERROR=0;dp.TIMEOUT=8;dp.HTTP_ERROR=6;_N.COMPLETE="complete";vN.EventType=Au;Au.OPEN="a";Au.CLOSE="b";Au.ERROR="c";Au.MESSAGE="d";wt.prototype.listen=wt.prototype.O;Je.prototype.listenOnce=Je.prototype.P;Je.prototype.getLastError=Je.prototype.Sa;Je.prototype.getLastErrorCode=Je.prototype.Ia;Je.prototype.getStatus=Je.prototype.da;Je.prototype.getResponseJson=Je.prototype.Wa;Je.prototype.getResponseText=Je.prototype.ja;Je.prototype.send=Je.prototype.ha;Je.prototype.setWithCredentials=Je.prototype.Oa;ur.prototype.digest=ur.prototype.l;ur.prototype.reset=ur.prototype.reset;ur.prototype.update=ur.prototype.j;we.prototype.add=we.prototype.add;we.prototype.multiply=we.prototype.R;we.prototype.modulo=we.prototype.gb;we.prototype.compare=we.prototype.X;we.prototype.toNumber=we.prototype.ea;we.prototype.toString=we.prototype.toString;we.prototype.getBits=we.prototype.D;we.fromNumber=Lr;we.fromString=tk;var mae=hr.createWebChannelTransport=function(){return new np},yae=hr.getStatEventTarget=function(){return hp()},_ae=hr.ErrorCode=dp,vae=hr.EventType=_N,Eae=hr.Event=vo,Sae=hr.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Cae=hr.FetchXmlHttpFactory=Nu,wae=hr.WebChannel=vN,Tae=hr.XhrIo=Je,nk=hr.Md5=ur,Eo=hr.Integer=we;var Uo=uf(NM(),1),qF=uf(kC(),1);var kM="@firebase/firestore",OM="4.5.1";var pt=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};pt.UNAUTHENTICATED=new pt(null);pt.GOOGLE_CREDENTIALS=new pt("google-credentials-uid");pt.FIRST_PARTY=new pt("first-party-uid");pt.MOCK_USER=new pt("mock-user");var Y5="10.10.0";var hc=Y5;function X5(n){hc=n}function J5(n){return H5(n,{depth:100})}var Os=new Ki("@firebase/firestore");function Vl(){return Os.logLevel}function ub(n){Os.setLogLevel(n)}function R(n,...e){if(Os.logLevel<=zn.DEBUG){let t=e.map(hb);Os.debug(`Firestore (${hc}): ${n}`,...t)}}function He(n,...e){if(Os.logLevel<=zn.ERROR){let t=e.map(hb);Os.error(`Firestore (${hc}): ${n}`,...t)}}function rr(n,...e){if(Os.logLevel<=zn.WARN){let t=e.map(hb);Os.warn(`Firestore (${hc}): ${n}`,...t)}}function hb(n){if(typeof n=="string")return n;try{return J5(n)}catch{return n}}function B(n="Unexpected state"){let e=`FIRESTORE (${hc}) INTERNAL ASSERTION FAILED: `+n;throw He(e),new Error(e)}function q(n,e){n||B()}function zF(n,e){n||B()}function M(n,e){return n}var S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},w=class extends QR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var st=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Im=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},u0=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(pt.UNAUTHENTICATED))}shutdown(){}},h0=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},d0=class{constructor(e){this.authProvider=e,this.currentUser=pt.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new st;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new st,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>m(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},a=l=>{R("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.tokenListener),o()};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(R("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new st)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(R("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(q(typeof r.accessToken=="string"),new Im(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.tokenListener)}getUser(){let e=this.auth&&this.auth.getUid();return q(e===null||typeof e=="string"),new pt(e)}},f0=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=pt.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},p0=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new f0(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(pt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},g0=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},m0=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){let r=s=>{s.error!=null&&R("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,R("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{R("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):R("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(q(typeof t.token=="string"),this.latestAppCheckToken=t.token,new g0(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.tokenListener)}};function Z5(n){if(!n)return new u0;switch(n.type){case"firstParty":return new p0(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new w(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function e8(n){return Q5(n)}var Am=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=e8(40);for(let o=0;o<s.length;++o)r.length<i&&s[o]<t&&(r+=e.charAt(s[o]%e.length))}return r}};function ne(n,e){return n<e?-1:n>e?1:0}function qo(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}function GF(n){return n+"\0"}var xM=-62135596800,PM=1e6,$e=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new w(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new w(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<xM)throw new w(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new w(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*PM);return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/PM}_compareTo(e){return this.seconds===e.seconds?ne(this.nanoseconds,e.nanoseconds):ne(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-xM,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};var H=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new $e(0,0))}static max(){return new n(new $e(253402300799,1e9-1))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var MM="__name__",Dm=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&B(),r===void 0?r=e.length-t:r>e.length-t&&B(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},ge=class n extends Dm{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new w(S.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},t8=/^[_a-zA-Z][_a-zA-Z0-9]*$/,at=class n extends Dm{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return t8.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===MM}static keyField(){return new n([MM])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new w(S.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new w(S.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new w(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a==="."&&!o?(s(),i++):(r+=a,i++)}if(s(),o)throw new w(S.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var P=class n{constructor(e){this.path=e}static fromPath(e){return new n(ge.fromString(e))}static fromName(e){return new n(ge.fromString(e).popFirst(5))}static empty(){return new n(ge.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ge.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ge.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new ge(e.slice()))}};var Kl=-1,n8=0,y0=(()=>{class n{constructor(t,r,i,s){this.indexId=t,this.collectionGroup=r,this.fields=i,this.indexState=s}}return n.UNKNOWN_ID=-1,n})();function db(n){return n.fields.find(e=>e.kind===2)}function zo(n){return n.fields.filter(e=>e.kind!==2)}function r8(n){let e=zo(n);return e.length===0?0:e[e.length-1].kind}function i8(n){return`id=${n.indexId}|cg=${n.collectionGroup}|f=${n.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}var Wl=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Ih=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(n8,ir.min())}};function jF(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=H.fromTimestamp(r===1e9?new $e(t+1,0):new $e(t,r));return new ir(i,P.empty(),e)}function WF(n){return new ir(n.readTime,n.key,Kl)}var ir=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(H.min(),P.empty(),Kl)}static max(){return new n(H.max(),P.empty(),Kl)}};function fb(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=P.comparator(n.documentKey,e.documentKey),t!==0)?t:ne(n.largestBatchId,e.largestBatchId)}var HF="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Rm=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Gs(n){return m(this,null,function*(){if(n.code===S.FAILED_PRECONDITION&&n.message===HF)R("LocalStore","Unexpectedly lost primary lease");else throw n})}var _=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&B(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var Nn="SimpleDb",s8=3,Nm=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new st,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new Vo(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=r=>{let i=pb(r.target.error);this.completionDeferred.reject(new Vo(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new Vo(t,s)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(R(Nn,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;!this.aborted&&typeof e.commit=="function"&&e.commit()}store(e){let t=this.transaction.objectStore(e);return new v0(t)}},Pi=class n{constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,n.getIOSVersion(eu())===12.2&&He("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return R(Nn,"Removing database:",e),Oo(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!vf())return!1;if(n.isMockPersistence())return!0;let e=eu(),t=n.getIOSVersion(e),r=0<t&&t<10,i=n.getAndroidVersion(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static isMockPersistence(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static getAndroidVersion(e){let t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}ensureDb(e){return m(this,null,function*(){return this.db||(R(Nn,"Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new Vo(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new w(S.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new w(S.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Vo(e,o))},i.onupgradeneeded=s=>{R(Nn,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.schemaConverter.createOrUpgrade(o,i.transaction,s.oldVersion,this.version).next(()=>{R(Nn,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=t=>this.versionchangelistener(t)),this.db})}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return m(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.ensureDb(e);let a=Nm.open(this.db,e,s?"readonly":"readwrite",r),l=i(a).next(c=>(a.maybeCommit(),c)).catch(c=>(a.abort(c),_.reject(c))).toPromise();return l.catch(()=>{}),yield a.completionPromise,l}catch(a){let l=a,c=l.name!=="FirebaseError"&&o<s8;if(R(Nn,"Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}},_0=class{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return Oo(this.dbCursor.delete())}},Vo=class extends w{constructor(e,t){super(S.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function js(n){return n.name==="IndexedDbTransactionError"}var v0=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(R(Nn,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(R(Nn,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Oo(r)}add(e){R(Nn,"ADD",this.store.name,e,e);let t=this.store.add(e);return Oo(t)}get(e){let t=this.store.get(e);return Oo(t).next(r=>(r===void 0&&(r=null),R(Nn,"GET",this.store.name,e,r),r))}delete(e){R(Nn,"DELETE",this.store.name,e);let t=this.store.delete(e);return Oo(t)}count(){R(Nn,"COUNT",this.store.name);let e=this.store.count();return Oo(e)}loadAll(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new _((o,a)=>{s.onerror=l=>{a(l.target.error)},s.onsuccess=l=>{o(l.target.result)}})}else{let s=this.cursor(r),o=[];return this.iterateCursor(s,(a,l)=>{o.push(l)}).next(()=>o)}}loadFirst(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new _((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}deleteAll(e,t){R(Nn,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let i=this.cursor(r);return this.iterateCursor(i,(s,o,a)=>a.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.iterateCursor(i,t)}iterateSerial(e){let t=this.cursor({});return new _((r,i)=>{t.onerror=s=>{let o=pb(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;if(!o){r();return}e(o.primaryKey,o.value).next(a=>{a?o.continue():r()})}})}iterateCursor(e,t){let r=[];return new _((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a){i();return}let l=new _0(a),c=t(a.primaryKey,a.value,l);if(c instanceof _){let u=c.catch(h=>(l.done(),_.reject(h)));r.push(u)}l.isDone?i():l.skipToKey===null?a.continue():a.continue(l.skipToKey)}}).next(()=>_.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}else return this.store.openCursor(e.range,t)}};function Oo(n){return new _((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=pb(r.target.error);t(i)}})}var FM=!1;function pb(n){let e=Pi.getIOSVersion(eu());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new w("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return FM||(FM=!0,setTimeout(()=>{throw r},0)),r}}return n}var Eh="IndexBackfiller",o8=15*1e3,a8=60*1e3,l8=50,E0=class{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(o8)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}schedule(e){R(Eh,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>m(this,null,function*(){this.task=null;try{let t=yield this.backfiller.backfill();R(Eh,`Documents written: ${t}`)}catch(t){js(t)?R(Eh,"Ignoring IndexedDB error during index backfill: ",t):yield Gs(t)}yield this.schedule(a8)}))}},S0=class{constructor(e,t){this.localStore=e,this.persistence=t}backfill(){return m(this,arguments,function*(e=l8){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))})}writeIndexEntries(e,t){let r=new Set,i=t,s=!0;return _.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o===null||r.has(o))s=!1;else return R(Eh,`Processing collection: ${o}`),this.writeEntriesForCollectionGroup(e,o,i).next(a=>{i-=a,r.add(o)})})).next(()=>t-i)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.getNewOffset(i,s)).next(a=>(R(Eh,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=WF(s);fb(o,r)>0&&(r=o)}),new ir(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var kn=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),Hl="",C0="",$F="",KF="";function ln(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=LM(e)),e=c8(n.get(t),e);return LM(e)}function c8(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+=Hl+$F;break;case Hl:t+=Hl+KF;break;default:t+=s}}return t}function LM(n){return n+Hl+C0}function ti(n){let e=n.length;if(q(e>=2),e===2)return q(n.charAt(0)===Hl&&n.charAt(1)===C0),ge.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf(Hl,s);switch((o<0||o>t)&&B(),n.charAt(o+1)){case C0:let l=n.substring(s,o),c;i.length===0?c=l:(i+=l,c=i,i=""),r.push(c);break;case $F:i+=n.substring(s,o),i+="\0";break;case KF:i+=n.substring(s,o+1);break;default:B()}s=o+2}return new ge(r)}var xo="remoteDocuments";var Xh="owner",Ol="owner",Jh="mutationQueues",u8="userId",Er="mutations",QF="batchId",Lo="userMutationsIndex",YF=["userId","batchId"];function h8(n){return[n]}function Em(n,e){return[n,ln(e)]}function XF(n,e,t){return[n,ln(e),t]}var d8={},dc="documentMutations",_y="remoteDocumentsV14",f8=["prefixPath","collectionGroup","readTime","documentId"],Sm="documentKeyIndex",p8=["prefixPath","collectionGroup","documentId"],JF="collectionGroupIndex",g8=["collectionGroup","readTime","prefixPath","documentId"],Zh="remoteDocumentGlobal",w0="remoteDocumentGlobalKey",fc="targets",m8="targetId",ZF="queryTargetsIndex",y8=["canonicalId","targetId"],pc="targetDocuments",_8=["targetId","path"],gb="documentTargetsIndex",v8=["path","targetId"],km="targetGlobalKey",ta="targetGlobal",Ah="collectionParents",E8=["collectionId","parent"],Ql="clientMetadata",S8="clientId",vy="bundles",C8="bundleId",Ey="namedQueries",w8="name",mb="indexConfiguration",T8="indexId",T0="collectionGroupIndex",b8="collectionGroup",yb="indexState",I8=["indexId","uid"],eL="sequenceNumberIndex",A8=["uid","sequenceNumber"],_b="indexEntries",D8=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],tL="documentKeyIndex",R8=["indexId","uid","orderedDocumentKey"],Sy="documentOverlays",N8=["userId","collectionPath","documentId"],b0="collectionPathOverlayIndex",k8=["userId","collectionPath","largestBatchId"],nL="collectionGroupOverlayIndex",O8=["userId","collectionGroup","largestBatchId"],x8=[Jh,Er,dc,xo,fc,Xh,ta,pc],P8=x8,M8=[...P8,Ql],F8=[...M8,Zh],L8=[...F8,Ah],rL=[...L8,vy,Ey],B8=[...rL,Sy],iL=[Jh,Er,dc,_y,fc,Xh,ta,pc,Ql,Zh,Ah,vy,Ey,Sy],sL=iL,V8=[...sL,mb,yb,_b];function U8(n){if(n===15)return V8;if(n===14)return sL;if(n===13)return iL;if(n===12)return B8;if(n===11)return rL;B()}var Dh=class extends Rm{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}};function Nt(n,e){let t=M(n);return Pi.getStore(t.simpleDbTransaction,e)}function BM(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function na(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function oL(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var Be=class n{constructor(e,t){this.comparator=e,this.root=t||Sh.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Sh.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Sh.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Gl(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Gl(this.root,e,this.comparator,!1)}getReverseIterator(){return new Gl(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Gl(this.root,e,this.comparator,!0)}},Gl=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Sh=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw B();let t=this.left.check();if(t!==this.right.check())throw B();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),I0=class{constructor(){this.size=0}get key(){throw B()}get value(){throw B()}get color(){throw B()}get left(){throw B()}get right(){throw B()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Sh(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};Sh.EMPTY=new I0;var De=class n{constructor(e){this.comparator=e,this.data=new Be(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Om(this.data.getIterator())}getIteratorFrom(e){return new Om(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Om=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function q8(n,e,t,r,i){let s=n.getIterator(),o=e.getIterator(),a=xl(s),l=xl(o);for(;a||l;){let c=!1,u=!1;if(a&&l){let h=t(a,l);h<0?u=!0:h>0&&(c=!0)}else a!=null?u=!0:c=!0;c?(r(l),l=xl(o)):u?(i(a),a=xl(s)):(a=xl(s),l=xl(o))}}function xl(n){return n.hasNext()?n.getNext():void 0}var On=class n{constructor(e){this.fields=e,e.sort(at.comparator)}static empty(){return new n([])}unionWith(e){let t=new De(at.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return qo(this.fields,e.fields,(t,r)=>t.isEqual(r))}};function z8(n){return Buffer.from(n,"base64").toString("binary")}function G8(n){return Buffer.from(n,"binary").toString("base64")}function aL(){return!0}var Rt=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=z8(e);return new n(t)}static fromUint8Array(e){let t=j8(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return G8(this.binaryString)}toUint8Array(){return W8(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return ne(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Rt.EMPTY_BYTE_STRING=new Rt("");function j8(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function W8(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var H8=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function xs(n){if(q(!!n),typeof n=="string"){let e=0,t=H8.exec(n);if(q(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=tt(n.seconds),t=tt(n.nanos);return{seconds:e,nanos:t}}}function tt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ps(n){return typeof n=="string"?Rt.fromBase64String(n):Rt.fromUint8Array(n)}var lL="server_timestamp",cL="__type__",uL="__previous_value__",hL="__local_write_time__";function Cy(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[cL])===null||t===void 0?void 0:t.stringValue)===lL}function $8(n,e){let t={fields:{[cL]:{stringValue:lL},[hL]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&Cy(e)&&(e=vb(e)),e&&(t.fields[uL]=e),{mapValue:t}}function vb(n){let e=n.mapValue.fields[uL];return Cy(e)?vb(e):e}function Rh(n){let e=xs(n.mapValue.fields[hL].timestampValue);return new $e(e.seconds,e.nanos)}var A0=class{constructor(e,t,r,i,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},D0="(default)",Ms=class n{constructor(e,t){this.projectId=e,this.database=t||D0}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===D0}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function K8(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new w(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ms(n.options.projectId,e)}var ks=-1;function ed(n){return n==null}function Nh(n){return n===0&&1/n===1/-0}function dL(n){return typeof n=="number"&&Number.isInteger(n)&&!Nh(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var fL="__max__",Rs={mapValue:{fields:{__type__:{stringValue:fL}}}},Cm={nullValue:"NULL_VALUE"};function Go(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Cy(n)?4:pL(n)?9007199254740991:10:B()}function Sr(n,e){if(n===e)return!0;let t=Go(n),r=Go(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Rh(n).isEqual(Rh(e));case 3:return Q8(n,e);case 5:return n.stringValue===e.stringValue;case 6:return X8(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return Y8(n,e);case 2:return J8(n,e);case 9:return qo(n.arrayValue.values||[],e.arrayValue.values||[],Sr);case 10:return Z8(n,e);case 9007199254740991:return!0;default:return B()}}function Q8(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=xs(n.timestampValue),r=xs(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function Y8(n,e){return tt(n.geoPointValue.latitude)===tt(e.geoPointValue.latitude)&&tt(n.geoPointValue.longitude)===tt(e.geoPointValue.longitude)}function X8(n,e){return Ps(n.bytesValue).isEqual(Ps(e.bytesValue))}function J8(n,e){if("integerValue"in n&&"integerValue"in e)return tt(n.integerValue)===tt(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=tt(n.doubleValue),r=tt(e.doubleValue);return t===r?Nh(t)===Nh(r):isNaN(t)&&isNaN(r)}return!1}function Z8(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(BM(t)!==BM(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!Sr(t[i],r[i])))return!1;return!0}function kh(n,e){return(n.values||[]).find(t=>Sr(t,e))!==void 0}function Fs(n,e){if(n===e)return 0;let t=Go(n),r=Go(e);if(t!==r)return ne(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ne(n.booleanValue,e.booleanValue);case 2:return e7(n,e);case 3:return VM(n.timestampValue,e.timestampValue);case 4:return VM(Rh(n),Rh(e));case 5:return ne(n.stringValue,e.stringValue);case 6:return r7(n.bytesValue,e.bytesValue);case 7:return t7(n.referenceValue,e.referenceValue);case 8:return n7(n.geoPointValue,e.geoPointValue);case 9:return i7(n.arrayValue,e.arrayValue);case 10:return s7(n.mapValue,e.mapValue);default:throw B()}}function e7(n,e){let t=tt(n.integerValue||n.doubleValue),r=tt(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function VM(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ne(n,e);let t=xs(n),r=xs(e),i=ne(t.seconds,r.seconds);return i!==0?i:ne(t.nanos,r.nanos)}function t7(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=ne(t[i],r[i]);if(s!==0)return s}return ne(t.length,r.length)}function n7(n,e){let t=ne(tt(n.latitude),tt(e.latitude));return t!==0?t:ne(tt(n.longitude),tt(e.longitude))}function r7(n,e){let t=Ps(n),r=Ps(e);return t.compareTo(r)}function i7(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Fs(t[i],r[i]);if(s)return s}return ne(t.length,r.length)}function s7(n,e){if(n===Rs.mapValue&&e===Rs.mapValue)return 0;if(n===Rs.mapValue)return 1;if(e===Rs.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){let a=ne(r[o],s[o]);if(a!==0)return a;let l=Fs(t[r[o]],i[s[o]]);if(l!==0)return l}return ne(r.length,s.length)}function Yl(n){return Eb(n)}function Eb(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?a7(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?o7(n.bytesValue):"referenceValue"in n?c7(n.referenceValue):"geoPointValue"in n?l7(n.geoPointValue):"arrayValue"in n?h7(n.arrayValue):"mapValue"in n?u7(n.mapValue):B()}function o7(n){return Ps(n).toBase64()}function a7(n){let e=xs(n);return`time(${e.seconds},${e.nanos})`}function l7(n){return`geo(${n.latitude},${n.longitude})`}function c7(n){return P.fromName(n).toString()}function u7(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${Eb(n.fields[i])}`;return t+"}"}function h7(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=Eb(r);return e+"]"}function jo(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function R0(n){return!!n&&"integerValue"in n}function d7(n){return!!n&&"doubleValue"in n}function f7(n){return R0(n)||d7(n)}function Oh(n){return!!n&&"arrayValue"in n}function UM(n){return!!n&&"nullValue"in n}function qM(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function wm(n){return!!n&&"mapValue"in n}function Ch(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return na(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Ch(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ch(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function pL(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===fL}function p7(n){return"nullValue"in n?Cm:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?jo(Ms.empty(),P.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:B()}function g7(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?jo(Ms.empty(),P.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Rs:B()}function zM(n,e){let t=Fs(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function GM(n,e){let t=Fs(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Yt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!wm(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=Ch(t)}setAll(e){let t=at.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Ch(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());wm(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Sr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!wm(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){na(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Ch(this.value))}};function gL(n){let e=[];return na(n.fields,(t,r)=>{let i=new at([t]);if(wm(r)){let o=gL(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new On(e)}var ft=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,H.min(),H.min(),H.min(),Yt.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,H.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,H.min(),H.min(),Yt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,H.min(),H.min(),Yt.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(H.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Yt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Yt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=H.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function m7(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?Fs(r,i):B()}var si=class{constructor(e,t){this.position=e,this.inclusive=t}};function mL(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField())r=P.comparator(P.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);r=Fs(o,a)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function y7(n,e,t){let r=mL(n,e,t);return n.inclusive?r>=0:r>0}function _7(n,e,t){let r=mL(n,e,t);return n.inclusive?r<=0:r<0}function jM(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!Sr(r,i))return!1}return!0}var Wo=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function v7(n){return n.field.canonicalString()+n.dir}function E7(n){return`${n.field.canonicalString()} (${n.dir})`}function S7(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var xm=class{},fe=class n extends xm{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new O0(e,t,r):t==="array-contains"?new M0(e,r):t==="in"?new Pm(e,r):t==="not-in"?new F0(e,r):t==="array-contains-any"?new L0(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new x0(e,r):new P0(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Fs(t,this.value)):t!==null&&Go(this.value)===Go(t)&&this.matchesComparison(Fs(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return B()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Te=class n extends xm{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return Xl(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function Xl(n){return n.op==="and"}function N0(n){return n.op==="or"}function Sb(n){return yL(n)&&Xl(n)}function yL(n){for(let e of n.filters)if(e instanceof Te)return!1;return!0}function k0(n){if(n instanceof fe)return n.field.canonicalString()+n.op.toString()+Yl(n.value);if(Sb(n))return n.filters.map(e=>k0(e)).join(",");{let e=n.filters.map(t=>k0(t)).join(",");return`${n.op}(${e})`}}function _L(n,e){if(n instanceof fe)return C7(n,e);if(n instanceof Te)return w7(n,e);B()}function C7(n,e){return e instanceof fe&&n.op===e.op&&n.field.isEqual(e.field)&&Sr(n.value,e.value)}function w7(n,e){return e instanceof Te&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&_L(i,e.filters[s]),!0):!1}function vL(n,e){let t=n.filters.concat(e);return Te.create(t,n.op)}function EL(n){return n instanceof fe?b7(n):n instanceof Te?T7(n):"Filter"}function T7(n){return n.op.toString()+" {"+n.getFilters().map(EL).join(" ,")+"}"}function b7(n){return`${n.field.canonicalString()} ${n.op} ${Yl(n.value)}`}var O0=class extends fe{constructor(e,t,r){super(e,t,r),this.key=P.fromName(r.referenceValue)}matches(e){let t=P.comparator(e.key,this.key);return this.matchesComparison(t)}},x0=class extends fe{constructor(e,t){super(e,"in",t),this.keys=SL("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},P0=class extends fe{constructor(e,t){super(e,"not-in",t),this.keys=SL("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function SL(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>P.fromName(r.referenceValue))}var M0=class extends fe{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Oh(t)&&kh(t.arrayValue,this.value)}},Pm=class extends fe{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&kh(this.value.arrayValue,t)}},F0=class extends fe{constructor(e,t){super(e,"not-in",t)}matches(e){if(kh(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!kh(this.value.arrayValue,t)}},L0=class extends fe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!Oh(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>kh(this.value.arrayValue,r))}};var B0=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function V0(n,e=null,t=[],r=[],i=null,s=null,o=null){return new B0(n,e,t,r,i,s,o)}function Ho(n){let e=M(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>k0(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>v7(r)).join(","),ed(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Yl(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Yl(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function I7(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>EL(t)).join(", ")}]`),ed(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>E7(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>Yl(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>Yl(t)).join(",")),`Target(${e})`}function td(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!S7(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!_L(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!jM(n.startAt,e.startAt)?!1:jM(n.endAt,e.endAt)}function Mm(n){return P.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function wy(n,e){return n.filters.filter(t=>t instanceof fe&&t.field.isEqual(e))}function A7(n,e){let t=db(e);if(t===void 0)return null;for(let r of wy(n,t.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}function D7(n,e){let t=new Map;for(let r of zo(e))for(let i of wy(n,r.fieldPath))switch(i.op){case"==":case"in":t.set(r.fieldPath.canonicalString(),i.value);break;case"not-in":case"!=":return t.set(r.fieldPath.canonicalString(),i.value),Array.from(t.values())}return null}function R7(n,e){let t=[],r=!0;for(let i of zo(e)){let s=i.kind===0?CL(n,i.fieldPath,n.startAt):wL(n,i.fieldPath,n.startAt);t.push(s.value),r&&(r=s.inclusive)}return new si(t,r)}function N7(n,e){let t=[],r=!0;for(let i of zo(e)){let s=i.kind===0?wL(n,i.fieldPath,n.endAt):CL(n,i.fieldPath,n.endAt);t.push(s.value),r&&(r=s.inclusive)}return new si(t,r)}function CL(n,e,t){let r=Cm,i=!0;for(let s of wy(n,e)){let o=Cm,a=!0;switch(s.op){case"<":case"<=":o=p7(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Cm;break}zM({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];zM({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function wL(n,e,t){let r=Rs,i=!0;for(let s of wy(n,e)){let o=Rs,a=!0;switch(s.op){case">=":case">":o=g7(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Rs;break}GM({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];GM({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function k7(n){let e=new De(at.comparator),t=!1;for(let r of n.filters)for(let i of r.getFlattenedFilters())i.field.isKeyField()||(i.op==="array-contains"||i.op==="array-contains-any"?t=!0:e=e.add(i.field));for(let r of n.orderBy)r.field.isKeyField()||(e=e.add(r.field));return e.size+(t?1:0)}function O7(n){return n.limit!==null}var Cr=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function TL(n,e,t,r,i,s,o,a){return new Cr(n,e,t,r,i,s,o,a)}function gc(n){return new Cr(n)}function x7(n,e){return new Cr(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function WM(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function P7(n){let e=new De(at.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function M7(n){return new Cr(ge.emptyPath(),n)}function F7(n){return P.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Cb(n){return n.collectionGroup!==null}function Jl(n){let e=M(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";P7(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new Wo(s,r))}),t.has(at.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new Wo(at.keyField(),r))}return e.memoizedNormalizedOrderBy}function cn(n){let e=M(n);return e.memoizedTarget||(e.memoizedTarget=L7(e,Jl(n))),e.memoizedTarget}function L7(n,e){if(n.limitType==="F")return V0(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Wo(i.field,s)});let t=n.endAt?new si(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new si(n.startAt.position,n.startAt.inclusive):null;return V0(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function wb(n,e){let t=n.filters.concat([e]);return new Cr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function B7(n,e){let t=n.explicitOrderBy.concat([e]);return new Cr(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function Fm(n,e,t){return new Cr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function V7(n,e){return new Cr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function U7(n,e){return new Cr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,e)}function nd(n,e){return td(cn(n),cn(e))&&n.limitType===e.limitType}function bL(n){return`${Ho(cn(n))}|lt:${n.limitType}`}function Ul(n){return`Query(target=${I7(cn(n))}; limitType=${n.limitType})`}function rd(n,e){return e.isFoundDocument()&&q7(n,e)&&z7(n,e)&&G7(n,e)&&j7(n,e)}function q7(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):P.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function z7(n,e){for(let t of Jl(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function G7(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function j7(n,e){return!(n.startAt&&!_7(n.startAt,Jl(n),e)||n.endAt&&!y7(n.endAt,Jl(n),e))}function IL(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function AL(n){return(e,t)=>{let r=!1;for(let i of Jl(n)){let s=W7(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function W7(n,e,t){let r=n.field.isKeyField()?P.comparator(e.key,t.key):m7(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return B()}}var oi=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){na(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return oL(this.inner)}size(){return this.innerSize}};var H7=new Be(P.comparator);function Sn(){return H7}var DL=new Be(P.comparator);function _h(...n){let e=DL;for(let t of n)e=e.insert(t.key,t);return e}function $7(){return xh()}function RL(n){let e=DL;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function ni(){return xh()}function NL(){return xh()}function xh(){return new oi(n=>n.toString(),(n,e)=>n.isEqual(e))}var K7=new Be(P.comparator);function Q7(){return K7}var Y7=new De(P.comparator);function ie(...n){let e=Y7;for(let t of n)e=e.add(t);return e}var X7=new De(ne);function Tb(){return X7}function kL(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Nh(e)?"-0":e}}function OL(n){return{integerValue:""+n}}function xL(n,e){return dL(e)?OL(e):kL(n,e)}var Zl=class{constructor(){this._=void 0}};function J7(n,e,t){return n instanceof Ls?$8(t,e):n instanceof Mi?ML(n,e):n instanceof Fi?FL(n,e):tQ(n,e)}function Z7(n,e,t){return n instanceof Mi?ML(n,e):n instanceof Fi?FL(n,e):t}function PL(n,e){return n instanceof Bs?f7(e)?e:{integerValue:0}:null}function eQ(n,e){return n instanceof Mi&&e instanceof Mi||n instanceof Fi&&e instanceof Fi?qo(n.elements,e.elements,Sr):n instanceof Bs&&e instanceof Bs?Sr(n.operand,e.operand):n instanceof Ls&&e instanceof Ls}var Ls=class extends Zl{},Mi=class extends Zl{constructor(e){super(),this.elements=e}};function ML(n,e){let t=LL(e);for(let r of n.elements)t.some(i=>Sr(i,r))||t.push(r);return{arrayValue:{values:t}}}var Fi=class extends Zl{constructor(e){super(),this.elements=e}};function FL(n,e){let t=LL(e);for(let r of n.elements)t=t.filter(i=>!Sr(i,r));return{arrayValue:{values:t}}}var Bs=class extends Zl{constructor(e,t){super(),this.serializer=e,this.operand=t}};function tQ(n,e){let t=PL(n,e),r=HM(t)+HM(n.operand);return R0(t)&&R0(n.operand)?OL(r):kL(n.serializer,r)}function HM(n){return tt(n.integerValue||n.doubleValue)}function LL(n){return Oh(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var $o=class{constructor(e,t){this.field=e,this.transform=t}};function nQ(n,e){return n.field.isEqual(e.field)&&eQ(n.transform,e.transform)}function rQ(n,e){return n===void 0&&e===void 0?!0:n&&e?qo(n,e,(t,r)=>nQ(t,r)):!1}var U0=class{constructor(e,t){this.version=e,this.transformResults=t}},et=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Ty(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var ec=class{};function BL(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Us(n.key,et.none()):new Vs(n.key,n.data,et.none());{let t=n.data,r=Yt.empty(),i=new De(at.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new wr(n.key,r,new On(i.toArray()),et.none())}}function iQ(n,e,t){n instanceof Vs?oQ(n,e,t):n instanceof wr?lQ(n,e,t):uQ(n,e,t)}function wh(n,e,t,r){return n instanceof Vs?aQ(n,e,t,r):n instanceof wr?cQ(n,e,t,r):hQ(n,e,t)}function sQ(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=PL(r.transform,i||null);s!=null&&(t===null&&(t=Yt.empty()),t.set(r.field,s))}return t||null}function $M(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!rQ(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var Vs=class extends ec{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};function oQ(n,e,t){let r=n.value.clone(),i=UL(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function aQ(n,e,t,r){if(!Ty(n.precondition,e))return t;let i=n.value.clone(),s=qL(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}var wr=class extends ec{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function lQ(n,e,t){if(!Ty(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=UL(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(VL(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function cQ(n,e,t,r){if(!Ty(n.precondition,e))return t;let i=qL(n.fieldTransforms,r,e),s=e.data;return s.setAll(VL(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function VL(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function UL(n,e,t){let r=new Map;q(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,Z7(o,a,t[i]))}return r}function qL(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,J7(s,o,e))}return r}var Us=class extends ec{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function uQ(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function hQ(n,e,t){return Ty(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var Ph=class extends ec{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Mh=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let o=r[i];iQ(s,e,o)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=wh(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=wh(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=NL();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let l=BL(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(H.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ie())}isEqual(e){return this.batchId===e.batchId&&qo(this.mutations,e.mutations,(t,r)=>$M(t,r))&&qo(this.baseMutations,e.baseMutations,(t,r)=>$M(t,r))}},q0=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){q(e.mutations.length===r.length);let i=Q7(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Fh=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var z0=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Dt=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(Dt||{});function zL(n){switch(n){case S.OK:return B();case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0;default:return B()}}function dQ(n){return zL(n)&&n!==S.ABORTED}function Tm(n){if(n===void 0)return He("GRPC error has no .code"),S.UNKNOWN;switch(n){case Dt.OK:return S.OK;case Dt.CANCELLED:return S.CANCELLED;case Dt.UNKNOWN:return S.UNKNOWN;case Dt.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case Dt.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case Dt.INTERNAL:return S.INTERNAL;case Dt.UNAVAILABLE:return S.UNAVAILABLE;case Dt.UNAUTHENTICATED:return S.UNAUTHENTICATED;case Dt.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case Dt.NOT_FOUND:return S.NOT_FOUND;case Dt.ALREADY_EXISTS:return S.ALREADY_EXISTS;case Dt.PERMISSION_DENIED:return S.PERMISSION_DENIED;case Dt.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case Dt.ABORTED:return S.ABORTED;case Dt.OUT_OF_RANGE:return S.OUT_OF_RANGE;case Dt.UNIMPLEMENTED:return S.UNIMPLEMENTED;case Dt.DATA_LOSS:return S.DATA_LOSS;default:return B()}}var G0=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var t0=null;function GL(){return new $5}function fQ(){return new K5("utf-8")}var pQ=new Eo([4294967295,4294967295],0);function KM(n){let e=GL().encode(n),t=new nk;return t.update(e),new Uint8Array(t.digest())}function QM(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new Eo([t,r],0),a=new Eo([i,s],0);return[o,a]}var j0=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Bo(`Invalid padding: ${t}`);if(r<0)throw new Bo(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Bo(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Bo(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=Eo.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(Eo.fromNumber(r)));return i.compare(pQ)===1&&(i=new Eo([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],r=e%8;return(t&1<<r)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=KM(e),[r,i]=QM(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,r){let i=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=KM(e),[r,i]=QM(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Bo=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Lh=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Bh.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(H.min(),i,new Be(ne),Sn(),ie())}},Bh=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,ie(),ie(),ie())}};var $l=class{constructor(e,t,r,i){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=i}},Lm=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},Bm=class{constructor(e,t,r=Rt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Vm=class{constructor(){this.pendingResponses=0,this.documentChanges=XM(),this._resumeToken=Rt.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=ie(),t=ie(),r=ie();return this.documentChanges.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:B()}}),new Bh(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=XM()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,q(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},gQ="WatchChangeAggregator",W0=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=Sn(),this.pendingDocumentTargetMapping=YM(),this.pendingTargetResets=new Be(ne)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:B()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((r,i)=>{this.isActiveTarget(i)&&t(i)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(t);if(i){let s=i.target;if(Mm(s))if(r===0){let o=new P(s.path);this.removeDocumentFromTarget(t,o,ft.newNoDocument(o,H.min()))}else q(r===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==r){let a=this.parseBloomFilter(e),l=a?this.applyBloomFilter(a,e,o):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}t0?.notifyOnExistenceFilterMismatch(mQ(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o;try{o=Ps(r).toUint8Array()}catch(l){if(l instanceof G0)return rr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let a;try{a=new j0(o,i,s)}catch(l){return l instanceof Bo?rr("BloomFilter error: ",l):rr("Applying bloom filter failed: ",l),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,r){let i=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return i===r-s?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),i++)}),i}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&Mm(a.target)){let l=new P(a.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(o,l)&&this.removeDocumentFromTarget(o,l,ft.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let r=ie();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(r=r.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let i=new Lh(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Sn(),this.pendingDocumentTargetMapping=YM(),this.pendingTargetResets=new Be(ne),i}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let i=this.ensureTargetState(e);this.targetContainsDocument(e,t)?i.addDocumentChange(t,1):i.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let r=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new Vm,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new De(ne),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||R(gQ,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new Vm),this.metadataProvider.getRemoteKeysForTarget(e).forEach(r=>{this.removeDocumentFromTarget(e,r,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function YM(){return new Be(P.comparator)}function XM(){return new Be(P.comparator)}function mQ(n,e,t,r,i){var s,o,a,l,c,u;let h={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},d=e.unchangedNames;return d&&(h.bloomFilter={applied:i===0,hashCount:(s=d?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(a=(o=d?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&l!==void 0?l:0,padding:(u=(c=d?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:f=>{var g;return(g=r?.mightContain(f))!==null&&g!==void 0?g:!1}}),h}var yQ=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),_Q=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),vQ=(()=>{let n={};return n.and="AND",n.or="OR",n})();var H0=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function EQ(n){let e=n.code===void 0?S.UNKNOWN:Tm(n.code);return new w(e,n.message||"")}function $0(n,e){return n.useProto3Json||ed(e)?e:{value:e}}function SQ(n){let e;return typeof n=="object"?e=n.value:e=n,ed(e)?null:e}function tc(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function CQ(n){let e=xs(n);return new $e(e.seconds,e.nanos)}function jL(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function wQ(n,e){return n.useProto3Json?(q(e===void 0||typeof e=="string"),Rt.fromBase64String(e||"")):(q(e===void 0||e instanceof Uint8Array),Rt.fromUint8Array(e||new Uint8Array))}function TQ(n,e){return tc(n,e.toTimestamp())}function ot(n){return q(!!n),H.fromTimestamp(CQ(n))}function bb(n,e){return K0(n,e).canonicalString()}function K0(n,e){let t=bQ(n).child("documents");return e===void 0?t:t.child(e)}function WL(n){let e=ge.fromString(n);return q(t2(e)),e}function Vh(n,e){return bb(n.databaseId,e.path)}function ri(n,e){let t=WL(e);if(t.get(1)!==n.databaseId.projectId)throw new w(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new w(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new P(KL(t))}function HL(n,e){return bb(n.databaseId,e)}function $L(n){let e=WL(n);return e.length===4?ge.emptyPath():KL(e)}function Q0(n){return new ge(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function bQ(n){return new ge(["projects",n.projectId,"databases",n.database])}function KL(n){return q(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function JM(n,e,t){return{name:Vh(n,e),fields:t.value.mapValue.fields}}function IQ(n,e){return{name:Vh(n,e.key),fields:e.data.value.mapValue.fields,updateTime:tc(n,e.version.toTimestamp()),createTime:tc(n,e.createTime.toTimestamp())}}function QL(n,e,t){let r=ri(n,e.name),i=ot(e.updateTime),s=e.createTime?ot(e.createTime):H.min(),o=new Yt({mapValue:{fields:e.fields}}),a=ft.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function AQ(n,e){q(!!e.found),e.found.name,e.found.updateTime;let t=ri(n,e.found.name),r=ot(e.found.updateTime),i=e.found.createTime?ot(e.found.createTime):H.min(),s=new Yt({mapValue:{fields:e.found.fields}});return ft.newFoundDocument(t,r,i,s)}function DQ(n,e){q(!!e.missing),q(!!e.readTime);let t=ri(n,e.missing),r=ot(e.readTime);return ft.newNoDocument(t,r)}function RQ(n,e){return"found"in e?AQ(n,e):"missing"in e?DQ(n,e):B()}function NQ(n,e){let t;if("targetChange"in e){e.targetChange;let r=kQ(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=wQ(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&EQ(o);t=new Bm(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=ri(n,r.document.name),s=ot(r.document.updateTime),o=r.document.createTime?ot(r.document.createTime):H.min(),a=new Yt({mapValue:{fields:r.document.fields}}),l=ft.newFoundDocument(i,s,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];t=new $l(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=ri(n,r.document),s=r.readTime?ot(r.readTime):H.min(),o=ft.newNoDocument(i,s),a=r.removedTargetIds||[];t=new $l([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=ri(n,r.document),s=r.removedTargetIds||[];t=new $l([],s,i,null)}else if("filter"in e){e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new z0(i,s),a=r.targetId;t=new Lm(a,o)}else return B();return t}function kQ(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:B()}function OQ(n){if(!("targetChange"in n))return H.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?H.min():ot(e.readTime)}function Uh(n,e){let t;if(e instanceof Vs)t={update:JM(n,e.key,e.value)};else if(e instanceof Us)t={delete:Vh(n,e.key)};else if(e instanceof wr)t={update:JM(n,e.key,e.data),updateMask:hY(e.fieldMask)};else if(e instanceof Ph)t={verify:Vh(n,e.key)};else return B();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>LQ(n,r))),e.precondition.isNone||(t.currentDocument=xQ(n,e.precondition)),t}function Y0(n,e){let t=e.currentDocument?PQ(e.currentDocument):et.none(),r=e.updateTransforms?e.updateTransforms.map(i=>BQ(n,i)):[];if(e.update){e.update.name;let i=ri(n,e.update.name),s=new Yt({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=dY(e.updateMask);return new wr(i,s,o,t,r)}else return new Vs(i,s,t,r)}else if(e.delete){let i=ri(n,e.delete);return new Us(i,t)}else if(e.verify){let i=ri(n,e.verify);return new Ph(i,t)}else return B()}function xQ(n,e){return e.updateTime!==void 0?{updateTime:TQ(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:B()}function PQ(n){return n.updateTime!==void 0?et.updateTime(ot(n.updateTime)):n.exists!==void 0?et.exists(n.exists):et.none()}function MQ(n,e){let t=n.updateTime?ot(n.updateTime):ot(e);return t.isEqual(H.min())&&(t=ot(e)),new U0(t,n.transformResults||[])}function FQ(n,e){return n&&n.length>0?(q(e!==void 0),n.map(t=>MQ(t,e))):[]}function LQ(n,e){let t=e.transform;if(t instanceof Ls)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof Mi)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof Fi)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof Bs)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw B()}function BQ(n,e){let t=null;if("setToServerValue"in e)q(e.setToServerValue==="REQUEST_TIME"),t=new Ls;else if("appendMissingElements"in e){let i=e.appendMissingElements.values||[];t=new Mi(i)}else if("removeAllFromArray"in e){let i=e.removeAllFromArray.values||[];t=new Fi(i)}else"increment"in e?t=new Bs(n,e.increment):B();let r=at.fromServerFormat(e.fieldPath);return new $o(r,t)}function YL(n,e){return{documents:[HL(n,e.path)]}}function VQ(n){let e=n.documents.length;q(e===1);let t=n.documents[0];return cn(gc($L(t)))}function XL(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=HL(n,i);let s=jQ(e.filters);s&&(t.structuredQuery.where=s);let o=HQ(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=$0(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=KQ(e.startAt)),e.endAt&&(t.structuredQuery.endAt=QQ(e.endAt)),{queryTarget:t,parent:i}}function JL(n){let e=$L(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){q(r===1);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=WQ(t.where));let o=[];t.orderBy&&(o=$Q(t.orderBy));let a=null;t.limit&&(a=SQ(t.limit));let l=null;t.startAt&&(l=YQ(t.startAt));let c=null;return t.endAt&&(c=XQ(t.endAt)),TL(e,i,o,s,a,"F",l,c)}function UQ(n){return cn(JL(n))}function qQ(n,e){let t=zQ(e.purpose);return t==null?null:{"goog-listen-tags":t}}function zQ(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return B()}}function GQ(n,e){let t,r=e.target;if(Mm(r)?t={documents:YL(n,r)}:t={query:XL(n,r).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=jL(n,e.resumeToken);let i=$0(n,e.expectedCount);i!==null&&(t.expectedCount=i)}else if(e.snapshotVersion.compareTo(H.min())>0){t.readTime=tc(n,e.snapshotVersion.toTimestamp());let i=$0(n,e.expectedCount);i!==null&&(t.expectedCount=i)}return t}function jQ(n){if(n.length!==0)return e2(Te.create(n,"and"))}function WQ(n){let e=ZL(n);return e instanceof Te&&Sb(e)?e.getFilters():[e]}function ZL(n){return n.unaryFilter!==void 0?lY(n):n.fieldFilter!==void 0?cY(n):n.compositeFilter!==void 0?uY(n):B()}function HQ(n){if(n.length!==0)return n.map(e=>iY(e))}function $Q(n){return n.map(e=>sY(e))}function KQ(n){return{before:n.inclusive,values:n.position}}function QQ(n){return{before:!n.inclusive,values:n.position}}function YQ(n){let e=!!n.before,t=n.values||[];return new si(t,e)}function XQ(n){let e=!n.before,t=n.values||[];return new si(t,e)}function JQ(n){return yQ[n]}function ZQ(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function eY(n){return _Q[n]}function tY(n){return vQ[n]}function nY(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return B();default:return B()}}function rY(n){switch(n){case"AND":return"and";case"OR":return"or";default:return B()}}function ql(n){return{fieldPath:n.canonicalString()}}function jl(n){return at.fromServerFormat(n.fieldPath)}function iY(n){return{field:ql(n.field),direction:JQ(n.dir)}}function sY(n){return new Wo(jl(n.field),ZQ(n.direction))}function e2(n){return n instanceof fe?aY(n):n instanceof Te?oY(n):B()}function oY(n){let e=n.getFilters().map(t=>e2(t));return e.length===1?e[0]:{compositeFilter:{op:tY(n.op),filters:e}}}function aY(n){if(n.op==="=="){if(qM(n.value))return{unaryFilter:{field:ql(n.field),op:"IS_NAN"}};if(UM(n.value))return{unaryFilter:{field:ql(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(qM(n.value))return{unaryFilter:{field:ql(n.field),op:"IS_NOT_NAN"}};if(UM(n.value))return{unaryFilter:{field:ql(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ql(n.field),op:eY(n.op),value:n.value}}}function lY(n){switch(n.unaryFilter.op){case"IS_NAN":let e=jl(n.unaryFilter.field);return fe.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=jl(n.unaryFilter.field);return fe.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=jl(n.unaryFilter.field);return fe.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=jl(n.unaryFilter.field);return fe.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return B();default:return B()}}function cY(n){return fe.create(jl(n.fieldFilter.field),nY(n.fieldFilter.op),n.fieldFilter.value)}function uY(n){return Te.create(n.compositeFilter.filters.map(e=>ZL(e)),rY(n.compositeFilter.op))}function hY(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function dY(n){let e=n.fieldPaths||[];return new On(e.map(t=>at.fromServerFormat(t)))}function t2(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var nc=class n{constructor(e,t,r,i,s=H.min(),o=H.min(),a=Rt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Um=class{constructor(e){this.remoteSerializer=e}};function fY(n,e){let t;if(e.document)t=QL(n.remoteSerializer,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=P.fromSegments(e.noDocument.path),i=Qo(e.noDocument.readTime);t=ft.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else if(e.unknownDocument){let r=P.fromSegments(e.unknownDocument.path),i=Qo(e.unknownDocument.version);t=ft.newUnknownDocument(r,i)}else return B();return e.readTime&&t.setReadTime(pY(e.readTime)),t}function ZM(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:by(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=IQ(n.remoteSerializer,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Ko(e.version)};else if(e.isUnknownDocument())r.unknownDocument={path:t.path.toArray(),version:Ko(e.version)};else return B();return r}function by(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function pY(n){let e=new $e(n[0],n[1]);return H.fromTimestamp(e)}function Ko(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Qo(n){let e=new $e(n.seconds,n.nanoseconds);return H.fromTimestamp(e)}function gY(n,e,t){let r=t.baseMutations.map(s=>Uh(n.remoteSerializer,s)),i=t.mutations.map(s=>Uh(n.remoteSerializer,s));return{userId:e,batchId:t.batchId,localWriteTimeMs:t.localWriteTime.toMillis(),baseMutations:r,mutations:i}}function Po(n,e){let t=(e.baseMutations||[]).map(s=>Y0(n.remoteSerializer,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let l=e.mutations[s+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>Y0(n.remoteSerializer,s)),i=$e.fromMillis(e.localWriteTimeMs);return new Mh(e.batchId,i,t,r)}function vh(n){let e=Qo(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Qo(n.lastLimboFreeSnapshotVersion):H.min(),r;return mY(n.query)?r=VQ(n.query):r=UQ(n.query),new nc(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Rt.fromBase64String(n.resumeToken))}function n2(n,e){let t=Ko(e.snapshotVersion),r=Ko(e.lastLimboFreeSnapshotVersion),i;Mm(e.target)?i=YL(n.remoteSerializer,e.target):i=XL(n.remoteSerializer,e.target).queryTarget;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ho(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function mY(n){return n.documents!==void 0}function yY(n){return{id:n.bundleId,createTime:Qo(n.createTime),version:n.version}}function _Y(n){return{bundleId:n.id,createTime:Ko(ot(n.createTime)),version:n.version}}function vY(n){return{name:n.name,query:Ib(n.bundledQuery),readTime:Qo(n.readTime)}}function EY(n){return{name:n.name,readTime:Ko(ot(n.readTime)),bundledQuery:n.bundledQuery}}function Ib(n){let e=JL({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Fm(e,e.limit,"L"):e}function SY(n){return{name:n.name,query:Ib(n.bundledQuery),readTime:ot(n.readTime)}}function CY(n){return{id:n.id,version:n.version,createTime:ot(n.createTime)}}function n0(n,e){return new Fh(e.largestBatchId,Y0(n.remoteSerializer,e.overlayMutation))}function wY(n,e,t){let[r,i,s]=r2(e,t.mutation.key);return{userId:e,collectionPath:i,documentId:s,collectionGroup:t.mutation.key.getCollectionGroup(),largestBatchId:t.largestBatchId,overlayMutation:Uh(n.remoteSerializer,t.mutation)}}function r2(n,e){let t=e.path.lastSegment(),r=ln(e.path.popLast());return[n,r,t]}function TY(n){return{indexId:n.indexId,collectionGroup:n.collectionGroup,fields:n.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function bY(n,e){let t=e?new Ih(e.sequenceNumber,new ir(Qo(e.readTime),new P(ti(e.documentKey)),e.largestBatchId)):Ih.empty(),r=n.fields.map(([i,s])=>new Wl(at.fromServerFormat(i),s));return new y0(n.indexId,n.collectionGroup,r,t)}function eF(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Ko(r.readTime),documentKey:ln(r.documentKey.path),largestBatchId:r.largestBatchId}}var X0=class{getBundleMetadata(e,t){return tF(e).get(t).next(r=>{if(r)return yY(r)})}saveBundleMetadata(e,t){return tF(e).put(_Y(t))}getNamedQuery(e,t){return nF(e).get(t).next(r=>{if(r)return vY(r)})}saveNamedQuery(e,t){return nF(e).put(EY(t))}};function tF(n){return Nt(n,vy)}function nF(n){return Nt(n,Ey)}var qm=class n{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return ph(e).get(r2(this.userId,t)).next(r=>r?n0(this.serializer,r):null)}getOverlays(e,t){let r=ni();return _.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new Fh(t,o);i.push(this.saveOverlay(e,a))}),_.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(ln(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(ph(e).deleteAll(b0,a))}),_.waitFor(s)}getOverlaysForCollection(e,t,r){let i=ni(),s=ln(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return ph(e).loadAll(b0,o).next(a=>{for(let l of a){let c=n0(this.serializer,l);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=ni(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ph(e).iterate({index:nL,range:a},(l,c,u)=>{let h=n0(this.serializer,c);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):u.done()}).next(()=>s)}saveOverlay(e,t){return ph(e).put(wY(this.serializer,this.userId,t))}};function ph(n){return Nt(n,Sy)}var IY=5,AY=10,DY=13,rF=15,RY=20,NY=25,kY=30,OY=37,xY=45,PY=50,MY=55,FY=60,LY=2,xi=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,IY);else if("booleanValue"in e)this.writeValueTypeLabel(t,AY),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,rF),t.writeNumber(tt(e.integerValue));else if("doubleValue"in e){let r=tt(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,DY):(this.writeValueTypeLabel(t,rF),Nh(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,RY),typeof r=="string"?t.writeString(r):(t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0))}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,kY),t.writeBytes(Ps(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,xY),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?pL(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):B()}writeIndexString(e,t){this.writeValueTypeLabel(t,NY),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,MY);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,PY);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,OY),P.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,FY),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(LY)}};xi.INSTANCE=new xi;var iF="\uD800",sF="\uDBFF",Pl=0,oF=255,aF=1,Ml=255,lF=255,cF=0,BY=64,VY=8,UY=1024;function qY(n){let e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n,!1),new Uint8Array(e.buffer)}function zY(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n=n<<4),n>>6||(e+=2,n=n<<2),n>>7||(e+=1),e}function GY(n){let e=0;for(let t=0;t<8;++t){let r=zY(n[t]&255);if(e+=r,r!==8)break}return e}function uF(n){let e=BY-GY(n);return Math.ceil(e/VY)}var J0=class{constructor(){this.buffer=new Uint8Array(UY),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteAscending(r);else if(r<2048)this.writeByteAscending(960|r>>>6),this.writeByteAscending(128|63&r);else if(t<iF||sF<t)this.writeByteAscending(480|r>>>12),this.writeByteAscending(128|63&r>>>6),this.writeByteAscending(128|63&r);else{let i=t.codePointAt(0);this.writeByteAscending(240|i>>>18),this.writeByteAscending(128|63&i>>>12),this.writeByteAscending(128|63&i>>>6),this.writeByteAscending(128|63&i)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteDescending(r);else if(r<2048)this.writeByteDescending(960|r>>>6),this.writeByteDescending(128|63&r);else if(t<iF||sF<t)this.writeByteDescending(480|r>>>12),this.writeByteDescending(128|63&r>>>6),this.writeByteDescending(128|63&r);else{let i=t.codePointAt(0);this.writeByteDescending(240|i>>>18),this.writeByteDescending(128|63&i>>>12),this.writeByteDescending(128|63&i>>>6),this.writeByteDescending(128|63&i)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=uF(t);this.ensureAvailable(1+r),this.buffer[this.position++]=r&255;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=t[i]&255}writeNumberDescending(e){let t=this.toOrderedBits(e),r=uF(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(r&255);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(t[i]&255)}writeInfinityAscending(){this.writeEscapedByteAscending(Ml),this.writeEscapedByteAscending(lF)}writeInfinityDescending(){this.writeEscapedByteDescending(Ml),this.writeEscapedByteDescending(lF)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=qY(e),r=(t[0]&128)!==0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}writeByteAscending(e){let t=e&255;t===Pl?(this.writeEscapedByteAscending(Pl),this.writeEscapedByteAscending(oF)):t===Ml?(this.writeEscapedByteAscending(Ml),this.writeEscapedByteAscending(cF)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=e&255;t===Pl?(this.writeEscapedByteDescending(Pl),this.writeEscapedByteDescending(oF)):t===Ml?(this.writeEscapedByteDescending(Ml),this.writeEscapedByteDescending(cF)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(Pl),this.writeEscapedByteAscending(aF)}writeSeparatorDescending(){this.writeEscapedByteDescending(Pl),this.writeEscapedByteDescending(aF)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=this.buffer.length*2;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},Z0=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}},eT=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}},Mo=class{constructor(){this.orderedCode=new J0,this.ascending=new Z0(this.orderedCode),this.descending=new eT(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return e===0?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}};var Fo=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}successor(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function bs(n,e){let t=n.indexId-e.indexId;return t!==0||(t=hF(n.arrayValue,e.arrayValue),t!==0)||(t=hF(n.directionalValue,e.directionalValue),t!==0)?t:P.comparator(n.documentKey,e.documentKey)}function hF(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var zm=class{constructor(e){this.inequalityFilters=new De((t,r)=>at.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[];for(let t of e.filters){let r=t;r.isInequality()?this.inequalityFilters=this.inequalityFilters.add(r):this.equalityFilters.push(r)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(q(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=db(e);if(t!==void 0&&!this.hasMatchingEqualityFilter(t))return!1;let r=zo(e),i=new Set,s=0,o=0;for(;s<r.length&&this.hasMatchingEqualityFilter(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!i.has(a.field.canonicalString())){let l=r[s];if(!this.matchesFilter(a,l)||!this.matchesOrderBy(this.orderBys[o++],l))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[o++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new De(at.comparator),t=[];for(let r of this.equalityFilters){if(r.field.isKeyField())continue;if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Wl(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Wl(r.field,0))}}for(let r of this.orderBys)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Wl(r.field,r.dir==="asc"?0:1)));return new y0(y0.UNKNOWN_ID,this.collectionId,t,Ih.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}matchesOrderBy(e,t){return e.field.isEqual(t.fieldPath)?t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc":!1}};function i2(n){var e,t;if(q(n instanceof fe||n instanceof Te),n instanceof fe)if(n instanceof Pm){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>fe.create(n.field,"==",s)))||[];return Te.create(i,"or")}else return n;let r=n.filters.map(i=>i2(i));return Te.create(r,n.op)}function jY(n){if(n.getFilters().length===0)return[];let e=tT(i2(n));return q(s2(e)),Ab(e)||Db(e)?[e]:e.getFilters()}function Ab(n){return n instanceof fe}function Db(n){return n instanceof Te&&Sb(n)}function s2(n){return Ab(n)||Db(n)||WY(n)}function WY(n){if(n instanceof Te&&N0(n)){for(let e of n.getFilters())if(!Ab(e)&&!Db(e))return!1;return!0}return!1}function tT(n){if(q(n instanceof fe||n instanceof Te),n instanceof fe)return n;if(n.filters.length===1)return tT(n.filters[0]);let e=n.filters.map(r=>tT(r)),t=Te.create(e,n.op);return t=Gm(t),s2(t)?t:(q(t instanceof Te),q(Xl(t)),q(t.filters.length>1),t.filters.reduce((r,i)=>Rb(r,i)))}function Rb(n,e){q(n instanceof fe||n instanceof Te),q(e instanceof fe||e instanceof Te);let t;return n instanceof fe?e instanceof fe?t=HY(n,e):t=dF(n,e):e instanceof fe?t=dF(e,n):t=$Y(n,e),Gm(t)}function HY(n,e){return Te.create([n,e],"and")}function $Y(n,e){if(q(n.filters.length>0&&e.filters.length>0),Xl(n)&&Xl(e))return vL(n,e.getFilters());let t=N0(n)?n:e,r=N0(n)?e:n,i=t.filters.map(s=>Rb(s,r));return Te.create(i,"or")}function dF(n,e){if(Xl(e))return vL(e,n.getFilters());{let t=e.filters.map(r=>Rb(n,r));return Te.create(t,"or")}}function Gm(n){if(q(n instanceof fe||n instanceof Te),n instanceof fe)return n;let e=n.getFilters();if(e.length===1)return Gm(e[0]);if(yL(n))return n;let t=e.map(i=>Gm(i)),r=[];return t.forEach(i=>{i instanceof fe?r.push(i):i instanceof Te&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:Te.create(r,n.op)}var nT=class{constructor(){this.collectionParentIndex=new qh}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),_.resolve()}getCollectionParents(e,t){return _.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return _.resolve()}deleteFieldIndex(e,t){return _.resolve()}deleteAllFieldIndexes(e){return _.resolve()}createTargetIndexes(e,t){return _.resolve()}getDocumentsMatchingTarget(e,t){return _.resolve(null)}getIndexType(e,t){return _.resolve(0)}getFieldIndexes(e,t){return _.resolve([])}getNextCollectionGroupToUpdate(e){return _.resolve(null)}getMinOffset(e,t){return _.resolve(ir.min())}getMinOffsetFromCollectionGroup(e,t){return _.resolve(ir.min())}updateCollectionGroup(e,t,r){return _.resolve()}updateIndexEntries(e,t){return _.resolve()}},qh=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new De(ge.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new De(ge.comparator)).toArray()}};var fF="IndexedDbIndexManager",mm=new Uint8Array(0),rT=class{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new qh,this.targetToDnfSubTargets=new oi(r=>Ho(r),(r,i)=>td(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let s={collectionId:r,parent:ln(i)};return pF(e).put(s)}return _.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[GF(t),""],!1,!0);return pF(e).loadAll(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(ti(o.parent))}return r})}addFieldIndex(e,t){let r=gh(e),i=TY(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Ll(e);return s.next(a=>{o.put(eF(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}else return s.next()}deleteFieldIndex(e,t){let r=gh(e),i=Ll(e),s=Fl(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=gh(e),r=Fl(e),i=Ll(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>i.deleteAll())}createTargetIndexes(e,t){return _.forEach(this.getSubTargets(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let o=new zm(r).buildTargetIndex();if(o!=null)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,t){let r=Fl(e),i=!0,s=new Map;return _.forEach(this.getSubTargets(t),o=>this.getFieldIndex(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=ie(),a=[];return _.forEach(s,(l,c)=>{R(fF,`Using index ${i8(l)} to execute ${Ho(t)}`);let u=A7(c,l),h=D7(c,l),d=R7(c,l),f=N7(c,l),g=this.encodeBound(l,c,d),y=this.encodeBound(l,c,f),E=this.encodeValues(l,c,h),I=this.generateIndexRanges(l.indexId,u,g,d.inclusive,y,f.inclusive,E);return _.forEach(I,C=>r.loadFirst(C,t.limit).next(N=>{N.forEach(k=>{let U=P.fromSegments(k.documentKey);o.has(U)||(o=o.add(U),a.push(U))})}))}).next(()=>a)}else return _.resolve(null)})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(e.filters.length===0?t=[e]:t=jY(Te.create(e.filters,"and")).map(i=>V0(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t),t)}generateIndexRanges(e,t,r,i,s,o,a){let l=(t!=null?t.length:1)*Math.max(r.length,s.length),c=l/(t!=null?t.length:1),u=[];for(let h=0;h<l;++h){let d=t?this.encodeSingleElement(t[h/c]):mm,f=this.generateLowerBound(e,d,r[h%c],i),g=this.generateUpperBound(e,d,s[h%c],o),y=a.map(E=>this.generateLowerBound(e,d,E,!0));u.push(...this.createRange(f,g,y))}return u}generateLowerBound(e,t,r,i){let s=new Fo(e,P.empty(),t,r);return i?s:s.successor()}generateUpperBound(e,t,r,i){let s=new Fo(e,P.empty(),t,r);return i?s.successor():s}getFieldIndex(e,t){let r=new zm(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.servedByIndex(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.getSubTargets(t);return _.forEach(i,s=>this.getFieldIndex(e,s).next(o=>{o?r!==0&&o.fields.length<k7(s)&&(r=1):r=0})).next(()=>O7(t)&&i.length>1&&r===2?1:r)}encodeDirectionalElements(e,t){let r=new Mo;for(let i of zo(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.forKind(i.kind);xi.INSTANCE.writeIndexValue(s,o)}return r.encodedBytes()}encodeSingleElement(e){let t=new Mo;return xi.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new Mo;return xi.INSTANCE.writeIndexValue(jo(this.databaseId,t),r.forKind(r8(e))),r.encodedBytes()}encodeValues(e,t,r){if(r===null)return[];let i=[];i.push(new Mo);let s=0;for(let o of zo(e)){let a=r[s++];for(let l of i)if(this.isInFilter(t,o.fieldPath)&&Oh(a))i=this.expandIndexValues(i,o,a);else{let c=l.forKind(o.kind);xi.INSTANCE.writeIndexValue(a,c)}}return this.getEncodedBytes(i)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let l=new Mo;l.seed(a.encodedBytes()),xi.INSTANCE.writeIndexValue(o,l.forKind(t.kind)),s.push(l)}return s}isInFilter(e,t){return!!e.filters.find(r=>r instanceof fe&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=gh(e),i=Ll(e);return(t?r.loadAll(T0,IDBKeyRange.bound(t,t)):r.loadAll()).next(s=>{let o=[];return _.forEach(s,a=>i.get([a.indexId,this.uid]).next(l=>{o.push(bY(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:ne(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=gh(e),s=Ll(e);return this.getNextSequenceNumber(e).next(o=>i.loadAll(T0,IDBKeyRange.bound(t,t)).next(a=>_.forEach(a,l=>s.put(eF(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return _.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?_.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(r.set(i.collectionGroup,l),_.forEach(l,c=>this.getExistingIndexEntries(e,i,c).next(u=>{let h=this.computeIndexEntries(s,c);return u.isEqual(h)?_.resolve():this.updateEntries(e,s,c,u,h)}))))})}addIndexEntry(e,t,r,i){return Fl(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(r,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,r,i){return Fl(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.encodeDirectionalKey(r,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,r){let i=Fl(e),s=new De(bs);return i.iterate({index:tL,range:IDBKeyRange.only([r.indexId,this.uid,this.encodeDirectionalKey(r,t)])},(o,a)=>{s=s.add(new Fo(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}computeIndexEntries(e,t){let r=new De(bs),i=this.encodeDirectionalElements(t,e);if(i==null)return r;let s=db(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Oh(o))for(let a of o.arrayValue.values||[])r=r.add(new Fo(t.indexId,e.key,this.encodeSingleElement(a),i))}else r=r.add(new Fo(t.indexId,e.key,mm,i));return r}updateEntries(e,t,r,i,s){R(fF,"Updating index entries for document '%s'",t.key);let o=[];return q8(i,s,bs,a=>{o.push(this.addIndexEntry(e,t,r,a))},a=>{o.push(this.deleteIndexEntry(e,t,r,a))}),_.waitFor(o)}getNextSequenceNumber(e){let t=1;return Ll(e).iterate({index:eL,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,s,o)=>{o.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>bs(o,a)).filter((o,a,l)=>!a||bs(o,l[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=bs(o,e),l=bs(o,t);if(a===0)i[0]=e.successor();else if(a>0&&l<0)i.push(o),i.push(o.successor());else if(l>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.isRangeMatchable(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,mm,[]],l=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,mm,[]];s.push(IDBKeyRange.bound(a,l))}return s}isRangeMatchable(e,t){return bs(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(gF)}getMinOffset(e,t){return _.mapArray(this.getSubTargets(t),r=>this.getFieldIndex(e,r).next(i=>i||B())).next(gF)}};function pF(n){return Nt(n,Ah)}function Fl(n){return Nt(n,_b)}function gh(n){return Nt(n,mb)}function Ll(n){return Nt(n,yb)}function gF(n){q(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;fb(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new ir(e.readTime,e.documentKey,t)}function o2(n,e,t){let r=n.store(Er),i=n.store(dc),s=[],o=IDBKeyRange.only(t.batchId),a=0,l=r.iterate({range:o},(u,h,d)=>(a++,d.delete()));s.push(l.next(()=>{q(a===1)}));let c=[];for(let u of t.mutations){let h=XF(e,u.key.path,t.batchId);s.push(i.delete(h)),c.push(u.key)}return _.waitFor(s).next(()=>c)}function jm(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else if(n.noDocument)e=n.noDocument;else throw B();return JSON.stringify(e).length}var Wm=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.documentKeysByBatchId={}}static forUser(e,t,r,i){q(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Is(e).iterate({index:Lo,range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=zl(e),o=Is(e);return o.add({}).next(a=>{q(typeof a=="number");let l=new Mh(a,t,r,i),c=gY(this.serializer,this.userId,l),u=[],h=new De((d,f)=>ne(d.canonicalString(),f.canonicalString()));for(let d of i){let f=XF(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),u.push(o.put(c)),u.push(s.put(f,d8))}return h.forEach(d=>{u.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=l.keys()}),_.waitFor(u).next(()=>l)})}lookupMutationBatch(e,t){return Is(e).get(t).next(r=>r?(q(r.userId===this.userId),Po(this.serializer,r)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?_.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.documentKeysByBatchId[t]=i,i}else return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return Is(e).iterate({index:Lo,range:i},(o,a,l)=>{a.userId===this.userId&&(q(a.batchId>=r),s=Po(this.serializer,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=ks;return Is(e).iterate({index:Lo,range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,ks],[this.userId,Number.POSITIVE_INFINITY]);return Is(e).loadAll(Lo,t).next(r=>r.map(i=>Po(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Em(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return zl(e).iterate({range:i},(o,a,l)=>{let[c,u,h]=o,d=ti(u);if(c!==this.userId||!t.path.isEqual(d)){l.done();return}return Is(e).get(h).next(f=>{if(!f)throw B();q(f.userId===this.userId),s.push(Po(this.serializer,f))})}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new De(ne),i=[];return t.forEach(s=>{let o=Em(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=zl(e).iterate({range:a},(c,u,h)=>{let[d,f,g]=c,y=ti(f);if(d!==this.userId||!s.path.isEqual(y)){h.done();return}r=r.add(g)});i.push(l)}),_.waitFor(i).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Em(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new De(ne);return zl(e).iterate({range:o},(l,c,u)=>{let[h,d,f]=l,g=ti(d);if(h!==this.userId||!r.isPrefixOf(g)){u.done();return}g.length===i&&(a=a.add(f))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],i=[];return t.forEach(s=>{i.push(Is(e).get(s).next(o=>{if(o===null)throw B();q(o.userId===this.userId),r.push(Po(this.serializer,o))}))}),_.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return o2(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),_.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return _.resolve();let r=IDBKeyRange.lowerBound(h8(this.userId)),i=[];return zl(e).iterate({range:r},(s,o,a)=>{if(s[0]!==this.userId){a.done();return}else{let c=ti(s[1]);i.push(c)}}).next(()=>{q(i.length===0)})})}containsKey(e,t){return a2(e,this.userId,t)}getMutationQueueMetadata(e){return l2(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:ks,lastStreamToken:""})}};function a2(n,e,t){let r=Em(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return zl(n).iterate({range:s,keysOnly:!0},(a,l,c)=>{let[u,h,d]=a;u===e&&h===i&&(o=!0),c.done()}).next(()=>o)}function KY(n,e){let t=!1;return l2(n).iterateSerial(r=>a2(n,r,e).next(i=>(i&&(t=!0),_.resolve(!i)))).next(()=>t)}function Is(n){return Nt(n,Er)}function zl(n){return Nt(n,dc)}function l2(n){return Nt(n,Jh)}var r0=2,rc=class n{constructor(e){this.lastId=e}next(){return this.lastId+=r0,this.lastId}static forTargetCache(){return new n(2-r0)}static forSyncEngine(){return new n(1-r0)}};var iT=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new rc(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(t=>H.fromTimestamp(new $e(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.saveMetadata(e,i)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Bl(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(r=>(q(r.targetCount>0),r.targetCount-=1,this.saveMetadata(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Bl(e).iterate((o,a)=>{let l=vh(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>_.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Bl(e).iterate((r,i)=>{let s=vh(i);t(s)})}retrieveMetadata(e){return mF(e).get(km).next(t=>(q(t!==null),t))}saveMetadata(e,t){return mF(e).put(km,t)}saveTargetData(e,t){return Bl(e).put(n2(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Ho(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Bl(e).iterate({range:i,index:ZF},(o,a,l)=>{let c=vh(a);td(t,c.target)&&(s=c,l.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=Ds(e);return t.forEach(o=>{let a=ln(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),_.waitFor(i)}removeMatchingKeys(e,t,r){let i=Ds(e);return _.forEach(t,s=>{let o=ln(s.path);return _.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=Ds(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Ds(e),s=ie();return i.iterate({range:r,keysOnly:!0},(o,a,l)=>{let c=ti(o[1]),u=new P(c);s=s.add(u)}).next(()=>s)}containsKey(e,t){let r=ln(t.path),i=IDBKeyRange.bound([r],[GF(r)],!1,!0),s=0;return Ds(e).iterate({index:gb,keysOnly:!0,range:i},([o,a],l,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}getTargetDataForTarget(e,t){return Bl(e).get(t).next(r=>r?vh(r):null)}};function Bl(n){return Nt(n,fc)}function mF(n){return Nt(n,ta)}function Ds(n){return Nt(n,pc)}var yF={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},id=-1,c2=40*1024*1024,nr=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};nr.DEFAULT_COLLECTION_PERCENTILE=10;nr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;nr.DEFAULT=new nr(c2,nr.DEFAULT_COLLECTION_PERCENTILE,nr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);nr.DISABLED=new nr(id,0,0);var _F="LruGarbageCollector",vF=1*1024*1024,QY=1*60*1e3,YY=5*60*1e3;function EF([n,e],[t,r]){let i=ne(n,t);return i===0?ne(e,r):i}var sT=class{constructor(e){this.maxElements=e,this.buffer=new De(EF),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();EF(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},oT=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==id&&this.scheduleGC(QY)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){R(_F,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>m(this,null,function*(){this.gcTask=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){js(t)?R(_F,"Ignoring IndexedDB error during garbage collection: ",t):yield Gs(t)}yield this.scheduleGC(YY)}))}},aT=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return _.resolve(kn.INVALID);let r=new sT(t);return this.delegate.forEachTarget(e,i=>r.addElement(i.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,i=>r.addElement(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===id?(R("LruGarbageCollector","Garbage collection skipped; disabled"),_.resolve(yF)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(R("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),yF):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,i,s,o,a,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(R("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(e,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(s=h,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>{if(c=Date.now(),Vl()<=zn.DEBUG){let d=`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${i} in ${a-o}ms
	Removed ${s} targets in ${l-a}ms
	Removed ${h} documents in ${c-l}ms
Total Duration: ${c-u}ms`;R("LruGarbageCollector",d)}return _.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})})}};function XY(n,e){return new aT(n,e)}var lT=class{constructor(e,t){this.db=e,this.garbageCollector=XY(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(r,i)=>t(i))}addReference(e,t,r){return ym(e,r)}removeReference(e,t,r){return ym(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return ym(e,t)}isPinned(e,t){return KY(e,t)}removeOrphanedDocuments(e,t){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],o=0;return this.forEachOrphanedDocument(e,(l,c)=>{if(c<=t){let u=this.isPinned(e,l).next(h=>{if(!h)return o++,i.getEntry(e,l).next(()=>(i.removeEntry(l,H.min()),Ds(e).delete(JY(l))))});s.push(u)}}).next(()=>_.waitFor(s)).next(()=>i.apply(e)).next(()=>o)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return ym(e,t)}forEachOrphanedDocument(e,t){let r=Ds(e),i=kn.INVALID,s;return r.iterate({index:gb},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==kn.INVALID&&t(new P(ti(s)),i),i=c,s=l):i=kn.INVALID}).next(()=>{i!==kn.INVALID&&t(new P(ti(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function JY(n){return[0,ln(n.path)]}function ZY(n,e){return{targetId:0,path:ln(n.path),sequenceNumber:e}}function ym(n,e){return Ds(n).put(ZY(e,n.currentSequenceNumber))}var Hm=class{constructor(){this.changes=new oi(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ft.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?_.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var cT=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return ko(e).put(r)}removeEntry(e,t,r){return ko(e).delete(eX(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=ft.newInvalidDocument(t);return ko(e).iterate({index:Sm,range:IDBKeyRange.only(mh(t))},(i,s)=>{r=this.maybeDecodeDocument(t,s)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:ft.newInvalidDocument(t)};return ko(e).iterate({index:Sm,range:IDBKeyRange.only(mh(t))},(i,s)=>{r={document:this.maybeDecodeDocument(t,s),size:jm(s)}}).next(()=>r)}getEntries(e,t){let r=Sn();return this.forEachDbEntry(e,t,(i,s)=>{let o=this.maybeDecodeDocument(i,s);r=r.insert(i,o)}).next(()=>r)}getSizedEntries(e,t){let r=Sn(),i=new Be(P.comparator);return this.forEachDbEntry(e,t,(s,o)=>{let a=this.maybeDecodeDocument(s,o);r=r.insert(s,a),i=i.insert(s,jm(o))}).next(()=>({documents:r,sizeMap:i}))}forEachDbEntry(e,t,r){if(t.isEmpty())return _.resolve();let i=new De(wF);t.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(mh(i.first()),mh(i.last())),o=i.getIterator(),a=o.getNext();return ko(e).iterate({index:Sm,range:s},(l,c,u)=>{let h=P.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&wF(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?u.skip(mh(a)):u.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),by(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ko(e).loadAll(IDBKeyRange.bound(a,l,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let u=Sn();for(let h of c){let d=this.maybeDecodeDocument(P.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(rd(t,d)||i.has(d.key))&&(u=u.insert(d.key,d))}return u})}getAllFromCollectionGroup(e,t,r,i){let s=Sn(),o=CF(t,r),a=CF(t,ir.max());return ko(e).iterate({index:JF,range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{let h=this.maybeDecodeDocument(P.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(h.key,h),s.size===i&&u.done()}).next(()=>s)}newChangeBuffer(e){return new uT(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return SF(e).get(w0).next(t=>(q(!!t),t))}setMetadata(e,t){return SF(e).put(w0,t)}maybeDecodeDocument(e,t){if(t){let r=fY(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(H.min())))return r}return ft.newInvalidDocument(e)}};function u2(n){return new cT(n)}var uT=class extends Hm{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new oi(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new De((s,o)=>ne(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.documentStates.get(s);if(t.push(this.documentCache.removeEntry(e,s,a.readTime)),o.isValidDocument()){let l=ZM(this.documentCache.serializer,o);i=i.add(s.path.popLast());let c=jm(l);r+=c-a.size,t.push(this.documentCache.addEntry(e,s,l))}else if(r-=a.size,this.trackRemovals){let l=ZM(this.documentCache.serializer,o.convertToNoDocument(H.min()));t.push(this.documentCache.addEntry(e,s,l))}}),i.forEach(s=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.documentCache.updateMetadata(e,r)),_.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(r=>(this.documentStates.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:r,sizeMap:i})=>(i.forEach((s,o)=>{this.documentStates.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function SF(n){return Nt(n,Zh)}function ko(n){return Nt(n,_y)}function mh(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function eX(n,e){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],by(e),t[t.length-1]]}function CF(n,e){let t=e.documentKey.path.toArray();return[n,by(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function wF(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=ne(t[s],r[s]),i)return i;return i=ne(t.length,r.length),i||(i=ne(t[t.length-2],r[r.length-2]),i)?i:ne(t[t.length-1],r[r.length-1])}var tX=15;var hT=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var $m=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&wh(r.mutation,i,On.empty(),$e.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ie()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ie()){let i=ni();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=_h();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=ni();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ie()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Sn(),o=xh(),a=$7();return t.forEach((l,c)=>{let u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof wr)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),wh(u.mutation,c,u.mutation.getFieldMask(),$e.now())):o.set(c.key,On.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var h;return a.set(c,new hT(u,(h=o.get(c))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,t){let r=xh(),i=new Be((o,a)=>o-a),s=ie();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=r.get(l)||On.empty();u=a.applyToLocalView(c,u),r.set(l,u);let h=(i.get(a.batchId)||ie()).add(l);i=i.insert(a.batchId,h)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,u=l.value,h=NL();u.forEach(d=>{if(!s.has(d)){let f=BL(t.get(d),r.get(d));f!==null&&h.set(d,f),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return _.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return F7(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Cb(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):_.resolve(ni()),a=Kl,l=s;return o.next(c=>_.forEach(c,(u,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(u)?_.resolve():this.remoteDocumentCache.getEntry(e,u).next(d=>{l=l.insert(u,d)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,ie())).next(u=>({batchId:a,changes:RL(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new P(t)).next(r=>{let i=_h();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=_h();return this.indexManager.getCollectionParents(e,s).next(a=>_.forEach(a,l=>{let c=x7(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,c)=>{let u=c.getKey();o.get(u)===null&&(o=o.insert(u,ft.newInvalidDocument(u)))});let a=_h();return o.forEach((l,c)=>{let u=s.get(l);u!==void 0&&wh(u.mutation,c,On.empty(),$e.now()),rd(t,c)&&(a=a.insert(l,c))}),a})}};var dT=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return _.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,CY(t)),_.resolve()}getNamedQuery(e,t){return _.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,SY(t)),_.resolve()}};var fT=class{constructor(){this.overlays=new Be(P.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return _.resolve(this.overlays.get(t))}getOverlays(e,t){let r=ni();return _.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),_.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),_.resolve()}getOverlaysForCollection(e,t,r){let i=ni(),s=t.length+1,o=new P(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return _.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Be((c,u)=>c-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let d=s.get(u.largestBatchId);d===null&&(d=ni(),s=s.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}let a=ni(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((h,d)=>a.set(h,d)),!(a.size()>=i)););return _.resolve(a)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Fh(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=ie(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};var zh=class{constructor(){this.refsByKey=new De(dt.compareByKey),this.refsByTarget=new De(dt.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new dt(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new dt(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new P(new ge([])),r=new dt(t,e),i=new dt(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new P(new ge([])),r=new dt(t,e),i=new dt(t,e+1),s=ie();return this.refsByTarget.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new dt(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},dt=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return P.comparator(e.key,t.key)||ne(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return ne(e.targetOrBatchId,t.targetOrBatchId)||P.comparator(e.key,t.key)}};var pT=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new De(dt.compareByKey)}checkEmpty(e){return _.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Mh(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new dt(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return _.resolve(o)}lookupMutationBatch(e,t){return _.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return _.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return _.resolve(this.mutationQueue.length===0?ks:this.nextBatchId-1)}getAllMutationBatches(e){return _.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new dt(t,0),i=new dt(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),_.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new De(ne);return t.forEach(i=>{let s=new dt(i,0),o=new dt(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{r=r.add(a.targetOrBatchId)})}),_.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;P.isDocumentKey(s)||(s=s.child(""));let o=new dt(new P(s),0),a=new De(ne);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return r.isPrefixOf(c)?(c.length===i&&(a=a.add(l.targetOrBatchId)),!0):!1},o),_.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");q(r===0),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return _.forEach(t.mutations,s=>{let o=new dt(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new dt(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return _.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,_.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function nX(){return new Be(P.comparator)}var gT=class{constructor(e){this.sizer=e,this.docs=nX(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return _.resolve(r?r.document.mutableCopy():ft.newInvalidDocument(t))}getEntries(e,t){let r=Sn();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():ft.newInvalidDocument(i))}),_.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Sn(),o=t.path,a=new P(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||fb(WF(u),r)<=0||!i.has(u.key)&&!rd(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return _.resolve(s)}getAllFromCollectionGroup(e,t,r,i){B()}forEachDocumentKey(e,t){return _.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new mT(this)}getSize(e){return _.resolve(this.size)}};function rX(n){return new gT(n)}var mT=class extends Hm{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),_.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var yT=class{constructor(e){this.persistence=e,this.targets=new oi(t=>Ho(t),td),this.lastRemoteSnapshotVersion=H.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new zh,this.targetCount=0,this.targetIdGenerator=rc.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),_.resolve()}getLastRemoteSnapshotVersion(e){return _.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return _.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),_.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),_.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new rc(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,_.resolve()}updateTargetData(e,t){return this.saveTargetData(t),_.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,_.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),_.waitFor(s).next(()=>i)}getTargetCount(e){return _.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return _.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),_.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),_.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),_.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return _.resolve(r)}containsKey(e,t){return _.resolve(this.references.containsKey(t))}};var iX="MemoryPersistence",Km=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new kn(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new yT(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new nT,this.remoteDocumentCache=rX(r),this.serializer=new Um(t),this.bundleCache=new dT(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new fT,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new pT(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){R(iX,"Starting transaction:",e);let i=new _T(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return _.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},_T=class extends Rm{constructor(e){super(),this.currentSequenceNumber=e}},Qm=class n{constructor(e){this.persistence=e,this.localViewReferences=new zh,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw B()}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),_.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),_.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),_.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return _.forEach(this.orphanedDocuments,i=>{let s=P.fromPath(i);return this.isReferenced(e,s).next(o=>{o||r.removeEntry(s,H.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return _.or([()=>_.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var vT=class{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,i){let s=new Nm("createOrUpgrade",t);r<1&&i>=1&&(oX(e),aX(e),TF(e),cX(e));let o=_.resolve();return r<3&&i>=3&&(r!==0&&(dX(e),TF(e)),o=o.next(()=>pX(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>lX(e,s))),o=o.next(()=>{gX(e)})),r<5&&i>=5&&(o=o.next(()=>this.removeAcknowledgedMutations(s))),r<6&&i>=6&&(o=o.next(()=>(hX(e),this.addDocumentGlobal(s)))),r<7&&i>=7&&(o=o.next(()=>this.ensureSequenceNumbers(s))),r<8&&i>=8&&(o=o.next(()=>this.createCollectionParentIndex(e,s))),r<9&&i>=9&&(o=o.next(()=>{fX(e)})),r<10&&i>=10&&(o=o.next(()=>this.rewriteCanonicalIds(s))),r<11&&i>=11&&(o=o.next(()=>{mX(e),yX(e)})),r<12&&i>=12&&(o=o.next(()=>{vX(e)})),r<13&&i>=13&&(o=o.next(()=>uX(e)).next(()=>this.rewriteRemoteDocumentCache(e,s)).next(()=>e.deleteObjectStore(xo))),r<14&&i>=14&&(o=o.next(()=>this.runOverlayMigration(e,s))),r<15&&i>=15&&(o=o.next(()=>_X(e))),o}addDocumentGlobal(e){let t=0;return e.store(xo).iterate((r,i)=>{t+=jm(i)}).next(()=>{let r={byteSize:t};return e.store(Zh).put(w0,r)})}removeAcknowledgedMutations(e){let t=e.store(Jh),r=e.store(Er);return t.loadAll().next(i=>_.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,ks],[s.userId,s.lastAcknowledgedBatchId]);return r.loadAll(Lo,o).next(a=>_.forEach(a,l=>{q(l.userId===s.userId);let c=Po(this.serializer,l);return o2(e,s.userId,c).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(pc),r=e.store(xo);return e.store(ta).get(km).next(s=>{let o=l=>t.put({targetId:0,path:ln(l),sequenceNumber:s.highestListenSequenceNumber}),a=[];return r.iterate((l,c)=>{let u=new ge(l),h=sX(u);a.push(t.get(h).next(d=>d?_.resolve():o(u)))}).next(()=>_.waitFor(a))})}createCollectionParentIndex(e,t){e.createObjectStore(Ah,{keyPath:E8});let r=t.store(Ah),i=new qh,s=o=>{if(i.add(o)){let a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:ln(l)})}};return t.store(xo).iterate({keysOnly:!0},(o,a)=>{let l=new ge(o);return s(l.popLast())}).next(()=>t.store(dc).iterate({keysOnly:!0},([o,a,l],c)=>{let u=ti(a);return s(u.popLast())}))}rewriteCanonicalIds(e){let t=e.store(fc);return t.iterate((r,i)=>{let s=vh(i),o=n2(this.serializer,s);return t.put(o)})}rewriteRemoteDocumentCache(e,t){let r=t.store(xo),i=[];return r.iterate((s,o)=>{let a=t.store(_y),l=EX(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>_.waitFor(i))}runOverlayMigration(e,t){let r=t.store(Er),i=u2(this.serializer),s=new Km(Qm.factory,this.serializer.remoteSerializer);return r.loadAll().next(o=>{let a=new Map;return o.forEach(l=>{var c;let u=(c=a.get(l.userId))!==null&&c!==void 0?c:ie();Po(this.serializer,l).keys().forEach(d=>u=u.add(d)),a.set(l.userId,u)}),_.forEach(a,(l,c)=>{let u=new pt(c),h=qm.forUser(this.serializer,u),d=s.getIndexManager(u),f=Wm.forUser(u,this.serializer,d,s.referenceDelegate);return new $m(i,f,h,d).recalculateAndSaveOverlaysForDocumentKeys(new Dh(t,kn.INVALID),l).next()})})}};function sX(n){return[0,ln(n)]}function oX(n){n.createObjectStore(Xh)}function aX(n){n.createObjectStore(Jh,{keyPath:u8}),n.createObjectStore(Er,{keyPath:QF,autoIncrement:!0}).createIndex(Lo,YF,{unique:!0}),n.createObjectStore(dc)}function lX(n,e){return e.store(Er).loadAll().next(r=>{n.deleteObjectStore(Er),n.createObjectStore(Er,{keyPath:QF,autoIncrement:!0}).createIndex(Lo,YF,{unique:!0});let s=e.store(Er),o=r.map(a=>s.put(a));return _.waitFor(o)})}function cX(n){n.createObjectStore(xo)}function uX(n){let e=n.createObjectStore(_y,{keyPath:f8});e.createIndex(Sm,p8),e.createIndex(JF,g8)}function hX(n){n.createObjectStore(Zh)}function TF(n){n.createObjectStore(pc,{keyPath:_8}).createIndex(gb,v8,{unique:!0}),n.createObjectStore(fc,{keyPath:m8}).createIndex(ZF,y8,{unique:!0}),n.createObjectStore(ta)}function dX(n){n.deleteObjectStore(pc),n.deleteObjectStore(fc),n.deleteObjectStore(ta)}function fX(n){n.objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges")}function pX(n){let e=n.store(ta),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:H.min().toTimestamp(),targetCount:0};return e.put(km,t)}function gX(n){n.createObjectStore(Ql,{keyPath:S8})}function mX(n){n.createObjectStore(vy,{keyPath:C8})}function yX(n){n.createObjectStore(Ey,{keyPath:w8})}function _X(n){n.createObjectStore(mb,{keyPath:T8,autoIncrement:!0}).createIndex(T0,b8,{unique:!1}),n.createObjectStore(yb,{keyPath:I8}).createIndex(eL,A8,{unique:!1}),n.createObjectStore(_b,{keyPath:D8}).createIndex(tL,R8,{unique:!1})}function vX(n){let e=n.createObjectStore(Sy,{keyPath:N8});e.createIndex(b0,k8,{unique:!1}),e.createIndex(nL,O8,{unique:!1})}function EX(n){return n.document?new P(ge.fromString(n.document.name).popFirst(5)):n.noDocument?P.fromSegments(n.noDocument.path):n.unknownDocument?P.fromSegments(n.unknownDocument.path):B()}var As="IndexedDbPersistence",i0=30*60*1e3,s0=5e3,SX=4e3,o0="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",CX="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",wX="firestore_zombie",h2="main",ET=class n{constructor(e,t,r,i,s,o,a,l,c,u,h=tX){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=s,this.window=o,this.document=a,this.sequenceNumberSyncer=c,this.forceOwningTab=u,this.schemaVersion=h,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=d=>Promise.resolve(),!n.isAvailable())throw new w(S.UNIMPLEMENTED,CX);this.referenceDelegate=new lT(this,i),this.dbName=t+h2,this.serializer=new Um(l),this.simpleDb=new Pi(this.dbName,this.schemaVersion,new vT(this.serializer)),this.targetCache=new iT(this.referenceDelegate,this.serializer),this.remoteDocumentCache=u2(this.serializer),this.bundleCache=new X0,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,u===!1&&He(As,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new w(S.FAILED_PRECONDITION,o0);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new kn(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=t=>m(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(t=>m(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(()=>m(this,null,function*(){this.started&&(yield this.updateClientMetadataAndTryBecomePrimary())})))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>_m(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(r=>{r||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(r=>this.isPrimary&&!r?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):r?this.acquireOrExtendPrimaryLease(e).next(()=>!0):!1)).catch(e=>{if(js(e))return R(As,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return R(As,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return yh(e).get(Ol).next(r=>_.resolve(this.isLocalClient(r)))}removeClientMetadata(e){return _m(e).delete(this.clientId)}maybeGarbageCollectMultiClientState(){return m(this,null,function*(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,i0)){this.lastGarbageCollectionTime=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=Nt(t,Ql);return r.loadAll().next(i=>{let s=this.filterActiveClients(i,i0),o=i.filter(a=>s.indexOf(a)===-1);return _.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}})}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",SX,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return e?e.ownerId===this.clientId:!1}canActAsPrimary(e){return this.forceOwningTab?_.resolve(!0):yh(e).get(Ol).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,s0)&&!this.isClientZombied(r.ownerId)){if(this.isLocalClient(r)&&this.networkEnabled)return!0;if(!this.isLocalClient(r)){if(!r.allowTabSynchronization)throw new w(S.FAILED_PRECONDITION,o0);return!1}}return this.networkEnabled&&this.inForeground?!0:_m(e).loadAll().next(s=>this.filterActiveClients(s,s0).find(a=>{if(this.clientId!==a.clientId){let l=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,u=this.networkEnabled===a.networkEnabled;if(l||c&&u)return!0}return!1})===void 0)}).next(r=>(this.isPrimary!==r&&R(As,`Client ${r?"is":"is not"} eligible for a primary lease.`),r))}shutdown(){return m(this,null,function*(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),yield this.simpleDb.runTransaction("shutdown","readwrite",[Xh,Ql],e=>{let t=new Dh(e,kn.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()})}filterActiveClients(e,t){return e.filter(r=>this.isWithinAge(r.updateTimeMs,t)&&!this.isClientZombied(r.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>_m(e).loadAll().next(t=>this.filterActiveClients(t,i0).map(r=>r.clientId)))}get started(){return this._started}getMutationQueue(e,t){return Wm.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new rT(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return qm.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){R(As,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=U8(this.schemaVersion),o;return this.simpleDb.runTransaction(e,i,s,a=>(o=new Dh(a,this.listenSequence?this.listenSequence.next():kn.INVALID),t==="readwrite-primary"?this.verifyPrimaryLease(o).next(l=>l?!0:this.canActAsPrimary(o)).next(l=>{if(!l)throw He(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new w(S.FAILED_PRECONDITION,HF);return r(o)}).next(l=>this.acquireOrExtendPrimaryLease(o).next(()=>l)):this.verifyAllowTabSynchronization(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(e){return yh(e).get(Ol).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,s0)&&!this.isClientZombied(r.ownerId)&&!this.isLocalClient(r)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!r.allowTabSynchronization))throw new w(S.FAILED_PRECONDITION,o0)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return yh(e).put(Ol,t)}static isAvailable(){return Pi.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=yh(e);return t.get(Ol).next(r=>this.isLocalClient(r)?(R(As,"Releasing primary lease."),t.delete(Ol)):_.resolve())}isWithinAge(e,t){let r=Date.now(),i=r-t,s=r;return e<i?!1:e>s?(He(`Detected an update time that is in the future: ${e} > ${s}`),!1):!0}attachVisibilityHandler(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground=this.document.visibilityState==="visible")}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.windowUnloadHandler=()=>{this.markClientZombied();let t=/(?:Version|Mobile)\/1[456]/;bv()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let r=((t=this.webStorage)===null||t===void 0?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return R(As,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return He(As,"Failed to get zombied client id.",r),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){He("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch{}}zombiedClientLocalStorageKey(e){return`${wX}_${this.persistenceKey}_${e}`}};function yh(n){return Nt(n,Xh)}function _m(n){return Nt(n,Ql)}function Nb(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}function TX(n){return m(this,null,function*(){if(!Pi.isAvailable())return Promise.resolve();let e=n+h2;yield Pi.delete(e)})}var kb="LocalStore",bX=5*60*1e6,Gh=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new Be(ne),this.targetIdByTarget=new oi(s=>Ho(s),td),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new $m(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function d2(n,e,t,r){return new Gh(n,e,t,r)}function f2(n,e){return m(this,null,function*(){let t=M(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{let a=[],l=[],c=ie();for(let u of s){a.push(u.batchId);for(let h of u.mutations)c=c.add(h.key)}for(let u of o){l.push(u.batchId);for(let h of u.mutations)c=c.add(h.key)}return t.localDocuments.getDocuments(i,c).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:l}))})})})}function IX(n,e){let t=M(n),r=$e.now(),i=e.reduce((a,l)=>a.add(l.key),ie()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let l=Sn(),c=ie();return t.remoteDocuments.getEntries(a,i).next(u=>{l=u,l.forEach((h,d)=>{d.isValidDocument()||(c=c.add(h))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,l)).next(u=>{s=u;let h=[];for(let d of e){let f=sQ(d,s.get(d.key).overlayedDocument);f!=null&&h.push(new wr(d.key,f,gL(f.value.mapValue),et.exists(!0)))}return t.mutationQueue.addMutationBatch(a,r,h,e)}).next(u=>{o=u;let h=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(a,u.batchId,h)})}).then(()=>({batchId:o.batchId,changes:RL(s)}))}function AX(n,e){let t=M(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return LX(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,DX(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function DX(n){let e=ie();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function RX(n,e){let t=M(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",r=>{let i;return t.mutationQueue.lookupMutationBatch(r,e).next(s=>(q(s!==null),i=s.keys(),t.mutationQueue.removeMutationBatch(r,s))).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,i)).next(()=>t.localDocuments.getDocuments(r,i))})}function NX(n){let e=M(n);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t))}function p2(n){let e=M(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function kX(n,e){let t=M(n),r=e.snapshotVersion,i=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=t.targetDataByTarget;let a=[];e.targetChanges.forEach((u,h)=>{let d=i.get(h);if(!d)return;a.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,h).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,h)));let f=d.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(h)!==null?f=f.withResumeToken(Rt.EMPTY_BYTE_STRING,H.min()).withLastLimboFreeSnapshotVersion(H.min()):u.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(u.resumeToken,r)),i=i.insert(h,f),OX(d,f,u)&&a.push(t.targetCache.updateTargetData(s,f))});let l=Sn(),c=ie();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(g2(s,o,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!r.isEqual(H.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(h=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return _.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=i,s))}function g2(n,e,t){let r=ie(),i=ie();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Sn();return t.forEach((a,l)=>{let c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(H.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):R(kb,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:o,existenceChangedKeys:i}})}function OX(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=bX?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function xX(n,e){return m(this,null,function*(){let t=M(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>_.forEach(e,i=>_.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>_.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if(js(r))R(kb,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(i,a)}}})}function PX(n,e){let t=M(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=ks),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function MX(n,e){let t=M(n);return t.persistence.runTransaction("read document","readonly",r=>t.localDocuments.getDocument(r,e))}function ic(n,e){let t=M(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.targetCache.getTargetData(r,e).next(s=>s?(i=s,_.resolve(i)):t.targetCache.allocateTargetId(r).next(o=>(i=new nc(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.targetCache.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.targetDataByTarget.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(r.targetId,r),t.targetIdByTarget.set(e,r.targetId)),r})}function FX(n,e,t){let r=M(n),i=r.targetIdByTarget.get(t);return i!==void 0?_.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(e,t)}function sc(n,e,t){return m(this,null,function*(){let r=M(n),i=r.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(js(o))R(kb,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}r.targetDataByTarget=r.targetDataByTarget.remove(e),r.targetIdByTarget.delete(i.target)})}function Iy(n,e,t){let r=M(n),i=H.min(),s=ie();return r.persistence.runTransaction("Execute query","readwrite",o=>FX(r,o,cn(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(o,e,t?i:H.min(),t?s:ie())).next(a=>(_2(r,IL(e),a),{documents:a,remoteKeys:s})))}function LX(n,e,t,r){let i=t.batch,s=i.keys(),o=_.resolve();return s.forEach(a=>{o=o.next(()=>r.getEntry(e,a)).next(l=>{let c=t.docVersions.get(a);q(c!==null),l.version.compareTo(c)<0&&(i.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),r.addEntry(l)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,i))}function BX(n,e){let t=M(n),r=M(t.mutationQueue);return t.persistence.runTransaction("Lookup mutation documents","readonly",i=>r.lookupMutationKeys(i,e).next(s=>s?t.localDocuments.getDocuments(i,s):_.resolve(null)))}function VX(n,e){M(M(n,Gh).mutationQueue).removeCachedMutationKeys(e)}function UX(n){return M(M(n,Gh).persistence).getActiveClients()}function m2(n,e){let t=M(n),r=M(t.targetCache),i=t.targetDataByTarget.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.getTargetDataForTarget(s,e).next(o=>o?o.target:null))}function y2(n,e){let t=M(n),r=t.collectionGroupReadTime.get(e)||H.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.remoteDocuments.getAllFromCollectionGroup(i,e,jF(r,Kl),Number.MAX_SAFE_INTEGER)).then(i=>(_2(t,e,i),i))}function _2(n,e,t){let r=n.collectionGroupReadTime.get(e)||H.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.collectionGroupReadTime.set(e,r)}function qX(n){return cn(gc(ge.fromString(`__bundle__/docs/${n}`)))}function zX(n,e,t,r){return m(this,null,function*(){let i=M(n),s=ie(),o=Sn();for(let c of t){let u=e.toDocumentKey(c.metadata.name);c.document&&(s=s.add(u));let h=e.toMutableDocument(c);h.setReadTime(e.toSnapshotVersion(c.metadata.readTime)),o=o.insert(u,h)}let a=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=yield ic(i,qX(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>g2(c,a,o).next(u=>(a.apply(c),u)).next(u=>i.targetCache.removeMatchingKeysForTargetId(c,l.targetId).next(()=>i.targetCache.addMatchingKeys(c,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,u.changedDocuments,u.existenceChangedKeys)).next(()=>u.changedDocuments)))})}function GX(n,e){let t=M(n),r=ot(e.createTime);return t.persistence.runTransaction("hasNewerBundle","readonly",i=>t.bundleCache.getBundleMetadata(i,e.id)).then(i=>!!i&&i.createTime.compareTo(r)>=0)}function jX(n,e){let t=M(n);return t.persistence.runTransaction("Save bundle","readwrite",r=>t.bundleCache.saveBundleMetadata(r,e))}function WX(n,e){let t=M(n);return t.persistence.runTransaction("Get named query","readonly",r=>t.bundleCache.getNamedQuery(r,e))}function HX(r,i){return m(this,arguments,function*(n,e,t=ie()){let s=yield ic(n,cn(Ib(e.bundledQuery))),o=M(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let l=ot(e.readTime);if(s.snapshotVersion.compareTo(l)>=0)return o.bundleCache.saveNamedQuery(a,e);let c=s.withResumeToken(Rt.EMPTY_BYTE_STRING,l);return o.targetDataByTarget=o.targetDataByTarget.insert(c.targetId,c),o.targetCache.updateTargetData(a,c).next(()=>o.targetCache.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.targetCache.addMatchingKeys(a,t,s.targetId)).next(()=>o.bundleCache.saveNamedQuery(a,e))})})}var ST=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var $X=100;function KX(){return bv()?8:Pi.getAndroidVersion(eu())>0?6:4}var Ym=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=$X,this.relativeIndexReadCostPerDocument=KX()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new ST;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(Vl()<=zn.DEBUG&&R("QueryEngine","SDK will not create cache indexes for query:",Ul(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),_.resolve()):(Vl()<=zn.DEBUG&&R("QueryEngine","Query:",Ul(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?(Vl()<=zn.DEBUG&&R("QueryEngine","The SDK decides to create cache indexes for query:",Ul(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,cn(t))):_.resolve())}performQueryUsingIndex(e,t){if(WM(t))return _.resolve(null);let r=cn(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Fm(t,null,"F"),r=cn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=ie(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.applyQuery(t,a);return this.needsRefill(t,c,o,l.readTime)?this.performQueryUsingIndex(e,Fm(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return WM(t)||i.isEqual(H.min())?_.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,r,i)?_.resolve(null):(Vl()<=zn.DEBUG&&R("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ul(t)),this.appendRemainingResults(e,o,t,jF(i,Kl)).next(a=>a))})}applyQuery(e,t){let r=new De(AL(e));return t.forEach((i,s)=>{rd(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return Vl()<=zn.DEBUG&&R("QueryEngine","Using full collection scan to execute query:",Ul(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,ir.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var v2="firestore_clients";function bF(n,e){return`${v2}_${n}_${e}`}var E2="firestore_mutations";function IF(n,e,t){let r=`${E2}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}var S2="firestore_targets";function a0(n,e){return`${S2}_${n}_${e}`}var QX="firestore_online_state";function YX(n){return`${QX}_${n}`}var XX="firestore_bundle_loaded_v2";function JX(n){return`${XX}_${n}`}var ZX="firestore_sequence_number";function eJ(n){return`${ZX}_${n}`}var ei="SharedClientState",Xm=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static fromWebStorageEntry(e,t,r){let i=JSON.parse(r),s=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object"),o;return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(o=new w(i.error.code,i.error.message))),s?new n(e,t,i.state,o):(He(ei,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Th=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object"),s;return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new w(r.error.code,r.error.message))),i?new n(e,r.state,s):(He(ei,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Jm=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Tb();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=dL(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(He(ei,`Failed to parse client data for instance '${e}': ${t}`),null)}},CT=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(He(ei,`Failed to parse online state: ${e}`),null)}},jh=class{constructor(){this.activeTargetIds=Tb()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},bh=class{constructor(e,t,r,i,s){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new Be(ne),this.started=!1,this.earlyEvents=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.localClientStorageKey=bF(this.persistenceKey,this.localClientId),this.sequenceNumberKey=eJ(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new jh),this.clientStateKeyRe=new RegExp(`^${v2}_${o}_([^_]*)$`),this.mutationBatchKeyRe=new RegExp(`^${E2}_${o}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=new RegExp(`^${S2}_${o}_(\\d+)$`),this.onlineStateKey=YX(this.persistenceKey),this.bundleLoadedKey=JX(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}start(){return m(this,null,function*(){let e=yield this.syncEngine.getActiveClients();for(let r of e){if(r===this.localClientId)continue;let i=this.getItem(bF(this.persistenceKey,r));if(i){let s=Jm.fromWebStorageEntry(r,i);s&&(this.activeClients=this.activeClients.insert(s.clientId,s))}}this.persistClientState();let t=this.storage.getItem(this.onlineStateKey);if(t){let r=this.fromWebStorageOnlineState(t);r&&this.handleOnlineStateEvent(r)}for(let r of this.earlyEvents)this.handleWebStorageEvent(r);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(a0(this.persistenceKey,e));if(r){let i=Th.fromWebStorageEntry(e,r);i&&(t=i.state)}}return this.localClientState.addQueryTarget(e),this.persistClientState(),t}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(a0(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.removeMutationState(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return R(ei,"READ",e,t),t}setItem(e,t){R(ei,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){R(ei,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(R(ei,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){He("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(()=>m(this,null,function*(){if(!this.started){this.earlyEvents.push(t);return}if(t.key!==null){if(this.clientStateKeyRe.test(t.key))if(t.newValue!=null){let r=this.fromWebStorageClientState(t.key,t.newValue);if(r)return this.handleClientStateEvent(r.clientId,r)}else{let r=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(r,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(r)return this.handleMutationBatchEvent(r)}}else if(this.queryTargetKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(r)return this.handleQueryTargetEvent(r)}}else if(t.key===this.onlineStateKey){if(t.newValue!==null){let r=this.fromWebStorageOnlineState(t.newValue);if(r)return this.handleOnlineStateEvent(r)}}else if(t.key===this.sequenceNumberKey){let r=tJ(t.newValue);r!==kn.INVALID&&this.sequenceNumberHandler(r)}else if(t.key===this.bundleLoadedKey){let r=this.fromWebStoreBundleLoadedState(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.synchronizeWithChangedDocuments(i)))}}}))}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let i=new Xm(this.currentUser,e,t,r),s=IF(this.persistenceKey,this.currentUser,e);this.setItem(s,i.toWebStorageJSON())}removeMutationState(e){let t=IF(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let i=a0(this.persistenceKey,e),s=new Th(e,t,r);this.setItem(i,s.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return Jm.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Xm.fromWebStorageEntry(new pt(s),i,t)}fromWebStorageQueryTargetMetadata(e,t){let r=this.queryTargetKeyRe.exec(e),i=Number(r[1]);return Th.fromWebStorageEntry(i,t)}fromWebStorageOnlineState(e){return CT.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}handleMutationBatchEvent(e){return m(this,null,function*(){if(e.user.uid!==this.currentUser.uid){R(ei,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)})}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),i=this.extractActiveQueryTargets(this.activeClients),s=this.extractActiveQueryTargets(r),o=[],a=[];return s.forEach(l=>{i.has(l)||o.push(l)}),i.forEach(l=>{s.has(l)||a.push(l)}),this.syncEngine.applyActiveTargetsChange(o,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=Tb();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}};function tJ(n){let e=kn.INVALID;if(n!=null)try{let t=JSON.parse(n);q(typeof t=="number"),e=t}catch(t){He(ei,"Failed to read sequence number from WebStorage",t)}return e}var Zm=class{constructor(){this.localState=new jh,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new jh,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var wT=class{addCallback(e){}shutdown(){}};var TT=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var vm=null;function nJ(){return 268435456+Math.round(2147483648*Math.random())}function l0(){return vm===null?vm=nJ():vm++,"0x"+vm.toString(16)}function rJ(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}var iJ="1.9.1",an="GrpcConnection",sJ=`gl-node/${process.versions.node} fire/${hc} grpc/${iJ}`;function c0(n,e,t,r){q(e===null||e.type==="OAuth");let i=new Uo.Metadata;return e&&e.headers.forEach((s,o)=>i.set(o,s)),t&&t.headers.forEach((s,o)=>i.set(o,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",sJ),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}var bT=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){R(an,"Creating Firestore stub.");let e=this.databaseInfo.ssl?Uo.credentials.createSsl():Uo.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let o=l0(),a=this.ensureActiveStub(),l=c0(this.databasePath,i,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},r);return rJ(u=>(R(an,`RPC '${e}' ${o} invoked with request:`,r),a[e](c,l,(h,d)=>{h?(R(an,`RPC '${e}' ${o} failed with error:`,h),u(new w(Tm(h.code),h.message))):(R(an,`RPC '${e}' ${o} completed with response:`,d),u(void 0,d))})))}invokeStreamingRPC(e,t,r,i,s,o){let a=l0(),l=[],c=new st;R(an,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),h=c0(this.databasePath,i,s,this.databaseInfo.appId),d=Object.assign(Object.assign({},r),{database:this.databasePath}),f=u[e](d,h),g=!1;return f.on("data",y=>{R(an,`RPC ${e} ${a} received result:`,y),l.push(y),o!==void 0&&l.length===o&&(g=!0,c.resolve(l))}),f.on("end",()=>{R(an,`RPC '${e}' ${a} completed.`),g||(g=!0,c.resolve(l))}),f.on("error",y=>{R(an,`RPC '${e}' ${a} failed with error:`,y);let E=Tm(y.code);c.reject(new w(E,y.message))}),c.promise}openStream(e,t,r){let i=l0(),s=this.ensureActiveStub(),o=c0(this.databasePath,t,r,this.databaseInfo.appId),a=s[e](o),l=!1,c=h=>{l||(l=!0,u.callOnClose(h),a.end())},u=new TT({sendFn:h=>{if(l)R(an,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,h);else{R(an,`RPC '${e}' stream ${i} sending:`,h);try{a.write(h)}catch(d){throw He("Failure sending:",h),He("Error:",d),d}}},closeFn:()=>{R(an,`RPC '${e}' stream ${i} closed locally via close().`),c()}});return a.on("data",h=>{l||(R(an,`RPC '${e}' stream ${i} received:`,h),u.callOnMessage(h))}),a.on("end",()=>{R(an,`RPC '${e}' stream ${i} ended.`),c()}),a.on("error",h=>{if(!l){rr(an,`RPC '${e}' stream ${i} error. Code:`,h.code,"Message:",h.message);let d=Tm(h.code);c(new w(d,h.message))}}),R(an,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},C2={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},oJ={nested:C2},aJ=Object.freeze({__proto__:null,nested:C2,default:oJ});var lJ={longs:String,enums:String,defaults:!0,oneofs:!1};function cJ(){let n=qF.fromJSON(aJ,lJ);return Uo.loadPackageDefinition(n)}function uJ(n){let e=cJ();return new bT(e,n)}function hJ(){return new wT}function w2(){return process.env.USE_MOCK_PERSISTENCE==="YES"?window:null}function dJ(){return null}function sd(n){return new H0(n,!1)}var fJ="ExponentialBackoff",pJ=1e3,gJ=1.5,mJ=60*1e3,Wh=class{constructor(e,t,r=pJ,i=gJ,s=mJ){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&R(fJ,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var AF="PersistentStream",yJ=60*1e3,_J=10*1e3,ey=class{constructor(e,t,r,i,s,o,a,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.backoff=new Wh(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.state===4){this.performBackoff();return}this.auth()}stop(){return m(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,yJ,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return m(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return m(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===S.RESOURCE_EXHAUSTED?(He(t.toString()),He("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===S.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new w(S.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,_J,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>m(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return R(AF,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(R(AF,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},IT=class extends ey{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onMessage(e){this.backoff.reset();let t=NQ(this.serializer,e),r=OQ(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=Q0(this.serializer),t.addTarget=GQ(this.serializer,e);let r=qQ(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=Q0(this.serializer),t.removeTarget=e,this.sendRequest(t)}},AT=class extends ey{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.handshakeComplete_=!1}get handshakeComplete(){return this.handshakeComplete_}start(){this.handshakeComplete_=!1,this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete_&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onMessage(e){if(q(!!e.streamToken),this.lastStreamToken=e.streamToken,this.handshakeComplete_){this.backoff.reset();let t=FQ(e.writeResults,e.commitTime),r=ot(e.commitTime);return this.listener.onMutationResult(r,t)}else return q(!e.writeResults||e.writeResults.length===0),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()}writeHandshake(){let e={};e.database=Q0(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Uh(this.serializer,r))};this.sendRequest(t)}};var DT=class{},RT=class extends DT{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new w(S.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeRPC(e,K0(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new w(S.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,r,i,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.invokeStreamingRPC(e,K0(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new w(S.UNKNOWN,o.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function vJ(n,e,t,r){return new RT(n,e,t,r)}function EJ(n,e){return m(this,null,function*(){let t=M(n),r={writes:e.map(i=>Uh(t.serializer,i))};yield t.invokeRPC("Commit",t.serializer.databaseId,ge.emptyPath(),r)})}function SJ(n,e){return m(this,null,function*(){let t=M(n),r={documents:e.map(a=>Vh(t.serializer,a))},i=yield t.invokeStreamingRPC("BatchGetDocuments",t.serializer.databaseId,ge.emptyPath(),r,e.length),s=new Map;i.forEach(a=>{let l=RQ(t.serializer,a);s.set(l.key.toString(),l)});let o=[];return e.forEach(a=>{let l=s.get(a.toString());q(!!l),o.push(l)}),o})}function CJ(n,e,t){let r=M(n);return r.verifyInitialized(),new AT(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}function wJ(n,e,t){let r=M(n);return r.verifyInitialized(),new IT(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}var TJ="OnlineStateTracker",DF=1,RF=10*1e3,NT=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",RF,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${RF/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=DF&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${DF} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(He(t),this.shouldWarnClientIsOffline=!1):R(TJ,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var Yo="RemoteStore",bJ=10,kT=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{r.enqueueAndForget(()=>m(this,null,function*(){Ws(this)&&(R(Yo,"Restarting streams for network reachability change."),yield zJ(this))}))}),this.onlineStateTracker=new NT(r,i)}};function IJ(n,e,t,r,i){return new kT(n,e,t,r,i)}function AJ(n){let e=M(n);return e.offlineCauses.delete(0),od(e)}function od(n){return m(this,null,function*(){if(Ws(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function DJ(n){return m(this,null,function*(){let e=M(n);e.offlineCauses.add(0),yield mc(e),e.onlineStateTracker.set("Offline")})}function mc(n){return m(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function RJ(n){return m(this,null,function*(){let e=M(n);R(Yo,"RemoteStore shutting down."),e.offlineCauses.add(5),yield mc(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function Ay(n,e){let t=M(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),Pb(t)?xb(t):vc(t).isOpen()&&Ob(t,e))}function yc(n,e){let t=M(n),r=vc(t);t.listenTargets.delete(e),r.isOpen()&&T2(t,e),t.listenTargets.size===0&&(r.isOpen()?r.markIdle():Ws(t)&&t.onlineStateTracker.set("Unknown"))}function Ob(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(H.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}vc(n).watch(e)}function T2(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),vc(n).unwatch(e)}function xb(n){n.watchChangeAggregator=new W0({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),vc(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function Pb(n){return Ws(n)&&!vc(n).isStarted()&&n.listenTargets.size>0}function Ws(n){return M(n).offlineCauses.size===0}function b2(n){n.watchChangeAggregator=void 0}function NJ(n){return m(this,null,function*(){n.listenTargets.forEach((e,t)=>{Ob(n,e)})})}function kJ(n,e){return m(this,null,function*(){b2(n),Pb(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),xb(n)):n.onlineStateTracker.set("Unknown")})}function OJ(n,e,t){return m(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof Bm&&e.state===2&&e.cause){try{yield PJ(n,e)}catch(r){R(Yo,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield ty(n,r)}return}if(e instanceof $l?n.watchChangeAggregator.handleDocumentChange(e):e instanceof Lm?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(H.min()))try{let r=yield p2(n.localStore);t.compareTo(r)>=0&&(yield xJ(n,t))}catch(r){R(Yo,"Failed to raise snapshot:",r),yield ty(n,r)}})}function ty(n,e,t){return m(this,null,function*(){if(js(e))n.offlineCauses.add(1),yield mc(n),n.onlineStateTracker.set("Offline"),t||(t=()=>p2(n.localStore)),n.asyncQueue.enqueueRetryable(()=>m(this,null,function*(){R(Yo,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield od(n)}));else throw e})}function I2(n,e){return e().catch(t=>ty(n,t,e))}function xJ(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((r,i)=>{if(r.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(i);s&&n.listenTargets.set(i,s.withResumeToken(r.resumeToken,e))}}),t.targetMismatches.forEach((r,i)=>{let s=n.listenTargets.get(r);if(!s)return;n.listenTargets.set(r,s.withResumeToken(Rt.EMPTY_BYTE_STRING,s.snapshotVersion)),T2(n,r);let o=new nc(s.target,r,i,s.sequenceNumber);Ob(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function PJ(n,e){return m(this,null,function*(){let t=e.cause;for(let r of e.targetIds)n.listenTargets.has(r)&&(yield n.remoteSyncer.rejectListen(r,t),n.listenTargets.delete(r),n.watchChangeAggregator.removeTarget(r))})}function _c(n){return m(this,null,function*(){let e=M(n),t=Hs(e),r=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:ks;for(;MJ(e);)try{let i=yield PX(e.localStore,r);if(i===null){e.writePipeline.length===0&&t.markIdle();break}else r=i.batchId,FJ(e,i)}catch(i){yield ty(e,i)}A2(e)&&D2(e)})}function MJ(n){return Ws(n)&&n.writePipeline.length<bJ}function FJ(n,e){n.writePipeline.push(e);let t=Hs(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function A2(n){return Ws(n)&&!Hs(n).isStarted()&&n.writePipeline.length>0}function D2(n){Hs(n).start()}function LJ(n){return m(this,null,function*(){Hs(n).writeHandshake()})}function BJ(n){return m(this,null,function*(){let e=Hs(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function VJ(n,e,t){return m(this,null,function*(){let r=n.writePipeline.shift(),i=q0.from(r,e,t);yield I2(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield _c(n)})}function UJ(n,e){return m(this,null,function*(){e&&Hs(n).handshakeComplete&&(yield qJ(n,e)),A2(n)&&D2(n)})}function qJ(n,e){return m(this,null,function*(){if(dQ(e.code)){let t=n.writePipeline.shift();Hs(n).inhibitBackoff(),yield I2(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield _c(n)}})}function zJ(n){return m(this,null,function*(){let e=M(n);e.offlineCauses.add(4),yield mc(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield od(e)})}function NF(n,e){return m(this,null,function*(){let t=M(n);t.asyncQueue.verifyOperationInProgress(),R(Yo,"RemoteStore received new credentials");let r=Ws(t);t.offlineCauses.add(3),yield mc(t),r&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield od(t)})}function OT(n,e){return m(this,null,function*(){let t=M(n);e?(t.offlineCauses.delete(2),yield od(t)):e||(t.offlineCauses.add(2),yield mc(t),t.onlineStateTracker.set("Unknown"))})}function vc(n){return n.watchStream||(n.watchStream=wJ(n.datastore,n.asyncQueue,{onOpen:NJ.bind(null,n),onClose:kJ.bind(null,n),onWatchChange:OJ.bind(null,n)}),n.onNetworkStatusChange.push(e=>m(this,null,function*(){e?(n.watchStream.inhibitBackoff(),Pb(n)?xb(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),b2(n))}))),n.watchStream}function Hs(n){return n.writeStream||(n.writeStream=CJ(n.datastore,n.asyncQueue,{onOpen:LJ.bind(null,n),onClose:UJ.bind(null,n),onHandshakeComplete:BJ.bind(null,n),onMutationResult:VJ.bind(null,n)}),n.onNetworkStatusChange.push(e=>m(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield _c(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(R(Yo,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var GJ="AsyncQueue",xT=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new st,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new w(S.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Ec(n,e){if(He(GJ,`${e}: ${n}`),js(n))return new w(S.UNAVAILABLE,`${e}: ${n}`);throw n}var ny=class n{constructor(e){e?this.comparator=(t,r)=>e(t,r)||P.comparator(t.key,r.key):this.comparator=(t,r)=>P.comparator(t.key,r.key),this.keyedMap=_h(),this.sortedSet=new Be(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var ry=class{constructor(){this.changeMap=new Be(P.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&r.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&r.type!==1?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):B()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}},oc=class n{constructor(e,t,r,i,s,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,ny.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!nd(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var PT=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};function jJ(){return new MT}var MT=class{constructor(){this.queries=new oi(e=>bL(e),nd),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}};function Mb(n,e){return m(this,null,function*(){let t=M(n),r=3,i=e.query,s=t.queries.get(i);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2):(s=new PT,r=e.listensToRemoteStore()?0:1);try{switch(r){case 0:s.viewSnap=yield t.onListen(i,!0);break;case 1:s.viewSnap=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i);break;default:break}}catch(o){let a=Ec(o,`Initialization of query '${Ul(e.query)}' failed`);e.onError(a);return}t.queries.set(i,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&Lb(t)})}function Fb(n,e){return m(this,null,function*(){let t=M(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),s.listeners.length===0?i=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function WJ(n,e){let t=M(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(i)&&(r=!0);o.viewSnap=i}}r&&Lb(t)}function HJ(n,e,t){let r=M(n),i=r.queries.get(e);if(i)for(let s of i.listeners)s.onError(t);r.queries.delete(e)}function $J(n,e){let t=M(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(r=!0)}),r&&Lb(t)}function KJ(n,e){M(n).snapshotsInSyncListeners.add(e),e.next()}function QJ(n,e){M(n).snapshotsInSyncListeners.delete(e)}function Lb(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var R2=function(n){return n.Default="default",n.Cache="cache",n}(R2||{}),Hh=class{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new oc(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r=t!=="Offline";return this.options.waitForSyncWhenOnline&&r?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=oc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==R2.Cache}};var FT=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=ie(),i=ie();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};var iy=class{constructor(e){this.serializer=e}toDocumentKey(e){return ri(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?QL(this.serializer,e.document,!1):ft.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return ot(e)}},LT=class{constructor(e,t,r){this.bundleMetadata=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=N2(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;let r=ge.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,r=new iy(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.toDocumentKey(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||ie()).add(s);t.set(o,a)}}return t}complete(){return m(this,null,function*(){let e=yield zX(this.localStore,new iy(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let r of this.queries)yield HX(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}})}};function N2(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}function YJ(n){return{taskState:"Success",documentsLoaded:n.totalDocuments,bytesLoaded:n.totalBytes,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var sy=class{constructor(e){this.key=e}},oy=class{constructor(e){this.key=e}},ay=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=ie(),this.mutatedKeys=ie(),this.docComparator=AL(e),this.documentSet=new ny(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new ry,i=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,h)=>{let d=i.get(u),f=rd(this.query,h)?h:null,g=d?this.mutatedKeys.has(d.key):!1,y=f?f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations:!1,E=!1;d&&f?d.data.isEqual(f.data)?g!==y&&(r.track({type:3,doc:f}),E=!0):this.shouldWaitForSyncedDocument(d,f)||(r.track({type:2,doc:f}),E=!0,(l&&this.docComparator(f,l)>0||c&&this.docComparator(f,c)<0)&&(a=!0)):!d&&f?(r.track({type:0,doc:f}),E=!0):d&&!f&&(r.track({type:1,doc:d}),E=!0,(l||c)&&(a=!0)),E&&(f?(o=o.add(f),y?s=s.add(u):s=s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{documentSet:o,changeSet:r,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((h,d)=>XJ(h.type,d.type)||this.docComparator(h.doc,d.doc)),this.applyTargetChange(r),i=i??!1;let a=t&&!i?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!i?1:0,u=c!==this.syncState;return this.syncState=c,o.length===0&&!u?{limboChanges:a}:{snapshot:new oc(this.query,e.documentSet,s,o,e.mutatedKeys,c===0,u,!1,r?r.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new ry,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=ie(),this.documentSet.forEach(r=>{this.shouldBeInLimbo(r.key)&&(this.limboDocuments=this.limboDocuments.add(r.key))});let t=[];return e.forEach(r=>{this.limboDocuments.has(r)||t.push(new oy(r))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new sy(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=ie();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return oc.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function XJ(n,e){let t=r=>{switch(r){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return B()}};return t(n)-t(e)}var $s="SyncEngine",BT=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},VT=class{constructor(e){this.key=e,this.receivedDocument=!1}},UT=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new oi(a=>bL(a),nd),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new Be(P.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new zh,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=rc.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function JJ(n,e,t,r,i,s,o){let a=new UT(n,e,t,r,i,s);return o&&(a._isPrimaryClient=!0),a}function ZJ(n,e,t=!0){return m(this,null,function*(){let r=Dy(n),i,s=r.queryViewsByQuery.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.computeInitialSnapshot()):i=yield k2(r,e,t,!0),i})}function eZ(n,e){return m(this,null,function*(){let t=Dy(n);yield k2(t,e,!0,!1)})}function k2(n,e,t,r){return m(this,null,function*(){let i=yield ic(n.localStore,cn(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield Bb(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Ay(n.remoteStore,i),a})}function Bb(n,e,t,r,i){return m(this,null,function*(){n.applyDocChanges=(h,d,f)=>hZ(n,h,d,f);let s=yield Iy(n.localStore,e,!0),o=new ay(e,s.remoteKeys),a=o.computeDocChanges(s.documents),l=Bh.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,l);qb(n,t,c.limboChanges);let u=new BT(e,t,o);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function tZ(n,e,t){return m(this,null,function*(){let r=M(n),i=r.queryViewsByQuery.get(e),s=r.queriesByTarget.get(i.targetId);if(s.length>1){r.queriesByTarget.set(i.targetId,s.filter(o=>!nd(o,e))),r.queryViewsByQuery.delete(e);return}r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield sc(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&yc(r.remoteStore,i.targetId),ac(r,i.targetId)}).catch(Gs))):(ac(r,i.targetId),yield sc(r.localStore,i.targetId,!0))})}function nZ(n,e){return m(this,null,function*(){let t=M(n),r=t.queryViewsByQuery.get(e),i=t.queriesByTarget.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),yc(t.remoteStore,r.targetId))})}function rZ(n,e,t){return m(this,null,function*(){let r=Gb(n);try{let i=yield IX(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),cZ(r,i.batchId,t),yield Ui(r,i.changes),yield _c(r.remoteStore)}catch(i){let s=Ec(i,"Failed to persist write");t.reject(s)}})}function O2(n,e){return m(this,null,function*(){let t=M(n);try{let r=yield kX(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&(q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.receivedDocument=!0:i.modifiedDocuments.size>0?q(o.receivedDocument):i.removedDocuments.size>0&&(q(o.receivedDocument),o.receivedDocument=!1))}),yield Ui(t,r,e)}catch(r){yield Gs(r)}})}function kF(n,e,t){let r=M(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&i.push(a.snapshot)}),$J(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function iZ(n,e,t){return m(this,null,function*(){let r=M(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.activeLimboResolutionsByTarget.get(e),s=i&&i.key;if(s){let o=new Be(P.comparator);o=o.insert(s,ft.newNoDocument(s,H.min()));let a=ie().add(s),l=new Lh(H.min(),new Map,new Be(ne),o,a);yield O2(r,l),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(e),zb(r)}else yield sc(r.localStore,e,!1).then(()=>ac(r,e,t)).catch(Gs)})}function sZ(n,e){return m(this,null,function*(){let t=M(n),r=e.batch.batchId;try{let i=yield AX(t.localStore,e);Ub(t,r,null),Vb(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Ui(t,i)}catch(i){yield Gs(i)}})}function oZ(n,e,t){return m(this,null,function*(){let r=M(n);try{let i=yield RX(r.localStore,e);Ub(r,e,t),Vb(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Ui(r,i)}catch(i){yield Gs(i)}})}function aZ(n,e){return m(this,null,function*(){let t=M(n);Ws(t.remoteStore)||R($s,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield NX(t.localStore);if(r===ks){e.resolve();return}let i=t.pendingWritesCallbacks.get(r)||[];i.push(e),t.pendingWritesCallbacks.set(r,i)}catch(r){let i=Ec(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function Vb(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function lZ(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new w(S.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function cZ(n,e,t){let r=n.mutationUserCallbacks[n.currentUser.toKey()];r||(r=new Be(ne)),r=r.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=r}function Ub(n,e,t){let r=M(n),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function ac(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(r),t&&n.syncEngineListener.onWatchError(r,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(i=>{n.limboDocumentRefs.containsKey(i)||x2(n,i)})}function x2(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(yc(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),zb(n))}function qb(n,e,t){for(let r of t)r instanceof sy?(n.limboDocumentRefs.addReference(r.key,e),uZ(n,r)):r instanceof oy?(R($s,"Document no longer in limbo: "+r.key),n.limboDocumentRefs.removeReference(r.key,e),n.limboDocumentRefs.containsKey(r.key)||x2(n,r.key)):B()}function uZ(n,e){let t=e.key,r=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(r)&&(R($s,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(r),zb(n))}function zb(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new P(ge.fromString(e)),r=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(r,new VT(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,r),Ay(n.remoteStore,new nc(cn(gc(t.path)),r,"TargetPurposeLimboResolution",kn.INVALID))}}function Ui(n,e,t){return m(this,null,function*(){let r=M(n),i=[],s=[],o=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((a,l)=>{o.push(r.applyDocChanges(l,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(l.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);let u=FT.fromSnapshot(l.targetId,c);s.push(u)}}))}),yield Promise.all(o),r.syncEngineListener.onWatchChange(i),yield xX(r.localStore,s))})}function hZ(n,e,t,r){return m(this,null,function*(){let i=e.view.computeDocChanges(t);i.needsRefill&&(i=yield Iy(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,i)));let s=r&&r.targetChanges.get(e.targetId),o=r&&r.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(i,n.isPrimaryClient,s,o);return qb(n,e.targetId,a.limboChanges),a.snapshot})}function dZ(n,e){return m(this,null,function*(){let t=M(n);if(!t.currentUser.isEqual(e)){R($s,"User change. New user:",e.toKey());let i=yield f2(t.localStore,e);t.currentUser=e,lZ(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield Ui(t,i.affectedDocuments)}})}function fZ(n,e){let t=M(n),r=t.activeLimboResolutionsByTarget.get(e);if(r&&r.receivedDocument)return ie().add(r.key);{let i=ie(),s=t.queriesByTarget.get(e);if(!s)return i;for(let o of s){let a=t.queryViewsByQuery.get(o);i=i.unionWith(a.view.syncedDocuments)}return i}}function pZ(n,e){return m(this,null,function*(){let t=M(n),r=yield Iy(t.localStore,e.query,!0),i=e.view.synchronizeWithPersistedState(r);return t.isPrimaryClient&&qb(t,e.targetId,i.limboChanges),i})}function gZ(n,e){return m(this,null,function*(){let t=M(n);return y2(t.localStore,e).then(r=>Ui(t,r))})}function mZ(n,e,t,r){return m(this,null,function*(){let i=M(n),s=yield BX(i.localStore,e);if(s===null){R($s,"Cannot apply mutation batch with id: "+e);return}t==="pending"?yield _c(i.remoteStore):t==="acknowledged"||t==="rejected"?(Ub(i,e,r||null),Vb(i,e),VX(i.localStore,e)):B(),yield Ui(i,s)})}function yZ(n,e){return m(this,null,function*(){let t=M(n);if(Dy(t),Gb(t),e===!0&&t._isPrimaryClient!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield OF(t,r.toArray());t._isPrimaryClient=!0,yield OT(t.remoteStore,!0);for(let s of i)Ay(t.remoteStore,s)}else if(e===!1&&t._isPrimaryClient!==!1){let r=[],i=Promise.resolve();t.queriesByTarget.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(ac(t,o),sc(t.localStore,o,!0))),yc(t.remoteStore,o)}),yield i,yield OF(t,r),_Z(t),t._isPrimaryClient=!1,yield OT(t.remoteStore,!1)}})}function _Z(n){let e=M(n);e.activeLimboResolutionsByTarget.forEach((t,r)=>{yc(e.remoteStore,r)}),e.limboDocumentRefs.removeAllReferences(),e.activeLimboResolutionsByTarget=new Map,e.activeLimboTargetsByKey=new Be(P.comparator)}function OF(n,e,t){return m(this,null,function*(){let r=M(n),i=[],s=[];for(let o of e){let a,l=r.queriesByTarget.get(o);if(l&&l.length!==0){a=yield ic(r.localStore,cn(l[0]));for(let c of l){let u=r.queryViewsByQuery.get(c),h=yield pZ(r,u);h.snapshot&&s.push(h.snapshot)}}else{let c=yield m2(r.localStore,o);a=yield ic(r.localStore,c),yield Bb(r,P2(c),o,!1,a.resumeToken)}i.push(a)}return r.syncEngineListener.onWatchChange(s),i})}function P2(n){return TL(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function vZ(n){let e=M(n);return UX(e.localStore)}function EZ(n,e,t,r){return m(this,null,function*(){let i=M(n);if(i._isPrimaryClient){R($s,"Ignoring unexpected query state notification.");return}let s=i.queriesByTarget.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield y2(i.localStore,IL(s[0])),a=Lh.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Rt.EMPTY_BYTE_STRING);yield Ui(i,o,a);break}case"rejected":{yield sc(i.localStore,e,!0),ac(i,e,r);break}default:B()}})}function SZ(n,e,t){return m(this,null,function*(){let r=Dy(n);if(r._isPrimaryClient){for(let i of e){if(r.queriesByTarget.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){R($s,"Adding an already active target "+i);continue}let o=yield m2(r.localStore,i),a=yield ic(r.localStore,o);yield Bb(r,P2(o),a.targetId,!1,a.resumeToken),Ay(r.remoteStore,a)}for(let i of t)r.queriesByTarget.has(i)&&(yield sc(r.localStore,i,!1).then(()=>{yc(r.remoteStore,i),ac(r,i)}).catch(Gs))}})}function Dy(n){let e=M(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=O2.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=fZ.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=iZ.bind(null,e),e.syncEngineListener.onWatchChange=WJ.bind(null,e.eventManager),e.syncEngineListener.onWatchError=HJ.bind(null,e.eventManager),e}function Gb(n){let e=M(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=sZ.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=oZ.bind(null,e),e}function CZ(n,e,t){let r=M(n);wZ(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}function wZ(n,e,t){return m(this,null,function*(){try{let r=yield e.getMetadata();if(yield GX(n.localStore,r))return yield e.close(),t._completeWith(YJ(r)),Promise.resolve(new Set);t._updateProgress(N2(r));let s=new LT(r,n.localStore,e.serializer),o=yield e.nextElement();for(;o;){let l=yield s.addSizedElement(o);l&&t._updateProgress(l),o=yield e.nextElement()}let a=yield s.complete();return yield Ui(n,a.changedDocs,void 0),yield jX(n.localStore,r),t._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(r){return rr($s,`Loading bundle failed with ${r}`),t._failWith(r),Promise.resolve(new Set)}})}var $h=class{constructor(){this.synchronizeTabs=!1}initialize(e){return m(this,null,function*(){this.serializer=sd(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return d2(this.persistence,new Ym,e.initialUser,this.serializer)}createPersistence(e){return new Km(Qm.factory,this.serializer)}createSharedClientState(e){return new Zm}terminate(){return m(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var ly=class n extends $h{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return m(this,null,function*(){yield cv(n.prototype,this,"initialize").call(this,e),yield this.onlineComponentProvider.initialize(this,e),yield Gb(this.onlineComponentProvider.syncEngine),yield _c(this.onlineComponentProvider.remoteStore),yield this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return d2(this.persistence,new Ym,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new oT(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new S0(t,this.persistence);return new E0(e.asyncQueue,r)}createPersistence(e){let t=Nb(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?nr.withCacheSize(this.cacheSizeBytes):nr.DEFAULT;return new ET(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,w2(),dJ(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Zm}},qT=class n extends ly{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return m(this,null,function*(){yield cv(n.prototype,this,"initialize").call(this,e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof bh&&(this.sharedClientState.syncEngine={applyBatchState:mZ.bind(null,t),applyTargetState:EZ.bind(null,t),applyActiveTargetsChange:SZ.bind(null,t),getActiveClients:vZ.bind(null,t),synchronizeWithChangedDocuments:gZ.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.setPrimaryStateListener(r=>m(this,null,function*(){yield yZ(this.onlineComponentProvider.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=w2();if(!bh.isAvailable(t))throw new w(S.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=Nb(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new bh(t,e.asyncQueue,r,e.clientId,e.initialUser)}},Kh=class{initialize(e,t){return m(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>kF(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=dZ.bind(null,this.syncEngine),yield OT(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return jJ()}createDatastore(e){let t=sd(e.databaseInfo.databaseId),r=uJ(e.databaseInfo);return vJ(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return IJ(this.localStore,this.datastore,e.asyncQueue,t=>kF(this.syncEngine,t,0),hJ())}createSyncEngine(e,t){return JJ(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return m(this,null,function*(){var e;yield RJ(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};var TZ=10240;function bZ(n,e=TZ){let t=0;return{read(){return m(this,null,function*(){if(t<n.byteLength){let s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return m(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}function jb(n,e,t){if(!t)throw new w(S.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Wb(n,e,t,r){if(e===!0&&r===!0)throw new w(S.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function xF(n){if(!P.isDocumentKey(n))throw new w(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function PF(n){if(P.isDocumentKey(n))throw new w(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function IZ(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function ad(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=AZ(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":B()}function AZ(n){return n.constructor?n.constructor.name:null}function me(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new w(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=ad(n);throw new w(S.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function M2(n,e){if(e<=0)throw new w(S.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function DZ(n,e){if(!(n instanceof Uint8Array))throw new w(S.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${ad(n)}`);return bZ(n,e)}var lc=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.observer.error?this.scheduleEvent(this.observer.error,e):He("Uncaught Error in snapshot listener:",e.toString())}mute(){this.muted=!0}scheduleEvent(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var zT=class{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}};var GT=class{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new st,this.buffer=new Uint8Array,this.textDecoder=fQ(),this.nextElementImpl().then(r=>{r&&r.isBundleMetadata()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.payload)}`))},r=>this.metadata.reject(r))}close(){return this.reader.cancel()}getMetadata(){return m(this,null,function*(){return this.metadata.promise})}nextElement(){return m(this,null,function*(){return yield this.getMetadata(),this.nextElementImpl()})}nextElementImpl(){return m(this,null,function*(){let e=yield this.readLength();if(e===null)return null;let t=this.textDecoder.decode(e),r=Number(t);isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`);let i=yield this.readJsonString(r);return new zT(JSON.parse(i),e.length+r)})}indexOfOpenBracket(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}readLength(){return m(this,null,function*(){for(;this.indexOfOpenBracket()<0&&!(yield this.pullMoreDataToBuffer()););if(this.buffer.length===0)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}readJsonString(e){return m(this,null,function*(){for(;this.buffer.length<e;)(yield this.pullMoreDataToBuffer())&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}raiseError(e){throw this.reader.cancel(),new Error(`Invalid bundle format: ${e}`)}pullMoreDataToBuffer(){return m(this,null,function*(){let e=yield this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};function RZ(n,e){return new GT(n,e)}var jT=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return m(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new w(S.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield SJ(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Us(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return m(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=P.fromPath(r);this.mutations.push(new Ph(i,this.precondition(i)))}),yield EJ(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=H.min();else throw B();let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new w(S.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(H.min())?et.exists(!1):et.updateTime(t):et.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(H.min()))throw new w(S.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return et.updateTime(t)}else return et.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var WT=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.attemptsRemaining=r.maxAttempts,this.backoff=new Wh(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(()=>m(this,null,function*(){let e=new jT(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.handleTransactionError(i)}))}).catch(r=>{this.handleTransactionError(r)})}))}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);return ed(t)||!t.catch||!t.then?(this.deferred.reject(Error("Transaction callback must return a Promise")),null):t}catch(t){return this.deferred.reject(t),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!zL(t)}return!1}};var qs="FirestoreClient",NZ=100,kZ=11,OZ=20,xZ=22,HT=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=pt.UNAUTHENTICATED,this.clientId=Am.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>m(this,null,function*(){R(qs,"Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(R(qs,"Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:NZ}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new w(S.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new st;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>m(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Ec(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function bm(n,e){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),R(qs,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>m(this,null,function*(){r.isEqual(i)||(yield f2(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function $T(n,e){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield Hb(n);R(qs,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>NF(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>NF(e.remoteStore,i)),n._onlineComponents=e})}function F2(n){return n.name==="FirebaseError"?n.code===S.FAILED_PRECONDITION||n.code===S.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===xZ||n.code===OZ||n.code===kZ:!0}function Hb(n){return m(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){R(qs,"Using user provided OfflineComponentProvider");try{yield bm(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!F2(t))throw t;rr("Error using user provided cache. Falling back to memory cache: "+t),yield bm(n,new $h)}}else R(qs,"Using default OfflineComponentProvider"),yield bm(n,new $h);return n._offlineComponents})}function Ry(n){return m(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(R(qs,"Using user provided OnlineComponentProvider"),yield $T(n,n._uninitializedComponentsProvider._online)):(R(qs,"Using default OnlineComponentProvider"),yield $T(n,new Kh))),n._onlineComponents})}function L2(n){return Hb(n).then(e=>e.persistence)}function $b(n){return Hb(n).then(e=>e.localStore)}function B2(n){return Ry(n).then(e=>e.remoteStore)}function Kb(n){return Ry(n).then(e=>e.syncEngine)}function PZ(n){return Ry(n).then(e=>e.datastore)}function cc(n){return m(this,null,function*(){let e=yield Ry(n),t=e.eventManager;return t.onListen=ZJ.bind(null,e.syncEngine),t.onUnlisten=tZ.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=eZ.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=nZ.bind(null,e.syncEngine),t})}function MZ(n){return n.asyncQueue.enqueue(()=>m(this,null,function*(){let e=yield L2(n),t=yield B2(n);return e.setNetworkEnabled(!0),AJ(t)}))}function FZ(n){return n.asyncQueue.enqueue(()=>m(this,null,function*(){let e=yield L2(n),t=yield B2(n);return e.setNetworkEnabled(!1),DJ(t)}))}function LZ(n){let e=new st;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){let t=yield Kb(n);return aZ(t,e)})),e.promise}function BZ(n,e,t,r){let i=new lc(r),s=new Hh(e,i,t);return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){let o=yield cc(n);return Mb(o,s)})),()=>{i.mute(),n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){let o=yield cc(n);return Fb(o,s)}))}}function VZ(n,e){let t=new st;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){let r=yield $b(n);return jZ(r,e,t)})),t.promise}function V2(n,e,t={}){let r=new st;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){let i=yield cc(n);return WZ(i,n.asyncQueue,e,t,r)})),r.promise}function UZ(n,e){let t=new st;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){let r=yield $b(n);return HZ(r,e,t)})),t.promise}function U2(n,e,t={}){let r=new st;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){let i=yield cc(n);return $Z(i,n.asyncQueue,e,t,r)})),r.promise}function qZ(n,e){let t=new st;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){let r=yield Kb(n);return rZ(r,e,t)})),t.promise}function zZ(n,e){let t=new lc(e);return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){let r=yield cc(n);return KJ(r,t)})),()=>{t.mute(),n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){let r=yield cc(n);return QJ(r,t)}))}}function GZ(n,e,t){let r=new st;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){let i=yield PZ(n);new WT(n.asyncQueue,i,t,e,r).run()})),r.promise}function jZ(n,e,t){return m(this,null,function*(){try{let r=yield MX(n,e);r.isFoundDocument()?t.resolve(r):r.isNoDocument()?t.resolve(null):t.reject(new w(S.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let i=Ec(r,`Failed to get document '${e} from cache`);t.reject(i)}})}function WZ(n,e,t,r,i){let s=new lc({next:a=>{e.enqueueAndForget(()=>Fb(n,o));let l=a.docs.has(t);!l&&a.fromCache?i.reject(new w(S.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&r&&r.source==="server"?i.reject(new w(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new Hh(gc(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return Mb(n,o)}function HZ(n,e,t){return m(this,null,function*(){try{let r=yield Iy(n,e,!0),i=new ay(e,r.remoteKeys),s=i.computeDocChanges(r.documents),o=i.applyChanges(s,!1);t.resolve(o.snapshot)}catch(r){let i=Ec(r,`Failed to execute query '${e} against cache`);t.reject(i)}})}function $Z(n,e,t,r,i){let s=new lc({next:a=>{e.enqueueAndForget(()=>Fb(n,o)),a.fromCache&&r.source==="server"?i.reject(new w(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new Hh(t,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return Mb(n,o)}function KZ(n,e,t,r){let i=YZ(t,sd(e));n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){CZ(yield Kb(n),i,r)}))}function QZ(n,e){return n.asyncQueue.enqueue(()=>m(this,null,function*(){return WX(yield $b(n),e)}))}function YZ(n,e){let t;return typeof n=="string"?t=GL().encode(n):t=n,RZ(DZ(t),e)}function XZ(n,e){return n.timeoutSeconds===e.timeoutSeconds}function q2(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var JZ="ComponentProvider",MF=new Map;function ZZ(n){let e=MF.get(n);e&&(R(JZ,"Removing Datastore"),MF.delete(n),e.terminate())}function eee(n,e,t,r){return new A0(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,q2(r.experimentalLongPollingOptions),r.useFetchStreams)}var z2="firestore.googleapis.com",FF=!0,LF=5,BF=30,tee=!0,cy=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new w(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=z2,this.ssl=FF}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:FF;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=c2;else{if(e.cacheSizeBytes!==id&&e.cacheSizeBytes<vF)throw new w(S.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${vF}`);this.cacheSizeBytes=e.cacheSizeBytes}Wb("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=tee:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=q2((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),nee(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&XZ(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function nee(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new w(S.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<LF)throw new w(S.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${LF})`);if(n.timeoutSeconds>BF)throw new w(S.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${BF})`)}}var Xo=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new cy({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new w(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new w(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new cy(e),e.credentials!==void 0&&(this._authCredentials=Z5(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return ZZ(this),Promise.resolve()}};function Ny(n,e,t,r={}){var i;n=me(n,Xo);let s=n._getSettings(),o=`${e}:${t}`;if(s.host!==z2&&s.host!==o&&rr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=pt.MOCK_USER;else{a=_f(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new w(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new pt(c)}n._authCredentials=new h0(new Im(a,l))}}var Bt=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Pe=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ii(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},ii=class n extends Bt{constructor(e,t,r){super(e,t,gc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Pe(this.firestore,null,new P(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function ky(n,e,...t){if(n=de(n),jb("collection","path",e),n instanceof Xo){let r=ge.fromString(e,...t);return PF(r),new ii(n,null,r)}else{if(!(n instanceof Pe)&&!(n instanceof ii))throw new w(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ge.fromString(e,...t));return PF(r),new ii(n.firestore,null,r)}}function Qb(n,e){if(n=me(n,Xo),jb("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new w(S.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Bt(n,null,M7(e))}function Sc(n,e,...t){if(n=de(n),arguments.length===1&&(e=Am.newId()),jb("doc","path",e),n instanceof Xo){let r=ge.fromString(e,...t);return xF(r),new Pe(n,null,new P(r))}else{if(!(n instanceof Pe)&&!(n instanceof ii))throw new w(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ge.fromString(e,...t));return xF(r),new Pe(n.firestore,n instanceof ii?n.converter:null,new P(r))}}function Oy(n,e){return n=de(n),e=de(e),(n instanceof Pe||n instanceof ii)&&(e instanceof Pe||e instanceof ii)?n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter:!1}function xy(n,e){return n=de(n),e=de(e),n instanceof Bt&&e instanceof Bt?n.firestore===e.firestore&&nd(n._query,e._query)&&n.converter===e.converter:!1}var ree="AsyncQueue",KT=class{constructor(){this.tail=Promise.resolve(),this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new Wh(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()}}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new st;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return m(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(js(e))R(ree,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=see(r);throw He("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=xT.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&B()}verifyOperationInProgress(){}drain(){return m(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function iee(){return new KT}function see(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var QT=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new st,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var G2=id,ze=class extends Xo{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=iee(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||W2(this),this._firestoreClient.terminate()}};function j2(n,e){let t=typeof n=="object"?n:ru(),r=typeof n=="string"?n:e||D0,i=wf(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=wv("firestore");s&&Ny(i,...s)}return i}function vt(n){return n._firestoreClient||W2(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function W2(n){var e,t,r;let i=n._freezeSettings(),s=eee(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new HT(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function Yb(n,e){n=me(n,ze),$2(n);let t=vt(n);if(t._uninitializedComponentsProvider)throw new w(S.FAILED_PRECONDITION,"SDK cache is already specified.");rr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new Kh,s=new ly(i,r.cacheSizeBytes,e?.forceOwnership);return H2(t,i,s)}function Xb(n){n=me(n,ze),$2(n);let e=vt(n);if(e._uninitializedComponentsProvider)throw new w(S.FAILED_PRECONDITION,"SDK cache is already specified.");rr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new Kh,i=new qT(r,t.cacheSizeBytes);return H2(e,r,i)}function H2(n,e,t){let r=new st;return n.asyncQueue.enqueue(()=>m(this,null,function*(){try{yield bm(n,t),yield $T(n,e),r.resolve()}catch(i){let s=i;if(!F2(s))throw s;rr("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function Jb(n){if(n._initialized&&!n._terminated)throw new w(S.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new st;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>m(this,null,function*(){try{yield TX(Nb(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function Zb(n){n=me(n,ze);let e=vt(n);return LZ(e)}function eI(n){n=me(n,ze);let e=vt(n);return MZ(e)}function tI(n){n=me(n,ze);let e=vt(n);return FZ(e)}function nI(n,e){n=me(n,ze);let t=vt(n),r=new QT;return KZ(t,n._databaseId,e,r),r}function rI(n,e){n=me(n,ze);let t=vt(n);return QZ(t,e).then(r=>r?new Bt(n,null,r.query):null)}function $2(n){if(n._initialized||n._terminated)throw new w(S.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}function oee(n,e=!0){X5(Tf),fo(new bn("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),o=new ze(new d0(t.getProvider("auth-internal")),new m0(t.getProvider("app-check-internal")),K8(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),tn(kM,OM,n),tn(kM,OM,"esm2017")}var ai=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Rt.fromBase64String(e))}catch(t){throw new w(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Rt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Tr=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new w(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new at(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Li=class{constructor(e){this._methodName=e}};var Jo=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new w(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new w(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ne(this._lat,e._lat)||ne(this._long,e._long)}};var aee=/^__.*__$/,YT=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new wr(e,this.data,this.fieldMask,t,this.fieldTransforms):new Vs(e,this.data,t,this.fieldTransforms)}},uy=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new wr(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function K2(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw B()}}var hy=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return dy(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(K2(this.dataSource)&&aee.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},XT=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||sd(e)}createContext(e,t,r,i=!1){return new hy({dataSource:e,methodName:t,targetDoc:r,path:at.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function ra(n){let e=n._freezeSettings(),t=sd(n._databaseId);return new XT(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Py(n,e,t,r,i,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);oI("Data must be an object, but it was:",o,r);let a=X2(r,o),l,c;if(s.merge)l=new On(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let h of s.mergeFields){let d=nb(e,h,t);if(!o.contains(d))throw new w(S.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);Z2(u,d)||u.push(d)}l=new On(u),c=o.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,c=o.fieldTransforms;return new YT(new Yt(a),l,c)}var Qh=class n extends Li{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function Q2(n,e,t){return new hy({dataSource:3,targetDoc:e.settings.targetDoc,methodName:n._methodName,arrayElement:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var JT=class n extends Li{_toFieldTransform(e){return new $o(e.path,new Ls)}isEqual(e){return e instanceof n}},ZT=class n extends Li{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=Q2(this,e,!0),r=this._elements.map(s=>ia(s,t)),i=new Mi(r);return new $o(e.path,i)}isEqual(e){return e instanceof n&&Iv(this._elements,e._elements)}},eb=class n extends Li{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=Q2(this,e,!0),r=this._elements.map(s=>ia(s,t)),i=new Fi(r);return new $o(e.path,i)}isEqual(e){return e instanceof n&&Iv(this._elements,e._elements)}},tb=class n extends Li{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new Bs(e.serializer,xL(e.serializer,this._operand));return new $o(e.path,t)}isEqual(e){return e instanceof n&&this._operand===e._operand}};function iI(n,e,t,r){let i=n.createContext(1,e,t);oI("Data must be an object, but it was:",i,r);let s=[],o=Yt.empty();na(r,(l,c)=>{let u=aI(e,l,t);c=de(c);let h=i.childContextForFieldPath(u);if(c instanceof Qh)s.push(u);else{let d=ia(c,h);d!=null&&(s.push(u),o.set(u,d))}});let a=new On(s);return new uy(o,a,i.fieldTransforms)}function sI(n,e,t,r,i,s){let o=n.createContext(1,e,t),a=[nb(e,r,t)],l=[i];if(s.length%2!==0)throw new w(S.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(nb(e,s[d])),l.push(s[d+1]);let c=[],u=Yt.empty();for(let d=a.length-1;d>=0;--d)if(!Z2(c,a[d])){let f=a[d],g=l[d];g=de(g);let y=o.childContextForFieldPath(f);if(g instanceof Qh)c.push(f);else{let E=ia(g,y);E!=null&&(c.push(f),u.set(f,E))}}let h=new On(c);return new uy(u,h,o.fieldTransforms)}function Y2(n,e,t,r=!1){let i=n.createContext(r?4:3,e);return ia(t,i)}function ia(n,e){if(n=de(n),J2(n))return oI("Unsupported field value:",e,n),X2(n,e);if(n instanceof Li)return cee(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return lee(n,e)}else return uee(n,e)}function X2(n,e){let t={};return oL(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):na(n,(r,i)=>{let s=ia(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function lee(n,e){let t=[],r=0;for(let i of n){let s=ia(i,e.childContextForArray(r));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),r++}return{arrayValue:{values:t}}}function cee(n,e){if(!K2(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function uee(n,e){if(n=de(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return xL(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=$e.fromDate(n);return{timestampValue:tc(e.serializer,t)}}else if(n instanceof $e){let t=new $e(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:tc(e.serializer,t)}}else{if(n instanceof Jo)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof ai)return{bytesValue:jL(e.serializer,n._byteString)};if(n instanceof Pe){let t=e.databaseId,r=n.firestore._databaseId;if(!r.isEqual(t))throw e.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:bb(n.firestore._databaseId||e.databaseId,n._key.path)}}else throw e.createError(`Unsupported field value: ${ad(n)}`)}}function J2(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof $e)&&!(n instanceof Jo)&&!(n instanceof ai)&&!(n instanceof Pe)&&!(n instanceof Li)}function oI(n,e,t){if(!J2(t)||!IZ(t)){let r=ad(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function nb(n,e,t){if(e=de(e),e instanceof Tr)return e._internalPath;if(typeof e=="string")return aI(n,e);throw dy("Field path arguments must be of type string or ",n,!1,void 0,t)}var hee=new RegExp("[~\\*/\\[\\]]");function aI(n,e,t){if(e.search(hee)>=0)throw dy(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Tr(...e.split("."))._internalPath}catch{throw dy(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function dy(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new w(S.INVALID_ARGUMENT,a+n+l)}function Z2(n,e){return n.some(t=>t.isEqual(e))}var Zo=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Pe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new rb(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(My("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},rb=class extends Zo{data(){return super.data()}};function My(n,e){return typeof e=="string"?aI(n,e):e instanceof Tr?e._internalPath:e._delegate._internalPath}function eB(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new w(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Yh=class{},ea=class extends Yh{};function li(n,e,...t){let r=[];e instanceof Yh&&r.push(e),r=r.concat(t),vee(r);for(let i of r)n=i._apply(n);return n}var fy=class n extends ea{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return nB(e._query,t),new Bt(e.firestore,e.converter,wb(e._query,t))}_parse(e){let t=ra(e.firestore);return dee(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function lI(n,e,t){let r=e,i=My("where",n);return fy._create(i,r,t)}var ib=class n extends Yh{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Te.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(yee(e._query,t),new Bt(e.firestore,e.converter,wb(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var sb=class n extends ea{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=fee(e._query,this._field,this._direction);return new Bt(e.firestore,e.converter,B7(e._query,t))}};function cI(n,e="asc"){let t=e,r=My("orderBy",n);return sb._create(r,t)}var py=class n extends ea{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new Bt(e.firestore,e.converter,Fm(e._query,this._limit,this._limitType))}};function uI(n){return M2("limit",n),py._create("limit",n,"F")}function hI(n){return M2("limitToLast",n),py._create("limitToLast",n,"L")}var gy=class n extends ea{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=tB(e,this.type,this._docOrFields,this._inclusive);return new Bt(e.firestore,e.converter,V7(e._query,t))}};function dI(...n){return gy._create("startAt",n,!0)}function fI(...n){return gy._create("startAfter",n,!1)}var my=class n extends ea{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=tB(e,this.type,this._docOrFields,this._inclusive);return new Bt(e.firestore,e.converter,U7(e._query,t))}};function pI(...n){return my._create("endBefore",n,!1)}function gI(...n){return my._create("endAt",n,!0)}function tB(n,e,t,r){if(t[0]=de(t[0]),t[0]instanceof Zo)return pee(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=ra(n.firestore);return gee(n._query,n.firestore._databaseId,i,e,t,r)}}function dee(n,e,t,r,i,s,o){let a;if(i.isKeyField()){if(s==="array-contains"||s==="array-contains-any")throw new w(S.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if(s==="in"||s==="not-in"){UF(o,s);let c=[];for(let u of o)c.push(VF(r,n,u));a={arrayValue:{values:c}}}else a=VF(r,n,o)}else(s==="in"||s==="not-in"||s==="array-contains-any")&&UF(o,s),a=Y2(t,e,o,s==="in"||s==="not-in");return fe.create(i,s,a)}function fee(n,e,t){if(n.startAt!==null)throw new w(S.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new w(S.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Wo(e,t)}function pee(n,e,t,r,i){if(!r)throw new w(S.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${t}().`);let s=[];for(let o of Jl(n))if(o.field.isKeyField())s.push(jo(e,r.key));else{let a=r.data.field(o.field);if(Cy(a))throw new w(S.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(a!==null)s.push(a);else{let l=o.field.canonicalString();throw new w(S.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${l}' (used as the orderBy) does not exist.`)}}return new si(s,i)}function gee(n,e,t,r,i,s){let o=n.explicitOrderBy;if(i.length>o.length)throw new w(S.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let l=0;l<i.length;l++){let c=i[l];if(o[l].field.isKeyField()){if(typeof c!="string")throw new w(S.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!Cb(n)&&c.indexOf("/")!==-1)throw new w(S.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);let h=n.path.child(ge.fromString(c));if(!P.isDocumentKey(h))throw new w(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${h}' is not because it contains an odd number of segments.`);let d=new P(h);a.push(jo(e,d))}else{let h=Y2(t,r,c);a.push(h)}}return new si(a,s)}function VF(n,e,t){if(t=de(t),typeof t=="string"){if(t==="")throw new w(S.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Cb(e)&&t.indexOf("/")!==-1)throw new w(S.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(ge.fromString(t));if(!P.isDocumentKey(r))throw new w(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return jo(n,new P(r))}else{if(t instanceof Pe)return jo(n,t._key);throw new w(S.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ad(t)}.`)}}function UF(n,e){if(!Array.isArray(n)||n.length===0)throw new w(S.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function mee(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function nB(n,e){let t=_ee(n.filters,mee(e.op));if(t!==null)throw t===e.op?new w(S.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new w(S.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function yee(n,e){let t=n,r=e.getFlattenedFilters();for(let i of r)nB(t,i),t=wb(t,i)}function _ee(n,e){for(let t of n)for(let r of t.getFlattenedFilters())if(e.indexOf(r.op)>=0)return r.op;return null}function vee(n){let e=n.filter(r=>r instanceof ib).length,t=n.filter(r=>r instanceof fy).length;if(e>1||e>0&&t>0)throw new w(S.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}var uc=class{convertValue(e,t="none"){switch(Go(e)){case 0:return null;case 1:return e.booleanValue;case 2:return tt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ps(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw B()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return na(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Jo(tt(e.latitude),tt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=vb(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Rh(e));default:return null}}convertTimestamp(e){let t=xs(e);return new $e(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ge.fromString(e);q(t2(r));let i=new Ms(r.get(1),r.get(3)),s=new P(r.popFirst(5));return i.isEqual(t)||He(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Fy(n,e,t){let r;return n?t&&(t.merge||t.mergeFields)?r=n.toFirestore(e,t):r=n.toFirestore(e):r=e,r}var ob=class extends uc{constructor(e){super(),this.firestore=e}convertBytes(e){return new ai(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Pe(this.firestore,null,t)}};function ab(n){return Eee(n,["next","error","complete"])}function Eee(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var Bi=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},sr=class extends Zo{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new zs(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(My("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},zs=class extends sr{data(e={}){return super.data(e)}},br=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Bi(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new zs(this._firestore,this._userDataWriter,r.key,r,new Bi(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new w(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=See(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function See(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new zs(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Bi(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new zs(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Bi(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),o=t.indexOf(r.doc.key)),{type:Cee(r.type),doc:i,oldIndex:s,newIndex:o}})}}function Cee(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return B()}}function Ly(n,e){return n instanceof sr&&e instanceof sr?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof br&&e instanceof br?n._firestore===e._firestore&&xy(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot):!1}function mI(n){n=me(n,Pe);let e=me(n.firestore,ze),t=vt(e);return V2(t,n._key).then(r=>bI(e,n,r))}var Vi=class extends uc{constructor(e){super(),this.firestore=e}convertBytes(e){return new ai(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Pe(this.firestore,null,t)}};function yI(n){n=me(n,Pe);let e=me(n.firestore,ze),t=vt(e),r=new Vi(e);return VZ(t,n._key).then(i=>new sr(e,r,n._key,i,new Bi(i!==null&&i.hasLocalMutations,!0),n.converter))}function _I(n){n=me(n,Pe);let e=me(n.firestore,ze),t=vt(e);return V2(t,n._key,{source:"server"}).then(r=>bI(e,n,r))}function vI(n){n=me(n,Bt);let e=me(n.firestore,ze),t=vt(e),r=new Vi(e);return eB(n._query),U2(t,n._query).then(i=>new br(e,r,n,i))}function EI(n){n=me(n,Bt);let e=me(n.firestore,ze),t=vt(e),r=new Vi(e);return UZ(t,n._query).then(i=>new br(e,r,n,i))}function SI(n){n=me(n,Bt);let e=me(n.firestore,ze),t=vt(e),r=new Vi(e);return U2(t,n._query,{source:"server"}).then(i=>new br(e,r,n,i))}function By(n,e,t){n=me(n,Pe);let r=me(n.firestore,ze),i=Fy(n.converter,e,t),s=ra(r),a=Py(s,"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,et.none());return Cc(r,[a])}function Vy(n,e,t,...r){n=me(n,Pe);let i=me(n.firestore,ze),s=ra(i);e=de(e);let o;typeof e=="string"||e instanceof Tr?o=sI(s,"updateDoc",n._key,e,t,r):o=iI(s,"updateDoc",n._key,e);let a=o.toMutation(n._key,et.exists(!0));return Cc(i,[a])}function CI(n){let e=me(n.firestore,ze),t=[new Us(n._key,et.none())];return Cc(e,t)}function wI(n,e){let t=me(n.firestore,ze),r=Sc(n),i=Fy(n.converter,e),s=ra(n.firestore),a=Py(s,"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,et.exists(!1));return Cc(t,[a]).then(()=>r)}function Uy(n,...e){var t,r,i;n=de(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]=="object"&&!ab(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(ab(e[o])){let d=e[o];e[o]=(t=d.next)===null||t===void 0?void 0:t.bind(d),e[o+1]=(r=d.error)===null||r===void 0?void 0:r.bind(d),e[o+2]=(i=d.complete)===null||i===void 0?void 0:i.bind(d)}let l,c,u;if(n instanceof Pe)c=me(n.firestore,ze),u=gc(n._key.path),l={next:d=>{e[o]&&e[o](bI(c,n,d))},error:e[o+1],complete:e[o+2]};else{let d=me(n,Bt);c=me(d.firestore,ze),u=d._query;let f=new Vi(c);l={next:g=>{e[o]&&e[o](new br(c,f,d,g))},error:e[o+1],complete:e[o+2]},eB(n._query)}let h=vt(c);return BZ(h,u,a,l)}function TI(n,e){n=me(n,ze);let t=vt(n),r=ab(e)?e:{next:e};return zZ(t,r)}function Cc(n,e){let t=vt(n);return qZ(t,e)}function bI(n,e,t){let r=t.docs.get(e._key),i=new Vi(n);return new sr(n,i,e._key,r,new Bi(t.hasPendingWrites,t.fromCache),e.converter)}var wee={maxAttempts:5};function Tee(n){if(n.maxAttempts<1)throw new w(S.INVALID_ARGUMENT,"Max attempts must be at least 1")}var yy=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ra(e)}set(e,t,r){this._verifyNotCommitted();let i=Ns(e,this._firestore),s=Fy(i.converter,t,r),o=Py(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,et.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=Ns(e,this._firestore);t=de(t);let o;return typeof t=="string"||t instanceof Tr?o=sI(this._dataReader,"WriteBatch.update",s._key,t,r,i):o=iI(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,et.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Ns(e,this._firestore);return this._mutations=this._mutations.concat(new Us(t._key,et.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new w(S.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Ns(n,e){if(n=de(n),n.firestore!==e)throw new w(S.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var lb=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=ra(e)}get(e){let t=Ns(e,this._firestore),r=new ob(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return B();let s=i[0];if(s.isFoundDocument())return new Zo(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new Zo(this._firestore,r,t._key,null,t.converter);throw B()})}set(e,t,r){let i=Ns(e,this._firestore),s=Fy(i.converter,t,r),o=Py(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(e,t,r,...i){let s=Ns(e,this._firestore);t=de(t);let o;return typeof t=="string"||t instanceof Tr?o=sI(this._dataReader,"Transaction.update",s._key,t,r,i):o=iI(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=Ns(e,this._firestore);return this._transaction.delete(t._key),this}};var cb=class extends lb{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Ns(e,this._firestore),r=new Vi(this._firestore);return super.get(e).then(i=>new sr(this._firestore,r,t._key,i._document,new Bi(!1,!1),t.converter))}};function II(n,e,t){n=me(n,ze);let r=Object.assign(Object.assign({},wee),t);Tee(r);let i=vt(n);return GZ(i,s=>e(new cb(n,s)),r)}function AI(){return new Qh("deleteField")}function DI(){return new JT("serverTimestamp")}function RI(...n){return new ZT("arrayUnion",n)}function NI(...n){return new eb("arrayRemove",n)}function kI(n){return new tb("increment",n)}oee("node");var ld=class{constructor(e){return e}},rB="firestore",OI=class{constructor(){return uu(rB)}};var xI=new Ie("angularfire2.firestore-instances");function bee(n,e){let t=Wv(rB,n,e);return t&&new ld(t)}function Iee(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new ld(r)}}var Aee={provide:OI,deps:[[new uo,xI]]},Dee={provide:ld,useFactory:bee,deps:[[new uo,xI],Gf]},Ree=(()=>{class n{constructor(){tn("angularfire",Ei.full,"fst")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Mt({type:n});static \u0275inj=Pt({providers:[Dee,Aee]})}return n})();function iB(n,...e){return{ngModule:Ree,providers:[{provide:xI,useFactory:Iee(n),multi:!0,deps:[Un,dv,Si,jf,[new uo,Wf],[new uo,Gn],...e]}]}}var sB=Hv(j2,!0);var Nee="firebase",kee="10.10.0";zt.registerVersion(Nee,kee,"app-compat");var Oee=["ngOnDestroy"],aB=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(Oee.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[s];return typeof l=="function"?l.bind(a):l?.then?l.then(c=>t.run(()=>c)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,c)=>o.then(u=>{let h=u?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,h),h})})})});var qy=class{constructor(e){return e}},Ks=new Ie("angularfire2.app.options"),Qs=new Ie("angularfire2.app.name");function sa(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=zt.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>zt.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;xee("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new qy(o)}var xee=(n,...e)=>{vv()&&typeof console<"u"&&console[n](...e)},Pee={provide:qy,useFactory:sa,deps:[Ks,Un,[new uo,Qs]]},lB=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:Ks,useValue:t},{provide:Qs,useValue:r}]}}constructor(t){zt.registerVersion("angularfire",Ei.full,"core"),zt.registerVersion("angularfire",Ei.full,"app-compat"),zt.registerVersion("angular",LR.full,t.toString())}static \u0275fac=function(r){return new(r||n)(G(Wi))};static \u0275mod=Mt({type:n});static \u0275inj=Pt({providers:[Pee]})}return n})();function wc(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return Mee(i,o)||(oB("error",`${e} was already initialized on the ${t} Firebase App with different settings.${Fee?" You may need to reload as Firebase is not HMR aware.":""}`),oB("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function Mee(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var Fee=typeof module<"u"&&!!module.hot,oB=(n,...e)=>{vv()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Lee=new Map,Bee={activated:!1,tokenObservers:[]},Vee={initialized:!1,enabled:!1};function Ir(n){return Lee.get(n)||Object.assign({},Bee)}function fB(){return Vee}var Uee="https://content-firebaseappcheck.googleapis.com/v1";var qee="exchangeDebugToken",cB={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},Wue=24*60*60*1e3;var MI=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return m(this,null,function*(){this.stop();try{this.pending=new Ct,this.pending.promise.catch(t=>{}),yield zee(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Ct,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function zee(n){return new Promise(e=>{setTimeout(e,n)})}var Gee={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Ys=new YR("appCheck","AppCheck",Gee);function pB(n){if(!Ir(n).activated)throw Ys.create("use-before-activation",{appName:n.name})}function gB(r,i){return m(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let f=yield o.getHeartbeatsHeader();f&&(s["X-Firebase-Client"]=f)}let a={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,a)}catch(f){throw Ys.create("fetch-network-error",{originalErrorMessage:f?.message})}if(l.status!==200)throw Ys.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(f){throw Ys.create("fetch-parse-error",{originalErrorMessage:f?.message})}let u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw Ys.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let h=Number(u[1])*1e3,d=Date.now();return{token:c.token,expireTimeMillis:d+h,issuedAtTimeMillis:d}})}function mB(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${Uee}/projects/${t}/apps/${r}:${qee}?key=${i}`,body:{debug_token:e}}}var jee="firebase-app-check-database",Wee=1,FI="firebase-app-check-store";var zy=null;function Hee(){return zy||(zy=new Promise((n,e)=>{try{let t=indexedDB.open(jee,Wee);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Ys.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(FI,{keyPath:"compositeKey"})}}}catch(t){e(Ys.create("storage-open",{originalErrorMessage:t?.message}))}}),zy)}function $ee(n,e){return Kee(Qee(n),e)}function Kee(n,e){return m(this,null,function*(){let r=(yield Hee()).transaction(FI,"readwrite"),s=r.objectStore(FI).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=l=>{o()},r.onerror=l=>{var c;a(Ys.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function Qee(n){return`${n.options.appId}-${n.name}`}var LI=new Ki("@firebase/app-check");function PI(n,e){return vf()?$ee(n,e).catch(t=>{LI.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function yB(){return fB().enabled}function _B(){return m(this,null,function*(){let n=fB();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var Yee={error:"UNKNOWN_ERROR"};function Xee(n){return yf.encodeString(JSON.stringify(n),!1)}function BI(n,e=!1){return m(this,null,function*(){let t=n.app;pB(t);let r=Ir(t),i=r.token,s;if(i&&!cd(i)&&(r.token=void 0,i=void 0),!i){let l=yield r.cachedTokenPromise;l&&(cd(l)?i=l:yield PI(t,void 0))}if(!e&&i&&cd(i))return{token:i.token};let o=!1;if(yB()){r.exchangeTokenPromise||(r.exchangeTokenPromise=gB(mB(t,yield _B()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let l=yield r.exchangeTokenPromise;return yield PI(t,l),r.token=l,{token:l.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield Ir(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?LI.warn(l.message):LI.error(l),s=l}let a;return i?s?cd(i)?a={token:i.token,internalError:s}:a=hB(s):(a={token:i.token},r.token=i,yield PI(t,i)):a=hB(s),o&&tte(t,a),a})}function Jee(n){return m(this,null,function*(){let e=n.app;pB(e);let{provider:t}=Ir(e);if(yB()){let r=yield _B(),{token:i}=yield gB(mB(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function Zee(n,e,t,r){let{app:i}=n,s=Ir(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&cd(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),uB(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>uB(n))}function vB(n,e){let t=Ir(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function uB(n){let{app:e}=n,t=Ir(e),r=t.tokenRefresher;r||(r=ete(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function ete(n){let{app:e}=n;return new MI(()=>m(this,null,function*(){let t=Ir(e),r;if(t.token?r=yield BI(n,!0):r=yield BI(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=Ir(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},cB.RETRIAL_MIN_WAIT,cB.RETRIAL_MAX_WAIT)}function tte(n,e){let t=Ir(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function cd(n){return n.expireTimeMillis-Date.now()>0}function hB(n){return{token:Xee(Yee),error:n}}var VI=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Ir(this.app);for(let t of e)vB(this.app,t.next);return Promise.resolve()}};function nte(n,e){return new VI(n,e)}function rte(n){return{getToken:e=>BI(n,e),getLimitedUseToken:()=>Jee(n),addTokenListener:e=>Zee(n,"INTERNAL",e),removeTokenListener:e=>vB(n.app,e)}}var ite="@firebase/app-check",ste="0.8.3";var ote="app-check",dB="app-check-internal";function ate(){fo(new bn(ote,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return nte(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(dB).initialize()})),fo(new bn(dB,n=>{let e=n.getProvider("app-check").getImmediate();return rte(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),tn(ite,ste)}ate();var lte=["localhost","0.0.0.0","127.0.0.1"],rhe=typeof window<"u"&&lte.includes(window.location.hostname);var ud=new Ie("angularfire2.auth.use-emulator"),hd=new Ie("angularfire2.auth.settings"),dd=new Ie("angularfire2.auth.tenant-id"),fd=new Ie("angularfire2.auth.langugage-code"),pd=new Ie("angularfire2.auth.use-device-language"),gd=new Ie("angularfire.auth.persistence"),md=(n,e,t,r,i,s,o,a)=>wc(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),r&&(l.tenantId=r),l.languageCode=i,s&&l.useDeviceLanguage(),o)for(let[c,u]of Object.entries(o))l.settings[c]=u;return a&&l.setPersistence(a),l},[t,r,i,s,o,a]),Gy=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,l,c,u,h,d,f){let g=new TR,y=wn(void 0).pipe(ji(o.outsideAngular),yi(()=>s.runOutsideAngular(()=>import("./chunk-IHBN2FX2.mjs"))),ke(()=>sa(t,s,r)),ke(E=>md(E,s,a,c,u,h,l,d)),uv({bufferSize:1,refCount:!1}));if(gf(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=wn(null);else{y.pipe(AR()).subscribe();let E=y.pipe(yi(N=>N.getRedirectResult().then(k=>k,()=>null)),Xe,uv({bufferSize:1,refCount:!1})),I=y.pipe(yi(N=>new Rr(k=>({unsubscribe:s.runOutsideAngular(()=>N.onAuthStateChanged(U=>k.next(U),U=>k.error(U),()=>k.complete()))})))),C=y.pipe(yi(N=>new Rr(k=>({unsubscribe:s.runOutsideAngular(()=>N.onIdTokenChanged(U=>k.next(U),U=>k.error(U),()=>k.complete()))}))));this.authState=E.pipe(hv(I),lo(o.outsideAngular),ji(o.insideAngular)),this.user=E.pipe(hv(C),lo(o.outsideAngular),ji(o.insideAngular)),this.idToken=this.user.pipe(yi(N=>N?Nr(N.getIdToken()):wn(null))),this.idTokenResult=this.user.pipe(yi(N=>N?Nr(N.getIdTokenResult()):wn(null))),this.credential=Kc(E,g,this.authState.pipe(Qc(N=>!N))).pipe(ke(N=>N?.user?N:null),lo(o.outsideAngular),ji(o.insideAngular))}return aB(this,y,s,{spy:{apply:(E,I,C)=>{(E.startsWith("signIn")||E.startsWith("createUser"))&&C.then(N=>g.next(N))}}})}static \u0275fac=function(r){return new(r||n)(G(Ks),G(Qs,8),G(Wi),G(Un),G(Si),G(ud,8),G(hd,8),G(dd,8),G(fd,8),G(pd,8),G(gd,8),G(Gn,8))};static \u0275prov=Et({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var cte="@firebase/firestore-compat",ute="0.3.28";function HI(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new w("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function SB(){if(typeof Uint8Array>"u")throw new w("unimplemented","Uint8Arrays are not available in this environment.")}function CB(){if(!aL())throw new w("unimplemented","Blobs are unavailable in Firestore in this environment.")}var jy=class n{constructor(e){this._delegate=e}static fromBase64String(e){return CB(),new n(ai.fromBase64String(e))}static fromUint8Array(e){return SB(),new n(ai.fromUint8Array(e))}toBase64(){return CB(),this._delegate.toBase64()}toUint8Array(){return SB(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function qI(n){return hte(n,["next","error","complete"])}function hte(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var zI=class{enableIndexedDbPersistence(e,t){return Yb(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return Xb(e._delegate)}clearIndexedDbPersistence(e){return Jb(e._delegate)}},Wy=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Ms||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&rr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){Ny(this._delegate,e,t,r)}enableNetwork(){return eI(this._delegate)}disableNetwork(){return tI(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,Wb("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Zb(this._delegate)}onSnapshotsInSync(e){return TI(this._delegate,e)}get app(){if(!this._appCompat)throw new w("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Ic(this,ky(this._delegate,e))}catch(t){throw un(t,"collection()","Firestore.collection()")}}doc(e){try{return new ci(this,Sc(this._delegate,e))}catch(t){throw un(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ca(this,Qb(this._delegate,e))}catch(t){throw un(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return II(this._delegate,t=>e(new Hy(this,t)))}batch(){return vt(this._delegate),new $y(new yy(this._delegate,e=>Cc(this._delegate,e)))}loadBundle(e){return nI(this._delegate,e)}namedQuery(e){return rI(this._delegate,e).then(t=>t?new ca(this,t):null)}},Tc=class extends uc{constructor(e){super(),this.firestore=e}convertBytes(e){return new jy(new ai(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return ci.forKey(t,this.firestore,null)}};function dte(n){ub(n)}var Hy=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Tc(e)}get(e){let t=oa(e);return this._delegate.get(t).then(r=>new aa(this._firestore,new sr(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=oa(e);return r?(HI("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=oa(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=oa(e);return this._delegate.delete(t),this}},$y=class{constructor(e){this._delegate=e}set(e,t,r){let i=oa(e);return r?(HI("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=oa(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=oa(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},bc=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new zs(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new la(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new Tc(e),t),i.set(t,s)),s}};bc.INSTANCES=new WeakMap;var ci=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Tc(e)}static forPath(e,t,r){if(e.length%2!==0)throw new w("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new Pe(t._delegate,r,new P(e)))}static forKey(e,t,r){return new n(t,new Pe(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Ic(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Ic(this.firestore,ky(this._delegate,e))}catch(t){throw un(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=de(e),e instanceof Pe?Oy(this._delegate,e):!1}set(e,t){t=HI("DocumentReference.set",t);try{return t?By(this._delegate,e,t):By(this._delegate,e)}catch(r){throw un(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?Vy(this._delegate,e):Vy(this._delegate,e,t,...r)}catch(i){throw un(i,"updateDoc()","DocumentReference.update()")}}delete(){return CI(this._delegate)}onSnapshot(...e){let t=wB(e),r=TB(e,i=>new aa(this.firestore,new sr(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Uy(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=yI(this._delegate):e?.source==="server"?t=_I(this._delegate):t=mI(this._delegate),t.then(r=>new aa(this.firestore,new sr(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(bc.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function un(n,e,t){return n.message=n.message.replace(e,t),n}function wB(n){for(let e of n)if(typeof e=="object"&&!qI(e))return e;return{}}function TB(n,e){var t,r;let i;return qI(n[0])?i=n[0]:qI(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var aa=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new ci(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Ly(this._delegate,e._delegate)}},la=class extends aa{data(e){let t=this._delegate.data(e);return this._delegate._converter||zF(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},ca=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Tc(e)}where(e,t,r){try{return new n(this.firestore,li(this._delegate,lI(e,t,r)))}catch(i){throw un(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,li(this._delegate,cI(e,t)))}catch(r){throw un(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,li(this._delegate,uI(e)))}catch(t){throw un(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,li(this._delegate,hI(e)))}catch(t){throw un(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,li(this._delegate,dI(...e)))}catch(t){throw un(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,li(this._delegate,fI(...e)))}catch(t){throw un(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,li(this._delegate,pI(...e)))}catch(t){throw un(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,li(this._delegate,gI(...e)))}catch(t){throw un(t,"endAt()","Query.endAt()")}}isEqual(e){return xy(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=EI(this._delegate):e?.source==="server"?t=SI(this._delegate):t=vI(this._delegate),t.then(r=>new yd(this.firestore,new br(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=wB(e),r=TB(e,i=>new yd(this.firestore,new br(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Uy(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(bc.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},GI=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new la(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},yd=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ca(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new la(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new GI(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new la(this._firestore,r))})}isEqual(e){return Ly(this._delegate,e._delegate)}},Ic=class n extends ca{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new ci(this.firestore,e):null}doc(e){try{return e===void 0?new ci(this.firestore,Sc(this._delegate)):new ci(this.firestore,Sc(this._delegate,e))}catch(t){throw un(t,"doc()","CollectionReference.doc()")}}add(e){return wI(this._delegate,e).then(t=>new ci(this.firestore,t))}isEqual(e){return Oy(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(bc.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function oa(n){return me(n,Pe)}var jI=class n{constructor(...e){this._delegate=new Tr(...e)}static documentId(){return new n(at.keyField().canonicalString())}isEqual(e){return e=de(e),e instanceof Tr?this._delegate._internalPath.isEqual(e._internalPath):!1}};var WI=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=DI();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=AI();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=RI(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=NI(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=kI(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var fte={Firestore:Wy,GeoPoint:Jo,Timestamp:$e,Blob:jy,Transaction:Hy,WriteBatch:$y,DocumentReference:ci,DocumentSnapshot:aa,Query:ca,QueryDocumentSnapshot:la,QuerySnapshot:yd,CollectionReference:Ic,FieldPath:jI,FieldValue:WI,setLogLevel:dte,CACHE_SIZE_UNLIMITED:G2};function pte(n,e){n.INTERNAL.registerComponent(new bn("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},fte)))}function gte(n){pte(n,(e,t)=>new Wy(e,t,new zI)),n.registerVersion(cte,ute,"node")}gte(zt);function mte(n,e=Da){return new Rr(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function bB(n,e){return mte(n,e)}function yte(n,e){return bB(n,e).pipe(ff(void 0),df(),ke(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function QI(n,e){return bB(n,e).pipe(ke(t=>({payload:t,type:"query"})))}var Ky=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=DB(r,t);return new Yy(i,s,this.afs)}snapshotChanges(){return yte(this.ref,this.afs.schedulers.outsideAngular).pipe(Xe)}valueChanges(e={}){return this.snapshotChanges().pipe(ke(({payload:t})=>e.idField?Bn(mt({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Nr(this.ref.get(e)).pipe(Xe)}};function Qy(n,e){return QI(n,e).pipe(ff(void 0),df(),ke(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,l)=>{let c=s.find(h=>h.doc.ref.isEqual(a.ref)),u=r?.payload.docs.find(h=>h.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&u&&JSON.stringify(u.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:a}})}),o}))}function IB(n,e,t){return Qy(n,t).pipe(co((r,i)=>_te(r,i.map(s=>s.payload),e),[]),hf(),ke(r=>r.map(i=>({type:i.type,payload:i}))))}function _te(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=vte(n,r))}),n}function $I(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function vte(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return $I(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return $I(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return $I(n,e.oldIndex,1);break}return n}function AB(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Yy=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Qy(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(ke(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(ff(void 0),df(),Qc(([r,i])=>i.length>0||!r),ke(([,r])=>r),Xe)}auditTrail(e){return this.stateChanges(e).pipe(co((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=AB(e);return IB(this.query,t,this.afs.schedulers.outsideAngular).pipe(Xe)}valueChanges(e={}){return QI(this.query,this.afs.schedulers.outsideAngular).pipe(ke(t=>t.payload.docs.map(r=>e.idField?Bn(mt({},r.data()),{[e.idField]:r.id}):r.data())),Xe)}get(e){return Nr(this.query.get(e)).pipe(Xe)}add(e){return this.ref.add(e)}doc(e){return new Ky(this.ref.doc(e),this.afs)}},KI=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Qy(this.query,this.afs.schedulers.outsideAngular).pipe(Xe):Qy(this.query,this.afs.schedulers.outsideAngular).pipe(ke(t=>t.filter(r=>e.indexOf(r.type)>-1)),Qc(t=>t.length>0),Xe)}auditTrail(e){return this.stateChanges(e).pipe(co((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=AB(e);return IB(this.query,t,this.afs.schedulers.outsideAngular).pipe(Xe)}valueChanges(e={}){return QI(this.query,this.afs.schedulers.outsideAngular).pipe(ke(r=>r.payload.docs.map(i=>e.idField?mt({[e.idField]:i.id},i.data()):i.data())),Xe)}get(e){return Nr(this.query.get(e)).pipe(Xe)}},Ete=new Ie("angularfire2.enableFirestorePersistence"),Ste=new Ie("angularfire2.firestore.persistenceSettings"),Cte=new Ie("angularfire2.firestore.settings"),wte=new Ie("angularfire2.firestore.use-emulator");function DB(n,e=t=>t){return{query:e(n),ref:n}}var RB=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,l,c,u,h,d,f,g,y,E,I,C){this.schedulers=l;let N=sa(t,a,r),k=u;h&&md(N,a,d,g,y,E,f,I),[this.firestore,this.persistenceEnabled$]=wc(`${N.name}.firestore`,"AngularFirestore",N.name,()=>{let U=a.runOutsideAngular(()=>N.firestore());if(s&&U.settings(s),k&&U.useEmulator(...k),i&&!gf(o)){let J=()=>{try{return Nr(U.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(ue){return typeof console<"u"&&console.warn(ue),wn(!1)}};return[U,a.runOutsideAngular(J)]}else return[U,wn(!1)]},[s,k,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=DB(i,r),a=this.schedulers.ngZone.run(()=>s);return new Yy(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new KI(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new Ky(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(G(Ks),G(Qs,8),G(Ete,8),G(Cte,8),G(Wi),G(Un),G(Si),G(Ste,8),G(wte,8),G(Gy,8),G(ud,8),G(hd,8),G(dd,8),G(fd,8),G(pd,8),G(gd,8),G(Gn,8))};static \u0275prov=Et({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var Xy=(()=>{let e=class e{constructor(r){this.firestore=r}agregarEmpleado(r){return this.firestore.collection("Datos Usuarios").add(r)}getEmpleados(){return this.firestore.collection("Datos Usuarios").snapshotChanges()}eliminarEmpleado(r){return this.firestore.collection("Datos Usuarios").doc(r).delete()}};e.\u0275fac=function(i){return new(i||e)(G(RB))},e.\u0275prov=Et({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function bte(n,e){n&1&&(Q(0,"span",16),se(1,"TODOS LOS CAMPOS SON OBLIGATORIOS"),Y())}var OB=(()=>{let e=class e{constructor(r,i){this.fb=r,this.empleadoService=i,this.submitted=!1,this.crearempleado=this.fb.group({nombre:["",xa.required],email:["",xa.required],phone:["",xa.required]})}ngOnInit(){}agregarempleado(){if(this.submitted=!0,this.crearempleado.invalid)return;let r={nombre:this.crearempleado.value.nombre,email:this.crearempleado.value.email,phone:this.crearempleado.value.phone,fechaCreacion:new Date,fechaActualizacion:new Date};this.empleadoService.agregarEmpleado(r).then(()=>{let i=document.getElementById("notification-message");i&&(i.textContent="Empleado agregado correctamente",this.showNotification(),setTimeout(()=>{this.hideNotification(),this.resetForm()},4e3))}).catch(i=>{console.log(i)})}showNotification(){let r=document.getElementById("notification");r&&r.classList.add("show")}hideNotification(){let r=document.getElementById("notification");r&&(r.classList.remove("show"),r.classList.add("hide"),setTimeout(()=>{r.classList.remove("hide")},300))}resetForm(){this.crearempleado.reset(),this.submitted=!1}};e.\u0275fac=function(i){return new(i||e)(te(B1),te(Xy))},e.\u0275cmp=Vn({type:e,selectors:[["app-crear-empleados"]],decls:22,vars:2,consts:[[1,"container","pt-4"],[1,"row"],[1,"col-lg-6","offset-lg-3"],[1,"card","text-center"],[1,"card-body"],["id","notification",1,"notification"],["id","notification-message"],["class","text-danger",4,"ngIf"],[1,"mt-4",3,"ngSubmit","formGroup"],[1,"col"],["type","text","formControlName","nombre","placeholder","Nombre",1,"form-control","form-control-lg"],["type","text","formControlName","email","placeholder","Email",1,"form-control","form-control-lg"],["type","number","formControlName","phone","placeholder","Telefono",1,"form-control","form-control-lg","mt-3"],[1,"mt-3"],["type","button","routerLink","/lista-empleados",1,"btn","btn-secondary","btn-lg","mr-3"],["type","submit",1,"btn","btn-dark","btn-lg"],[1,"text-danger"]],template:function(i,s){i&1&&(Q(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h3"),se(6,"Agregar Empleado"),Y(),Q(7,"div",5),mn(8,"span",6),Y(),Hi(9,bte,2,0,"span",7),Q(10,"form",8),en("ngSubmit",function(){return s.agregarempleado()}),Q(11,"div",1)(12,"div",9),mn(13,"input",10),Y(),Q(14,"div",9),mn(15,"input",11),Y()(),mn(16,"input",12),Q(17,"div",13)(18,"button",14),se(19,"VOLVER"),Y(),Q(20,"button",15),se(21,"AGREGAR"),Y()()()()()()()()),i&2&&(We(9),cr("ngIf",s.submitted&&s.crearempleado.invalid),We(),cr("formGroup",s.crearempleado))},dependencies:[Na,mf,Uf,La,Vv,Ff,Lf,Uv,qv],styles:[".notification[_ngcontent-%COMP%]{display:none;position:fixed;bottom:20px;right:20px;padding:15px;background-color:#4caf50;color:#fff;border-radius:5px;box-shadow:0 2px 5px #0003;transition:opacity .3s ease}.notification.show[_ngcontent-%COMP%]{display:block;opacity:1}.notification.hide[_ngcontent-%COMP%]{opacity:0}"]});let n=e;return n})();var HU=uf(fU(),1);var m_="5",$U="v",KU="s",QU="r",YU="f",XU=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,JU="ls",ZU="p",LA="ac",eq="websocket",tq="long_polling";var BA=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ut(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Ef(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var VA=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return qn(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var nq=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new BA(e)}}catch{}return new VA},va=nq("localStorage"),UA=nq("sessionStorage");var Pc=new Ki("@firebase/database"),rq=function(){let n=1;return function(){return n++}}(),iq=function(n){let e=t1(n),t=new e1;t.update(e);let r=t.digest();return yf.encodeByteArray(r)},Jd=function(...n){let e="";for(let t=0;t<n.length;t++){let r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Jd.apply(null,r):typeof r=="object"?e+=ut(r):e+=r,e+=" "}return e},Ea=null,pU=!0,sq=function(n,e){O(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Pc.logLevel=zn.VERBOSE,Ea=Pc.log.bind(Pc),e&&UA.set("logging_enabled",!0)):typeof n=="function"?Ea=n:(Ea=null,UA.remove("logging_enabled"))},kt=function(...n){if(pU===!0&&(pU=!1,Ea===null&&UA.get("logging_enabled")===!0&&sq(!0)),Ea){let e=Jd.apply(null,n);Ea(e)}},Zd=function(n){return function(...e){kt(n,...e)}},qA=function(...n){let e="FIREBASE INTERNAL ERROR: "+Jd(...n);Pc.error(e)},pi=function(...n){let e=`FIREBASE FATAL ERROR: ${Jd(...n)}`;throw Pc.error(e),new Error(e)},Xt=function(...n){let e="FIREBASE WARNING: "+Jd(...n);Pc.warn(e)},One=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Xt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},q_=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},xne=function(n){if(Pr()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},no="[MIN_NAME]",qi="[MAX_NAME]",Ca=function(n,e){if(n===e)return 0;if(n===no||e===qi)return-1;if(e===no||n===qi)return 1;{let t=gU(n),r=gU(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},Pne=function(n,e){return n===e?0:n<e?-1:1},Dd=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+ut(e))},qD=function(n){if(typeof n!="object"||n===null)return ut(n);let e=[];for(let r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=ut(e[r]),t+=":",t+=qD(n[e[r]]);return t+="}",t},oq=function(n,e){let t=n.length;if(t<=e)return[n];let r=[];for(let i=0;i<t;i+=e)i+e>t?r.push(n.substring(i,t)):r.push(n.substring(i,i+e));return r};function Ot(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var aq=function(n){O(!q_(n),"Invalid JSON number");let e=11,t=52,r=(1<<e-1)-1,i,s,o,a,l;n===0?(s=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),s=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-r-t))));let c=[];for(l=t;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(s%2?1:0),s=Math.floor(s/2);c.push(i?1:0),c.reverse();let u=c.join(""),h="";for(l=0;l<64;l+=8){let d=parseInt(u.substr(l,8),2).toString(16);d.length===1&&(d="0"+d),h=h+d}return h.toLowerCase()},Mne=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Fne=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Lne(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}var Bne=new RegExp("^-?(0*)\\d{1,10}$"),Vne=-2147483648,Une=2147483647,gU=function(n){if(Bne.test(n)){let e=Number(n);if(e>=Vne&&e<=Une)return e}return null},Gc=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw Xt("Exception was thrown by user callback.",t),e},Math.floor(0))}},qne=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Od=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var y_=class{constructor(e,t,r,i,s=!1,o="",a=!1,l=!1){this.secure=t,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=va.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&va.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function zne(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function lq(n,e,t){O(typeof e=="string","typeof type must == string"),O(typeof t=="object","typeof params must == object");let r;if(e===eq)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===tq)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);zne(n)&&(t.ns=n.namespace);let i=[];return Ot(t,(s,o)=>{i.push(s+"="+o)}),r+i.join("&")}var zA=class{constructor(){this.counters_={}}incrementCounter(e,t=1){qn(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return $R(this.counters_)}};var NA={},kA={};function zD(n){let e=n.toString();return NA[e]||(NA[e]=new zA),NA[e]}function Gne(n,e){let t=n.toString();return kA[t]||(kA[t]=e()),kA[t]}var GD="";function jD(n){GD=n}var jne=16384,Wne=45e3,Ld=null;typeof MozWebSocket<"u"?Ld=MozWebSocket:typeof WebSocket<"u"&&(Ld=WebSocket);function Hne(n){Ld=n}var Oc=(()=>{class n{constructor(t,r,i,s,o,a,l){this.connId=t,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Zd(this.connId),this.stats_=zD(r),this.connURL=n.connectionURL_(r,a,l,s,i),this.nodeAdmin=r.nodeAdmin}static connectionURL_(t,r,i,s,o){let a={};return a[$U]=m_,!Pr()&&typeof location<"u"&&location.hostname&&XU.test(location.hostname)&&(a[QU]=YU),r&&(a[KU]=r),i&&(a[JU]=i),s&&(a[LA]=s),o&&(a[ZU]=o),lq(t,eq,a)}open(t,r){this.onDisconnect=r,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,va.set("previous_websocket_failure",!0);try{let i;if(Pr()){let s=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${m_}/${GD}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a})}this.mySock=new Ld(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let r=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(r);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&Ld!==null&&!n.forceDisallow_}static previouslyFailed(){return va.isInMemoryStorage||va.get("previous_websocket_failure")===!0}markConnectionHealthy(){va.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let r=this.frames.join("");this.frames=null;let i=Ef(r);this.onMessage(i)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(O(this.frames===null,"We already have a frame buffer"),t.length<=6){let r=Number(t);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let r=t.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(r);else{let i=this.extractFrameCount_(r);i!==null&&this.appendFrame_(i)}}send(t){this.resetKeepAlive();let r=ut(t);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);let i=oq(r,jne);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Wne))}sendString_(t){try{this.mySock.send(t)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4,n})(),mU="@firebase/database",yU="1.0.4";var GA=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(r=>this.appCheck=r)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){Xt(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var jA=class{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(kt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Xt(e)}},xd=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),WA=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&Gc(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var _U="start",$ne="close",Kne="pLPCommand",Qne="pRTLPCB",cq="id",uq="pw",hq="ser",Yne="cb",Xne="seg",Jne="ts",Zne="d",ere="dframe",dq=1870,fq=30,tre=dq-fq,nre=25e3,rre=3e4,Bd=class n{constructor(e,t,r,i,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Zd(e),this.stats_=zD(t),this.urlFn=l=>(this.appCheckToken&&(l[LA]=this.appCheckToken),lq(t,tq,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new WA(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(rre)),xne(()=>{if(this.isClosed_)return;this.scriptTagHolder=new HA((...s)=>{let[o,a,l,c,u]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===_U)this.id=a,this.password=l;else if(o===$ne)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let r={};r[_U]="t",r[hq]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[Yne]=this.scriptTagHolder.uniqueCallbackIdentifier),r[$U]=m_,this.transportSessionId&&(r[KU]=this.transportSessionId),this.lastSessionId&&(r[JU]=this.lastSessionId),this.applicationId&&(r[ZU]=this.applicationId),this.appCheckToken&&(r[LA]=this.appCheckToken),typeof location<"u"&&location.hostname&&XU.test(location.hostname)&&(r[QU]=YU);let i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return Pr()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Mne()&&!Fne()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=ut(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let r=HR(t),i=oq(r,tre);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Pr())return;this.myDisconnFrame=document.createElement("iframe");let r={};r[ere]="t",r[cq]=e,r[uq]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=ut(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},HA=class n{constructor(e,t,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Pr())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=rq(),window[Kne+this.uniqueCallbackIdentifier]=e,window[Qne+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";</script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){kt("frame writing exception"),a.stack&&kt(a.stack),kt(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||kt("No IE domain setting required")}catch{let r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[cq]=this.myID,e[uq]=this.myPW,e[hq]=this.currentSerial;let t=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+fq+r.length<=dq;){let o=this.pendingSegs.shift();r=r+"&"+Xne+i+"="+o.seg+"&"+Jne+i+"="+o.ts+"&"+Zne+i+"="+o.d,i++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(r,Math.floor(nre)),s=()=>{clearTimeout(i),r()};this.addTag(e,s)}addTag(e,t){Pr()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){let i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{kt("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}};var pq=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[Bd,Oc]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let r=Oc&&Oc.isAvailable(),i=r&&!Oc.previouslyFailed();if(t.webSocketOnly&&(r||Xt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Oc];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),ire=6e4,sre=5e3,ore=10*1024,are=100*1024,OA="t",vU="d",lre="s",EU="r",cre="e",SU="o",CU="a",wU="n",TU="p",ure="h",$A=class{constructor(e,t,r,i,s,o,a,l,c,u){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Zd("c:"+this.id+":"),this.transportManager_=new pq(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Od(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>are?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>ore?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(OA in e){let t=e[OA];t===CU?this.upgradeIfSecondaryHealthy_():t===EU?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===SU&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=Dd("t",e),r=Dd("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:TU,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:CU,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:wU,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=Dd("t",e),r=Dd("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=Dd(OA,e);if(vU in e){let r=e[vU];if(t===ure){let i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===wU){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===lre?this.onConnectionShutdown_(r):t===EU?this.onReset_(r):t===cre?qA("Server Error: "+r):t===SU?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):qA("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),m_!==r&&Xt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Od(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(ire))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Od(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(sre))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:TU,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(va.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var __=class{put(e,t,r,i){}merge(e,t,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}};var v_=class{constructor(e){this.allowedEvents_=e,this.listeners_={},O(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});let i=this.getInitialEvent(e);i&&t.apply(r,i)}off(e,t,r){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===t&&(!r||r===i[s].context)){i.splice(s,1);return}}validateEventType_(e){O(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var E_=class n extends v_{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Tv()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return O(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var bU=32,IU=768,Ce=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function Se(){return new Ce("")}function oe(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function ro(n){return n.pieces_.length-n.pieceNum_}function Re(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new Ce(n.pieces_,e)}function WD(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function hre(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Vd(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function gq(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new Ce(e,0)}function je(n,e){let t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof Ce)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{let r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&t.push(r[i])}return new Ce(t,0)}function ae(n){return n.pieceNum_>=n.pieces_.length}function fn(n,e){let t=oe(n),r=oe(e);if(t===null)return e;if(t===r)return fn(Re(n),Re(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function dre(n,e){let t=Vd(n,0),r=Vd(e,0);for(let i=0;i<t.length&&i<r.length;i++){let s=Ca(t[i],r[i]);if(s!==0)return s}return t.length===r.length?0:t.length<r.length?-1:1}function HD(n,e){if(ro(n)!==ro(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function or(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(ro(n)>ro(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}var KA=class{constructor(e,t){this.errorPrefix_=t,this.parts_=Vd(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=nu(this.parts_[r]);mq(this)}};function fre(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=nu(e),mq(n)}function pre(n){let e=n.parts_.pop();n.byteLength_-=nu(e),n.parts_.length>0&&(n.byteLength_-=1)}function mq(n){if(n.byteLength_>IU)throw new Error(n.errorPrefix_+"has a key path longer than "+IU+" bytes ("+n.byteLength_+").");if(n.parts_.length>bU)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+bU+") or object contains a cycle "+_a(n))}function _a(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var QA=class n extends v_{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new n}getInitialEvent(e){return O(e==="visible","Unknown event type: "+e),[this.visible_]}};var Rd=1e3,gre=60*5*1e3,AU=30*1e3,mre=1.3,yre=3e4,_re="server_kill",DU=3,$D=(()=>{class n extends __{constructor(t,r,i,s,o,a,l,c){if(super(),this.repoInfo_=t,this.applicationId_=r,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=Zd("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Rd,this.maxReconnectDelay_=gre,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!Pr())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");QA.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&E_.getInstance().on("online",this.onOnline_,this)}sendRequest(t,r,i){let s=++this.requestNumber_,o={r:s,a:t,b:r};this.log_(ut(o)),O(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[s]=i)}get(t){this.initConnection_();let r=new Ct,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let l=a.d;a.s==="ok"?r.resolve(l):r.reject(l)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),r.promise}listen(t,r,i,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),O(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),O(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let l={onComplete:s,hashFn:r,query:t,tag:i};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(t){let r=this.outstandingGets_[t];this.sendRequest("g",r.request,i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(i)})}sendListen_(t){let r=t.query,i=r._path.toString(),s=r._queryIdentifier;this.log_("Listen on "+i+" for "+s);let o={p:i},a="q";t.tag&&(o.q=r._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,l=>{let c=l.d,u=l.s;n.warnOnListenWarnings_(c,r),(this.listens.get(i)&&this.listens.get(i).get(s))===t&&(this.log_("listen response",l),u!=="ok"&&this.removeListen_(i,s),t.onComplete&&t.onComplete(u,c))})}static warnOnListenWarnings_(t,r){if(t&&typeof t=="object"&&qn(t,"w")){let i=$i(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let s='".indexOn": "'+r._queryParams.getIndex().toString()+'"',o=r._path.toString();Xt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||JR(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=AU)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,r=XR(t)?"auth":"gauth",i={cred:t};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(r,i,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let r=t.s,i=t.d||"error";r==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,i)})}unlisten(t,r){let i=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),O(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,t._queryObject,r)}sendUnlisten_(t,r,i,s){this.log_("Unlisten on "+t+" for "+r);let o={p:t},a="n";s&&(o.q=i,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:r,onComplete:i})}onDisconnectMerge(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:r,onComplete:i})}onDisconnectCancel(t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(t,r,i,s){let o={p:r,d:i};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,r,i,s){this.putInternal("p",t,r,i,s)}merge(t,r,i,s){this.putInternal("m",t,r,i,s)}putInternal(t,r,i,s,o){this.initConnection_();let a={p:r,d:i};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+r)}sendPut_(t){let r=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(r,i,o=>{this.log_(r+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let r={c:t};this.log_("reportStats",r),this.sendRequest("s",r,i=>{if(i.s!=="ok"){let o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+ut(t));let r=t.r,i=this.requestCBHash_[r];i&&(delete this.requestCBHash_[r],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,r){this.log_("handleServerMessage",t,r),t==="d"?this.onDataUpdate_(r.p,r.d,!1,r.t):t==="m"?this.onDataUpdate_(r.p,r.d,!0,r.t):t==="c"?this.onListenRevoked_(r.p,r.q):t==="ac"?this.onAuthRevoked_(r.s,r.d):t==="apc"?this.onAppCheckRevoked_(r.s,r.d):t==="sd"?this.onSecurityDebugPacket_(r):qA("Unrecognized action received from server: "+ut(t)+`
Are you using the latest client?`)}onReady_(t,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){O(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Rd,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Rd,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>yre&&(this.reconnectDelay_=Rd),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,r=Math.max(0,this.reconnectDelay_-t);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*mre)}this.onConnectStatus_(!1)}establishConnection_(){return m(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,l=null,c=function(){l?l.close():(a=!0,i())},u=function(d){O(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(d)};this.realtime_={close:c,sendRequest:u};let h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[d,f]=yield Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);a?kt("getToken() completed but was canceled"):(kt("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=f&&f.token,l=new $A(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,r,i,g=>{Xt(g+" ("+this.repoInfo_.toString()+")"),this.interrupt(_re)},o))}catch(d){this.log_("Failed to get token: "+d),a||(this.repoInfo_.nodeAdmin&&Xt(d),c())}}})}interrupt(t){kt("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){kt("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Sf(this.interruptReasons_)&&(this.reconnectDelay_=Rd,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let r=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let r=this.outstandingPuts_[t];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,r){let i;r?i=r.map(o=>qD(o)).join("$"):i="default";let s=this.removeListen_(t,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,r){let i=new Ce(t).toString(),s;if(this.listens.has(i)){let o=this.listens.get(i);s=o.get(r),o.delete(r),o.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(t,r){kt("Auth token revoked: "+t+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=DU&&(this.reconnectDelay_=AU,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,r){kt("App check token revoked: "+t+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=DU&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let r of t.values())this.sendListen_(r);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},r="js";Pr()&&(this.repoInfo_.nodeAdmin?r="admin_node":r="node"),t["sdk."+r+"."+GD.replace(/\./g,"-")]=1,Tv()?t["framework.cordova"]=1:KR()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=E_.getInstance().currentlyOnline();return Sf(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),ce=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var Mc=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let r=new ce(no,e),i=new ce(no,t);return this.compare(r,i)!==0}minPost(){return ce.MIN}};var g_,S_=class extends Mc{static get __EMPTY_NODE(){return g_}static set __EMPTY_NODE(e){g_=e}compare(e,t){return Ca(e.name,t.name)}isDefinedOn(e){throw ka("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return ce.MIN}maxPost(){return new ce(qi,g_)}makePost(e,t){return O(typeof e=="string","KeyIndex indexValue must always be a string."),new ce(e,g_)}toString(){return".key"}},fi=new S_;var xc=class{constructor(e,t,r,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Ar=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??ar.EMPTY_NODE,this.right=o??ar.EMPTY_NODE}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return ar.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,r){let i,s;if(i=this,r(t,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,r),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),r(t,i.key)===0){if(i.right.isEmpty())return ar.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,r))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),YA=class{copy(e,t,r,i,s){return this}insert(e,t,r){return new Ar(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},ar=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Ar.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Ar.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,i=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new xc(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new xc(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new xc(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new xc(this.root_,null,this.comparator_,!0,e)}};ar.EMPTY_NODE=new YA;function vre(n,e){return Ca(n.name,e.name)}function KD(n,e){return Ca(n,e)}var XA;function Ere(n){XA=n}var yq=function(n){return typeof n=="number"?"number:"+aq(n):"string:"+n},_q=function(n){if(n.isLeafNode()){let e=n.val();O(typeof e=="string"||typeof e=="number"||typeof e=="object"&&qn(e,".sv"),"Priority must be a string or number.")}else O(n===XA||n.isEmpty(),"priority of unexpected type.");O(n===XA||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var RU,Fc=(()=>{class n{constructor(t,r=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=r,this.lazyHash_=null,O(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),_q(this.priorityNode_)}static set __childrenNodeConstructor(t){RU=t}static get __childrenNodeConstructor(){return RU}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return ae(t)?this:oe(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,r){return null}updateImmediateChild(t,r){return t===".priority"?this.updatePriority(r):r.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,r).updatePriority(this.priorityNode_)}updateChild(t,r){let i=oe(t);return i===null?r:r.isEmpty()&&i!==".priority"?this:(O(i!==".priority"||ro(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(Re(t),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,r){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+yq(this.priorityNode_.val())+":");let r=typeof this.value_;t+=r+":",r==="number"?t+=aq(this.value_):t+=this.value_,this.lazyHash_=iq(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(O(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let r=typeof t.value_,i=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(r),o=n.VALUE_TYPE_ORDER.indexOf(i);return O(s>=0,"Unknown leaf type: "+r),O(o>=0,"Unknown leaf type: "+i),s===o?i==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let r=t;return this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),vq,Eq;function Sre(n){vq=n}function Cre(n){Eq=n}var JA=class extends Mc{compare(e,t){let r=e.node.getPriority(),i=t.node.getPriority(),s=r.compareTo(i);return s===0?Ca(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return ce.MIN}maxPost(){return new ce(qi,new Fc("[PRIORITY-POST]",Eq))}makePost(e,t){let r=vq(e);return new ce(t,new Fc("[PRIORITY-POST]",r))}toString(){return".priority"}},Me=new JA;var wre=Math.log(2),ZA=class{constructor(e){let t=s=>parseInt(Math.log(s)/wre,10),r=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},C_=function(n,e,t,r){n.sort(e);let i=function(l,c){let u=c-l,h,d;if(u===0)return null;if(u===1)return h=n[l],d=t?t(h):h,new Ar(d,h.node,Ar.BLACK,null,null);{let f=parseInt(u/2,10)+l,g=i(l,f),y=i(f+1,c);return h=n[f],d=t?t(h):h,new Ar(d,h.node,Ar.BLACK,g,y)}},s=function(l){let c=null,u=null,h=n.length,d=function(g,y){let E=h-g,I=h;h-=g;let C=i(E+1,I),N=n[E],k=t?t(N):N;f(new Ar(k,N.node,y,null,C))},f=function(g){c?(c.left=g,c=g):(u=g,c=g)};for(let g=0;g<l.count;++g){let y=l.nextBitIsOne(),E=Math.pow(2,l.count-(g+1));y?d(E,Ar.BLACK):(d(E,Ar.BLACK),d(E,Ar.RED))}return u},o=new ZA(n.length),a=s(o);return new ar(r||e,a)};var xA,kc={},Lc=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return O(kc&&Me,"ChildrenNode.ts has not been loaded"),xA=xA||new n({".priority":kc},{".priority":Me}),xA}get(e){let t=$i(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof ar?t:null}hasIndex(e){return qn(this.indexSet_,e.toString())}addIndex(e,t){O(e!==fi,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=t.getIterator(ce.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();let a;i?a=C_(r,e.getCompare()):a=kc;let l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;let u=Object.assign({},this.indexes_);return u[l]=a,new n(u,c)}addToIndexes(e,t){let r=tu(this.indexes_,(i,s)=>{let o=$i(this.indexSet_,s);if(O(o,"Missing index implementation for "+s),i===kc)if(o.isDefinedOn(e.node)){let a=[],l=t.getIterator(ce.Wrap),c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),C_(a,o.getCompare())}else return kc;else{let a=t.get(e.name),l=i;return a&&(l=l.remove(new ce(e.name,a))),l.insert(e,e.node)}});return new n(r,this.indexSet_)}removeFromIndexes(e,t){let r=tu(this.indexes_,i=>{if(i===kc)return i;{let s=t.get(e.name);return s?i.remove(new ce(e.name,s)):i}});return new n(r,this.indexSet_)}};var Nd,re=(()=>{class n{constructor(t,r,i){this.children_=t,this.priorityNode_=r,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&_q(this.priorityNode_),this.children_.isEmpty()&&O(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Nd||(Nd=new n(new ar(KD),null,Lc.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Nd}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let r=this.children_.get(t);return r===null?Nd:r}}getChild(t){let r=oe(t);return r===null?this:this.getImmediateChild(r).getChild(Re(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,r){if(O(r,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(r);{let i=new ce(t,r),s,o;r.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(t,r),o=this.indexMap_.addToIndexes(i,this.children_));let a=s.isEmpty()?Nd:this.priorityNode_;return new n(s,a,o)}}updateChild(t,r){let i=oe(t);if(i===null)return r;{O(oe(t)!==".priority"||ro(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(i).updateChild(Re(t),r);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let r={},i=0,s=0,o=!0;if(this.forEachChild(Me,(a,l)=>{r[a]=l.val(t),i++,o&&n.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*i){let a=[];for(let l in r)a[l]=r[l];return a}else return t&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+yq(this.getPriority().val())+":"),this.forEachChild(Me,(r,i)=>{let s=i.hash();s!==""&&(t+=":"+r+":"+s)}),this.lazyHash_=t===""?"":iq(t)}return this.lazyHash_}getPredecessorChildName(t,r,i){let s=this.resolveIndex_(i);if(s){let o=s.getPredecessorKey(new ce(t,r));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(t){let r=this.getFirstChildName(t);return r?new ce(r,this.children_.get(r)):null}getLastChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(t){let r=this.getLastChildName(t);return r?new ce(r,this.children_.get(r)):null}forEachChild(t,r){let i=this.resolveIndex_(t);return i?i.inorderTraversal(s=>r(s.name,s.node)):this.children_.inorderTraversal(r)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,ce.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,ce.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===ef?-1:0}withIndex(t){if(t===fi||this.indexMap_.hasIndex(t))return this;{let r=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,r)}}isIndexed(t){return t===fi||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let r=t;if(this.getPriority().equals(r.getPriority()))if(this.children_.count()===r.children_.count()){let i=this.getIterator(Me),s=r.getIterator(Me),o=i.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=i.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===fi?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),eD=class extends re{constructor(){super(new ar(KD),re.EMPTY_NODE,Lc.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return re.EMPTY_NODE}isEmpty(){return!1}},ef=new eD;Object.defineProperties(ce,{MIN:{value:new ce(no,re.EMPTY_NODE)},MAX:{value:new ce(qi,ef)}});S_.__EMPTY_NODE=re.EMPTY_NODE;Fc.__childrenNodeConstructor=re;Ere(ef);Cre(ef);var Tre=!0;function Ke(n,e=null){if(n===null)return re.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),O(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new Fc(t,Ke(e))}if(!(n instanceof Array)&&Tre){let t=[],r=!1;if(Ot(n,(o,a)=>{if(o.substring(0,1)!=="."){let l=Ke(a);l.isEmpty()||(r=r||!l.getPriority().isEmpty(),t.push(new ce(o,l)))}}),t.length===0)return re.EMPTY_NODE;let s=C_(t,vre,o=>o.name,KD);if(r){let o=C_(t,Me.getCompare());return new re(s,Ke(e),new Lc({".priority":o},{".priority":Me}))}else return new re(s,Ke(e),Lc.Default)}else{let t=re.EMPTY_NODE;return Ot(n,(r,i)=>{if(qn(n,r)&&r.substring(0,1)!=="."){let s=Ke(i);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(r,s))}}),t.updatePriority(Ke(e))}}Sre(Ke);var Ud=class extends Mc{constructor(e){super(),this.indexPath_=e,O(!ae(e)&&oe(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let r=this.extractChild(e.node),i=this.extractChild(t.node),s=r.compareTo(i);return s===0?Ca(e.name,t.name):s}makePost(e,t){let r=Ke(e),i=re.EMPTY_NODE.updateChild(this.indexPath_,r);return new ce(t,i)}maxPost(){let e=re.EMPTY_NODE.updateChild(this.indexPath_,ef);return new ce(qi,e)}toString(){return Vd(this.indexPath_,0).join("/")}};var tD=class extends Mc{compare(e,t){let r=e.node.compareTo(t.node);return r===0?Ca(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return ce.MIN}maxPost(){return ce.MAX}makePost(e,t){let r=Ke(e);return new ce(t,r)}toString(){return".value"}},QD=new tD;function Sq(n){return{type:"value",snapshotNode:n}}function Bc(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function qd(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function zd(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function bre(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var Gd=class{constructor(e){this.index_=e}updateChild(e,t,r,i,s,o){O(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(i).equals(r.getChild(i))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(qd(t,a)):O(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Bc(t,r)):o.trackChildChange(zd(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Me,(i,s)=>{t.hasChild(i)||r.trackChildChange(qd(i,s))}),t.isLeafNode()||t.forEachChild(Me,(i,s)=>{if(e.hasChild(i)){let o=e.getImmediateChild(i);o.equals(s)||r.trackChildChange(zd(i,s,o))}else r.trackChildChange(Bc(i,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?re.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var w_=class n{constructor(e){this.indexedFilter_=new Gd(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,i,s,o){return this.matches(new ce(t,r))||(r=re.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,i,s,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=re.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(re.EMPTY_NODE);let s=this;return t.forEachChild(Me,(o,a)=>{s.matches(new ce(o,a))||(i=i.updateImmediateChild(o,re.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var nD=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{let r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new w_(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,i,s,o){return this.rangedFilter_.matches(new ce(t,r))||(r=re.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,i,s,o):this.fullLimitUpdateChild_(e,t,r,s,o)}updateFullNode(e,t,r){let i;if(t.isLeafNode()||t.isEmpty())i=re.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=re.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(re.EMPTY_NODE);let s;this.reverse_?s=i.getReverseIterator(this.index_):s=i.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,re.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,i,s){let o;if(this.reverse_){let h=this.index_.getCompare();o=(d,f)=>h(f,d)}else o=this.index_.getCompare();let a=e;O(a.numChildren()===this.limit_,"");let l=new ce(t,r),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(l);if(a.hasChild(t)){let h=a.getImmediateChild(t),d=i.getChildAfterChild(this.index_,c,this.reverse_);for(;d!=null&&(d.name===t||a.hasChild(d.name));)d=i.getChildAfterChild(this.index_,d,this.reverse_);let f=d==null?1:o(d,l);if(u&&!r.isEmpty()&&f>=0)return s?.trackChildChange(zd(t,r,h)),a.updateImmediateChild(t,r);{s?.trackChildChange(qd(t,h));let y=a.updateImmediateChild(t,re.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(s?.trackChildChange(Bc(d.name,d.node)),y.updateImmediateChild(d.name,d.node)):y}}else return r.isEmpty()?e:u&&o(c,l)>=0?(s!=null&&(s.trackChildChange(qd(c.name,c.node)),s.trackChildChange(Bc(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(c.name,re.EMPTY_NODE)):e}};var jd=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Me}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return O(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return O(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:no}hasEnd(){return this.endSet_}getIndexEndValue(){return O(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return O(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:qi}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return O(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Me}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function Ire(n){return n.loadsAllData()?new Gd(n.getIndex()):n.hasLimit()?new nD(n):new w_(n)}function Are(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function Dre(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function rD(n,e,t){let r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function Rre(n,e,t){let r;return n.index_===fi||t?r=rD(n,e,t):r=rD(n,e,qi),r.startAfterSet_=!0,r}function iD(n,e,t){let r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function Nre(n,e,t){let r;return n.index_===fi||t?r=iD(n,e,t):r=iD(n,e,no),r.endBeforeSet_=!0,r}function z_(n,e){let t=n.copy();return t.index_=e,t}function NU(n){let e={};if(n.isDefault())return e;let t;if(n.index_===Me?t="$priority":n.index_===QD?t="$value":n.index_===fi?t="$key":(O(n.index_ instanceof Ud,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=ut(t),n.startSet_){let r=n.startAfterSet_?"startAfter":"startAt";e[r]=ut(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+ut(n.indexStartName_))}if(n.endSet_){let r=n.endBeforeSet_?"endBefore":"endAt";e[r]=ut(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+ut(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function kU(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==Me&&(e.i=n.index_.toString()),e}var sD=class n extends __{constructor(e,t,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=Zd("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(O(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,r),a={};this.listens_[o]=a;let l=NU(e._queryParams);this.restRequest_(s+".json",l,(c,u)=>{let h=u;if(c===404&&(h=null,c=null),c===null&&this.onDataUpdate_(s,h,!1,r),$i(this.listens_,o)===a){let d;c?c===401?d="permission_denied":d="rest_error:"+c:d="ok",i(d,null)}})}unlisten(e,t){let r=n.getListenId_(e,t);delete this.listens_[r]}get(e){let t=NU(e._queryParams),r=e._path.toString(),i=new Ct;return this.restRequest_(r+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ZR(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Ef(a.responseText)}catch{Xt("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,l)}else a.status!==401&&a.status!==404&&Xt("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}};var oD=class{constructor(){this.rootNode_=re.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function T_(){return{value:null,children:new Map}}function jc(n,e,t){if(ae(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let r=oe(e);n.children.has(r)||n.children.set(r,T_());let i=n.children.get(r);e=Re(e),jc(i,e,t)}}function aD(n,e){if(ae(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(Me,(r,i)=>{jc(n,new Ce(r),i)}),aD(n,e)}}else if(n.children.size>0){let t=oe(e);return e=Re(e),n.children.has(t)&&aD(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function lD(n,e,t){n.value!==null?t(e,n.value):kre(n,(r,i)=>{let s=new Ce(e.toString()+"/"+r);lD(i,s,t)})}function kre(n,e){n.children.forEach((t,r)=>{e(r,t)})}var cD=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Ot(this.last_,(r,i)=>{t[r]=t[r]-i}),this.last_=e,t}};var OU=10*1e3,Ore=30*1e3,xre=5*60*1e3,uD=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new cD(e);let r=OU+(Ore-OU)*Math.random();Od(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){let e=this.statsListener_.get(),t={},r=!1;Ot(e,(i,s)=>{s>0&&qn(this.statsToReport_,i)&&(t[i]=s,r=!0)}),r&&this.server_.reportStats(t),Od(this.reportStats_.bind(this),Math.floor(Math.random()*2*xre))}};var di=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(di||{});function YD(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function XD(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function JD(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var hD=class n{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=di.ACK_USER_WRITE,this.source=YD()}operationForChild(e){if(ae(this.path)){if(this.affectedTree.value!=null)return O(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new Ce(e));return new n(Se(),t,this.revert)}}else return O(oe(this.path)===e,"operationForChild called for unrelated child."),new n(Re(this.path),this.affectedTree,this.revert)}};var b_=class n{constructor(e,t){this.source=e,this.path=t,this.type=di.LISTEN_COMPLETE}operationForChild(e){return ae(this.path)?new n(this.source,Se()):new n(this.source,Re(this.path))}};var Vc=class n{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=di.OVERWRITE}operationForChild(e){return ae(this.path)?new n(this.source,Se(),this.snap.getImmediateChild(e)):new n(this.source,Re(this.path),this.snap)}};var Wd=class n{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=di.MERGE}operationForChild(e){if(ae(this.path)){let t=this.children.subtree(new Ce(e));return t.isEmpty()?null:t.value?new Vc(this.source,Se(),t.value):new n(this.source,Se(),t)}else return O(oe(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,Re(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var gi=class{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ae(e))return this.isFullyInitialized()&&!this.filtered_;let t=oe(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var dD=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function Pre(n,e,t,r){let i=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(bre(o.childName,o.snapshotNode))}),kd(n,i,"child_removed",e,r,t),kd(n,i,"child_added",e,r,t),kd(n,i,"child_moved",s,r,t),kd(n,i,"child_changed",e,r,t),kd(n,i,"value",e,r,t),i}function kd(n,e,t,r,i,s){let o=r.filter(a=>a.type===t);o.sort((a,l)=>Fre(n,a,l)),o.forEach(a=>{let l=Mre(n,a,s);i.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,n.query_))})})}function Mre(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function Fre(n,e,t){if(e.childName==null||t.childName==null)throw ka("Should only compare child_ events.");let r=new ce(e.childName,e.snapshotNode),i=new ce(t.childName,t.snapshotNode);return n.index_.compare(r,i)}function G_(n,e){return{eventCache:n,serverCache:e}}function Pd(n,e,t,r){return G_(new gi(e,t,r),n.serverCache)}function Cq(n,e,t,r){return G_(n.eventCache,new gi(e,t,r))}function I_(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Sa(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var PA,Lre=()=>(PA||(PA=new ar(Pne)),PA),pn=class n{constructor(e,t=Lre()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return Ot(e,(r,i)=>{t=t.set(new Ce(r),i)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Se(),value:this.value};if(ae(e))return null;{let r=oe(e),i=this.children.get(r);if(i!==null){let s=i.findRootMostMatchingPathAndValue(Re(e),t);return s!=null?{path:je(new Ce(r),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ae(e))return this;{let t=oe(e),r=this.children.get(t);return r!==null?r.subtree(Re(e)):new n(null)}}set(e,t){if(ae(e))return new n(t,this.children);{let r=oe(e),s=(this.children.get(r)||new n(null)).set(Re(e),t),o=this.children.insert(r,s);return new n(this.value,o)}}remove(e){if(ae(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=oe(e),r=this.children.get(t);if(r){let i=r.remove(Re(e)),s;return i.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,i),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if(ae(e))return this.value;{let t=oe(e),r=this.children.get(t);return r?r.get(Re(e)):null}}setTree(e,t){if(ae(e))return t;{let r=oe(e),s=(this.children.get(r)||new n(null)).setTree(Re(e),t),o;return s.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,s),new n(this.value,o)}}fold(e){return this.fold_(Se(),e)}fold_(e,t){let r={};return this.children.inorderTraversal((i,s)=>{r[i]=s.fold_(je(e,i),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,Se(),t)}findOnPath_(e,t,r){let i=this.value?r(t,this.value):!1;if(i)return i;if(ae(e))return null;{let s=oe(e),o=this.children.get(s);return o?o.findOnPath_(Re(e),je(t,s),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Se(),t)}foreachOnPath_(e,t,r){if(ae(e))return this;{this.value&&r(t,this.value);let i=oe(e),s=this.children.get(i);return s?s.foreachOnPath_(Re(e),je(t,i),r):new n(null)}}foreach(e){this.foreach_(Se(),e)}foreach_(e,t){this.children.inorderTraversal((r,i)=>{i.foreach_(je(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}};var Dr=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new pn(null))}};function Md(n,e,t){if(ae(e))return new Dr(new pn(t));{let r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){let i=r.path,s=r.value,o=fn(i,e);return s=s.updateChild(o,t),new Dr(n.writeTree_.set(i,s))}else{let i=new pn(t),s=n.writeTree_.setTree(e,i);return new Dr(s)}}}function fD(n,e,t){let r=n;return Ot(t,(i,s)=>{r=Md(r,je(e,i),s)}),r}function xU(n,e){if(ae(e))return Dr.empty();{let t=n.writeTree_.setTree(e,new pn(null));return new Dr(t)}}function pD(n,e){return wa(n,e)!=null}function wa(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(fn(t.path,e)):null}function PU(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Me,(r,i)=>{e.push(new ce(r,i))}):n.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new ce(r,i.value))}),e}function eo(n,e){if(ae(e))return n;{let t=wa(n,e);return t!=null?new Dr(new pn(t)):new Dr(n.writeTree_.subtree(e))}}function gD(n){return n.writeTree_.isEmpty()}function Uc(n,e){return wq(Se(),n.writeTree_,e)}function wq(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((i,s)=>{i===".priority"?(O(s.value!==null,"Priority writes must always be leaf nodes"),r=s.value):t=wq(je(n,i),s,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(je(n,".priority"),r)),t}}function j_(n,e){return Aq(e,n)}function Bre(n,e,t,r,i){O(r>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:i}),i&&(n.visibleWrites=Md(n.visibleWrites,e,t)),n.lastWriteId=r}function Vre(n,e,t,r){O(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=fD(n.visibleWrites,e,t),n.lastWriteId=r}function Ure(n,e){for(let t=0;t<n.allWrites.length;t++){let r=n.allWrites[t];if(r.writeId===e)return r}return null}function qre(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);O(t>=0,"removeWrite called with nonexistent writeId.");let r=n.allWrites[t];n.allWrites.splice(t,1);let i=r.visible,s=!1,o=n.allWrites.length-1;for(;i&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&zre(a,r.path)?i=!1:or(r.path,a.path)&&(s=!0)),o--}if(i){if(s)return Gre(n),!0;if(r.snap)n.visibleWrites=xU(n.visibleWrites,r.path);else{let a=r.children;Ot(a,l=>{n.visibleWrites=xU(n.visibleWrites,je(r.path,l))})}return!0}else return!1}function zre(n,e){if(n.snap)return or(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&or(je(n.path,t),e))return!0;return!1}function Gre(n){n.visibleWrites=Tq(n.allWrites,jre,Se()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function jre(n){return n.visible}function Tq(n,e,t){let r=Dr.empty();for(let i=0;i<n.length;++i){let s=n[i];if(e(s)){let o=s.path,a;if(s.snap)or(t,o)?(a=fn(t,o),r=Md(r,a,s.snap)):or(o,t)&&(a=fn(o,t),r=Md(r,Se(),s.snap.getChild(a)));else if(s.children){if(or(t,o))a=fn(t,o),r=fD(r,a,s.children);else if(or(o,t))if(a=fn(o,t),ae(a))r=fD(r,Se(),s.children);else{let l=$i(s.children,oe(a));if(l){let c=l.getChild(Re(a));r=Md(r,Se(),c)}}}else throw ka("WriteRecord should have .snap or .children")}}return r}function bq(n,e,t,r,i){if(!r&&!i){let s=wa(n.visibleWrites,e);if(s!=null)return s;{let o=eo(n.visibleWrites,e);if(gD(o))return t;if(t==null&&!pD(o,Se()))return null;{let a=t||re.EMPTY_NODE;return Uc(o,a)}}}else{let s=eo(n.visibleWrites,e);if(!i&&gD(s))return t;if(!i&&t==null&&!pD(s,Se()))return null;{let o=function(c){return(c.visible||i)&&(!r||!~r.indexOf(c.writeId))&&(or(c.path,e)||or(e,c.path))},a=Tq(n.allWrites,o,e),l=t||re.EMPTY_NODE;return Uc(a,l)}}}function Wre(n,e,t){let r=re.EMPTY_NODE,i=wa(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(Me,(s,o)=>{r=r.updateImmediateChild(s,o)}),r;if(t){let s=eo(n.visibleWrites,e);return t.forEachChild(Me,(o,a)=>{let l=Uc(eo(s,new Ce(o)),a);r=r.updateImmediateChild(o,l)}),PU(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{let s=eo(n.visibleWrites,e);return PU(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function Hre(n,e,t,r,i){O(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=je(e,t);if(pD(n.visibleWrites,s))return null;{let o=eo(n.visibleWrites,s);return gD(o)?i.getChild(t):Uc(o,i.getChild(t))}}function $re(n,e,t,r){let i=je(e,t),s=wa(n.visibleWrites,i);if(s!=null)return s;if(r.isCompleteForChild(t)){let o=eo(n.visibleWrites,i);return Uc(o,r.getNode().getImmediateChild(t))}else return null}function Kre(n,e){return wa(n.visibleWrites,e)}function Qre(n,e,t,r,i,s,o){let a,l=eo(n.visibleWrites,e),c=wa(l,Se());if(c!=null)a=c;else if(t!=null)a=Uc(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let u=[],h=o.getCompare(),d=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),f=d.getNext();for(;f&&u.length<i;)h(f,r)!==0&&u.push(f),f=d.getNext();return u}else return[]}function Yre(){return{visibleWrites:Dr.empty(),allWrites:[],lastWriteId:-1}}function A_(n,e,t,r){return bq(n.writeTree,n.treePath,e,t,r)}function ZD(n,e){return Wre(n.writeTree,n.treePath,e)}function MU(n,e,t,r){return Hre(n.writeTree,n.treePath,e,t,r)}function D_(n,e){return Kre(n.writeTree,je(n.treePath,e))}function Xre(n,e,t,r,i,s){return Qre(n.writeTree,n.treePath,e,t,r,i,s)}function eR(n,e,t){return $re(n.writeTree,n.treePath,e,t)}function Iq(n,e){return Aq(je(n.treePath,e),n.writeTree)}function Aq(n,e){return{treePath:n,writeTree:e}}var mD=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,r=e.childName;O(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),O(r!==".priority","Only non-priority child changes can be tracked.");let i=this.changeMap.get(r);if(i){let s=i.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(r,zd(r,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(r,qd(r,i.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(r,Bc(r,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(r,zd(r,e.snapshotNode,i.oldSnap));else throw ka("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}};var yD=class{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}},Dq=new yD,Hd=class{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let r=this.optCompleteServerCache_!=null?new gi(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return eR(this.writes_,e,r)}}getChildAfterChild(e,t,r){let i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Sa(this.viewCache_),s=Xre(this.writes_,i,t,1,r,e);return s.length===0?null:s[0]}};function Jre(n){return{filter:n}}function Zre(n,e){O(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),O(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function eie(n,e,t,r,i){let s=new mD,o,a;if(t.type===di.OVERWRITE){let c=t;c.source.fromUser?o=_D(n,e,c.path,c.snap,r,i,s):(O(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!ae(c.path),o=R_(n,e,c.path,c.snap,r,i,a,s))}else if(t.type===di.MERGE){let c=t;c.source.fromUser?o=nie(n,e,c.path,c.children,r,i,s):(O(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=vD(n,e,c.path,c.children,r,i,a,s))}else if(t.type===di.ACK_USER_WRITE){let c=t;c.revert?o=sie(n,e,c.path,r,i,s):o=rie(n,e,c.path,c.affectedTree,r,i,s)}else if(t.type===di.LISTEN_COMPLETE)o=iie(n,e,t.path,r,s);else throw ka("Unknown operation type: "+t.type);let l=s.getChanges();return tie(e,o,l),{viewCache:o,changes:l}}function tie(n,e,t){let r=e.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=I_(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&t.push(Sq(I_(e)))}}function Rq(n,e,t,r,i,s){let o=e.eventCache;if(D_(r,t)!=null)return e;{let a,l;if(ae(t))if(O(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=Sa(e),u=c instanceof re?c:re.EMPTY_NODE,h=ZD(r,u);a=n.filter.updateFullNode(e.eventCache.getNode(),h,s)}else{let c=A_(r,Sa(e));a=n.filter.updateFullNode(e.eventCache.getNode(),c,s)}else{let c=oe(t);if(c===".priority"){O(ro(t)===1,"Can't have a priority with additional path components");let u=o.getNode();l=e.serverCache.getNode();let h=MU(r,t,u,l);h!=null?a=n.filter.updatePriority(u,h):a=o.getNode()}else{let u=Re(t),h;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();let d=MU(r,t,o.getNode(),l);d!=null?h=o.getNode().getImmediateChild(c).updateChild(u,d):h=o.getNode().getImmediateChild(c)}else h=eR(r,c,e.serverCache);h!=null?a=n.filter.updateChild(o.getNode(),c,h,u,i,s):a=o.getNode()}}return Pd(e,a,o.isFullyInitialized()||ae(t),n.filter.filtersNodes())}}function R_(n,e,t,r,i,s,o,a){let l=e.serverCache,c,u=o?n.filter:n.filter.getIndexedFilter();if(ae(t))c=u.updateFullNode(l.getNode(),r,null);else if(u.filtersNodes()&&!l.isFiltered()){let f=l.getNode().updateChild(t,r);c=u.updateFullNode(l.getNode(),f,null)}else{let f=oe(t);if(!l.isCompleteForPath(t)&&ro(t)>1)return e;let g=Re(t),E=l.getNode().getImmediateChild(f).updateChild(g,r);f===".priority"?c=u.updatePriority(l.getNode(),E):c=u.updateChild(l.getNode(),f,E,g,Dq,null)}let h=Cq(e,c,l.isFullyInitialized()||ae(t),u.filtersNodes()),d=new Hd(i,h,s);return Rq(n,h,t,i,d,a)}function _D(n,e,t,r,i,s,o){let a=e.eventCache,l,c,u=new Hd(i,e,s);if(ae(t))c=n.filter.updateFullNode(e.eventCache.getNode(),r,o),l=Pd(e,c,!0,n.filter.filtersNodes());else{let h=oe(t);if(h===".priority")c=n.filter.updatePriority(e.eventCache.getNode(),r),l=Pd(e,c,a.isFullyInitialized(),a.isFiltered());else{let d=Re(t),f=a.getNode().getImmediateChild(h),g;if(ae(d))g=r;else{let y=u.getCompleteChild(h);y!=null?WD(d)===".priority"&&y.getChild(gq(d)).isEmpty()?g=y:g=y.updateChild(d,r):g=re.EMPTY_NODE}if(f.equals(g))l=e;else{let y=n.filter.updateChild(a.getNode(),h,g,d,u,o);l=Pd(e,y,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function FU(n,e){return n.eventCache.isCompleteForChild(e)}function nie(n,e,t,r,i,s,o){let a=e;return r.foreach((l,c)=>{let u=je(t,l);FU(e,oe(u))&&(a=_D(n,a,u,c,i,s,o))}),r.foreach((l,c)=>{let u=je(t,l);FU(e,oe(u))||(a=_D(n,a,u,c,i,s,o))}),a}function LU(n,e,t){return t.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function vD(n,e,t,r,i,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;ae(t)?c=r:c=new pn(null).setTree(t,r);let u=e.serverCache.getNode();return c.children.inorderTraversal((h,d)=>{if(u.hasChild(h)){let f=e.serverCache.getNode().getImmediateChild(h),g=LU(n,f,d);l=R_(n,l,new Ce(h),g,i,s,o,a)}}),c.children.inorderTraversal((h,d)=>{let f=!e.serverCache.isCompleteForChild(h)&&d.value===null;if(!u.hasChild(h)&&!f){let g=e.serverCache.getNode().getImmediateChild(h),y=LU(n,g,d);l=R_(n,l,new Ce(h),y,i,s,o,a)}}),l}function rie(n,e,t,r,i,s,o){if(D_(i,t)!=null)return e;let a=e.serverCache.isFiltered(),l=e.serverCache;if(r.value!=null){if(ae(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return R_(n,e,t,l.getNode().getChild(t),i,s,a,o);if(ae(t)){let c=new pn(null);return l.getNode().forEachChild(fi,(u,h)=>{c=c.set(new Ce(u),h)}),vD(n,e,t,c,i,s,a,o)}else return e}else{let c=new pn(null);return r.foreach((u,h)=>{let d=je(t,u);l.isCompleteForPath(d)&&(c=c.set(u,l.getNode().getChild(d)))}),vD(n,e,t,c,i,s,a,o)}}function iie(n,e,t,r,i){let s=e.serverCache,o=Cq(e,s.getNode(),s.isFullyInitialized()||ae(t),s.isFiltered());return Rq(n,o,t,r,Dq,i)}function sie(n,e,t,r,i,s){let o;if(D_(r,t)!=null)return e;{let a=new Hd(r,e,i),l=e.eventCache.getNode(),c;if(ae(t)||oe(t)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=A_(r,Sa(e));else{let h=e.serverCache.getNode();O(h instanceof re,"serverChildren would be complete if leaf node"),u=ZD(r,h)}u=u,c=n.filter.updateFullNode(l,u,s)}else{let u=oe(t),h=eR(r,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=l.getImmediateChild(u)),h!=null?c=n.filter.updateChild(l,u,h,Re(t),a,s):e.eventCache.getNode().hasChild(u)?c=n.filter.updateChild(l,u,re.EMPTY_NODE,Re(t),a,s):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=A_(r,Sa(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,s)))}return o=e.serverCache.isFullyInitialized()||D_(r,Se())!=null,Pd(e,c,o,n.filter.filtersNodes())}}var ED=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let r=this.query_._queryParams,i=new Gd(r.getIndex()),s=Ire(r);this.processor_=Jre(s);let o=t.serverCache,a=t.eventCache,l=i.updateFullNode(re.EMPTY_NODE,o.getNode(),null),c=s.updateFullNode(re.EMPTY_NODE,a.getNode(),null),u=new gi(l,o.isFullyInitialized(),i.filtersNodes()),h=new gi(c,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=G_(h,u),this.eventGenerator_=new dD(this.query_)}get query(){return this.query_}};function oie(n){return n.viewCache_.serverCache.getNode()}function aie(n){return I_(n.viewCache_)}function lie(n,e){let t=Sa(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!ae(e)&&!t.getImmediateChild(oe(e)).isEmpty())?t.getChild(e):null}function BU(n){return n.eventRegistrations_.length===0}function cie(n,e){n.eventRegistrations_.push(e)}function VU(n,e,t){let r=[];if(t){O(e==null,"A cancel should cancel all event registrations.");let i=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,i);o&&r.push(o)})}if(e){let i=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return r}function UU(n,e,t,r){e.type===di.MERGE&&e.source.queryId!==null&&(O(Sa(n.viewCache_),"We should always have a full cache before handling merges"),O(I_(n.viewCache_),"Missing event cache, even though we have a server cache"));let i=n.viewCache_,s=eie(n.processor_,i,e,t,r);return Zre(n.processor_,s.viewCache),O(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,Nq(n,s.changes,s.viewCache.eventCache.getNode(),null)}function uie(n,e){let t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Me,(s,o)=>{r.push(Bc(s,o))}),t.isFullyInitialized()&&r.push(Sq(t.getNode())),Nq(n,r,t.getNode(),e)}function Nq(n,e,t,r){let i=r?[r]:n.eventRegistrations_;return Pre(n.eventGenerator_,e,t,i)}var N_,k_=class{constructor(){this.views=new Map}};function hie(n){O(!N_,"__referenceConstructor has already been defined"),N_=n}function die(){return O(N_,"Reference.ts has not been loaded"),N_}function fie(n){return n.views.size===0}function tR(n,e,t,r){let i=e.source.queryId;if(i!==null){let s=n.views.get(i);return O(s!=null,"SyncTree gave us an op for an invalid query."),UU(s,e,t,r)}else{let s=[];for(let o of n.views.values())s=s.concat(UU(o,e,t,r));return s}}function kq(n,e,t,r,i){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=A_(t,i?r:null),l=!1;a?l=!0:r instanceof re?(a=ZD(t,r),l=!1):(a=re.EMPTY_NODE,l=!1);let c=G_(new gi(a,l,!1),new gi(r,i,!1));return new ED(e,c)}return o}function pie(n,e,t,r,i,s){let o=kq(n,e,r,i,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),cie(o,t),uie(o,t)}function gie(n,e,t,r){let i=e._queryIdentifier,s=[],o=[],a=io(n);if(i==="default")for(let[l,c]of n.views.entries())o=o.concat(VU(c,t,r)),BU(c)&&(n.views.delete(l),c.query._queryParams.loadsAllData()||s.push(c.query));else{let l=n.views.get(i);l&&(o=o.concat(VU(l,t,r)),BU(l)&&(n.views.delete(i),l.query._queryParams.loadsAllData()||s.push(l.query)))}return a&&!io(n)&&s.push(new(die())(e._repo,e._path)),{removed:s,events:o}}function Oq(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function to(n,e){let t=null;for(let r of n.views.values())t=t||lie(r,e);return t}function xq(n,e){if(e._queryParams.loadsAllData())return W_(n);{let r=e._queryIdentifier;return n.views.get(r)}}function Pq(n,e){return xq(n,e)!=null}function io(n){return W_(n)!=null}function W_(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var O_;function mie(n){O(!O_,"__referenceConstructor has already been defined"),O_=n}function yie(){return O(O_,"Reference.ts has not been loaded"),O_}var _ie=1,x_=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new pn(null),this.pendingWriteTree_=Yre(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function nR(n,e,t,r,i){return Bre(n.pendingWriteTree_,e,t,r,i),i?Wc(n,new Vc(YD(),e,t)):[]}function vie(n,e,t,r){Vre(n.pendingWriteTree_,e,t,r);let i=pn.fromObject(t);return Wc(n,new Wd(YD(),e,i))}function Zs(n,e,t=!1){let r=Ure(n.pendingWriteTree_,e);if(qre(n.pendingWriteTree_,e)){let s=new pn(null);return r.snap!=null?s=s.set(Se(),!0):Ot(r.children,o=>{s=s.set(new Ce(o),!0)}),Wc(n,new hD(r.path,s,t))}else return[]}function tf(n,e,t){return Wc(n,new Vc(XD(),e,t))}function Eie(n,e,t){let r=pn.fromObject(t);return Wc(n,new Wd(XD(),e,r))}function Sie(n,e){return Wc(n,new b_(XD(),e))}function Cie(n,e,t){let r=rR(n,t);if(r){let i=iR(r),s=i.path,o=i.queryId,a=fn(s,e),l=new b_(JD(o),a);return sR(n,s,l)}else return[]}function P_(n,e,t,r,i=!1){let s=e._path,o=n.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||Pq(o,e))){let l=gie(o,e,t,r);fie(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let c=l.removed;if(a=l.events,!i){let u=c.findIndex(d=>d._queryParams.loadsAllData())!==-1,h=n.syncPointTree_.findOnPath(s,(d,f)=>io(f));if(u&&!h){let d=n.syncPointTree_.subtree(s);if(!d.isEmpty()){let f=bie(d);for(let g=0;g<f.length;++g){let y=f[g],E=y.query,I=Bq(n,y);n.listenProvider_.startListening(Fd(E),$d(n,E),I.hashFn,I.onComplete)}}}!h&&c.length>0&&!r&&(u?n.listenProvider_.stopListening(Fd(e),null):c.forEach(d=>{let f=n.queryToTagMap.get($_(d));n.listenProvider_.stopListening(Fd(d),f)}))}Iie(n,c)}return a}function Mq(n,e,t,r){let i=rR(n,r);if(i!=null){let s=iR(i),o=s.path,a=s.queryId,l=fn(o,e),c=new Vc(JD(a),l,t);return sR(n,o,c)}else return[]}function wie(n,e,t,r){let i=rR(n,r);if(i){let s=iR(i),o=s.path,a=s.queryId,l=fn(o,e),c=pn.fromObject(t),u=new Wd(JD(a),l,c);return sR(n,o,u)}else return[]}function SD(n,e,t,r=!1){let i=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(i,(d,f)=>{let g=fn(d,i);s=s||to(f,g),o=o||io(f)});let a=n.syncPointTree_.get(i);a?(o=o||io(a),s=s||to(a,Se())):(a=new k_,n.syncPointTree_=n.syncPointTree_.set(i,a));let l;s!=null?l=!0:(l=!1,s=re.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((f,g)=>{let y=to(g,Se());y&&(s=s.updateImmediateChild(f,y))}));let c=Pq(a,e);if(!c&&!e._queryParams.loadsAllData()){let d=$_(e);O(!n.queryToTagMap.has(d),"View does not exist, but we have a tag");let f=Aie();n.queryToTagMap.set(d,f),n.tagToQueryMap.set(f,d)}let u=j_(n.pendingWriteTree_,i),h=pie(a,e,t,u,s,l);if(!c&&!o&&!r){let d=xq(a,e);h=h.concat(Die(n,e,d))}return h}function H_(n,e,t){let i=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{let l=fn(o,e),c=to(a,l);if(c)return c});return bq(i,e,s,t,!0)}function Tie(n,e){let t=e._path,r=null;n.syncPointTree_.foreachOnPath(t,(c,u)=>{let h=fn(c,t);r=r||to(u,h)});let i=n.syncPointTree_.get(t);i?r=r||to(i,Se()):(i=new k_,n.syncPointTree_=n.syncPointTree_.set(t,i));let s=r!=null,o=s?new gi(r,!0,!1):null,a=j_(n.pendingWriteTree_,e._path),l=kq(i,e,a,s?o.getNode():re.EMPTY_NODE,s);return aie(l)}function Wc(n,e){return Fq(e,n.syncPointTree_,null,j_(n.pendingWriteTree_,Se()))}function Fq(n,e,t,r){if(ae(n.path))return Lq(n,e,t,r);{let i=e.get(Se());t==null&&i!=null&&(t=to(i,Se()));let s=[],o=oe(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){let c=t?t.getImmediateChild(o):null,u=Iq(r,o);s=s.concat(Fq(a,l,c,u))}return i&&(s=s.concat(tR(i,n,r,t))),s}}function Lq(n,e,t,r){let i=e.get(Se());t==null&&i!=null&&(t=to(i,Se()));let s=[];return e.children.inorderTraversal((o,a)=>{let l=t?t.getImmediateChild(o):null,c=Iq(r,o),u=n.operationForChild(o);u&&(s=s.concat(Lq(u,a,l,c)))}),i&&(s=s.concat(tR(i,n,r,t))),s}function Bq(n,e){let t=e.query,r=$d(n,t);return{hashFn:()=>(oie(e)||re.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?Cie(n,t._path,r):Sie(n,t._path);{let s=Lne(i,t);return P_(n,t,null,s)}}}}function $d(n,e){let t=$_(e);return n.queryToTagMap.get(t)}function $_(n){return n._path.toString()+"$"+n._queryIdentifier}function rR(n,e){return n.tagToQueryMap.get(e)}function iR(n){let e=n.indexOf("$");return O(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new Ce(n.substr(0,e))}}function sR(n,e,t){let r=n.syncPointTree_.get(e);O(r,"Missing sync point for query tag that we're tracking");let i=j_(n.pendingWriteTree_,e);return tR(r,t,i,null)}function bie(n){return n.fold((e,t,r)=>{if(t&&io(t))return[W_(t)];{let i=[];return t&&(i=Oq(t)),Ot(r,(s,o)=>{i=i.concat(o)}),i}})}function Fd(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(yie())(n._repo,n._path):n}function Iie(n,e){for(let t=0;t<e.length;++t){let r=e[t];if(!r._queryParams.loadsAllData()){let i=$_(r),s=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(s)}}}function Aie(){return _ie++}function Die(n,e,t){let r=e._path,i=$d(n,e),s=Bq(n,t),o=n.listenProvider_.startListening(Fd(e),i,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(r);if(i)O(!io(a.value),"If we're adding a query, it shouldn't be shadowed");else{let l=a.fold((c,u,h)=>{if(!ae(c)&&u&&io(u))return[W_(u).query];{let d=[];return u&&(d=d.concat(Oq(u).map(f=>f.query))),Ot(h,(f,g)=>{d=d.concat(g)}),d}});for(let c=0;c<l.length;++c){let u=l[c];n.listenProvider_.stopListening(Fd(u),$d(n,u))}}return o}var CD=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},wD=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=je(this.path_,e);return new n(this.syncTree_,t)}node(){return H_(this.syncTree_,this.path_)}},Rie=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},qU=function(n,e,t){if(!n||typeof n!="object")return n;if(O(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return Nie(n[".sv"],e,t);if(typeof n[".sv"]=="object")return kie(n[".sv"],e);O(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},Nie=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:O(!1,"Unexpected server value: "+n)}},kie=function(n,e,t){n.hasOwnProperty("increment")||O(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let r=n.increment;typeof r!="number"&&O(!1,"Unexpected increment value: "+r);let i=e.node();if(O(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let o=i.getValue();return typeof o!="number"?r:o+r},Vq=function(n,e,t,r){return aR(e,new wD(t,n),r)},oR=function(n,e,t){return aR(n,new CD(e),t)};function aR(n,e,t){let r=n.getPriority().val(),i=qU(r,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,a=qU(o.getValue(),e,t);return a!==o.getValue()||i!==o.getPriority().val()?new Fc(a,Ke(i)):n}else{let o=n;return s=o,i!==o.getPriority().val()&&(s=s.updatePriority(new Fc(i))),o.forEachChild(Me,(a,l)=>{let c=aR(l,e.getImmediateChild(a),t);c!==l&&(s=s.updateImmediateChild(a,c))}),s}}var Kd=class{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}};function K_(n,e){let t=e instanceof Ce?e:new Ce(e),r=n,i=oe(t);for(;i!==null;){let s=$i(r.node.children,i)||{children:{},childCount:0};r=new Kd(i,r,s),t=Re(t),i=oe(t)}return r}function Ta(n){return n.node.value}function lR(n,e){n.node.value=e,TD(n)}function Uq(n){return n.node.childCount>0}function Oie(n){return Ta(n)===void 0&&!Uq(n)}function Q_(n,e){Ot(n.node.children,(t,r)=>{e(new Kd(t,n,r))})}function qq(n,e,t,r){t&&!r&&e(n),Q_(n,i=>{qq(i,e,!0,r)}),t&&r&&e(n)}function xie(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function nf(n){return new Ce(n.parent===null?n.name:nf(n.parent)+"/"+n.name)}function TD(n){n.parent!==null&&Pie(n.parent,n.name,n)}function Pie(n,e,t){let r=Oie(t),i=qn(n.node.children,e);r&&i?(delete n.node.children[e],n.node.childCount--,TD(n)):!r&&!i&&(n.node.children[e]=t.node,n.node.childCount++,TD(n))}var Mie=/[\[\].#$\/\u0000-\u001F\u007F]/,Fie=/[\[\].#$\u0000-\u001F\u007F]/,MA=10*1024*1024,Y_=function(n){return typeof n=="string"&&n.length!==0&&!Mie.test(n)},zq=function(n){return typeof n=="string"&&n.length!==0&&!Fie.test(n)},Lie=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),zq(n)},Qd=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!q_(n)||n&&typeof n=="object"&&qn(n,".sv")},mi=function(n,e,t,r){r&&e===void 0||rf(yn(n,"value"),e,t)},rf=function(n,e,t){let r=t instanceof Ce?new KA(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+_a(r));if(typeof e=="function")throw new Error(n+"contains a function "+_a(r)+" with contents = "+e.toString());if(q_(e))throw new Error(n+"contains "+e.toString()+" "+_a(r));if(typeof e=="string"&&e.length>MA/3&&nu(e)>MA)throw new Error(n+"contains a string greater than "+MA+" utf8 bytes "+_a(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,s=!1;if(Ot(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!Y_(o)))throw new Error(n+" contains an invalid key ("+o+") "+_a(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);fre(r,o),rf(n,a,r),pre(r)}),i&&s)throw new Error(n+' contains ".value" child '+_a(r)+" in addition to actual children.")}},Bie=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];let s=Vd(r);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!Y_(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(dre);let i=null;for(t=0;t<e.length;t++){if(r=e[t],i!==null&&or(i,r))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},Gq=function(n,e,t,r){if(r&&e===void 0)return;let i=yn(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");let s=[];Ot(e,(o,a)=>{let l=new Ce(o);if(rf(i,a,je(t,l)),WD(l)===".priority"&&!Qd(a))throw new Error(i+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(l)}),Bie(i,s)},cR=function(n,e,t){if(!(t&&e===void 0)){if(q_(e))throw new Error(yn(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Qd(e))throw new Error(yn(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},sf=function(n,e,t,r){if(!(r&&t===void 0)&&!Y_(t))throw new Error(yn(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Hc=function(n,e,t,r){if(!(r&&t===void 0)&&!zq(t))throw new Error(yn(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Vie=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Hc(n,e,t,r)},Pn=function(n,e){if(oe(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},jq=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Y_(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Lie(t))throw new Error(yn(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var bD=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function X_(n,e){let t=null;for(let r=0;r<e.length;r++){let i=e[r],s=i.getPath();t!==null&&!HD(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(i)}t&&n.eventLists_.push(t)}function Wq(n,e,t){X_(n,t),Hq(n,r=>HD(r,e))}function Mn(n,e,t){X_(n,t),Hq(n,r=>or(r,e)||or(e,r))}function Hq(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){let i=n.eventLists_[r];if(i){let s=i.path;e(s)?(Uie(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function Uie(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let r=t.getEventRunner();Ea&&kt("event: "+t.toString()),Gc(r)}}}var $q="repo_interrupt",qie=25,ID=class{constructor(e,t,r,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new bD,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=T_(),this.transactionQueueTree_=new Kd,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function zie(n,e,t){if(n.stats_=zD(n.repoInfo_),n.forceRestClient_||qne())n.server_=new sD(n.repoInfo_,(r,i,s,o)=>{zU(n,r,i,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>GU(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ut(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new $D(n.repoInfo_,e,(r,i,s,o)=>{zU(n,r,i,s,o)},r=>{GU(n,r)},r=>{Gie(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=Gne(n.repoInfo_,()=>new uD(n.stats_,n.server_)),n.infoData_=new oD,n.infoSyncTree_=new x_({startListening:(r,i,s,o)=>{let a=[],l=n.infoData_.getNode(r._path);return l.isEmpty()||(a=tf(n.infoSyncTree_,r._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),uR(n,"connected",!1),n.serverSyncTree_=new x_({startListening:(r,i,s,o)=>(n.server_.listen(r,s,i,(a,l)=>{let c=o(a,l);Mn(n.eventQueue_,r._path,c)}),[]),stopListening:(r,i)=>{n.server_.unlisten(r,i)}})}function Kq(n){let t=n.infoData_.getNode(new Ce(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function of(n){return Rie({timestamp:Kq(n)})}function zU(n,e,t,r,i){n.dataUpdateCount++;let s=new Ce(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(r){let l=tu(t,c=>Ke(c));o=wie(n.serverSyncTree_,s,l,i)}else{let l=Ke(t);o=Mq(n.serverSyncTree_,s,l,i)}else if(r){let l=tu(t,c=>Ke(c));o=Eie(n.serverSyncTree_,s,l)}else{let l=Ke(t);o=tf(n.serverSyncTree_,s,l)}let a=s;o.length>0&&(a=qc(n,s)),Mn(n.eventQueue_,a,o)}function GU(n,e){uR(n,"connected",e),e===!1&&Hie(n)}function Gie(n,e){Ot(e,(t,r)=>{uR(n,t,r)})}function uR(n,e,t){let r=new Ce("/.info/"+e),i=Ke(t);n.infoData_.updateSnapshot(r,i);let s=tf(n.infoSyncTree_,r,i);Mn(n.eventQueue_,r,s)}function J_(n){return n.nextWriteId_++}function jie(n,e,t){let r=Tie(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(i=>{let s=Ke(i).withIndex(e._queryParams.getIndex());SD(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=tf(n.serverSyncTree_,e._path,s);else{let a=$d(n.serverSyncTree_,e);o=Mq(n.serverSyncTree_,e._path,s,a)}return Mn(n.eventQueue_,e._path,o),P_(n.serverSyncTree_,e,t,null,!0),s},i=>($c(n,"get for query "+ut(e)+" failed: "+i),Promise.reject(new Error(i))))}function hR(n,e,t,r,i){$c(n,"set",{path:e.toString(),value:t,priority:r});let s=of(n),o=Ke(t,r),a=H_(n.serverSyncTree_,e),l=oR(o,a,s),c=J_(n),u=nR(n.serverSyncTree_,e,l,c,!0);X_(n.eventQueue_,u),n.server_.put(e.toString(),o.val(!0),(d,f)=>{let g=d==="ok";g||Xt("set at "+e+" failed: "+d);let y=Zs(n.serverSyncTree_,c,!g);Mn(n.eventQueue_,e,y),so(n,i,d,f)});let h=fR(n,e);qc(n,h),Mn(n.eventQueue_,h,[])}function Wie(n,e,t,r){$c(n,"update",{path:e.toString(),value:t});let i=!0,s=of(n),o={};if(Ot(t,(a,l)=>{i=!1,o[a]=Vq(je(e,a),Ke(l),n.serverSyncTree_,s)}),i)kt("update() called with empty data.  Don't do anything."),so(n,r,"ok",void 0);else{let a=J_(n),l=vie(n.serverSyncTree_,e,o,a);X_(n.eventQueue_,l),n.server_.merge(e.toString(),t,(c,u)=>{let h=c==="ok";h||Xt("update at "+e+" failed: "+c);let d=Zs(n.serverSyncTree_,a,!h),f=d.length>0?qc(n,e):e;Mn(n.eventQueue_,f,d),so(n,r,c,u)}),Ot(t,c=>{let u=fR(n,je(e,c));qc(n,u)}),Mn(n.eventQueue_,e,[])}}function Hie(n){$c(n,"onDisconnectEvents");let e=of(n),t=T_();lD(n.onDisconnect_,Se(),(i,s)=>{let o=Vq(i,s,n.serverSyncTree_,e);jc(t,i,o)});let r=[];lD(t,Se(),(i,s)=>{r=r.concat(tf(n.serverSyncTree_,i,s));let o=fR(n,i);qc(n,o)}),n.onDisconnect_=T_(),Mn(n.eventQueue_,Se(),r)}function $ie(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,i)=>{r==="ok"&&aD(n.onDisconnect_,e),so(n,t,r,i)})}function jU(n,e,t,r){let i=Ke(t);n.server_.onDisconnectPut(e.toString(),i.val(!0),(s,o)=>{s==="ok"&&jc(n.onDisconnect_,e,i),so(n,r,s,o)})}function Kie(n,e,t,r,i){let s=Ke(t,r);n.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&jc(n.onDisconnect_,e,s),so(n,i,o,a)})}function Qie(n,e,t,r){if(Sf(t)){kt("onDisconnect().update() called with empty data.  Don't do anything."),so(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(i,s)=>{i==="ok"&&Ot(t,(o,a)=>{let l=Ke(a);jc(n.onDisconnect_,je(e,o),l)}),so(n,r,i,s)})}function Yie(n,e,t){let r;oe(e._path)===".info"?r=SD(n.infoSyncTree_,e,t):r=SD(n.serverSyncTree_,e,t),Wq(n.eventQueue_,e._path,r)}function AD(n,e,t){let r;oe(e._path)===".info"?r=P_(n.infoSyncTree_,e,t):r=P_(n.serverSyncTree_,e,t),Wq(n.eventQueue_,e._path,r)}function Qq(n){n.persistentConnection_&&n.persistentConnection_.interrupt($q)}function Xie(n){n.persistentConnection_&&n.persistentConnection_.resume($q)}function $c(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),kt(t,...e)}function so(n,e,t,r){e&&Gc(()=>{if(t==="ok")e(null);else{let i=(t||"error").toUpperCase(),s=i;r&&(s+=": "+r);let o=new Error(s);o.code=i,e(o)}})}function Jie(n,e,t,r,i,s){$c(n,"transaction on "+e);let o={path:e,update:t,onComplete:r,status:null,order:rq(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=dR(n,e,void 0);o.currentInputSnapshot=a;let l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{rf("transaction failed: Data returned ",l,o.path),o.status=0;let c=K_(n.transactionQueueTree_,e),u=Ta(c)||[];u.push(o),lR(c,u);let h;typeof l=="object"&&l!==null&&qn(l,".priority")?(h=$i(l,".priority"),O(Qd(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(H_(n.serverSyncTree_,e)||re.EMPTY_NODE).getPriority().val();let d=of(n),f=Ke(l,h),g=oR(f,a,d);o.currentOutputSnapshotRaw=f,o.currentOutputSnapshotResolved=g,o.currentWriteId=J_(n);let y=nR(n.serverSyncTree_,e,g,o.currentWriteId,o.applyLocally);Mn(n.eventQueue_,e,y),Z_(n,n.transactionQueueTree_)}}function dR(n,e,t){return H_(n.serverSyncTree_,e,t)||re.EMPTY_NODE}function Z_(n,e=n.transactionQueueTree_){if(e||ev(n,e),Ta(e)){let t=Xq(n,e);O(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&Zie(n,nf(e),t)}else Uq(e)&&Q_(e,t=>{Z_(n,t)})}function Zie(n,e,t){let r=t.map(c=>c.currentWriteId),i=dR(n,e,r),s=i,o=i.hash();for(let c=0;c<t.length;c++){let u=t[c];O(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;let h=fn(e,u.path);s=s.updateChild(h,u.currentOutputSnapshotRaw)}let a=s.val(!0),l=e;n.server_.put(l.toString(),a,c=>{$c(n,"transaction put response",{path:l.toString(),status:c});let u=[];if(c==="ok"){let h=[];for(let d=0;d<t.length;d++)t[d].status=2,u=u.concat(Zs(n.serverSyncTree_,t[d].currentWriteId)),t[d].onComplete&&h.push(()=>t[d].onComplete(null,!0,t[d].currentOutputSnapshotResolved)),t[d].unwatcher();ev(n,K_(n.transactionQueueTree_,e)),Z_(n,n.transactionQueueTree_),Mn(n.eventQueue_,e,u);for(let d=0;d<h.length;d++)Gc(h[d])}else{if(c==="datastale")for(let h=0;h<t.length;h++)t[h].status===3?t[h].status=4:t[h].status=0;else{Xt("transaction at "+l.toString()+" failed: "+c);for(let h=0;h<t.length;h++)t[h].status=4,t[h].abortReason=c}qc(n,e)}},o)}function qc(n,e){let t=Yq(n,e),r=nf(t),i=Xq(n,t);return ese(n,i,r),r}function ese(n,e,t){if(e.length===0)return;let r=[],i=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let l=e[a],c=fn(t,l.path),u=!1,h;if(O(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)u=!0,h=l.abortReason,i=i.concat(Zs(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=qie)u=!0,h="maxretry",i=i.concat(Zs(n.serverSyncTree_,l.currentWriteId,!0));else{let d=dR(n,l.path,o);l.currentInputSnapshot=d;let f=e[a].update(d.val());if(f!==void 0){rf("transaction failed: Data returned ",f,l.path);let g=Ke(f);typeof f=="object"&&f!=null&&qn(f,".priority")||(g=g.updatePriority(d.getPriority()));let E=l.currentWriteId,I=of(n),C=oR(g,d,I);l.currentOutputSnapshotRaw=g,l.currentOutputSnapshotResolved=C,l.currentWriteId=J_(n),o.splice(o.indexOf(E),1),i=i.concat(nR(n.serverSyncTree_,l.path,C,l.currentWriteId,l.applyLocally)),i=i.concat(Zs(n.serverSyncTree_,E,!0))}else u=!0,h="nodata",i=i.concat(Zs(n.serverSyncTree_,l.currentWriteId,!0))}Mn(n.eventQueue_,t,i),i=[],u&&(e[a].status=2,function(d){setTimeout(d,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(h),!1,null))))}ev(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)Gc(r[a]);Z_(n,n.transactionQueueTree_)}function Yq(n,e){let t,r=n.transactionQueueTree_;for(t=oe(e);t!==null&&Ta(r)===void 0;)r=K_(r,t),e=Re(e),t=oe(e);return r}function Xq(n,e){let t=[];return Jq(n,e,t),t.sort((r,i)=>r.order-i.order),t}function Jq(n,e,t){let r=Ta(e);if(r)for(let i=0;i<r.length;i++)t.push(r[i]);Q_(e,i=>{Jq(n,i,t)})}function ev(n,e){let t=Ta(e);if(t){let r=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[r]=t[i],r++);t.length=r,lR(e,t.length>0?t:void 0)}Q_(e,r=>{ev(n,r)})}function fR(n,e){let t=nf(Yq(n,e)),r=K_(n.transactionQueueTree_,e);return xie(r,i=>{FA(n,i)}),FA(n,r),qq(r,i=>{FA(n,i)}),t}function FA(n,e){let t=Ta(e);if(t){let r=[],i=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(O(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(O(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(Zs(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?lR(e,void 0):t.length=s+1,Mn(n.eventQueue_,nf(e),i);for(let o=0;o<r.length;o++)Gc(r[o])}}function tse(n){let e="",t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let i=t[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function nse(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Xt(`Invalid query segment '${t}' in query '${n}'`)}return e}var DD=function(n,e){let t=rse(n),r=t.namespace;t.domain==="firebase.com"&&pi(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&pi("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||One();let i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new y_(t.host,t.secure,r,i,e,"",r!==t.subdomain),path:new Ce(t.pathString)}},rse=function(n){let e="",t="",r="",i="",s="",o=!0,a="https",l=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let u=n.indexOf("/");u===-1&&(u=n.length);let h=n.indexOf("?");h===-1&&(h=n.length),e=n.substring(0,Math.min(u,h)),u<h&&(i=tse(n.substring(u,h)));let d=nse(n.substring(Math.min(n.length,h)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;let f=e.slice(0,c);if(f.toLowerCase()==="localhost")t="localhost";else if(f.split(".").length<=2)t=f;else{let g=e.indexOf(".");r=e.substring(0,g).toLowerCase(),t=e.substring(g+1),s=r}"ns"in d&&(s=d.ns)}return{host:e,port:l,domain:t,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};var WU="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",ise=function(){let n=0,e=[];return function(t){let r=t===n;n=t;let i,s=new Array(8);for(i=7;i>=0;i--)s[i]=WU.charAt(t%64),t=Math.floor(t/64);O(t===0,"Cannot push at time == 0");let o=s.join("");if(r){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=WU.charAt(e[i]);return O(o.length===20,"nextPushId: Length should be 20."),o}}();var M_=class{constructor(e,t,r,i){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=i}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ut(this.snapshot.exportVal())}},F_=class{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var Yd=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return O(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var L_=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new Ct;return $ie(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Pn("OnDisconnect.remove",this._path);let e=new Ct;return jU(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Pn("OnDisconnect.set",this._path),mi("OnDisconnect.set",e,this._path,!1);let t=new Ct;return jU(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Pn("OnDisconnect.setWithPriority",this._path),mi("OnDisconnect.setWithPriority",e,this._path,!1),cR("OnDisconnect.setWithPriority",t,!1);let r=new Ct;return Kie(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){Pn("OnDisconnect.update",this._path),Gq("OnDisconnect.update",e,this._path,!1);let t=new Ct;return Qie(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var gn=class n{constructor(e,t,r,i){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=i}get key(){return ae(this._path)?null:WD(this._path)}get ref(){return new Fn(this._repo,this._path)}get _queryIdentifier(){let e=kU(this._queryParams),t=qD(e);return t==="{}"?"default":t}get _queryObject(){return kU(this._queryParams)}isEqual(e){if(e=de(e),!(e instanceof n))return!1;let t=this._repo===e._repo,r=HD(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+hre(this._path)}};function tv(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function ao(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===fi){let r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==no)throw new Error(r);if(typeof e!="string")throw new Error(i)}if(n.hasEnd()){if(n.getIndexEndName()!==qi)throw new Error(r);if(typeof t!="string")throw new Error(i)}}else if(n.getIndex()===Me){if(e!=null&&!Qd(e)||t!=null&&!Qd(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(O(n.getIndex()instanceof Ud||n.getIndex()===QD,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function nv(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var Fn=class n extends gn{constructor(e,t){super(e,t,new jd,!1)}get parent(){let e=gq(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},zc=class n{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new Ce(e),r=oo(this.ref,e);return new n(this._node.getChild(t),r,Me)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new n(i,oo(this.ref,r),Me)))}hasChild(e){let t=new Ce(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function pR(n,e){return n=de(n),n._checkNotDeleted("ref"),e!==void 0?oo(n._root,e):n._root}function gR(n,e){n=de(n),n._checkNotDeleted("refFromURL");let t=DD(e,n._repo.repoInfo_.nodeAdmin);jq("refFromURL",t);let r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&pi("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),pR(n,t.path.toString())}function oo(n,e){return n=de(n),oe(n._path)===null?Vie("child","path",e,!1):Hc("child","path",e,!1),new Fn(n._repo,je(n._path,e))}function Zq(n,e){n=de(n),Pn("push",n._path),mi("push",e,n._path,!0);let t=Kq(n._repo),r=ise(t),i=oo(n,r),s=oo(n,r),o;return e!=null?o=rv(s,e).then(()=>s):o=Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function e3(n){return Pn("remove",n._path),rv(n,null)}function rv(n,e){n=de(n),Pn("set",n._path),mi("set",e,n._path,!1);let t=new Ct;return hR(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function t3(n,e){n=de(n),Pn("setPriority",n._path),cR("setPriority",e,!1);let t=new Ct;return hR(n._repo,je(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function n3(n,e,t){if(Pn("setWithPriority",n._path),mi("setWithPriority",e,n._path,!1),cR("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let r=new Ct;return hR(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function r3(n,e){Gq("update",e,n._path,!1);let t=new Ct;return Wie(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function i3(n){n=de(n);let e=new Yd(()=>{}),t=new Xd(e);return jie(n._repo,n,t).then(r=>new zc(r,new Fn(n._repo,n._path),n._queryParams.getIndex()))}var Xd=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let r=t._queryParams.getIndex();return new M_("value",this,new zc(e.snapshotNode,new Fn(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new F_(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},B_=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new F_(this,e,t):null}createEvent(e,t){O(e.childName!=null,"Child events should have a childName.");let r=oo(new Fn(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new M_(e.type,this,new zc(e.snapshotNode,r,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function af(n,e,t,r,i){let s;if(typeof r=="object"&&(s=void 0,i=r),typeof r=="function"&&(s=r),i&&i.onlyOnce){let l=t,c=(u,h)=>{AD(n._repo,n,a),l(u,h)};c.userCallback=t.userCallback,c.context=t.context,t=c}let o=new Yd(t,s||void 0),a=e==="value"?new Xd(o):new B_(e,o);return Yie(n._repo,n,a),()=>AD(n._repo,n,a)}function iv(n,e,t,r){return af(n,"value",e,t,r)}function mR(n,e,t,r){return af(n,"child_added",e,t,r)}function yR(n,e,t,r){return af(n,"child_changed",e,t,r)}function _R(n,e,t,r){return af(n,"child_moved",e,t,r)}function vR(n,e,t,r){return af(n,"child_removed",e,t,r)}function ER(n,e,t){let r=null,i=t?new Yd(t):null;e==="value"?r=new Xd(i):e&&(r=new B_(e,i)),AD(n._repo,n,r)}var Ln=class{},V_=class extends Ln{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){mi("endAt",this._value,e._path,!0);let t=iD(e._queryParams,this._value,this._key);if(nv(t),ao(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new gn(e._repo,e._path,t,e._orderByCalled)}};function s3(n,e){return sf("endAt","key",e,!0),new V_(n,e)}var RD=class extends Ln{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){mi("endBefore",this._value,e._path,!1);let t=Nre(e._queryParams,this._value,this._key);if(nv(t),ao(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new gn(e._repo,e._path,t,e._orderByCalled)}};function o3(n,e){return sf("endBefore","key",e,!0),new RD(n,e)}var U_=class extends Ln{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){mi("startAt",this._value,e._path,!0);let t=rD(e._queryParams,this._value,this._key);if(nv(t),ao(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new gn(e._repo,e._path,t,e._orderByCalled)}};function a3(n=null,e){return sf("startAt","key",e,!0),new U_(n,e)}var ND=class extends Ln{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){mi("startAfter",this._value,e._path,!1);let t=Rre(e._queryParams,this._value,this._key);if(nv(t),ao(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new gn(e._repo,e._path,t,e._orderByCalled)}};function l3(n,e){return sf("startAfter","key",e,!0),new ND(n,e)}var kD=class extends Ln{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new gn(e._repo,e._path,Are(e._queryParams,this._limit),e._orderByCalled)}};function c3(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new kD(n)}var OD=class extends Ln{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new gn(e._repo,e._path,Dre(e._queryParams,this._limit),e._orderByCalled)}};function u3(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new OD(n)}var xD=class extends Ln{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){tv(e,"orderByChild");let t=new Ce(this._path);if(ae(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let r=new Ud(t),i=z_(e._queryParams,r);return ao(i),new gn(e._repo,e._path,i,!0)}};function h3(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Hc("orderByChild","path",n,!1),new xD(n)}var PD=class extends Ln{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){tv(e,"orderByKey");let t=z_(e._queryParams,fi);return ao(t),new gn(e._repo,e._path,t,!0)}};function d3(){return new PD}var MD=class extends Ln{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){tv(e,"orderByPriority");let t=z_(e._queryParams,Me);return ao(t),new gn(e._repo,e._path,t,!0)}};function f3(){return new MD}var FD=class extends Ln{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){tv(e,"orderByValue");let t=z_(e._queryParams,QD);return ao(t),new gn(e._repo,e._path,t,!0)}};function p3(){return new FD}var LD=class extends Ln{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(mi("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new V_(this._value,this._key)._apply(new U_(this._value,this._key)._apply(e))}};function g3(n,e){return sf("equalTo","key",e,!0),new LD(n,e)}function lr(n,...e){let t=de(n);for(let r of e)t=r._apply(t);return t}hie(Fn);mie(Fn);var sse="FIREBASE_DATABASE_EMULATOR_HOST",BD={},ose=!1;function ase(n,e,t,r){n.repoInfo_=new y_(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),r&&(n.authTokenProvider_=r)}function SR(n,e,t,r,i){let s=r||n.options.databaseURL;s===void 0&&(n.options.projectId||pi("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),kt("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=DD(s,i),a=o.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[sse]),c?(l=!0,s=`http://${c}?ns=${a.namespace}`,o=DD(s,i),a=o.repoInfo):l=!o.repoInfo.secure;let u=i&&l?new xd(xd.OWNER):new jA(n.name,n.options,e);jq("Invalid Firebase Database URL",o),ae(o.path)||pi("Database URL must point to the root of a Firebase Database (not including a child path).");let h=cse(a,n,u,new GA(n.name,t));return new VD(h,n)}function lse(n,e){let t=BD[e];(!t||t[n.key]!==n)&&pi(`Database ${e}(${n.repoInfo_}) has already been deleted.`),Qq(n),delete t[n.key]}function cse(n,e,t,r){let i=BD[e.name];i||(i={},BD[e.name]=i);let s=i[n.toURLString()];return s&&pi("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new ID(n,ose,t,r),i[n.toURLString()]=s,s}var VD=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(zie(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Fn(this._repo,Se())),this._rootInternal}_delete(){return this._rootInternal!==null&&(lse(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&pi("Cannot call "+e+" on a deleted database.")}};function m3(){pq.IS_TRANSPORT_INITIALIZED&&Xt("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function y3(){m3(),Bd.forceDisallow()}function _3(){m3(),Oc.forceDisallow(),Bd.forceAllow()}function v3(n,e,t,r={}){n=de(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&pi("Cannot call useEmulator() after instance has already been initialized.");let i=n._repoInternal,s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&pi('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new xd(xd.OWNER);else if(r.mockUserToken){let o=typeof r.mockUserToken=="string"?r.mockUserToken:_f(r.mockUserToken,n.app.options.projectId);s=new xd(o)}ase(i,e,t,s)}function E3(n){n=de(n),n._checkNotDeleted("goOffline"),Qq(n._repo)}function S3(n){n=de(n),n._checkNotDeleted("goOnline"),Xie(n._repo)}function C3(n,e){sq(n,e)}function use(n){jD(Tf),fo(new bn("database",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return SR(r,i,s,t)},"PUBLIC").setMultipleInstances(!0)),tn(mU,yU,n),tn(mU,yU,"esm2017")}var hse={".sv":"timestamp"};function w3(){return hse}function T3(n){return{".sv":{increment:n}}}var UD=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function b3(n,e,t){var r;if(n=de(n),Pn("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let i=(r=t?.applyLocally)!==null&&r!==void 0?r:!0,s=new Ct,o=(l,c,u)=>{let h=null;l?s.reject(l):(h=new zc(u,new Fn(n._repo,n._path),Me),s.resolve(new UD(c,h)))},a=iv(n,()=>{});return Jie(n._repo,n._path,e,o,a,i),s.promise}$D.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};$D.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};Hne(HU.default.Client);use("node");var dse="@firebase/database-compat",fse="1.0.4";var pse=new Ki("@firebase/database-compat"),I3=function(n){let e="FIREBASE WARNING: "+n;pse.warn(e)};var gse=function(n,e,t,r){if(!(r&&t===void 0)&&typeof t!="boolean")throw new Error(yn(n,e)+"must be a boolean.")},mse=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(yn(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var CR=class{constructor(e){this._delegate=e}cancel(e){X("OnDisconnect.cancel",0,1,arguments.length),yt("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),r=>e(r)),t}remove(e){X("OnDisconnect.remove",0,1,arguments.length),yt("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),r=>e(r)),t}set(e,t){X("OnDisconnect.set",1,2,arguments.length),yt("OnDisconnect.set","onComplete",t,!0);let r=this._delegate.set(e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){X("OnDisconnect.setWithPriority",2,3,arguments.length),yt("OnDisconnect.setWithPriority","onComplete",r,!0);let i=this._delegate.setWithPriority(e,t);return r&&i.then(()=>r(null),s=>r(s)),i}update(e,t){if(X("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,I3("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}yt("OnDisconnect.update","onComplete",t,!0);let r=this._delegate.update(e);return t&&r.then(()=>t(null),i=>t(i)),r}};var wR=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return X("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var ba=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return X("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return X("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return X("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return X("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return X("DataSnapshot.child",0,1,arguments.length),e=String(e),Hc("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return X("DataSnapshot.hasChild",1,1,arguments.length),Hc("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return X("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return X("DataSnapshot.forEach",1,1,arguments.length),yt("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return X("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return X("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return X("DataSnapshot.ref",0,0,arguments.length),new zi(this._database,this._delegate.ref)}get ref(){return this.getRef()}},sv=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,r,i){var s;X("Query.on",2,4,arguments.length),yt("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",r,i),a=(c,u)=>{t.call(o.context,new ba(this.database,c),u)};a.userCallback=t,a.context=o.context;let l=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return iv(this._delegate,a,l),t;case"child_added":return mR(this._delegate,a,l),t;case"child_removed":return vR(this._delegate,a,l),t;case"child_changed":return yR(this._delegate,a,l),t;case"child_moved":return _R(this._delegate,a,l),t;default:throw new Error(yn("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,r){if(X("Query.off",0,3,arguments.length),mse("Query.off",e,!0),yt("Query.off","callback",t,!0),Av("Query.off","context",r,!0),t){let i=()=>{};i.userCallback=t,i.context=r,ER(this._delegate,e,i)}else ER(this._delegate,e)}get(){return i3(this._delegate).then(e=>new ba(this.database,e))}once(e,t,r,i){X("Query.once",1,4,arguments.length),yt("Query.once","callback",t,!0);let s=n.getCancelAndContextArgs_("Query.once",r,i),o=new Ct,a=(c,u)=>{let h=new ba(this.database,c);t&&t.call(s.context,h,u),o.resolve(h)};a.userCallback=t,a.context=s.context;let l=c=>{s.cancel&&s.cancel.call(s.context,c),o.reject(c)};switch(e){case"value":iv(this._delegate,a,l,{onlyOnce:!0});break;case"child_added":mR(this._delegate,a,l,{onlyOnce:!0});break;case"child_removed":vR(this._delegate,a,l,{onlyOnce:!0});break;case"child_changed":yR(this._delegate,a,l,{onlyOnce:!0});break;case"child_moved":_R(this._delegate,a,l,{onlyOnce:!0});break;default:throw new Error(yn("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return X("Query.limitToFirst",1,1,arguments.length),new n(this.database,lr(this._delegate,c3(e)))}limitToLast(e){return X("Query.limitToLast",1,1,arguments.length),new n(this.database,lr(this._delegate,u3(e)))}orderByChild(e){return X("Query.orderByChild",1,1,arguments.length),new n(this.database,lr(this._delegate,h3(e)))}orderByKey(){return X("Query.orderByKey",0,0,arguments.length),new n(this.database,lr(this._delegate,d3()))}orderByPriority(){return X("Query.orderByPriority",0,0,arguments.length),new n(this.database,lr(this._delegate,f3()))}orderByValue(){return X("Query.orderByValue",0,0,arguments.length),new n(this.database,lr(this._delegate,p3()))}startAt(e=null,t){return X("Query.startAt",0,2,arguments.length),new n(this.database,lr(this._delegate,a3(e,t)))}startAfter(e=null,t){return X("Query.startAfter",0,2,arguments.length),new n(this.database,lr(this._delegate,l3(e,t)))}endAt(e=null,t){return X("Query.endAt",0,2,arguments.length),new n(this.database,lr(this._delegate,s3(e,t)))}endBefore(e=null,t){return X("Query.endBefore",0,2,arguments.length),new n(this.database,lr(this._delegate,o3(e,t)))}equalTo(e,t){return X("Query.equalTo",1,2,arguments.length),new n(this.database,lr(this._delegate,g3(e,t)))}toString(){return X("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return X("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(X("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,r){let i={cancel:void 0,context:void 0};if(t&&r)i.cancel=t,yt(e,"cancel",i.cancel,!0),i.context=r,Av(e,"context",i.context,!0);else if(t)if(typeof t=="object"&&t!==null)i.context=t;else if(typeof t=="function")i.cancel=t;else throw new Error(yn(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return i}get ref(){return new zi(this.database,new Fn(this._delegate._repo,this._delegate._path))}},zi=class n extends sv{constructor(e,t){super(e,new gn(t._repo,t._path,new jd,!1)),this.database=e,this._delegate=t}getKey(){return X("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return X("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,oo(this._delegate,e))}getParent(){X("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return X("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){X("Reference.set",1,2,arguments.length),yt("Reference.set","onComplete",t,!0);let r=rv(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}update(e,t){if(X("Reference.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,I3("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Pn("Reference.update",this._delegate._path),yt("Reference.update","onComplete",t,!0);let r=r3(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){X("Reference.setWithPriority",2,3,arguments.length),yt("Reference.setWithPriority","onComplete",r,!0);let i=n3(this._delegate,e,t);return r&&i.then(()=>r(null),s=>r(s)),i}remove(e){X("Reference.remove",0,1,arguments.length),yt("Reference.remove","onComplete",e,!0);let t=e3(this._delegate);return e&&t.then(()=>e(null),r=>e(r)),t}transaction(e,t,r){X("Reference.transaction",1,3,arguments.length),yt("Reference.transaction","transactionUpdate",e,!1),yt("Reference.transaction","onComplete",t,!0),gse("Reference.transaction","applyLocally",r,!0);let i=b3(this._delegate,e,{applyLocally:r}).then(s=>new wR(s.committed,new ba(this.database,s.snapshot)));return t&&i.then(s=>t(null,s.committed,s.snapshot),s=>t(s,!1,null)),i}setPriority(e,t){X("Reference.setPriority",1,2,arguments.length),yt("Reference.setPriority","onComplete",t,!0);let r=t3(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}push(e,t){X("Reference.push",0,2,arguments.length),yt("Reference.push","onComplete",t,!0);let r=Zq(this._delegate,e),i=r.then(o=>new n(this.database,o));t&&i.then(()=>t(null),o=>t(o));let s=new n(this.database,r);return s.then=i.then.bind(i),s.catch=i.catch.bind(i,void 0),s}onDisconnect(){return Pn("Reference.onDisconnect",this._delegate._path),new CR(new L_(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var Ia=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:y3,forceLongPolling:_3}}useEmulator(e,t,r={}){v3(this._delegate,e,t,r)}ref(e){if(X("database.ref",0,1,arguments.length),e instanceof zi){let t=gR(this._delegate,e.toString());return new zi(this,t)}else{let t=pR(this._delegate,e);return new zi(this,t)}}refFromURL(e){X("database.refFromURL",1,1,arguments.length);let r=gR(this._delegate,e);return new zi(this,r)}goOffline(){return X("database.goOffline",0,0,arguments.length),E3(this._delegate)}goOnline(){return X("database.goOnline",0,0,arguments.length),S3(this._delegate)}};Ia.ServerValue={TIMESTAMP:w3(),increment:n=>T3(n)};function yse({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:i,namespace:s,nodeAdmin:o=!1}){jD(t);let a=new Dv("database-standalone"),l=new Cf("auth-internal",a);l.setComponent(new bn("auth-internal",()=>r,"PRIVATE"));let c;return i&&(c=new Cf("app-check-internal",a),c.setComponent(new bn("app-check-internal",()=>i,"PRIVATE"))),{instance:new Ia(SR(n,l,c,e,o),n),namespace:s}}var _se=Object.freeze({__proto__:null,initStandalone:yse});var vse=Ia.ServerValue;function Ese(n){n.INTERNAL.registerComponent(new bn("database-compat",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app-compat").getImmediate(),i=e.getProvider("database").getImmediate({identifier:t});return new Ia(i,r)},"PUBLIC").setServiceProps({Reference:zi,Query:sv,Database:Ia,DataSnapshot:ba,enableLogging:C3,INTERNAL:_se,ServerValue:vse}).setMultipleInstances(!0)),n.registerVersion(dse,fse,"node")}Ese(zt);function lf(n,e,t="on",r=Da){return new Rr(i=>{let s=null;return s=n[t](e,(o,a)=>{r.schedule(()=>{i.next({snapshot:o,prevKey:a})}),t==="once"&&r.schedule(()=>i.complete())},o=>{r.schedule(()=>i.error(o))}),t==="on"?{unsubscribe(){s!=null&&n.off(e,s)}}:{unsubscribe(){}}}).pipe(ke(i=>{let{snapshot:s,prevKey:o}=i,a=null;return s.exists()&&(a=s.key),{type:e,payload:s,prevKey:o,key:a}}),DR())}function Sse(n){return typeof n=="string"}function Cse(n){return typeof n.exportVal=="function"}function k3(n){return n==null}function O3(n){return typeof n.set=="function"}function A3(n,e){return O3(e)?e:n.ref(e)}function x3(n,e){if(Sse(n))return e.stringCase();if(O3(n))return e.firebaseCase();if(Cse(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function P3(n){return(k3(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function M3(n,e,t){e=P3(e);let r=e.map(i=>lf(n,i,"on",t));return Kc(...r)}function wse(n,e,t){let r=M3(n,e).pipe(co((i,s)=>[...i,s],[]));return bse(n,r,t)}function Tse(n,e){return lf(n,"value","on",e).pipe(ke(t=>{let r;return t.payload.forEach(i=>(r=i.key,!1)),{data:t,lastKeyToLoad:r}}))}function bse(n,e,t){return Tse(n,t).pipe(kR(e),ke(([i,s])=>{let o=i.lastKeyToLoad,a=s.map(l=>l.key);return{actions:s,lastKeyToLoad:o,loadedKeys:a}}),RR(i=>i.loadedKeys.indexOf(i.lastKeyToLoad)===-1),ke(i=>i.actions))}function D3(n,e){return function(r,i){return x3(r,{stringCase:()=>n.child(r)[e](i),firebaseCase:()=>r[e](i),snapshotCase:()=>r.ref[e](i)})}}function Ise(n){return function(t){return t?x3(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function Ase(n,e,t){return lf(n,"value","once",t).pipe(yi(r=>{let i=[wn(r)];return e.forEach(s=>i.push(lf(n,s,"on",t))),Kc(...i).pipe(co(Rse,[]))}),hf())}function F3(n,e){let t=n.length;for(let r=0;r<t;r++)if(n[r].payload.key===e)return r;return-1}function Dse(n,e){if(k3(e))return 0;{let t=F3(n,e);return t===-1?n.length:t+1}}function Rse(n,e){let{payload:t,prevKey:r,key:i}=e,s=F3(n,i),o=Dse(n,r);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(l=>{let c={payload:l,type:"value",prevKey:a,key:l.key};return a=l.key,n=[...n,c],!1})}return n;case"child_added":if(s>-1)(n[s-1]?.key||null)!==r&&(n=n.filter(l=>l.payload.key!==t.key),n.splice(o,0,e));else{if(r==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===i?e:a);case"child_moved":if(s>-1){let a=n.splice(s,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function R3(n,e,t){return e=P3(e),Ase(n,e,t)}function Nse(n,e){let t=e.schedulers.outsideAngular,r=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:D3(r,"update"),set:D3(r,"set"),push:i=>r.push(i),remove:Ise(r),snapshotChanges(i){return R3(n,i,t).pipe(Xe)},stateChanges(i){return M3(n,i,t).pipe(Xe)},auditTrail(i){return wse(n,i,t).pipe(Xe)},valueChanges(i,s){return R3(n,i,t).pipe(ke(a=>a.map(l=>s&&s.idField?Bn(mt({},l.payload.val()),{[s.idField]:l.key}):l.payload.val())),Xe)}}}function N3(n,e){return function(){return lf(n,"value","on",e)}}function kse(n,e){return{query:n,snapshotChanges(){return N3(n,e.schedulers.outsideAngular)().pipe(Xe)},update(t){return n.ref.update(t)},set(t){return n.ref.set(t)},remove(){return n.ref.remove()},valueChanges(){return N3(n,e.schedulers.outsideAngular)().pipe(Xe,ke(r=>r.payload.exists()?r.payload.val():null))}}}var Ose=new Ie("angularfire2.realtimeDatabaseURL"),xse=new Ie("angularfire2.database.use-emulator"),ov=(()=>{class n{schedulers;database;constructor(t,r,i,s,o,a,l,c,u,h,d,f,g,y,E){this.schedulers=a;let I=l,C=sa(t,o,r);c&&md(C,o,u,d,f,g,h,y),this.database=wc(`${C.name}.database.${i}`,"AngularFireDatabase",C.name,()=>{let N=o.runOutsideAngular(()=>C.database(i||void 0));return I&&N.useEmulator(...I),N},[I])}list(t,r){let i=this.schedulers.ngZone.runOutsideAngular(()=>A3(this.database,t)),s=i;return r&&(s=r(i)),Nse(s,this)}object(t){let r=this.schedulers.ngZone.runOutsideAngular(()=>A3(this.database,t));return kse(r,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(r){return new(r||n)(G(Ks),G(Qs,8),G(Ose,8),G(Wi),G(Un),G(Si),G(xse,8),G(Gy,8),G(ud,8),G(hd,8),G(dd,8),G(fd,8),G(pd,8),G(gd,8),G(Gn,8))};static \u0275prov=Et({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var B3=(()=>{let e=class e{constructor(r){this.db=r}getEmpleadoPorNombre(r){return this.db.object(`DatosDue\xF1os/${r}`).valueChanges()}};e.\u0275fac=function(i){return new(i||e)(G(ov))},e.\u0275prov=Et({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var V3=(()=>{let e=class e{constructor(r,i){this.route=r,this.empleadoService=i}ngOnInit(){this.route.params.subscribe(r=>{let i=r.nombre;this.getEmpleadoPorNombre(i)})}getEmpleadoPorNombre(r){this.empleadoService.getEmpleadoPorNombre(r).subscribe(i=>{this.empleado=i},i=>{console.error("Error al obtener empleado:",i)})}};e.\u0275fac=function(i){return new(i||e)(te(GR),te(B3))},e.\u0275cmp=Vn({type:e,selectors:[["app-lista-empleados"]],decls:42,vars:7,consts:[[1,"container","mt-4"],[1,"card"],[1,"card-body","d-flex","justify-content-between","align-items-center"],[1,"h3"],[1,"table","table-striped","mt-3"],["scope","row"]],template:function(i,s){i&1&&(Q(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),se(4,"Detalles del Empleado"),Y()(),Q(5,"table",4)(6,"tbody")(7,"tr")(8,"th",5),se(9,"Nombre"),Y(),Q(10,"td"),se(11),Y()(),Q(12,"tr")(13,"th",5),se(14,"Direcci\xF3n"),Y(),Q(15,"td"),se(16),Y()(),Q(17,"tr")(18,"th",5),se(19,"Email"),Y(),Q(20,"td"),se(21),Y()(),Q(22,"tr")(23,"th",5),se(24,"Nombre Perro"),Y(),Q(25,"td"),se(26),Y()(),Q(27,"tr")(28,"th",5),se(29,"Raza Perro"),Y(),Q(30,"td"),se(31),Y()(),Q(32,"tr")(33,"th",5),se(34,"Edad Perro"),Y(),Q(35,"td"),se(36),Y()(),Q(37,"tr")(38,"th",5),se(39,"Ruta de Imagen"),Y(),Q(40,"td"),se(41),Y()()()()()()),i&2&&(We(11),Or(s.empleado==null?null:s.empleado.nombre),We(5),Or(s.empleado==null?null:s.empleado.direccion),We(5),Or(s.empleado==null?null:s.empleado.email),We(5),Or(s.empleado==null?null:s.empleado.fechaini),We(5),Or(s.empleado==null?null:s.empleado.fechafin),We(5),Or(s.empleado==null?null:s.empleado.descripcion),We(5),Or(s.empleado==null?null:s.empleado.rutaImagen))},styles:[".card-body[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px}td[_ngcontent-%COMP%]{padding:12px;text-align:left}"]});let n=e;return n})();var U3=(()=>{let e=class e{constructor(r){this.db=r,this.dbPath="/Datos Cuidadores"}agregarEmpleado(r){let i=this.db.createPushId();return this.db.list(this.dbPath).set(i,r)}getEmpleados3(){return this.db.list(this.dbPath).snapshotChanges().pipe(ke(r=>r.map(i=>mt({id:i.payload.key},i.payload.val()))))}eliminarEmpleado3(r){return this.db.list(this.dbPath).remove(r)}};e.\u0275fac=function(i){return new(i||e)(G(ov))},e.\u0275prov=Et({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var q3=n=>["/lista-empleados",n];function Fse(n,e){n&1&&(Q(0,"h5",16),se(1,"NO HAY DATOS PARA MOSTRAR"),Y())}function Lse(n,e){if(n&1){let t=MR();Q(0,"tr")(1,"td",21)(2,"a",22),se(3),Y()(),Q(4,"td",23)(5,"a",24),en("click",function(){let i=OR(t).$implicit,s=Zc(2);return xR(s.eliminarEmpleado(i.id))}),mn(6,"img",25),Y(),Q(7,"a",26),mn(8,"img",27),Y()()()}if(n&2){let t=e.$implicit;We(2),cr("routerLink",yv(3,q3,t.nombre)),We(),Or(t.nombre),We(4),cr("routerLink",yv(5,q3,t.nombre))}}function Bse(n,e){if(n&1&&(Q(0,"table",17)(1,"thead")(2,"tr")(3,"th",18),se(4,"Nombre"),Y(),Q(5,"th",19),se(6,"Acciones"),Y()()(),Q(7,"tbody"),Hi(8,Lse,9,7,"tr",20),Y()()),n&2){let t=Zc();We(8),cr("ngForOf",t.empleadosFiltrados)}}var z3=(()=>{let e=class e{constructor(r,i){this._empleadoService=r,this._empleadoService3=i,this.empleados=[],this.empleadosFiltrados=[],this.role="owner"}ngOnInit(){this.getEmpleadosDue\u00F1o()}onRoleChange(r){this.role=r.target.value,this.role==="owner"?this.getEmpleadosDue\u00F1o():this.getEmpleadosCuidador()}getEmpleadosDue\u00F1o(){this._empleadoService.getEmpleados().subscribe(r=>{this.empleados=r.map(i=>mt({id:i.payload.doc.id},i.payload.doc.data())),this.empleadosFiltrados=this.empleados,console.log("Empleados en la colecci\xF3n (Due\xF1os):",this.empleados)},r=>{console.error("Error al obtener empleados (Due\xF1os):",r)})}getEmpleadosCuidador(){this._empleadoService3.getEmpleados3().subscribe(r=>{this.empleados=r,this.empleadosFiltrados=this.empleados,console.log("Empleados en la colecci\xF3n (Cuidadores):",this.empleados)},r=>{console.error("Error al obtener empleados (Cuidadores):",r)})}eliminarEmpleado(r){this.role==="owner"?this._empleadoService.eliminarEmpleado(r).then(()=>{console.log("Empleado eliminado con \xE9xito"),this.showNotification("Empleado eliminado correctamente"),this.getEmpleadosDue\u00F1o()}).catch(i=>{console.error("Error al eliminar empleado:",i)}):this._empleadoService3.eliminarEmpleado3(r).then(()=>{console.log("Empleado eliminado con \xE9xito"),this.showNotification("Empleado eliminado correctamente"),this.getEmpleadosCuidador()}).catch(i=>{console.error("Error al eliminar empleado:",i)})}showNotification(r){let i=document.getElementById("notification-message");i&&(i.textContent=r,this.showNotificationElement(),setTimeout(()=>{this.hideNotificationElement()},4e3))}showNotificationElement(){let r=document.getElementById("notification");r&&r.classList.add("show")}hideNotificationElement(){let r=document.getElementById("notification");r&&(r.classList.remove("show"),r.classList.add("hide"),setTimeout(()=>{r.classList.remove("hide")},300))}buscarEmpleado(r){r?this.empleadosFiltrados=this.empleados.filter(i=>i.nombre.toLowerCase().includes(r.toLowerCase())):this.empleadosFiltrados=this.empleados}onBuscarEmpleado(r){let i=r.target.value;this.buscarEmpleado(i)}};e.\u0275fac=function(i){return new(i||e)(te(Xy),te(U3))},e.\u0275cmp=Vn({type:e,selectors:[["tabla-empleados"]],decls:20,vars:2,consts:[[1,"container","mt-4"],[1,"card"],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"h3"],["id","role-selector",1,"form-select",3,"change"],["value","owner","selected",""],["value","caretaker"],[1,"card-body"],["class","no-data",4,"ngIf"],[1,"input-group","mb-3"],["type","text","placeholder","Buscar por nombre...",1,"form-control",3,"input"],["routerLink","/crear-empleados",1,"btn","btn-dark"],[1,"table-responsive"],["class","table table-striped mt-3",4,"ngIf"],["id","notification",1,"notification"],["id","notification-message"],[1,"no-data"],[1,"table","table-striped","mt-3"],["scope","col",1,"nombre"],["scope","col",1,"acciones"],[4,"ngFor","ngForOf"],[1,"nombre"],[3,"routerLink"],[1,"acciones"],[1,"action-icon",2,"cursor","pointer",3,"click"],["src","assets/iconos/eliminar.ico","alt","Icono Eliminar"],[1,"action-icon",3,"routerLink"],["src","assets/iconos/ver.ico","alt","Icono Ver Detalles"]],template:function(i,s){i&1&&(Q(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),se(4,"LISTA CUIDADORES"),Y(),Q(5,"select",4),en("change",function(a){return s.onRoleChange(a)}),Q(6,"option",5),se(7,"Due\xF1o"),Y(),Q(8,"option",6),se(9,"Cuidador"),Y()()(),Q(10,"div",7),Hi(11,Fse,2,0,"h5",8),Q(12,"div",9)(13,"input",10),en("input",function(a){return s.onBuscarEmpleado(a)}),Y(),Q(14,"button",11),se(15,"Agregar"),Y()(),Q(16,"div",12),Hi(17,Bse,9,1,"table",13),Y()()()(),Q(18,"div",14),mn(19,"span",15),Y()),i&2&&(We(11),cr("ngIf",s.empleados.length==0),We(6),cr("ngIf",s.empleados.length>0))},dependencies:[UR,Na,mf,P1,F1],styles:[".card-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid #e9ecef}.card-header[_ngcontent-%COMP%]   .h3[_ngcontent-%COMP%]{margin:0}.no-data[_ngcontent-%COMP%]{margin-top:15px;color:brown;text-align:center}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{flex-grow:1}.input-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{flex-shrink:0}.table[_ngcontent-%COMP%]{margin-top:20px}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}.table-striped[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-of-type(odd){background-color:#0000000d}.table-hover[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#0000001a}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   .nombre[_ngcontent-%COMP%]{padding-left:200px}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   .acciones[_ngcontent-%COMP%]{padding-right:30px}.nombre[_ngcontent-%COMP%]{padding-left:200px}.action-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:20px;height:20px;margin-right:10px}.notification[_ngcontent-%COMP%]{display:none;position:fixed;bottom:20px;right:20px;padding:15px;background-color:#ba1d1d;color:#fff;border-radius:5px;box-shadow:0 2px 5px #0003;transition:opacity .3s ease}.notification.show[_ngcontent-%COMP%]{display:block;opacity:1}.notification.hide[_ngcontent-%COMP%]{opacity:0;transition:opacity .3s ease}"]});let n=e;return n})();var G3=(()=>{let e=class e{constructor(){}login(r,i){return r==="diego"&&i==="123456"?wn(!0):wn(!1)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=Et({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function Use(n,e){if(n&1&&(Q(0,"div",9)(1,"span"),se(2,"!"),Y(),se(3),mn(4,"img",10),Y()),n&2){let t=Zc();We(3),FR(" ",t.errorMessage," ")}}var j3=(()=>{let e=class e{constructor(r,i){this.router=r,this.authService=i,this.username="",this.password="",this.errorMessage=""}onSubmit(){if(!this.username||!this.password){this.errorMessage="Ingrese el nombre de usuario y la contrase\xF1a.";return}let r=this.sanitizeInput(this.username),i=this.sanitizeInput(this.password);this.authService.login(r,i).subscribe(s=>{s?(this.router.navigate(["/tabla-empleados"]),console.log("Sesi\xF3n iniciada correctamente")):(console.log("Credenciales incorrectas"),this.errorMessage="Credenciales incorrectas")},s=>{console.log("Error al autenticar:",s)})}sanitizeInput(r){return r.replace(/[^a-zA-Z0-9]/g,"")}};e.\u0275fac=function(i){return new(i||e)(te(WR),te(G3))},e.\u0275cmp=Vn({type:e,selectors:[["app-login"]],decls:17,vars:3,consts:[[1,"login-box"],[1,"photo-container"],["src","../../../assets/iconos/perro3.png","alt","Foto de perfil",2,"width","160px","height","160px"],[3,"submit"],[1,"user-box"],["type","text","name","username","required","",3,"ngModelChange","ngModel"],["type","password","name","password","required","",3,"ngModelChange","ngModel"],["type","submit"],["class","error-msg",4,"ngIf"],[1,"error-msg"],["src","../../../assets/iconos/exclamacion.png","alt","Error",1,"error-icon"]],template:function(i,s){i&1&&(Q(0,"div",0)(1,"div",1),mn(2,"img",2),Y(),Q(3,"h2"),se(4,"Login"),Y(),Q(5,"form",3),en("submit",function(){return s.onSubmit()}),Q(6,"div",4)(7,"input",5),mv("ngModelChange",function(a){return gv(s.username,a)||(s.username=a),a}),Y(),Q(8,"label"),se(9,"Username"),Y()(),Q(10,"div",4)(11,"input",6),mv("ngModelChange",function(a){return gv(s.password,a)||(s.password=a),a}),Y(),Q(12,"label"),se(13,"Password"),Y()(),Q(14,"button",7),se(15," Submit "),Y()(),Hi(16,Use,5,1,"div",8),Y()),i&2&&(We(7),pv("ngModel",s.username),We(4),pv("ngModel",s.password),We(5),cr("ngIf",s.errorMessage))},dependencies:[Na,Uf,La,Ff,Lf,zv,Bv,Lv],styles:['html[_ngcontent-%COMP%]{height:100%}body[_ngcontent-%COMP%]{margin:0;padding:0;font-family:sans-serif;background:linear-gradient(#141e30,#243b55)}.login-box[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;width:400px;padding:40px;transform:translate(-50%,-50%);background:rgba(0,0,0,.5);box-sizing:border-box;box-shadow:0 15px 25px #0009;border-radius:10px}.login-box[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 30px;padding:0;color:#fff;text-align:center}.login-box[_ngcontent-%COMP%]   .user-box[_ngcontent-%COMP%]{position:relative}.login-box[_ngcontent-%COMP%]   .user-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:10px 0;font-size:16px;color:#fff;margin-bottom:30px;border:none;border-bottom:1px solid #fff;outline:none;background:transparent}.login-box[_ngcontent-%COMP%]   .user-box[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{position:absolute;top:0;left:0;padding:10px 0;font-size:16px;color:#fff;pointer-events:none;transition:.5s}.login-box[_ngcontent-%COMP%]   .user-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus ~ label[_ngcontent-%COMP%], .login-box[_ngcontent-%COMP%]   .user-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:valid ~ label[_ngcontent-%COMP%]{top:-20px;left:0;color:#03e9f4;font-size:12px}.login-box[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{position:relative;display:inline-block;padding:10px 20px;color:#03e9f4;font-size:16px;text-decoration:none;text-transform:uppercase;overflow:hidden;transition:.5s;margin-top:40px;letter-spacing:4px}.login-box[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;display:block}.login-box[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{position:relative;display:inline-block;padding:10px 20px;color:#03e9f4;font-size:16px;text-decoration:none;text-transform:uppercase;overflow:hidden;transition:.5s;letter-spacing:4px;border:none;background-color:transparent;cursor:pointer}.login-box[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;width:0;height:100%;background:linear-gradient(90deg,transparent,#03e9f4);transition:width .5s,height .5s,left .5s,top .5s;z-index:-1}.login-box[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:before, .login-box[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:active:before{width:100%;height:100%;left:0;top:0}.error[_ngcontent-%COMP%]{background-color:red}.error-msg[_ngcontent-%COMP%]{color:red;font-size:15px;font-weight:700;margin-bottom:10px}.photo-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.error-icon[_ngcontent-%COMP%]{width:20px;height:20px;margin-left:10px}.error-msg[_ngcontent-%COMP%]{display:flex;align-items:center}']});let n=e;return n})();var qse=[{path:"tabla-empleados",component:z3},{path:"crear-empleados",component:OB},{path:"lista-empleados/:nombre",component:V3},{path:"login",component:j3},{path:"",redirectTo:"login",pathMatch:"full"},{path:"**",redirectTo:"tabla-empleados",pathMatch:"full"}],W3=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Mt({type:e}),e.\u0275inj=Pt({imports:[Cv.forRoot(qse),Cv]});let n=e;return n})();var H3=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Vn({type:e,selectors:[["app-navbar"]],decls:4,vars:0,consts:[["data-bs-theme","dark",1,"navbar","bg-dark","border-bottom","border-body"],[1,"container-fluid"],[1,"navbar-brand","mb-0","h1"]],template:function(i,s){i&1&&(Q(0,"nav",0)(1,"div",1)(2,"span",2),se(3,"Mi-Mascota Perruna"),Y()()())},styles:[".container-fluid[_ngcontent-%COMP%]{display:flex;justify-content:center}"]});let n=e;return n})();var av=(()=>{let e=class e{constructor(){this.title="empleados"}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Vn({type:e,selectors:[["app-root"]],decls:2,vars:0,template:function(i,s){i&1&&mn(0,"app-navbar")(1,"router-outlet")},dependencies:[jR,H3]});let n=e;return n})();var $3={production:!1,firebase:{apiKey:"AIzaSyA_SM6d1nCztP2JON5DHytWOOWs7Jl_Ff4",authDomain:"perruna-cd211.firebaseapp.com",databaseURL:"https://perruna-cd211-default-rtdb.firebaseio.com",projectId:"perruna-cd211",storageBucket:"perruna-cd211.appspot.com",messagingSenderId:"796763331783",appId:"1:796763331783:web:2fd75de7e305206f66b2e2",measurementId:"G-RHB6WS2L9H"}};var K3=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Mt({type:e,bootstrap:[av]}),e.\u0275inj=Pt({imports:[qR,W3,U1,V1,lB.initializeApp($3.firebase),iB(()=>sB())]});let n=e;return n})();var Gse=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Mt({type:e,bootstrap:[av]}),e.\u0275inj=Pt({imports:[K3,zR]});let n=e;return n})();export{hi as a,Gse as b};
